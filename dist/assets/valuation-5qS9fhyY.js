var e=(1+Math.sqrt(5))/2,t=44,n=11,r=t*n,i=17491.270421,a=e,o=1/e,s={low:1-1/e**6,med:1,high:1+1/e**6},c=1/e**6,l=1/e**5,u=1/e**3,d=1/e**4,f=1+1/e**4,p=.7,m=.3,ee=1/m,h=1/e**6,g=1/e**6,_=.15,v=1/e**5,y=1+1/e**3,b=1/e**5,x=i,S=1/e**7,C=1/e**7,w=1/e**8,T=1/e,E=1/e**2,D=1/e**2,O=1/e**3,te=1/e**4,k=1/e**4,ne=1/e**5,re=1/e**6,ie=1/e**5,A=i*365,ae=A,oe=1/e**3,se=1/e**2,ce=1/e**4,le=1/e**6,ue=1/e**7,de=1/e**8,fe=1/e**8,j=1/e**9,pe=1/e**4,M=1/e,me={RARITY_ONE_OF_ONE:a,RARITY_EXP:o,QUALITY_MAP:s,CREATOR_VERIFIED_LIFT:c,CREATOR_REP_MAX:l,PROV_LOG_SLOPE:u,HOLD_SLOPE:d,HOLD_CAP:f,CLOSURE_CENTER:p,CLOSURE_RANGE:m,CLOSURE_GAIN:h,CADENCE_GAIN:g,CHURN_KAPPA:_,AGE_EPS:v,AGE_CAP:y,RESONANCE_GAIN:b,DISCOUNT_PULSE_HALFSPAN:x,GEOM_EDGE_GAIN:S,GEOM_PHI_GAIN:C,GEOM_PRIME_GAIN:w,MOMENT_FIB_EXACT_GAIN:T,MOMENT_LUCAS_EXACT_GAIN:E,MOMENT_PHI_TRANSITION_GAIN:D,MOMENT_UNIFORM_GAIN:O,MOMENT_PAL_GAIN:te,MOMENT_RUN_GAIN:k,MOMENT_SEQ_GAIN:ne,MOMENT_LOW_ENTROPY_GAIN:re,GENESIS_BIAS_GAIN:ie,YEAR_PULSES_APPROX:A,ADOPTION_TAU_PULSES:ae,ADOPTION_GAIN_BASE:oe,ADOPTION_GAIN_RARE:se,INDEX_SCARCITY_GAIN:ce,FIB_STEP_GAIN:le,LUCAS_STEP_GAIN:ue,BREATH_WAVE_GAIN:de,DAY_WAVE_GAIN:fe,STROBE_WAVE_GAIN:j,MOMENT_AFFINITY_GAIN_BASE:pe,MOMENT_AFFINITY_DIGIT_WEIGHT:M,DEFAULT_STEPS_PER_BEAT:t,PULSES_PER_STEP:n,PULSES_PER_BEAT_CANON:r,PULSES_PER_DAY_EXACT:i,PHI:e};function N(e){if(e===null)return`null`;switch(typeof e){case`string`:case`number`:case`boolean`:return JSON.stringify(e);case`object`:{if(Array.isArray(e))return`[`+e.map(N).join(`,`)+`]`;let t=e;return`{`+Object.keys(t).sort().map(e=>JSON.stringify(e)+`:`+N(t[e])).join(`,`)+`}`}default:return`null`}}function he(e){return N(e)}function ge(){let e=`val-policy:`+he(me),t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=t+((t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24))>>>0;return(`00000000`+(t>>>0).toString(16)).slice(-8)}var _e=ge(),P=(e,t,n)=>Math.max(t,Math.min(n,e)),F=e=>Math.log(1+Math.max(0,e)),I=e=>e-Math.floor(e);function ve(e){if(!e.length)return 0;let t=e.slice().sort((e,t)=>e-t),n=Math.floor(t.length/2);return t.length%2?t[n]:(t[n-1]+t[n])/2}function ye(e){let t=new Set;for(let n of e)n.receiverSignature&&t.add(n.receiverSignature);return Math.max(t.size,1)}function be(e){return e.filter(e=>e.receiverSignature&&e.receiverKaiPulse!=null)}function xe(e){if(e.length<2)return[];let t=[];for(let n=1;n<e.length;n++){let r=e[n-1].senderKaiPulse,i=e[n].senderKaiPulse;Number.isFinite(r)&&Number.isFinite(i)&&i>=r&&t.push(i-r)}return t}function Se(e){if(e.length===0)return 1;let t=ve(e)||1,n=0;for(let r of e)n+=Math.abs(r-t)/t;return 1/(1+n/e.length)}function Ce(e,t){let n=e?.expectedCashflowPhi?.map(e=>({atPulse:e.atPulse,amount:e.amountPhi}))??[],r=e?.expectedCashflowKS?.map(e=>({atPulse:e.atPulse,amount:e.amountKS}))??[];return[...n,...r].reduce((e,n)=>{let r=n.atPulse-t,i=1/(1+Math.max(0,r)/x);return e+n.amount*i},0)}function we(t){if(!t||!Number.isFinite(t)||t<=0)return .5;let n=Math.log(t)/Math.log(e);return .5+.5*P(1-2*Math.abs(n-Math.round(n)),0,1)}function Te(e){if(typeof e!=`number`||!Number.isFinite(e)||e<2)return!1;let t=Math.floor(e);if(t%2==0)return t===2;for(let e=3;e*e<=t;e+=2)if(t%e===0)return!1;return!0}function Ee(e,t,n){let r=1;if(typeof e.stepIndex==`number`&&(e.stepIndex===0||e.stepIndex===(t>0?t-1:-1))&&(r*=1+S),Te(e.beat)&&(r*=1+w),n>.9){let e=(n-.9)/.1;r*=1+C*P(e,0,1)}return r}function De(e){if(e<0n)throw Error(`sqrt of negative`);if(e<2n)return e;let t=e,n=(e>>1n)+1n;for(;n<t;)t=n,n=n+e/n>>1n;return t}function Oe(e){if(e<0n)return!1;let t=De(e);return t*t===e}var ke=new Map;function L(e){if(!Number.isFinite(e)||e<0)return!1;let t=Math.trunc(Math.abs(e)),n=ke.get(t);if(n!==void 0)return n;let r=BigInt(t),i=5n*r*r+4n,a=5n*r*r-4n,o=Oe(i)||Oe(a);return ke.set(t,o),o}var Ae=new Map;function R(e){if(!Number.isFinite(e)||e<0)return!1;let t=Math.trunc(Math.abs(e)),n=Ae.get(t);if(n!==void 0)return n;let r=BigInt(t),i=2n,a=1n;for(;a<r;){let e=i+a;i=a,a=e}let o=a===r;return Ae.set(t,o),o}function z(e){return Math.abs(Math.trunc(e)).toString()}function B(e){if(e.length<=1)return!1;for(let t=1;t<e.length;t++)if(e[t]!==e[0])return!1;return!0}function V(e){if(e.length<=1)return!1;for(let t=0,n=e.length-1;t<n;t++,n--)if(e[t]!==e[n])return!1;return!0}function H(e){if(e.length===0)return 0;let t=1,n=1;for(let r=1;r<e.length;r++)e[r]===e[r-1]?(n++,n>t&&(t=n)):n=1;return t}function je(e){if(e.length===0)return{len:0,digit:``};let t=1,n=1,r=e[0],i=e[0];for(let a=1;a<e.length;a++)e[a]===e[a-1]?(n++,i=e[a],n>t&&(t=n,r=i)):(n=1,i=e[a]);return{len:t,digit:r}}function U(e){if(e.length<=1)return 1;let t=1,n=1,r=0;for(let i=1;i<e.length;i++){let a=e.charCodeAt(i-1)-48,o=e.charCodeAt(i)-48-a;o===r&&(o===1||o===-1)?n++:o===1||o===-1?(r=o,n=2):(r=0,n=1),n>t&&(t=n)}return t}function Me(e){if(e.length===0)return 1;let t=Array(10).fill(0);for(let n of e)t[n.charCodeAt(0)-48]++;let n=0;for(let r of t)if(r){let t=r/e.length;n-=t*Math.log(t)}let r=Math.log(Math.min(10,e.length));return P(n/(r||1),0,1)}function Ne(e){return!Number.isFinite(e)||e<0?1:1+ie*(1-2*(e/(e+A)))}var W=new Map;function G(t){if(!Number.isFinite(t)||t<1)return null;let n=Math.trunc(t),r=W.get(n);if(r!==void 0)return r;let i=n,a=Math.log(i)/Math.log(e),o=Math.max(1,Math.floor(a)-2),s=null;for(let t=o;t<=o+6;t++)if(Math.ceil(e**+t)===i){s=t;break}return W.set(n,s),s}function Pe(e){if(!Number.isFinite(e)||e<0)return 1;let t=z(e),n=t.length,r=1;L(e)&&(r*=1+T),R(e)&&(r*=1+E),G(e)!==null&&(r*=1+D),B(t)&&(r*=1+O),V(t)&&(r*=1+te);let i=H(t);if(i>=3){let e=P((i-2)/Math.max(3,n-2),0,1);r*=1+k*e}let a=U(t);if(a>=4){let e=P((a-3)/Math.max(4,n-3),0,1);r*=1+ne*e}let o=Me(t);return r*=1+re*(1-o),r}function K(t){if(!Number.isFinite(t)||t<0)return 0;let n=z(t),r=n.length,i=0,a=0,o=L(t)?1:0;i+=1*o,a+=1;let s=R(t)?1:0;i+=1/e*s,a+=1/e;let c=B(n)?1:0;i+=1/e*c,a+=1/e;let l=V(n)?1:0;i+=1/e**2*l,a+=1/e**2;let u=P((H(n)-2)/Math.max(3,r-2),0,1);i+=1/e**2*u,a+=1/e**2;let d=P((U(n)-3)/Math.max(4,r-3),0,1);i+=1/e**3*d,a+=1/e**3;let f=Me(n);return i+=1/e**3*(1-f),a+=1/e**3,a<=0?0:P(i/a,0,1)}function Fe(e){if(!e.length)return 1;let t=0;for(let n of e)t+=Math.log(Math.max(n,1e-12));return Math.exp(t/e.length)}function Ie(e,t,n){if(!Number.isFinite(e)||!Number.isFinite(t)||n<=0)return .5;let r=((e-t)%n+n)%n,i=2*Math.PI*r/n;return .5*(1+Math.cos(i))}function q(e,t){return!Number.isFinite(e)||t<=0?0:Math.floor(Math.floor(Math.max(0,e))/n)%t}function Le(e){return Number.isFinite(e)?Math.floor(Math.max(0,e))%n:0}function J(t){return!Number.isFinite(t)||t<=0?0:I(Math.log(t)/Math.log(e))}function Re(e,t){if(e.size===0&&t.size===0)return 0;let n=new Set([...e,...t]),r=0;for(let n of e)t.has(n)&&r++;return r/n.size}function Y(e){let t=new Set;L(e)&&t.add(`fib`),R(e)&&t.add(`lucas`);let n=z(e);return B(n)&&t.add(`uniform`),V(n)&&t.add(`pal`),H(n)>=4&&t.add(`longrun`),U(n)>=5&&t.add(`longseq`),t}function ze(t){return!Number.isFinite(t)||t<=0?0:1-e**+(-t/ae)}function Be(e){if(!Number.isFinite(e)||e<=0)return 0;let t=1n,n=1n,r=0,i=BigInt(Math.trunc(e));for(;n<=i;){r++;let e=t+n;t=n,n=e}return r}function Ve(e){if(!Number.isFinite(e)||e<=0)return 0;let t=2n,n=1n,r=0,i=BigInt(Math.trunc(e));for(;n<=i;){r++;let e=t+n;t=n,n=e}return r}function He(t,n){let r=I((t+n)*e);return{phase01:r,wave:1+j*(2*r-1)}}function Ue(e){return Number.isFinite(e)&&e>0?Math.trunc(e):t}function We(e,t){return typeof e.kaiPulse==`number`?e.kaiPulse:typeof e.pulse==`number`?e.pulse:t}function Ge(e,t,n){return typeof e.stepIndex==`number`&&Number.isFinite(e.stepIndex)?P(Math.trunc(e.stepIndex),0,t-1):q(n,t)}function Ke(e,t,n){return typeof e.beat==`number`&&Number.isFinite(e.beat)?Math.trunc(e.beat):Math.floor(n/t)}function qe(e){return Object.freeze(e.inputs),Object.freeze(e.headRef),Object.freeze(e)}var Je=new Map;function Ye(e,t){let r=Ue(e.stepsPerBeat),m=r*n,x=We(e,t),S=e.transfers??[],C=be(S),w=Math.max(1,(t-x)/m),T=S.length/w,E=ye(S),D=S.length===0?1:C.length/S.length,O=Se(xe(S)),te=ve(C.map(e=>(e.receiverKaiPulse-e.senderKaiPulse)/m).filter(e=>e>=0)),k=we(e.frequencyHz),ne=Ge(e,r,x),re=Ke(e,m,x),ie=Ee({...e,stepIndex:ne,beat:re},r,k),A=Math.max(0,t-x),ae=Ce(e.ip,t),j=e.seriesSize??1,me=j<=1?a:j**+-o,N=e.quality??`med`,ge=s[N],Te=(e.creatorVerified?1+c:1)+(e.creatorRep??0)*l,De=1+u*F(E-1),Oe=1+h*P((D-p)*ee,-1,1),ke=1+g*(2*O-1),L=P(1+d*F(te),1,f),Ae=1+b*(2*k-1),R=A/m,z=Math.min(y,1+v*F(R)),B=1/(1+_*Math.max(0,T)),V=Pe(x),H=Fe(C.map(e=>Number.isFinite(e.receiverKaiPulse)?Pe(e.receiverKaiPulse):1)),je=Ne(x),U=V*Math.max(1,H)*je,Me=me*ge*Te*De*Oe*ke*L*Ae*z*B*ie*U,W=ze(x),G=ze(t),Ye=Math.max(0,G-W),Xe=K(x),Ze=oe+se*Xe,Qe=Math.exp(Ze*Ye),X=1+ce*(1-W),$e=Be(A),et=Ve(A),tt=Math.exp(le*$e),nt=Math.exp(ue*et),rt=X*Qe*tt*nt,it=1*V*X*Qe*tt*nt*Math.max(1,je),at=m>0?t%m/m:0,ot=1+de*(.5+.5*O)*Math.sin(2*Math.PI*at),st=I(t/i),ct=I(x/i),lt=1-Math.abs((st-ct+1)%1-.5)*2,Z=1+fe*(.5+.5*k)*(.5+.5*O)*(2*lt-1),{phase01:Q,wave:ut}=He(x,t),dt=ne,ft=Ie(q(t,r),dt,r),pt=Le(x),mt=Ie(Le(t),pt,n),ht=1-Math.abs((J(t+1)-J(x+1)+1)%1-.5)*2,gt=Xe,_t=K(t),vt=1-Math.abs(gt-_t),yt=M*Re(Y(x),Y(t))+(1-M)*vt,bt=.3*ft+.3*mt+.2*ht+.2*yt,xt=pe*(.5+.5*gt)*(.5+.5*k),St=1+xt*(2*bt-1),Ct=ot*Z*ut*St,wt=Me*rt,Tt=Math.max(0,wt-it),Et=it+Tt*Ct,Dt=1*Et+ae,Ot={headHash:void 0,transfersWindowRoot:e.transfersWindowRoot,cumulativeTransfers:e.cumulativeTransfers??S.length},kt={size:j,quality:N,creatorVerified:!!e.creatorVerified,creatorRep:e.creatorRep??0,uniqueHolders:E,closedFraction:D,cadenceRegularity:O,medianHoldBeats:te,velocityPerBeat:T,resonancePhi:k,pulsesPerBeat:m,agePulses:A,geometryLift:ie,momentLift:U,pv_phi:ae,algorithmVersion:`phi/kosmos-vφ-5`,adoptionAtClaim:W,adoptionNow:G,adoptionDelta:Ye,rarityScore01:Xe,fibAccrualLevels:$e,lucasAccrualLevels:et,indexScarcity:X,adoptionLift:Qe,fibAccrualLift:tt,lucasAccrualLift:nt,breathPhase01:at,breathWave:ot,dayPhase01:st,dayWave:Z,strobePhase01:Q,strobeWave:ut,momentAffinitySim01:bt,momentAffinityAmp:xt,momentAffinityOsc:St,combinedOsc:Ct,dynamicGrowth:rt,rarityFloor:it,premiumBandBase:Tt},At=_e,$={version:1,unit:`Φ`,algorithm:`phi/kosmos-vφ-5`,policyId:e.valuationPolicyId,policyChecksum:At,valuePhi:Dt,premium:Et,inputs:kt,computedAtPulse:t,headRef:Ot},jt=he({algorithm:$.algorithm,policy:$.policyId??null,policyChecksum:$.policyChecksum,inputs:$.inputs,minimalHead:{headHash:$.headRef.headHash??null,transfersWindowRoot:$.headRef.transfersWindowRoot??null,cumulativeTransfers:$.headRef.cumulativeTransfers}}),Mt=Je.get(jt);if(Mt)return{unsigned:Mt,stampPayload:jt};let Nt=qe({...$,inputs:{...$.inputs},headRef:{...$.headRef}});return Je.set(jt,Nt),{unsigned:Nt,stampPayload:jt}}async function Xe(e,t,n,r){let{unsigned:i,stampPayload:a}=Ye(e,t),o={...i,headRef:{...i.headRef,headHash:r}},s=await n(a);return{seal:{...o,stamp:s}}}function Ze(e,t){return{...e,valuation:t}}function Qe(e){let t=e.inputs;return[`Algorithm: ${e.algorithm} • Policy checksum: ${e.policyChecksum}`,`Series rarity: size=${t.size} → rarityFactor≈${t.size<=1?a:t.size**+-o}`,`Moment lifts: geometry=${t.geometryLift} × numericMoment=${t.momentLift} × genesis/baseline floor=${t.rarityFloor}`,`Adoption field: ΔA=${t.adoptionDelta} → adoptionLift=${t.adoptionLift} • indexScarcity=${t.indexScarcity} • fibLevels=${t.fibAccrualLevels} • lucasLevels=${t.lucasAccrualLevels}`,`Live alignment: breath=${t.breathWave} • day=${t.dayWave} • strobe=${t.strobeWave} • affinity=${t.momentAffinityOsc} → combined=${t.combinedOsc}`,`Premium: floor=${t.rarityFloor} + band=${t.premiumBandBase} × combined=${t.combinedOsc} ⇒ premium=${e.premium} → valueΦ=${e.valuePhi}`].join(`
`)}function X(e){return K(e)}function $e(e){let t=[],n=z(e),r=n.length;L(e)&&t.push(`✓ Fibonacci exact (+${T*100}%)`),R(e)&&t.push(`✓ Lucas exact (+${E*100}%)`),G(e)!==null&&t.push(`✓ φ-spiral transition (+${D*100}%)`),B(n)&&t.push(`✓ Uniform digits (${n[0].repeat(Math.max(1,r))}) (+${O*100}%)`),V(n)&&t.push(`✓ Palindrome (+${te*100}%)`);let{len:i,digit:a}=je(n);if(i>=3){let e=P((i-2)/Math.max(3,r-2),0,1);t.push(`✓ Long digit run (${i}×${a}) (+${k*e*100}%)`)}let o=U(n);if(o>=4){let e=P((o-3)/Math.max(4,r-3),0,1);t.push(`✓ Consecutive sequence (len ${o}) (+${ne*e*100}%)`)}let s=Me(n);return s<1&&t.push(`✓ Low entropy (digit uniformity) (+${re*(1-s)*100}%)`),t.length===0&&t.push(`• Clean moment (no special digit motifs)`),t}function et(e,t,r){let a=Ue(r?.stepsPerBeat),o=a*n,s=typeof r?.cadenceRegularity==`number`?P(r.cadenceRegularity,0,1):1,c=typeof r?.resonancePhi==`number`?P(r.resonancePhi,0,1):.5,l=o>0?t%o/o:0,u=1+de*(.5+.5*s)*Math.sin(2*Math.PI*l),d=I(t/i),f=I(e/i),p=1-Math.abs((d-f+1)%1-.5)*2,m=1+fe*(.5+.5*c)*(.5+.5*s)*(2*p-1),ee=typeof r?.stepIndexClaimOverride==`number`?P(Math.trunc(r.stepIndexClaimOverride),0,a-1):q(e,a),h=Ie(q(t,a),ee,a),g=Le(e),_=Ie(Le(t),g,n),v=1-Math.abs((J(t+1)-J(e+1)+1)%1-.5)*2,y=K(e),b=K(t),x=1-Math.abs(y-b),S=Re(Y(e),Y(t)),{phase01:C,wave:w}=He(e,t),T=M*S+(1-M)*x,E=.3*h+.3*_+.2*v+.2*T,D=pe*(.5+.5*y)*(.5+.5*c),O=1+D*(2*E-1);return{breathWave:u,dayWave:m,strobeWave:w,momentAffinity:O,combinedOsc:u*m*w*O,breathPhase01:l,dayPhase01:d,strobePhase01:C,momentAffinitySim01:E,momentAffinityAmp:D}}function tt(e,t){let r=Ue(t?.stepsPerBeat)*n,i=be(e),a=[];return i.forEach((e,t)=>{let n=t+1,i=(e.receiverKaiPulse-e.senderKaiPulse)/r,o=[];L(e.receiverKaiPulse)&&o.push(`Fibonacci pulse`),R(e.receiverKaiPulse)&&o.push(`Lucas pulse`);let s=z(e.receiverKaiPulse);B(s)&&o.push(`uniform digits`),V(s)&&o.push(`palindrome`);let c=H(s);if(c>=4){let{digit:e}=je(s);o.push(`long run (${c}×${e})`)}let l=``;l=i<5?`quick flip → churn penalty`:i<20?`held ${i} beats`:`held ${i} beats (strong stewardship)`;let u=o.length?` + ${o.join(` • `)}`:``;a.push(`Transfer ${n}: ${l}${u}`)}),a.length||a.push(`No closed transfers yet — lineage still forming.`),a}function nt(e,t){let n=Re(Y(e),Y(t)),r=K(e),i=K(t),a=1-Math.abs(r-i);return M*n+(1-M)*a}function rt(e,t){let n=t?.title??`Kai-Sigil Valuation Scroll`,r=[`# ${n}`,``,"```",Qe(e),"```",``,`### Rarity Evidence`,...$e(e.computedAtPulse).map(e=>`- `+e)].join(`
`),i=t?.width??800,a=t?.padding??24,o=Qe(e).split(`
`),s=o.map((e,t)=>`<text x="${a}" y="${a+60+t*20}" font-family="ui-monospace, SFMono-Regular, Menlo, monospace" font-size="14">${it(e)}</text>`).join(``),c=`<text x="${a}" y="${a+24}" font-family="serif" font-size="24" font-weight="600">${it(n)} · φ</text>`,l=a+80+o.length*20+a;return{seal:e,scrollText:r,scrollSVG:`<svg xmlns="http://www.w3.org/2000/svg" width="${i}" height="${l}" viewBox="0 0 ${i} ${l}">
    <defs>
      <linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-opacity="0.06"/><stop offset="1" stop-opacity="0.12"/></linearGradient>
    </defs>
    <rect x="0" y="0" width="${i}" height="${l}" fill="white"/>
    <rect x="${a/2}" y="${a/2}" width="${i-a}" height="${l-a}" fill="url(#g)" rx="${a/2}"/>
    ${c}
    ${s}
  </svg>`}}function it(e){return e.replace(/&/g,`&amp;`).replace(/</g,`&lt;`).replace(/>/g,`&gt;`).replace(/"/g,`&quot;`)}function at(e,t){let n=Object.assign({creatorRep:.3,closedFraction:.25,medianHoldBeats:.2,pv_phi:.15,verified:.1},t?.weights??{}),r=P(F(e.medianHoldBeats)/Math.log(56),0,1),i=e.pv_phi>0?P(F(e.pv_phi)/Math.log(4),0,1):0,a=e.creatorVerified?1:0,o=P(n.creatorRep*P(e.creatorRep,0,1)+n.closedFraction*P(e.closedFraction,0,1)+n.medianHoldBeats*r+n.pv_phi*i+n.verified*a,0,1),s=(()=>o>=.86?5:o>=.7?4:o>=.5?3:o>=.3?2:1)(),c=[];return e.creatorVerified&&c.push(`Creator verified`),e.creatorRep>.7&&c.push(`High creator rep (${e.creatorRep*100}%)`),e.closedFraction>.66&&c.push(`Strong closure (${e.closedFraction*100}%)`),e.medianHoldBeats>20&&c.push(`Good stewardship (${e.medianHoldBeats} beats)`),e.pv_phi>0&&c.push(`Intrinsic IP present (${e.pv_phi} Φ)`),{stars:s,score01:o,reasons:c}}function ot(e,t){let n=t?.inputs;if(L(e))return{tier:`I`,label:`Fibonacci Moment`,reason:`Claim pulse is an exact Fibonacci number.`};if(R(e))return{tier:`I`,label:`Lucas Moment`,reason:`Claim pulse is an exact Lucas number.`};if(n&&n.closedFraction>=.66&&n.medianHoldBeats>=20)return{tier:`II`,label:`Lineage Stewardship`,reason:`High closure and long median holds.`};if(t&&n&&n.combinedOsc>=1+pe*.5)return{tier:`III`,label:`High Oscillation`,reason:`Strong live alignment (combined oscillators > baseline).`};let r=z(e);return B(r)||V(r)?{tier:`IV`,label:`Digit Geometry`,reason:B(r)?`Uniform digits`:`Palindrome digits`}:{tier:`V`,label:`Clean Moment`,reason:`No special numeric motif (still pure).`}}function st(e,t,r=1,a){let o=Ue(a?.stepsPerBeat)*n,s=[];for(let n=0,a=e;n<t;n++,a+=r){let t=[];L(a)&&t.push(`FIB`),R(a)&&t.push(`LUC`),G(a)!==null&&t.push(`PHI△`);let n=z(a);B(n)&&t.push(`UNI`),V(n)&&t.push(`PAL`);let r=o>0?a%o/o:0,{wave:c}=He(e,a),l=I(a/i);s.push({pulse:a,rarity01:K(a),tags:t,breathPhase01:r,strobeWave:c,dayPhase01:l})}return s}function ct(t,n=2,r=44100,i){let a=i?.stereo??!0,o=a?2:1,s=Math.max(1,Math.floor(n*r)),c=i?.baseHz??220,l=Ue(i?.stepsPerBeat),u=q(t,l),d=J(t+1),f=(d-.5)*24,p=c*2**(u/l*12/12)*2**(f/12),m=new Int16Array(s*o);for(let t=0;t<s;t++){let n=t/r,i=(Math.sin(2*Math.PI*p*n)+Math.sin(2*Math.PI*(p*2**(1/(1200*e)))*n))*.5*.6;if(a){let e=.5+.5*Math.sin(2*Math.PI*d*n),r=i*(1-e),a=i*e;m[t*2]=r*32767|0,m[t*2+1]=a*32767|0}else m[t]=i*32767|0}let ee=r*o*2,h=o*2,g=m.byteLength,_=36+g,v=new Uint8Array(44);lt(v,0,`RIFF`),Q(v,4,_),lt(v,8,`WAVE`),lt(v,12,`fmt `),Q(v,16,16),Z(v,20,1),Z(v,22,o),Q(v,24,r),Q(v,28,ee),Z(v,32,h),Z(v,34,16),lt(v,36,`data`),Q(v,40,g);let y=new Uint8Array(44+g);return y.set(v,0),y.set(new Uint8Array(m.buffer),44),{wav:y,dataURI:`data:audio/wav;base64,`+ut(y)}}function lt(e,t,n){for(let r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)}function Z(e,t,n){e[t]=n&255,e[t+1]=n>>8&255}function Q(e,t,n){e[t]=n&255,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function ut(e){let t=``;for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return typeof btoa==`function`?btoa(t):Buffer.from(t,`binary`).toString(`base64`)}function dt(t,n){let r=n?.width??800,i=n?.height??800,a=r/2,o=i/2,s=n?.turns??3.5,c=n?.stroke??1.5,l=Math.min(r,i)*.02,u=1/(Math.PI/2),d=1200,f=``;for(let t=0;t<=d;t++){let n=t/d*(2*Math.PI*s),r=l*e**+(u*n),i=a+r*Math.cos(n),c=o+r*Math.sin(n);f+=t===0?`M ${i} ${c}`:` L ${i} ${c}`}let p=L(t),m=R(t),ee=G(t)!==null,h=z(t),g=V(h),_=B(h),v=5+6*X(t),y=2*Math.PI*J(t+1),b=l*e**+(u*y),x=a+b*Math.cos(y),S=o+b*Math.sin(y);return`<svg xmlns="http://www.w3.org/2000/svg" width="${r}" height="${i}" viewBox="0 0 ${r} ${i}">
    <rect width="${r}" height="${i}" fill="white"/>
    <path d="${f}" fill="none" stroke="black" stroke-width="${c}"/>
    <circle cx="${x}" cy="${S}" r="${v}" fill="none" stroke="black" stroke-width="1.25"/>
    <text x="${x+10}" y="${S-10}" font-size="12" font-family="ui-sans-serif, system-ui">pulse ${t}</text>
    <g font-size="12" font-family="ui-sans-serif, system-ui">
      <text x="${r-260}" y="${i-108}">Fibonacci: ${p?`✓`:`–`}</text>
      <text x="${r-260}" y="${i-90}">Lucas: ${m?`✓`:`–`}</text>
      <text x="${r-260}" y="${i-72}">φ transition: ${ee?`✓`:`–`}</text>
      <text x="${r-260}" y="${i-54}">Palindrome: ${g?`✓`:`–`}</text>
      <text x="${r-260}" y="${i-36}">Uniform: ${_?`✓`:`–`}</text>
      <text x="${r-260}" y="${i-18}">Rarity score: ${X(t)}</text>
    </g>
  </svg>`}function ft(e,t){let{scrollText:n,scrollSVG:r}=rt(e,{title:t?.title}),i=pt(n).replace(/\n/g,`<br/>`);return`<!doctype html><html><head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>${pt(t?.title??`Kai-Sigil Scroll`)}</title>
    <style>
      body{font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto; margin:0; color:#111;}
      .wrap{max-width:900px; margin:40px auto; padding:24px}
      h1{font-size:28px; margin:0 0 12px}
      .card{background:#fafafa; border:1px solid #eee; border-radius:16px; padding:16px}
      pre{font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size:14px; white-space:pre-wrap}
      svg{width:100%; height:auto; display:block}
    </style></head><body>
      <div class="wrap">
        <h1>${pt(t?.title??`Kai-Sigil Scroll`)}</h1>
        <div class="card"><pre>${i}</pre></div>
        <div style="height:18px"></div>
        <div class="card">${r}</div>
      </div>
    </body></html>`}function pt(e){return e.replace(/&/g,`&amp;`).replace(/</g,`&lt;`).replace(/>/g,`&gt;`).replace(/"/g,`&quot;`)}export{at as a,$e as c,dt as d,ft as f,rt as h,Ye as i,nt as l,st as m,Xe as n,tt as o,ct as p,ot as r,et as s,Ze as t,X as u};