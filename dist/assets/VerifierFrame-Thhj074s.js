import{Ut as e,a as t,c as n,f as r,gi as i,h as a,l as o,m as s,o as c,u as l,ui as u}from"./index-B8rBjB4W.js";import{t as d}from"./browser-BlX_V4Db.js";var f=i(d(),1);async function p(e,t){let n=typeof t==`number`?t:t?.size??160,r=typeof t==`number`?2:t?.margin??2,i=typeof t==`number`?`Q`:t?.ecc??`Q`;return(0,f.toDataURL)(String(e),{width:Math.max(16,Math.floor(n)),margin:r,errorCorrectionLevel:i})}var m=i(u(),1),h=i(e(),1);function g(e,t=10,n=10){return e?e.length<=t+n+3?e:`${e.slice(0,t)}â€¦${e.slice(-n)}`:``}function _(e,t=10,n=10){return e?e.length<=t+n+3?e:`${e.slice(0,t)}â€¦${e.slice(-n)}`:``}async function v(e){try{return typeof navigator>`u`||!navigator.clipboard?.writeText?!1:(await navigator.clipboard.writeText(e),!0)}catch{return!1}}function y(){return(0,h.jsxs)(`svg`,{className:`kv-ic`,viewBox:`0 0 24 24`,"aria-hidden":`true`,focusable:`false`,children:[(0,h.jsx)(`path`,{d:`M14 5h5v5`,fill:`none`,stroke:`currentColor`,strokeWidth:`1.7`,strokeLinecap:`round`,strokeLinejoin:`round`}),(0,h.jsx)(`path`,{d:`M10 14 19 5`,fill:`none`,stroke:`currentColor`,strokeWidth:`1.7`,strokeLinecap:`round`,strokeLinejoin:`round`}),(0,h.jsx)(`path`,{d:`M19 14v4a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h4`,fill:`none`,stroke:`currentColor`,strokeWidth:`1.7`,strokeLinecap:`round`})]})}function b(){return(0,h.jsx)(`span`,{className:`kv-remember`,"aria-hidden":`true`,children:`ðŸ’ `})}function x({pulse:e,kaiSignature:t,phiKey:i,caption:u,chakraDay:d,compact:f=!1,verifierBaseUrl:x}){let[S,C]=(0,m.useState)(`idle`),[w,T]=(0,m.useState)(`idle`),[E,D]=(0,m.useState)(null),[O,k]=(0,m.useState)(null),A=f?92:128,j=f?`kv-verifier kv-verifier--compact`:`kv-verifier`,M=(0,m.useMemo)(()=>({"--qr-size":`${A}px`}),[A]),N=(0,m.useMemo)(()=>{let r=x??l(),u=String(r).replace(/\/+$/,``)||`/verify`,f=typeof t==`string`?t.trim():``,p=a(f),m=n(e,f),h=o(e,f,u),g=s(typeof d==`string`?d:String(d??``)),_=typeof i==`string`?i.trim():``,v=e>0&&f.length>0&&_.length>0&&g?{v:`KPV-1`,pulse:e,chakraDay:g,kaiSignature:f,phiKey:_,verifierSlug:m}:null;return{v:`KVPF-1`,hashAlg:c,canon:`JCS`,verifierUrl:h,verifierBaseUrl:u,verifierSlug:m,pulse:e,chakraDay:g??void 0,kaiSignature:f,kaiSignatureShort:p,phiKey:_,proofCapsule:v,capsuleHash:void 0}},[d,t,i,e,x]);(0,m.useEffect)(()=>{let e=!1;return(async()=>{if(!N.proofCapsule){D(null);return}try{let t=await r(N.proofCapsule);e||D(t)}catch{e||D(null)}})(),()=>{e=!0}},[N.proofCapsule]),(0,m.useEffect)(()=>{let e=!1;if(k(null),N.verifierUrl)return(async()=>{try{let t=await p(N.verifierUrl,{size:A,margin:2,ecc:`M`});e||k(t)}catch{e||k(null)}})(),()=>{e=!0}},[N.verifierUrl,A]);let P=Number.isFinite(e)&&e>0?String(e):`â€”`,F=typeof u==`string`?u.trim():``,I=g(N.phiKey,f?10:12,f?10:12),L=E?_(E,f?10:12,f?10:12):`â€”`,R=!!N.proofCapsule&&!!E,z=async()=>{C(await v(N.verifierUrl)?`ok`:`error`),window.setTimeout(()=>C(`idle`),1600)},B=async()=>{try{let e=E??void 0;!e&&N.proofCapsule&&(e=await r(N.proofCapsule),D(e));let t={...N,capsuleHash:e};T(await v(JSON.stringify(t,null,2))?`ok`:`error`),window.setTimeout(()=>T(`idle`),1600)}catch{T(`error`),window.setTimeout(()=>T(`idle`),1600)}};return(0,h.jsxs)(`section`,{className:j,"aria-label":`Kai-Sigil verification frame`,"data-role":`verifier-frame`,"data-seal":R?`ok`:`off`,children:[(0,h.jsx)(`div`,{className:`kv-topline`,"aria-hidden":`true`}),(0,h.jsxs)(`div`,{className:`kv-wrap`,children:[(0,h.jsxs)(`div`,{className:`kv-topbar`,"aria-label":`Verifier top bar`,children:[(0,h.jsx)(`div`,{className:`kv-qr-shell`,role:`img`,"aria-label":`QR code for verifier pulse ${P}`,title:`Scan to open verifier`,style:M,children:(0,h.jsx)(`div`,{className:`kv-qr-inner`,children:O?(0,h.jsx)(`img`,{className:`kv-qr-image`,src:O,width:A,height:A,alt:`QR code for verifier pulse ${P}`,loading:`eager`,decoding:`async`}):(0,h.jsxs)(`div`,{className:`kv-qr-fallback`,"aria-label":`QR unavailable`,children:[(0,h.jsx)(`div`,{className:`kv-qr-fallback__mark`,children:`QR`}),(0,h.jsx)(`div`,{className:`kv-qr-fallback__sub`,children:`Open link`})]})})}),(0,h.jsxs)(`div`,{className:`kv-chipbar`,"aria-label":`Seal chips`,children:[(0,h.jsxs)(`div`,{className:R?`kv-chip kv-chip--ok`:`kv-chip`,title:`KPV-1 capsule binding`,children:[(0,h.jsx)(`span`,{className:`kv-chip__dot`,"aria-hidden":`true`}),(0,h.jsx)(`span`,{className:`kv-chip__txt`,children:`KPV-1`})]}),(0,h.jsx)(`div`,{className:`kv-chip`,title:`Hash algorithm`,children:(0,h.jsx)(`span`,{className:`kv-chip__txt`,children:c.toUpperCase()})}),(0,h.jsx)(`div`,{className:`kv-chip`,title:`Canonicalization`,children:(0,h.jsx)(`span`,{className:`kv-chip__txt`,children:`JCS`})}),(0,h.jsx)(`div`,{className:R?`kv-chip kv-chip--status kv-chip--ok`:`kv-chip kv-chip--status`,title:`Seal status`,children:(0,h.jsx)(`span`,{className:`kv-chip__txt`,children:R?`OFFICIAL SEAL`:`INCOMPLETE`})})]})]}),(0,h.jsxs)(`div`,{className:`kv-body`,children:[(0,h.jsxs)(`header`,{className:`kv-head`,children:[(0,h.jsx)(`h3`,{className:`kv-title`,children:`â˜¤Kai Sigil-Glyph Verifier`}),(0,h.jsx)(`p`,{className:`kv-sub`,children:`Payload-bound proof vessel (capsule). Inhale to affirm this Î¦-Key sealed this moment.`})]}),(0,h.jsxs)(`dl`,{className:`kv-meta`,"aria-label":`Verification fields`,children:[(0,h.jsxs)(`div`,{className:`kv-row`,children:[(0,h.jsx)(`dt`,{className:`kv-k`,children:`â˜¤Kai (Pulse)`}),(0,h.jsx)(`dd`,{className:`kv-v`,children:P})]}),(0,h.jsxs)(`div`,{className:`kv-row`,children:[(0,h.jsx)(`dt`,{className:`kv-k`,children:`â˜¤Kai-Sig`}),(0,h.jsx)(`dd`,{className:`kv-v kv-mono`,children:N.kaiSignatureShort||`â€”`})]}),(0,h.jsxs)(`div`,{className:`kv-row`,children:[(0,h.jsx)(`dt`,{className:`kv-k`,children:`Î¦-Key`}),(0,h.jsx)(`dd`,{className:`kv-v kv-mono`,title:N.phiKey,children:I||`â€”`})]}),(0,h.jsxs)(`div`,{className:`kv-row`,children:[(0,h.jsx)(`dt`,{className:`kv-k`,children:`Spiral (Chakra)`}),(0,h.jsx)(`dd`,{className:`kv-v`,children:N.chakraDay??`â€”`})]}),(0,h.jsxs)(`div`,{className:`kv-row kv-row--wide`,children:[(0,h.jsx)(`dt`,{className:`kv-k`,children:`Vessel Hash`}),(0,h.jsx)(`dd`,{className:`kv-v kv-mono`,title:E??``,children:L})]})]}),F?(0,h.jsxs)(`p`,{className:`kv-caption`,children:[`â€œ`,F,`â€`]}):null,(0,h.jsxs)(`div`,{className:`kv-actions`,"aria-label":`Actions`,children:[(0,h.jsxs)(`a`,{href:N.verifierUrl,target:`_blank`,rel:`noopener noreferrer`,className:`kv-btn kv-btn--primary`,children:[(0,h.jsx)(y,{}),(0,h.jsx)(`span`,{className:`kv-btn__txt`,children:`Open`})]}),(0,h.jsxs)(`button`,{type:`button`,onClick:()=>void z(),className:`kv-btn kv-btn--ghost`,title:`ðŸ’  Remember Link`,children:[(0,h.jsx)(b,{}),(0,h.jsx)(`span`,{className:`kv-btn__txt`,children:S===`ok`?`Remembered`:`Link`})]}),(0,h.jsxs)(`button`,{type:`button`,onClick:()=>void B(),className:`kv-btn kv-btn--ghost`,title:`ðŸ’  Remember Proof`,children:[(0,h.jsx)(b,{}),(0,h.jsx)(`span`,{className:`kv-btn__txt`,children:w===`ok`?`Remembered`:`Proof`})]}),(0,h.jsx)(`div`,{className:`kv-toast`,"aria-live":`polite`,children:w===`error`||S===`error`?`Remember failed`:w===`ok`?`Proof remembered`:S===`ok`?`Link remembered`:``})]}),(0,h.jsxs)(`div`,{className:`kv-url`,"aria-label":`Verifier URL`,children:[(0,h.jsx)(`span`,{className:`kv-url__k`,children:`Verifier:`}),(0,h.jsx)(`span`,{className:`kv-url__v`,children:N.verifierUrl})]})]})]})]})}export{x as t};