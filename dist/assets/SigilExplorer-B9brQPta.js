import{$t as e,An as t,Cn as n,D as r,Dn as i,E as a,En as o,F as s,Gt as c,In as l,J as u,Jt as d,Kt as f,Mn as p,Nn as m,On as h,Pn as g,Qn as _,Qt as v,Sn as y,T as b,Tn as x,Wr as S,Xt as C,Yt as w,Zt as T,_n as E,ai as D,an as O,bn as ee,cn as k,dn as A,ei as te,en as j,er as ne,fn as re,gn as ie,hi as M,hn as N,ii as ae,in as oe,it as se,jn as P,kn as ce,ln as F,mn as I,ni as le,nn as ue,on as de,pi as L,pn as R,qt as fe,rn as pe,rr as z,sn as me,tn as B,un as V,vn as he,w as ge,wn as H,wr as _e,xi as U,xn as ve,yn as ye}from"./index-BB2Samwe.js";var W=U(M(),1);const be={root:`#ff3b3b`,sacral:`#ff8a3d`,solar:`#ffd54a`,heart:`#3dff9a`,throat:`#46d3ff`,thirdEye:`#6b6cff`,crown:`#c18bff`};function xe(e){if(typeof e!=`string`)return null;let t=e.trim().toLowerCase();return t?t.includes(`root`)?`root`:t.includes(`sacral`)?`sacral`:t.includes(`solar`)||t.includes(`plexus`)||t.includes(`sun`)?`solar`:t.includes(`heart`)?`heart`:t.includes(`throat`)?`throat`:t.includes(`third`)||t.includes(`eye`)||t.includes(`indigo`)?`thirdEye`:t.includes(`crown`)||t.includes(`krown`)||t.includes(`violet`)?`crown`:t===`1`?`root`:t===`2`?`sacral`:t===`3`?`solar`:t===`4`?`heart`:t===`5`?`throat`:t===`6`?`thirdEye`:t===`7`?`crown`:null:null}function G(e){let t=xe(e),n=t?be[t]:`var(--sx-accent)`;return{"--sx-chakra":n}}function Se(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}function K(e){if(typeof e==`number`)return!Number.isFinite(e)||Math.abs(e)<1e-12?void 0:Math.abs(e);if(typeof e==`string`){let t=Number(e);if(!Number.isNaN(t)&&Math.abs(t)>=1e-12)return Math.abs(t)}}function q(e){if(typeof e!=`string`)return null;let t=e.trim().toLowerCase();return t?t.includes(`receive`)||t.includes(`received`)||t.includes(`inhale`)?`receive`:t.includes(`send`)||t.includes(`sent`)||t.includes(`exhale`)?`send`:null:null}function J(e){if(typeof e==`number`)return!Number.isFinite(e)||e<=0?void 0:e;if(typeof e==`string`){let t=Number(e);if(!Number.isNaN(t)&&t>0)return t}}function Ce(e){if(typeof e==`number`&&Number.isFinite(e)&&e>0)return e;if(typeof e==`string`){let t=Number(e);if(!Number.isNaN(t)&&t>0)return t}}function we(e){let t=e,n=Se(t.feed)?t.feed:null,r=e=>e?q(e.phiDirection)||q(e.transferDirection)||q(e.transferMode)||q(e.transferKind):null,i=e=>{if(e)return e.phiDelta??e.phiSigned??e.phiChange},a=e=>e?K(e.transferAmountPhi)??K(e.transferPhi)??K(e.amountPhi)??K(e.phiAmount)??K(e.childAllocationPhi)??K(e.branchBasePhi):void 0,o=e=>e?J(e.amountUsd)??J(e.usdAmount)??J(e.usdValue)??J(e.valueUsd)??J(e.usd):void 0,s=e=>e?J(e.usdPerPhi)??J(e.fxUsdPerPhi)??J(e.usd_per_phi):void 0,c=e=>e?Ce(e.atPulse)??Ce(e.sentPulse)??Ce(e.senderKaiPulse)??Ce(e.transferPulse):void 0,l=r(t)??r(n),u=i(t)??i(n),d=typeof u==`number`?u:void 0;d===void 0&&typeof u==`string`&&(d=Number(u));let f=l??(typeof d==`number`&&Number.isFinite(d)?d>=0?`receive`:`send`:null);if(!f)return;let p=a(t)??a(n)??(Se(t.preview)?K(t.preview.amountPhi):void 0)??(Se(n?.preview)?K(n.preview.amountPhi):void 0)??(typeof d==`number`&&Number.isFinite(d)?Math.abs(d):void 0);if(p===void 0)return;let m=o(t)??o(n)??(Se(t.preview)?J(t.preview.amountUsd):void 0)??(Se(n?.preview)?J(n.preview.amountUsd):void 0),h=s(t)??s(n)??(Se(t.preview)?J(t.preview.usdPerPhi):void 0)??(Se(n?.preview)?J(n.preview.usdPerPhi):void 0),g=c(t)??c(n)??(Se(t.preview)?Ce(t.preview.atPulse):void 0)??(Se(n?.preview)?Ce(n.preview.atPulse):void 0);return{direction:f,amount:p,amountUsd:m??(h===void 0?void 0:p*h),sentPulse:g,source:`payload`}}function Te(e){for(let t of[`transferUrl`,`transferURL`,`transferLink`,`transfer_link`,`sealUrl`,`sealURL`,`sigilTransferUrl`]){let n=e[t];if(typeof n!=`string`||!n.trim())continue;let r=ye(n.trim());if(!r)continue;let i=we(r);if(i)return i}}function Ee(e,t){if(!e)return;let n=t.get(e.toLowerCase());if(!n)return;let r=K(n.amountPhi);if(r!==void 0)return{direction:n.direction,amount:r,amountUsd:J(n.amountUsd),sentPulse:Ce(n.sentPulse),source:`registry`}}function De(e){return!!e&&typeof e==`object`&&!Array.isArray(e)}function Oe(e,t){if(!De(e))return;let n=e[t];return typeof n==`string`&&n.trim().length>0?n.trim():void 0}function ke(e){if(typeof e!=`string`)return null;let t=e.trim().toLowerCase();return t?t.includes(`receive`)||t.includes(`received`)||t.includes(`inhale`)?`receive`:t.includes(`send`)||t.includes(`sent`)||t.includes(`exhale`)?`send`:null:null}function Ae(e){let t=e,n=De(t.feed)?t.feed:null,r=e=>e?ke(e.transferDirection)||ke(e.transferMode)||ke(e.transferKind)||ke(e.phiDirection):null,i=!!(r(t)??r(n)),a=!!(typeof t.transferNonce==`string`||typeof t.nonce==`string`||typeof t.transferToken==`string`||typeof t.token==`string`||n&&(typeof n.transferNonce==`string`||typeof n.nonce==`string`||typeof n.transferToken==`string`||typeof n.token==`string`)),o=!!(typeof t.parentUrl==`string`||typeof t.parentHash==`string`||typeof t.parentCanonical==`string`||n&&(typeof n.parentUrl==`string`||typeof n.parentHash==`string`||typeof n.parentCanonical==`string`));return i||a||o}function je(e){return e.kind!==`post`||!n(e.primaryUrl)||we(e.payload)?!1:!Ae(e.payload)}function Me(e){let t=new Map,r=new Map;for(let[n,i]of e){let e=N(n),a=E(e),o=ie(e,i),s=y(e,i);t.set(e,o);let c=r.get(o);if(!c){r.set(o,{payload:i,urls:new Set([e]),kind:a,momentKey:s});continue}F(i,c.payload)>0&&(c.payload=i),c.urls.add(e);let l=c.momentKey,u=s;l.startsWith(`u:`)&&!u.startsWith(`u:`)&&(c.momentKey=u),l.startsWith(`h:`)&&(u.startsWith(`k:`)||u.startsWith(`sig:`)||u.startsWith(`tok:`))&&(c.momentKey=u)}let i=new Map;for(let[e,t]of r){let n=H(Array.from(t.urls),t.kind);i.set(e,{id:e,payload:t.payload,urls:t.urls,primaryUrl:n,kind:t.kind,momentKey:t.momentKey})}let a=new Map;for(let e of i.values()){let t=e.momentKey;a.has(t)||a.set(t,[]),a.get(t).push(e.id)}let o=new Map,s=new Map,c=new Map,l=new Map;for(let e of i.values()){let t=n(e.primaryUrl);t&&!l.has(t)&&l.set(t,e.id)}for(let[e,t]of a){let n=t.map(e=>i.get(e)).filter(Boolean),r=n.filter(e=>e.kind===`post`),a;a=r.length>0?r.slice().sort((e,t)=>x(t.primaryUrl,`post`)-x(e.primaryUrl,`post`))[0]:n.slice().sort((e,t)=>x(t.primaryUrl,t.kind)-x(e.primaryUrl,e.kind))[0];let l=a?.id??t[0];o.set(e,l);for(let e of t)s.set(e,l);for(let e of t){let t=i.get(e);if(t)for(let e of t.urls)c.set(e,l)}}let u=new Map,d=new Map;for(let e of i.values()){if(!je(e))continue;let t=n(e.primaryUrl);t&&(d.has(t)||d.set(t,e.id))}for(let e of i.values()){let r=s.get(e.id)??e.id;if(e.id!==r)continue;let i=Oe(e.payload,`originUrl`),a=i?N(i):ee(e.primaryUrl)??e.primaryUrl,o=n(a),f=t.get(a)??(o?l.get(o):void 0),p=(o?d.get(o):void 0)??f??c.get(a);u.set(r,p??r)}let f=new Map;for(let e of i.values()){let r=s.get(e.id)??e.id,i=u.get(r)??r,a,o=Oe(e.payload,`parentUrl`);if(o){let r=N(o),i=n(r),s=t.get(r)??(i?l.get(i):void 0)??c.get(r);s&&s!==e.id&&(a=s)}!a&&e.id!==r&&(a=r),f.set(e.id,{id:e.id,payload:e.payload,urls:e.urls,primaryUrl:e.primaryUrl,kind:e.kind,momentKey:e.momentKey,parentId:a,originId:i,momentParentId:r})}return f}function Ne(e,t){let n=[];for(let[r,i]of t)i.parentId===e&&n.push(r);return n.sort((e,n)=>F(t.get(n).payload,t.get(e).payload)),n}function Pe(e,t,n=new Set){let r=t.get(e);if(!r)return null;if(n.has(e))return{id:r.id,url:r.primaryUrl,urls:Array.from(r.urls),payload:r.payload,children:[]};n.add(e);let i=Ne(e,t).map(e=>Pe(e,t,n)).filter(Boolean);return{id:r.id,url:r.primaryUrl,urls:Array.from(r.urls),payload:r.payload,children:i}}function Fe(e){let t=0,n=e.payload,r=e=>{t+=1,F(e.payload,n)>0&&(n=e.payload),e.children.forEach(r)};return r(e),{nodeCount:t,latest:n}}function Ie(e){let t=Me(e),n=new Map;for(let[e,r]of t){let t=r.originId;n.has(t)||n.set(t,[]),n.get(t).push(e)}let r=[];for(let e of n.keys()){let n=Pe(e,t);if(!n)continue;let i=Fe(n);r.push({root:n,nodeCount:i.nodeCount,latest:i.latest})}return r.sort((e,t)=>{let n=F(t.latest,e.latest);return n===0?t.nodeCount===e.nodeCount?F(t.root.payload,e.root.payload):t.nodeCount-e.nodeCount:n}),r.map(e=>e.root)}function Le(e){let t=e.payload;if(De(t)&&typeof t.canonicalHash==`string`)return t.canonicalHash;let r=n(e.url);if(r)return r;for(let t of e.urls){let e=n(t);if(e)return e;let r=ye(t);if(!r)continue;let i=r;if(De(i)&&typeof i.canonicalHash==`string`)return i.canonicalHash}}var Y=U(fe(),1),Re=typeof window<`u`,ze=`sigil:explorer:open`,Be=`sigil:explorer:bc:v1`,Ve=`sigil:explorer:select:bc:v1`,He=`sigil:explorer:selectedHash:v1`,Ue=1000000n,We=(e,t)=>{if(t===0n)return 0n;let n=e%t;return n>=0n?n:n+t},Ge=(e,t)=>{let n=e<0n?-e:e,r=t<0n?-t:t;for(;r!==0n;){let e=n%r;n=r,r=e}return n},Ke=(()=>{let e=Ge(S,Ue);return e===0n?0n:S/e})(),qe=(1+Math.sqrt(5))/2,Je=e=>{if(!Number.isFinite(e))return 0;let t=BigInt(Math.trunc(e));if(Ke<=0n)return 0;let n=We(t,Ke);return Number(n)},Ye=e=>{let t=Number.isFinite(e)?Math.trunc(e):0,{beat:n,stepIndex:r,percentIntoStep:i}=te(BigInt(t)*Ue);return{beat:n,stepIndex:r,stepPct:ae(i)}},Xe=e=>{let t=0;for(let n=0;n<e.length;n+=1)t=(t*31+e.charCodeAt(n))%1e6;return t/1e6},Ze=e=>{let t=Xe(e),n=Xe(e.split(``).reverse().join(``)),r=Xe(`${e}phi`);return`${Math.floor(80+t*175)} ${Math.floor(80+n*175)} ${Math.floor(80+r*175)}`},Qe=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}];function $e(e,t,n){return Math.max(t,Math.min(n,e))}function et(e){return!!e&&typeof e==`object`&&!Array.isArray(e)}function tt(e){return typeof e==`string`&&e.trim().length>0?e.trim():void 0}function nt(e){let t=tt(e);return t?t.toLowerCase():void 0}function rt(e){return typeof e==`number`&&Number.isFinite(e)?e:void 0}function it(e){return JSON.parse(e)}function at(e){try{return window.localStorage.getItem(e)}catch{return null}}function ot(e,t){try{window.localStorage.setItem(e,t)}catch{}}function st(e){let t=tt(e);if(t===`send`||t===`receive`)return t}function ct(e){let t=(e??``).toLowerCase();return t.includes(`root`)?`chakra-root`:t.includes(`sacral`)?`chakra-sacral`:t.includes(`solar`)?`chakra-solar`:t.includes(`heart`)?`chakra-heart`:t.includes(`throat`)?`chakra-throat`:t.includes(`third`)||t.includes(`brow`)?`chakra-third`:t.includes(`crown`)?`chakra-crown`:`chakra-unknown`}function lt(e){let t=(e??``).toLowerCase();return t.includes(`root`)?`shape-root`:t.includes(`sacral`)?`shape-sacral`:t.includes(`solar`)?`shape-solar`:t.includes(`heart`)?`shape-heart`:t.includes(`throat`)?`shape-throat`:t.includes(`third`)||t.includes(`brow`)?`shape-third`:t.includes(`crown`)?`shape-crown`:null}function ut(e,t=10){return e.length<=t?e:e.slice(0,t)}function dt(e){return e?e.startsWith(`-`)?e:`+${e}`:`—`}function ft(e){let t=n(e);if(typeof t==`string`&&t.length)return t.toLowerCase();let r=e.match(/\/s\/([0-9a-f]{32,128})(?:\?|$)/i);return r?.[1]?r[1].toLowerCase():null}function pt(e){let t=nt(e.parentHash);if(t)return t;let n=tt(e.parentUrl);if(n){let e=ft(n);if(e)return e}}function mt(e){let t=tt(e.originUrl);if(t){let e=ft(t);if(e)return e}}function ht(e){let t=0,n=e=>{e!=null&&(typeof e==`string`&&e.length===0||(t+=1))};return n(e.pulse),n(e.beat),n(e.stepIndex),n(e.chakraDay),n(e.userPhiKey),n(e.kaiSignature),n(e.parentHash),n(e.originHash),n(e.transferDirection),n(e.transferAmountPhi),n(e.phiDelta),n(e.receiverKaiPulse),t}function gt(e){let t=e[0]??``,n=-1/0;for(let r of e){let e=N(r),i=x(e,E(e));i>n&&(n=i,t=r)}return he(t)}function _t(e,t){let n=new Map;for(let[e,t]of j){let r=N(e),i=ft(r);if(!i)continue;let a=et(t)?t:{},o={hash:i,bestUrl:he(r),pulse:rt(a.pulse),beat:rt(a.beat),stepIndex:rt(a.stepIndex),chakraDay:tt(a.chakraDay),userPhiKey:tt(a.userPhiKey),kaiSignature:nt(a.kaiSignature),parentHash:pt(a),originHash:mt(a),transferDirection:st(a.transferDirection),transferAmountPhi:tt(a.transferAmountPhi),phiDelta:tt(a.phiDelta),receiverKaiPulse:rt(a.receiverKaiPulse)},s=n.get(i);if(!s){n.set(i,{hash:i,bestUrl:o.bestUrl??he(r),sources:[r],pulse:o.pulse,beat:o.beat,stepIndex:o.stepIndex,chakraDay:o.chakraDay,userPhiKey:o.userPhiKey,kaiSignature:o.kaiSignature,parentHash:o.parentHash,originHash:o.originHash,transferDirection:o.transferDirection,transferAmountPhi:o.transferAmountPhi,phiDelta:o.phiDelta,receiverKaiPulse:o.receiverKaiPulse,degree:0});continue}let c=new Set(s.sources);c.add(r);let l=ht(s),u=ht(o)>l,d={...s,sources:Array.from(c),bestUrl:s.bestUrl,pulse:u&&o.pulse!==void 0?o.pulse:s.pulse??o.pulse,beat:u&&o.beat!==void 0?o.beat:s.beat??o.beat,stepIndex:u&&o.stepIndex!==void 0?o.stepIndex:s.stepIndex??o.stepIndex,chakraDay:u&&o.chakraDay?o.chakraDay:s.chakraDay??o.chakraDay,userPhiKey:u&&o.userPhiKey?o.userPhiKey:s.userPhiKey??o.userPhiKey,kaiSignature:u&&o.kaiSignature?o.kaiSignature:s.kaiSignature??o.kaiSignature,parentHash:u&&o.parentHash?o.parentHash:s.parentHash??o.parentHash,originHash:u&&o.originHash?o.originHash:s.originHash??o.originHash,transferDirection:u&&o.transferDirection?o.transferDirection:s.transferDirection??o.transferDirection,transferAmountPhi:u&&o.transferAmountPhi?o.transferAmountPhi:s.transferAmountPhi??o.transferAmountPhi,phiDelta:u&&o.phiDelta?o.phiDelta:s.phiDelta??o.phiDelta,receiverKaiPulse:u&&o.receiverKaiPulse!==void 0?o.receiverKaiPulse:s.receiverKaiPulse??o.receiverKaiPulse,degree:0};n.set(i,d)}let r=new Map;for(let e of n.values())e.parentHash&&r.set(e.parentHash,(r.get(e.parentHash)??0)+1);for(let e of n.values()){let t=0;e.parentHash&&(t+=1),e.originHash&&(t+=1),t+=r.get(e.hash)??0,e.degree=t,e.bestUrl=gt(e.sources)}let i=e=>typeof e.pulse==`number`?e.pulse:-1;return Array.from(n.values()).sort((e,n)=>t===`degreeDesc`?n.degree===e.degree?i(n)-i(e):n.degree-e.degree:t===`pulseAsc`?i(e)-i(n):i(n)-i(e)).slice(0,e)}function vt(e){if(e<=0)return[];let t=[{q:0,r:0}],n=1;for(;t.length<e;){let r=Qe[4].q*n,i=Qe[4].r*n;for(let a=0;a<6&&t.length<e;a++){let o=Qe[a].q,s=Qe[a].r;for(let a=0;a<n&&t.length<e;a++)t.push({q:r,r:i}),r+=o,i+=s}n+=1}return t}function yt(e,t){return{x:t*Math.sqrt(3)*(e.q+e.r/2),y:t*(3/2)*e.r}}function bt(e){let t=e;return rt(t.pulse??t.latestPulse??t.latest_pulse)}function xt(e){return et(e)?typeof e.pulled==`boolean`&&typeof e.imported==`number`:!1}var St=W.memo(function(e){let{node:t,x:n,y:r,selected:i,onClick:a}=e,o=Ye(Je(typeof t.pulse==`number`&&Number.isFinite(t.pulse)?t.pulse:0)),s=(Xe(t.hash)-.5)*220*qe,c=Math.floor(Xe(t.hash)*6),l=lt(t.chakraDay)??`shape-${c}`,u=t.chakraDay?void 0:Ze(t.hash),d=[];typeof t.pulse==`number`&&d.push(`pulse ${t.pulse}`),Number.isFinite(o.beat)&&Number.isFinite(o.stepIndex)&&d.push(`beat ${o.beat} step ${o.stepIndex}`),t.chakraDay&&d.push(t.chakraDay),d.push(ut(t.hash,12));let f=d.join(` — `);return(0,Y.jsx)(`button`,{type:`button`,className:[`sigilHex`,ct(t.chakraDay),t.transferDirection?`xfer-${t.transferDirection}`:``,i?`isSelected`:``].join(` `),style:{transform:`translate3d(${n}px, ${r}px, ${s.toFixed(2)}px)`},onClick:a,"aria-label":f,title:f,children:(0,Y.jsxs)(`div`,{className:`sigilHexInner`,children:[(0,Y.jsx)(`div`,{className:`sigilHexGlyphFrame`,"aria-hidden":`true`,children:(0,Y.jsx)(`div`,{className:`sigilHexGlyphSimple ${l}`,style:u?{"--hex-tint":u}:void 0})}),(0,Y.jsxs)(`div`,{className:`sigilHexTop`,children:[(0,Y.jsx)(`span`,{className:`sigilHexPulse`,children:typeof t.pulse==`number`?t.pulse:`—`}),(0,Y.jsx)(`span`,{className:`sigilHexHash`,children:ut(t.hash)})]}),(0,Y.jsxs)(`div`,{className:`sigilHexMid`,children:[(0,Y.jsxs)(`span`,{className:`sigilHexBeat`,children:[o.beat,`:`,o.stepIndex]}),(0,Y.jsx)(`span`,{className:`sigilHexDelta`,children:dt(t.phiDelta)})]}),(0,Y.jsx)(`div`,{className:`sigilHexBot`,children:(0,Y.jsx)(`span`,{className:`sigilHexChakra`,children:t.chakraDay||`—`})})]})})});function Ct({className:n,sort:r=`pulseDesc`,maxNodes:i=1400,edgeMode:a=`all`,syncMode:s=`standalone`,onOpenPulseView:c}){let l=s===`standalone`,[u,f]=(0,W.useState)(a),[h,g]=(0,W.useState)(``),[_,y]=(0,W.useState)(()=>v()?1:0),[b,x]=(0,W.useState)(null),S=(0,W.useRef)(null),[E,D]=(0,W.useState)({w:0,h:0}),[O,ee]=(0,W.useState)(.6),[A,te]=(0,W.useState)({x:-18,y:0,z:0}),[j,ne]=(0,W.useState)(!1),[re,ie]=(0,W.useState)({x:0,y:0}),M=(0,W.useRef)({active:!1,mode:`pan`,x0:0,y0:0,panX0:0,panY0:0,rotX0:0,rotY0:0,rotZ0:0}),N=(0,W.useRef)(null),ae=(0,W.useRef)(!1),se=(0,W.useRef)(null),ce=(0,W.useCallback)(()=>{(0,W.startTransition)(()=>y(e=>e+1))},[]);(0,W.useEffect)(()=>{if(!Re)return;l&&(p(),m(),de()),o(),v()&&ce(),window.dispatchEvent(new Event(ze)),se.current=`BroadcastChannel`in window?new BroadcastChannel(Ve):null;let e=e=>{let t=e.data;if(!et(t)||tt(t.type)!==`sigil:select`)return;let n=nt(t.hash);n&&x(n)};se.current?.addEventListener(`message`,e);let t=e=>{if(!e.key||!e.newValue)return;if(e.key===He){let t=nt(e.newValue);t&&x(t);return}let t=e.key===C,n=e.key===w;if(!(!t&&!n))try{let t=it(e.newValue);if(!Array.isArray(t))return;let n=!1;for(let e of t)typeof e==`string`&&T(e,{includeAncestry:!0,broadcast:!1,persist:!1,source:`local`,enqueueToApi:l})&&(n=!0);n&&(ue(),ce())}catch{}};window.addEventListener(`storage`,t);let n=`BroadcastChannel`in window?new BroadcastChannel(Be):null,r=e=>{let t=e.data;if(!et(t)||tt(t.type)!==`sigil:add`)return;let n=tt(t.url);n&&T(n,{includeAncestry:!0,broadcast:!1,persist:!0,source:`local`,enqueueToApi:l})&&ce()};n?.addEventListener(`message`,r);let i=e=>{let t=e,n=typeof t.detail?.url==`string`?t.detail.url:``;n&&T(n,{includeAncestry:!0,broadcast:!0,persist:!0,source:`local`,enqueueToApi:l})&&ce()},a=e=>{let t=e,n=typeof t.detail?.url==`string`?t.detail.url:``;n&&T(n,{includeAncestry:!0,broadcast:!0,persist:!0,source:`local`,enqueueToApi:l})&&ce()};window.addEventListener(`sigil:url-registered`,i),window.addEventListener(`sigil:minted`,a);let s=()=>{l&&(me(),oe())};return window.addEventListener(`pagehide`,s),()=>{window.removeEventListener(`storage`,t),window.removeEventListener(`sigil:url-registered`,i),window.removeEventListener(`sigil:minted`,a),window.removeEventListener(`pagehide`,s),n?.removeEventListener(`message`,r),n?.close(),se.current?.removeEventListener(`message`,e),se.current?.close(),se.current=null}},[l,ce]),(0,W.useEffect)(()=>{let e=S.current;if(!e||typeof ResizeObserver>`u`)return;let t=new ResizeObserver(e=>{let t=e[0]?.contentRect;t&&D({w:Math.round(t.width),h:Math.round(t.height)})});return t.observe(e),()=>t.disconnect()},[]),(0,W.useEffect)(()=>{if(!Re)return;let e=document.documentElement,t=document.body,n=document.scrollingElement||document.documentElement,r={htmlOverscroll:e?.style.overscrollBehavior??``,htmlOverscrollY:e?.style.overscrollBehaviorY??``,bodyOverscroll:t?.style.overscrollBehavior??``,bodyOverscrollY:t?.style.overscrollBehaviorY??``,rootOverscroll:n?.style.overscrollBehavior??``,rootOverscrollY:n?.style.overscrollBehaviorY??``};return e&&(e.style.overscrollBehavior=`none`,e.style.overscrollBehaviorY=`none`),t&&(t.style.overscrollBehavior=`none`,t.style.overscrollBehaviorY=`none`),n&&(n.style.overscrollBehavior=`none`,n.style.overscrollBehaviorY=`none`),()=>{e&&(e.style.overscrollBehavior=r.htmlOverscroll,e.style.overscrollBehaviorY=r.htmlOverscrollY),t&&(t.style.overscrollBehavior=r.bodyOverscroll,t.style.overscrollBehaviorY=r.bodyOverscrollY),n&&(n.style.overscrollBehavior=r.rootOverscroll,n.style.overscrollBehaviorY=r.rootOverscrollY)}},[]),(0,W.useEffect)(()=>{if(!Re)return;let e=S.current;if(!e)return;let t=0,n=0,r=e=>{e.touches.length===1&&(t=e.touches[0]?.clientY??0,n=e.touches[0]?.clientX??0)},i=e=>{if(!e.cancelable||e.touches.length!==1)return;let r=e.touches[0]?.clientY??0,i=e.touches[0]?.clientX??0,a=r-t,o=i-n;t=r,n=i,!(Math.abs(a)<=Math.abs(o))&&a>0&&window.scrollY<=0&&e.preventDefault()};return e.addEventListener(`touchstart`,r,{passive:!0}),e.addEventListener(`touchmove`,i,{passive:!1}),()=>{e.removeEventListener(`touchstart`,r),e.removeEventListener(`touchmove`,i)}},[]);let F=(0,W.useCallback)(async t=>{if(e()&&s===`standalone`){if(k(),t===`pulse`){await oe();return}await oe()}},[s]),le=(0,W.useCallback)(async(n,r)=>{if(e()&&s===`standalone`&&!ae.current){ae.current=!0;try{let e=await P(e=>new URL(t,e).toString(),{method:`GET`,cache:`no-store`,signal:r,headers:void 0});if(!e||!e.ok)return;let i=``,a;try{let t=await e.json(),n=t;i=typeof n.seal==`string`?n.seal:``,a=bt(t)}catch{return}let o=N.current,s=a==null?void 0:wt();if(o&&i&&o===i&&!(a!=null&&(s==null||a>s))&&n===`pulse`){N.current=i;return}let c=await d(r);xt(c)?(c.pulled&&(N.current=c.remoteSeal??i??o??null),c.imported>0&&ce()):N.current=i||o,k(),await oe()}finally{ae.current=!1}}},[ce,s]);(0,W.useEffect)(()=>{if(!Re||s!==`standalone`)return;let e=new AbortController;F(`open`),le(`open`,e.signal);let t=()=>{document.visibilityState===`visible`&&(F(`visible`),le(`visible`,e.signal))},n=()=>{F(`focus`),le(`focus`,e.signal)},r=()=>{F(`online`),le(`online`,e.signal)};return document.addEventListener(`visibilitychange`,t),window.addEventListener(`focus`,n),window.addEventListener(`online`,r),()=>{document.removeEventListener(`visibilitychange`,t),window.removeEventListener(`focus`,n),window.removeEventListener(`online`,r),e.abort()}},[le,F,s]);let L=(0,W.useMemo)(()=>_t(i,r),[_,i,r]),R=(0,W.useMemo)(()=>{let e=new Map;for(let t of L)e.set(t.hash,t);return e},[L]),fe=(0,W.useMemo)(()=>{let e=new Map;for(let t of L){if(!t.parentHash)continue;let n=e.get(t.parentHash)??[];n.push(t.hash),e.set(t.parentHash,n)}return e},[L]),pe=(0,W.useMemo)(()=>{if(L.length===0)return null;if(Re){let e=at(He),t=e?e.toLowerCase():``;if(t&&R.has(t))return t}let e=null;for(let t of L)e?t.degree>e.degree&&(e=t):e=t;return e?.hash??L[0].hash},[L,R]),z=(0,W.useMemo)(()=>{let e=b?b.toLowerCase():null;return e&&R.has(e)?e:pe},[b,R,pe]),B=(0,W.useMemo)(()=>z?R.get(z)??null:null,[z,R]),V=B&&typeof B.pulse==`number`&&Number.isFinite(B.pulse)?Je(B.pulse):null,he=V==null?null:Ye(V),ge=(0,W.useMemo)(()=>{let e=h.trim().toLowerCase();return e?L.filter(t=>!!(t.hash.includes(e)||typeof t.pulse==`number`&&String(t.pulse).includes(e)||t.userPhiKey&&t.userPhiKey.toLowerCase().includes(e)||t.kaiSignature&&t.kaiSignature.toLowerCase().includes(e)||t.chakraDay&&t.chakraDay.toLowerCase().includes(e))):L},[L,h]),H=(0,W.useMemo)(()=>{let e=ge.length,t=vt(e).map(e=>yt(e,45)),n=1/0,r=1/0,i=-1/0,a=-1/0;for(let e of t)n=Math.min(n,e.x),r=Math.min(r,e.y),i=Math.max(i,e.x),a=Math.max(a,e.y);let o=Math.sqrt(3)*45,s=(Number.isFinite(n)?-n:0)+96,c=(Number.isFinite(r)?-r:0)+96,l=ge.map((e,n)=>{let r=t[n]??{x:0,y:0};return{node:e,x:r.x+s-o/2,y:r.y+c-90/2,cx:r.x+s,cy:r.y+c}}),u=(Number.isFinite(i-n)?i-n:0)+192+o,d=(Number.isFinite(a-r)?a-r:0)+192+90,f=new Map;for(let e of l)f.set(e.node.hash,e);return{width:u,height:d,items:l,itemByHash:f,centerOf:e=>{if(!e)return null;let t=f.get(e);return t?{x:t.cx,y:t.cy}:null}}},[ge]),_e=(0,W.useMemo)(()=>{if(!z||!E.w||!E.h)return{x:0,y:0};let e=H.centerOf(z);return e?{x:E.w/2-e.x*O,y:E.h/2-e.y*O}:{x:0,y:0}},[z,E.w,E.h,H,O]),U=j?re:_e,ve=(0,W.useMemo)(()=>{if(!z||u===`none`)return[];let e=H.itemByHash.get(z),t=R.get(z);if(!e||!t)return[];let n=[],r=(t,r)=>{if(!t)return;let i=H.itemByHash.get(t);i&&n.push({x1:e.cx,y1:e.cy,x2:i.cx,y2:i.cy,kind:r})};if((u===`parent`||u===`parent+children`||u===`all`)&&r(t.parentHash,`parent`),u===`parent+children`||u===`all`){let e=fe.get(t.hash)??[];for(let t of e)r(t,`child`)}return u===`all`&&r(t.originHash,`origin`),n},[z,u,H,R,fe]),ye=()=>{ne(!1),ie({x:0,y:0})},be=e=>{if(Re){ot(He,e);try{se.current?.postMessage({type:`sigil:select`,hash:e})}catch{}}},xe=(e,t)=>{let n=e.toLowerCase();if(x(n),be(n),ye(),c){let e=R.get(n),r=e?.pulse;if(typeof r==`number`&&Number.isFinite(r)){let n=t?.currentTarget.getBoundingClientRect();c({pulse:r,originHash:e?.originHash,anchor:n?{x:n.left+n.width/2,y:n.bottom}:void 0})}}},G=e=>{let t=S.current;if(!t)return;let n=e.deltaY,r=$e(O*(n>0?.9:1.12),.12,4.25),i=t.getBoundingClientRect(),a=e.clientX-i.left,o=e.clientY-i.top,s=U,c=(a-s.x)/O,l=(o-s.y)/O,u=a-c*r,d=o-l*r;ee(r),ne(!0),ie({x:u,y:d})},Se=e=>{e.button!==0&&e.button!==2||e.target instanceof HTMLElement&&e.target.closest(`.sigilHex`)||(ne(!0),M.current={active:!0,mode:e.button===2||e.shiftKey?`rotate`:`pan`,x0:e.clientX,y0:e.clientY,panX0:U.x,panY0:U.y,rotX0:A.x,rotY0:A.y,rotZ0:A.z},e.currentTarget.setPointerCapture(e.pointerId))},K=e=>{if(!M.current.active)return;let t=e.clientX-M.current.x0,n=e.clientY-M.current.y0;M.current.mode===`rotate`?te({x:$e(M.current.rotX0+n*.35,-85,85),y:M.current.rotY0+t*.35,z:e.altKey?M.current.rotZ0+t*.2:M.current.rotZ0}):ie({x:M.current.panX0+t,y:M.current.panY0+n})},q=e=>{M.current.active=!1;try{e.currentTarget.releasePointerCapture(e.pointerId)}catch{}},J=()=>{B&&window.open(B.bestUrl,`_blank`,`noopener,noreferrer`)},Ce=async()=>{if(B&&navigator.clipboard)try{await navigator.clipboard.writeText(B.bestUrl)}catch{}},we=B?fe.get(B.hash)?.length??0:0;return(0,Y.jsxs)(`div`,{className:[`sigilHoneycomb`,n??``].join(` `),children:[(0,Y.jsxs)(`div`,{className:`sigilHoneycombHeader`,children:[(0,Y.jsx)(`div`,{className:`sigilHoneycombTitle`,"aria-hidden":`true`}),(0,Y.jsxs)(`div`,{className:`sigilHoneycombControls`,children:[(0,Y.jsxs)(`div`,{className:`searchBox`,children:[(0,Y.jsx)(`input`,{value:h,onChange:e=>g(e.target.value),placeholder:`Search hash / pulse / phiKey / signature / chakra…`,spellCheck:!1}),h?(0,Y.jsx)(`button`,{className:`miniBtn`,onClick:()=>g(``),type:`button`,children:`Clear`}):null]}),(0,Y.jsxs)(`div`,{className:`toggleRow`,children:[(0,Y.jsxs)(`div`,{className:`seg`,children:[(0,Y.jsxs)(`button`,{type:`button`,className:u===`none`?`on`:``,onClick:()=>f(`none`),"aria-label":`Edges off`,children:[(0,Y.jsx)(`span`,{className:`btn-icon`,children:`◌`}),(0,Y.jsx)(`span`,{className:`btn-text`,children:`Edges: Off`})]}),(0,Y.jsxs)(`button`,{type:`button`,className:u===`parent`?`on`:``,onClick:()=>f(`parent`),"aria-label":`Parent edges`,children:[(0,Y.jsx)(`span`,{className:`btn-icon`,children:`↑`}),(0,Y.jsx)(`span`,{className:`btn-text`,children:`Parent`})]}),(0,Y.jsxs)(`button`,{type:`button`,className:u===`parent+children`?`on`:``,onClick:()=>f(`parent+children`),"aria-label":`Parent and children edges`,children:[(0,Y.jsx)(`span`,{className:`btn-icon`,children:`⇄`}),(0,Y.jsx)(`span`,{className:`btn-text`,children:`Parent+Kids`})]}),(0,Y.jsxs)(`button`,{type:`button`,className:u===`all`?`on`:``,onClick:()=>f(`all`),"aria-label":`All edges`,children:[(0,Y.jsx)(`span`,{className:`btn-icon`,children:`◎`}),(0,Y.jsx)(`span`,{className:`btn-text`,children:`All`})]})]}),(0,Y.jsx)(`div`,{className:`seg`})]})]})]}),(0,Y.jsxs)(`div`,{className:`sigilHoneycombBody`,children:[(0,Y.jsx)(`div`,{className:`combViewport`,ref:S,onWheel:G,onPointerDown:Se,onPointerMove:K,onPointerUp:q,onPointerCancel:q,onContextMenu:e=>e.preventDefault(),children:(0,Y.jsxs)(`div`,{className:`combInner`,style:{width:`${H.width}px`,height:`${H.height}px`,transform:`translate(${U.x}px, ${U.y}px) scale(${O}) rotateX(${A.x}deg) rotateY(${A.y}deg) rotateZ(${A.z}deg)`},children:[(0,Y.jsx)(`svg`,{className:`combEdges`,width:H.width,height:H.height,"aria-hidden":`true`,children:ve.map((e,t)=>(0,Y.jsx)(`line`,{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,className:`edgeLine edge-${e.kind}`,vectorEffect:`non-scaling-stroke`},`${e.kind}-${t}`))}),H.items.map(e=>(0,Y.jsx)(St,{node:e.node,x:e.x,y:e.y,selected:e.node.hash===z,onClick:t=>xe(e.node.hash,t)},e.node.hash))]})}),(0,Y.jsx)(`aside`,{className:`combInspector`,"aria-label":`Honeycomb inspector`,children:(0,Y.jsxs)(`div`,{className:`inspectorCard`,children:[(0,Y.jsxs)(`div`,{className:`inspectorHead`,children:[(0,Y.jsx)(`div`,{className:`inspectorTitle`,children:`Selection`}),(0,Y.jsx)(`div`,{className:`inspectorSub`,children:B?ut(B.hash,16):`—`})]}),(0,Y.jsxs)(`div`,{className:`inspectorGrid`,children:[(0,Y.jsx)(`div`,{className:`k`,children:`Pulse`}),(0,Y.jsx)(`div`,{className:`v mono`,children:B?.pulse??`—`}),(0,Y.jsx)(`div`,{className:`k`,children:`Beat:Step`}),(0,Y.jsx)(`div`,{className:`v mono`,children:he?`${he.beat}:${he.stepIndex}`:`—`}),(0,Y.jsx)(`div`,{className:`k`,children:`Chakra`}),(0,Y.jsx)(`div`,{className:`v`,children:B?.chakraDay??`—`}),(0,Y.jsx)(`div`,{className:`k`,children:`ΔΦ`}),(0,Y.jsx)(`div`,{className:`v mono`,children:dt(B?.phiDelta)}),(0,Y.jsx)(`div`,{className:`k`,children:`Transfer`}),(0,Y.jsx)(`div`,{className:`v`,children:B?.transferDirection??`—`}),(0,Y.jsx)(`div`,{className:`k`,children:`Parent`}),(0,Y.jsx)(`div`,{className:`v mono`,children:B?.parentHash?(0,Y.jsx)(`button`,{className:`linkBtn`,type:`button`,onClick:()=>xe(B.parentHash),children:ut(B.parentHash,14)}):`—`}),(0,Y.jsx)(`div`,{className:`k`,children:`Children`}),(0,Y.jsx)(`div`,{className:`v mono`,children:B?we:`—`}),(0,Y.jsx)(`div`,{className:`k`,children:`Origin`}),(0,Y.jsx)(`div`,{className:`v mono`,children:B?.originHash?(0,Y.jsx)(`button`,{className:`linkBtn`,type:`button`,onClick:()=>xe(B.originHash),children:ut(B.originHash,14)}):`—`}),(0,Y.jsx)(`div`,{className:`k`,children:`PhiKey`}),(0,Y.jsx)(`div`,{className:`v mono`,children:B?.userPhiKey?ut(B.userPhiKey,20):`—`}),(0,Y.jsx)(`div`,{className:`k`,children:`KaiSig`}),(0,Y.jsx)(`div`,{className:`v mono`,children:B?.kaiSignature?ut(B.kaiSignature,20):`—`}),(0,Y.jsx)(`div`,{className:`k`,children:`Degree`}),(0,Y.jsx)(`div`,{className:`v mono`,children:B?.degree??`—`})]}),(0,Y.jsxs)(`div`,{className:`inspectorActions`,children:[(0,Y.jsx)(`button`,{type:`button`,className:`primaryBtn`,onClick:J,disabled:!B,children:`Open`}),(0,Y.jsx)(`button`,{type:`button`,className:`miniBtn`,onClick:Ce,disabled:!B,children:`Copy URL`})]}),B?.sources?.length?(0,Y.jsxs)(`details`,{className:`sources`,children:[(0,Y.jsxs)(`summary`,{children:[`Sources (`,B.sources.length,`)`]}),(0,Y.jsxs)(`div`,{className:`sourcesList`,children:[B.sources.slice(0,40).map((e,t)=>(0,Y.jsx)(`div`,{className:`sourceItem mono`,children:I(e)},`${t}-${e}`)),B.sources.length>40?(0,Y.jsxs)(`div`,{className:`sourceMore`,children:[`… `,B.sources.length-40,` more`]}):null]})]}):null]})})]})]})}function wt(){let e;for(let[,t]of j){if(!et(t))continue;let n=rt(t.pulse);n!=null&&(e==null||n>e)&&(e=n)}return e}var Tt=U(L(),1),Et=`41.3.1`,Dt=typeof window<`u`,Ot=`sigil:explorer:select:bc:v1`,kt=`sigil:explorer:selectedHash:v1`,At=1000000n;function jt(){return globalThis}function Mt(e){let t=jt();if(typeof t.requestIdleCallback==`function`){let n=t.requestIdleCallback(()=>e(),{timeout:200});return{cancel:()=>{typeof t.cancelIdleCallback==`function`&&t.cancelIdleCallback(n)}}}let n=window.setTimeout(e,32);return{cancel:()=>clearTimeout(n)}}function Nt(e,t,n){return Math.max(t,Math.min(n,e))}function Pt(e){return!!e&&typeof e==`object`&&!Array.isArray(e)}function Ft(e){return typeof e==`string`&&e.trim().length>0?e.trim():void 0}function It(e){let t=Ft(e);return t?t.toLowerCase():void 0}function X(e){if(typeof e==`number`&&Number.isFinite(e))return e;if(typeof e==`string`){let t=Number(e);if(Number.isFinite(t))return t}}function Lt(e,t){try{window.localStorage.setItem(e,t)}catch{}}function Rt(e){if(Dt){Lt(kt,e);try{let t=`BroadcastChannel`in window?new BroadcastChannel(Ot):null;t?.postMessage({type:`sigil:select`,hash:e}),t?.close()}catch{}}}function zt(e,t=10){return e.length<=t?e:e.slice(0,t)}function Bt(e){return e==null||!Number.isFinite(e)?`—`:new Intl.NumberFormat(`en-US`,{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}function Vt(e){return e==null||!Number.isFinite(e)?`—`:e.toFixed(6).replace(/0+$/u,``).replace(/\.$/u,``)}function Ht(e){let t=(e??``).toLowerCase();return t.includes(`root`)?`Root`:t.includes(`sacral`)?`Sacral`:t.includes(`solar`)?`Solar Plexus`:t.includes(`heart`)?`Heart`:t.includes(`throat`)?`Throat`:t.includes(`third`)||t.includes(`brow`)?`Third Eye`:t.includes(`crown`)?`Crown`:`Root`}async function Ut(e){if(Dt&&e&&navigator.clipboard)try{await navigator.clipboard.writeText(e)}catch{}}var Wt=(e,t)=>{if(t===0n)return 0n;let n=e%t;return n>=0n?n:n+t},Gt=(e,t)=>{let n=e<0n?-e:e,r=t<0n?-t:t;for(;r!==0n;){let e=n%r;n=r,r=e}return n},Kt=(()=>{let e=Gt(S,At);return e===0n?0n:S/e})(),qt=new Set,Jt=(1+Math.sqrt(5))/2,Yt=e=>{if(!Number.isFinite(e))return 0;let t=BigInt(Math.trunc(e));if(Kt<=0n)return 0;let n=Wt(t,Kt);return Number(n)},Xt=e=>{let t=Number.isFinite(e)?Math.trunc(e):0,{beat:n,stepIndex:r,percentIntoStep:i}=te(BigInt(t)*At);return{beat:n,stepIndex:r,stepPct:ae(i)}},Zt=e=>{let t=0;for(let n=0;n<e.length;n+=1)t=(t*31+e.charCodeAt(n))%1e6;return t/1e6};function Qt(e){let[,t]=(0,W.useState)(0),n=qt.has(e);return(0,W.useEffect)(()=>{if(n)return;let r=!1,i=Mt(()=>{r||(qt.add(e),t(e=>e+1))});return()=>{r=!0,i.cancel()}},[n,e]),n}function $t(e){let t=n(e);if(typeof t==`string`&&t.length)return t.toLowerCase();let r=e.match(/\/s\/([0-9a-f]{32,128})(?:\?|$)/i);return r?.[1]?r[1].toLowerCase():null}function en(e){let t=It(e.parentHash);if(t)return t;let n=Ft(e.parentUrl);if(n){let e=$t(n);if(e)return e}}function tn(e){let t=Ft(e.originUrl);if(t){let e=$t(t);if(e)return e}}function nn(e){let t=Ft(e);if(t===`send`||t===`receive`)return t}function rn(e){let t=0,n=e=>{e!=null&&(typeof e==`string`&&e.length===0||(t+=1))};return n(e.pulse),n(e.beat),n(e.stepIndex),n(e.chakraDay),n(e.userPhiKey),n(e.kaiSignature),n(e.parentHash),n(e.originHash),n(e.transferDirection),n(e.transferAmountPhi),n(e.phiDelta),t}function an(e){let t=e[0]??``,n=-1/0;for(let r of e){let e=N(r),i=x(e,E(e));i>n&&(n=i,t=r)}return he(t)}function on(e){let t=new Map;for(let[n,r]of j){if(!Pt(r))continue;let i=X(r.pulse);if(i!==e)continue;let a=N(n),o=$t(a);if(!o)continue;let s={hash:o,bestUrl:he(a),sources:[a],pulse:i,beat:X(r.beat),stepIndex:X(r.stepIndex),chakraDay:Ft(r.chakraDay),userPhiKey:Ft(r.userPhiKey),kaiSignature:It(r.kaiSignature),parentHash:en(r),originHash:tn(r),transferDirection:nn(r.transferDirection),transferAmountPhi:Ft(r.transferAmountPhi),phiDelta:Ft(r.phiDelta)},c=t.get(o);if(!c){t.set(o,{hash:o,bestUrl:s.bestUrl??he(a),sources:[a],pulse:s.pulse,beat:s.beat,stepIndex:s.stepIndex,chakraDay:s.chakraDay,userPhiKey:s.userPhiKey,kaiSignature:s.kaiSignature,parentHash:s.parentHash,originHash:s.originHash,transferDirection:s.transferDirection,transferAmountPhi:s.transferAmountPhi,phiDelta:s.phiDelta,degree:0});continue}let l=new Set(c.sources);l.add(a);let u=rn(c),d=rn(s)>u;t.set(o,{...c,sources:Array.from(l),pulse:c.pulse??s.pulse,beat:d&&s.beat!==void 0?s.beat:c.beat??s.beat,stepIndex:d&&s.stepIndex!==void 0?s.stepIndex:c.stepIndex??s.stepIndex,chakraDay:d&&s.chakraDay?s.chakraDay:c.chakraDay??s.chakraDay,userPhiKey:d&&s.userPhiKey?s.userPhiKey:c.userPhiKey??s.userPhiKey,kaiSignature:d&&s.kaiSignature?s.kaiSignature:c.kaiSignature??s.kaiSignature,parentHash:d&&s.parentHash?s.parentHash:c.parentHash??s.parentHash,originHash:d&&s.originHash?s.originHash:c.originHash??s.originHash,transferDirection:d&&s.transferDirection?s.transferDirection:c.transferDirection??s.transferDirection,transferAmountPhi:d&&s.transferAmountPhi?s.transferAmountPhi:c.transferAmountPhi??s.transferAmountPhi,phiDelta:d&&s.phiDelta?s.phiDelta:c.phiDelta??s.phiDelta,bestUrl:c.bestUrl,degree:0})}let n=new Map;for(let e of t.values())e.parentHash&&n.set(e.parentHash,(n.get(e.parentHash)??0)+1);for(let e of t.values()){let t=0;e.parentHash&&(t+=1),e.originHash&&(t+=1),t+=n.get(e.hash)??0,e.degree=t,e.bestUrl=an(e.sources)}return Array.from(t.values()).sort((e,t)=>{if(t.degree!==e.degree)return t.degree-e.degree;let n=typeof e.beat==`number`?e.beat:-1,r=typeof t.beat==`number`?t.beat:-1;if(r!==n)return r-n;let i=typeof e.stepIndex==`number`?e.stepIndex:-1,a=typeof t.stepIndex==`number`?t.stepIndex:-1;return a===i?e.hash<t.hash?-1:e.hash>t.hash?1:0:a-i})}var sn=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}];function cn(e){if(e<=0)return[];let t=[{q:0,r:0}],n=1;for(;t.length<e;){let r=sn[4].q*n,i=sn[4].r*n;for(let a=0;a<6&&t.length<e;a++){let o=sn[a].q,s=sn[a].r;for(let a=0;a<n&&t.length<e;a++)t.push({q:r,r:i}),r+=o,i+=s}n+=1}return t}function ln(e,t){return{x:t*Math.sqrt(3)*(e.q+e.r/2),y:t*(3/2)*e.r}}function un(e){return{pulse:X(e.pulse),beat:X(e.beat),stepIndex:X(e.stepIndex),chakraDay:Ft(e.chakraDay),userPhiKey:Ft(e.userPhiKey),kaiSignature:It(e.kaiSignature),transfers:Array.isArray(e.transfers)?e.transfers:void 0,segments:Array.isArray(e.segments)?e.segments:void 0,ip:Pt(e.ip)?e.ip:void 0}}function dn(e,t){if(t==null||!Number.isFinite(t))return null;try{let{unsigned:n}=_e(un(e),t);return Number.isFinite(n.valuePhi)?n.valuePhi:null}catch{return null}}function fn(e,t){if(t==null||!Number.isFinite(t))return null;try{let n=f({meta:un(e),nowPulse:t,usd:100,currentStreakDays:0,lifetimeUsdSoFar:0},c);return Number.isFinite(n.usdPerPhi)?n.usdPerPhi:null}catch{return null}}function pn(e){let[t,n]=(0,W.useState)(()=>{if(!Dt)return!1;try{return window.matchMedia(e).matches}catch{return!1}});return(0,W.useEffect)(()=>{if(!Dt)return;let t;try{t=window.matchMedia(e)}catch{return}let r=e=>n(e.matches);if(`addEventListener`in t)return t.addEventListener(`change`,r),()=>t.removeEventListener(`change`,r);let i=t;return i.addListener?.(r),()=>i.removeListener?.(r)},[e]),t}function mn(e){let{enabled:t,shellRef:n,anchor:r}=e;(0,W.useLayoutEffect)(()=>{if(!Dt||!t)return;let e=n.current;if(!e||!r)return;let i=()=>{let e=n.current;if(!e)return;let t=window.innerWidth,i=window.innerHeight,a=e.getBoundingClientRect(),o=r.y+10,s=r.y-a.height-10,c=i-(o+a.height)-12,l=s-12,u=c<0&&l>c,d=r.x-a.width*.5,f=u?s:o,p=Nt(d,12,Math.max(12,t-a.width-12)),m=Nt(f,12,Math.max(12,i-a.height-12));e.style.left=`${p}px`,e.style.top=`${m}px`,e.style.transformOrigin=`${Math.max(0,r.x-p)}px ${Math.max(0,r.y-m)}px`,e.setAttribute(`data-popover-flip`,u?`above`:`below`)},a=window.requestAnimationFrame(i),o=()=>{window.cancelAnimationFrame(a),a=window.requestAnimationFrame(i)};window.addEventListener(`resize`,o,{passive:!0}),window.addEventListener(`scroll`,o,{passive:!0,capture:!0});let s=null;return typeof ResizeObserver<`u`&&(s=new ResizeObserver(()=>o()),s.observe(e)),()=>{window.cancelAnimationFrame(a),window.removeEventListener(`resize`,o),window.removeEventListener(`scroll`,o,!0),s?.disconnect()}},[t,n,r?.x,r?.y])}function hn(e){let t=(e??``).toLowerCase();return t.includes(`root`)?`chakra-root`:t.includes(`sacral`)?`chakra-sacral`:t.includes(`solar`)?`chakra-solar`:t.includes(`heart`)?`chakra-heart`:t.includes(`throat`)?`chakra-throat`:t.includes(`third`)||t.includes(`brow`)?`chakra-third`:t.includes(`crown`)?`chakra-crown`:`chakra-unknown`}function gn(e){let t=[];for(let n=0;n<e.length;n+=1){let r=e[n];if(!Pt(r))continue;let i=X(r.i)??n,a=X(r.value)??X(r.phi)??X(r.v)??X(r.y);if(a==null)continue;let o=X(r.usdPerPhi)??X(r.usd_per_phi)??X(r.rate)??X(r.usdRate),s=X(r.pulse)??X(r.x);t.push({i,phi:a,usdPerPhi:o??void 0,pulse:s??void 0})}return t}function _n(e,t,n){if(t===`phi`)return e.phi;let r=e.usdPerPhi??n;return r==null||!Number.isFinite(r)?NaN:e.phi*r}function vn(e,t,n,r){let i=e=>0,a=e=>0;if(e.length<2)return{d:``,minV:0,maxV:0,xAt:i,yAt:a};let o=1/0,s=-1/0;for(let t of e)Number.isFinite(t)&&(o=Math.min(o,t),s=Math.max(s,t));if(!Number.isFinite(o)||!Number.isFinite(s))return{d:``,minV:0,maxV:0,xAt:i,yAt:a};let c=Math.max(1e-9,s-o),l=e.length,u=r,d=t-r,f=r,p=n-r,m=e=>u+e/Math.max(1,l-1)*(d-u),h=e=>p-(e-o)/c*(p-f),g=``;for(let t=0;t<l;t+=1){let n=e[t],r=m(t),i=h(n);g+=t===0?`M ${r.toFixed(2)} ${i.toFixed(2)}`:` L ${r.toFixed(2)} ${i.toFixed(2)}`}return{d:g,minV:o,maxV:s,xAt:m,yAt:h}}function yn(e,t){return Number.isFinite(t)?e===`phi`?`${Vt(t)} Φ`:`$${Bt(t)}`:`—`}function bn(e){let{points:t,values:n,idx:r,usdPerPhiFallback:i,hi:a,lo:o}=e;if(r<0||r>=n.length)return null;let s=t[r],c=n[r],l=n[0],u=s?.phi??NaN,d=s?.usdPerPhi??i,f=d!=null&&Number.isFinite(d)?u*d:NaN,p=l,m=Number.isFinite(p)?c-p:NaN,h=Number.isFinite(p)&&p!==0?m/Math.abs(p)*100:NaN;return{i:s?.i??r,pulse:s?.pulse,valueMode:c,valuePhi:u,valueUsd:f,usdPerPhiPoint:d??void 0,hi:a,lo:o,dFromStart:m,dPctFromStart:h,points:n.length}}function xn(e){let{open:t,locked:n,x:r,y:i,mode:a,tip:o}=e,s=Dt?document.body:null;return!t||s==null?null:(0,Tt.createPortal)((0,Y.jsx)(`div`,{className:`phmTipPortal ${n?`isLocked`:``}`,style:{left:`${r}px`,top:`${i}px`},"aria-hidden":`true`,children:(0,Y.jsxs)(`div`,{className:`phmTipInner`,children:[(0,Y.jsxs)(`div`,{className:`phmTipTop`,children:[(0,Y.jsx)(`div`,{className:`phmTipTitle`,children:a===`phi`?`Asset Value (Φ)`:`Asset Value (USD)`}),(0,Y.jsx)(`div`,{className:`phmTipIndex`,children:o.pulse==null?`Index ${o.i}`:`Pulse ${Math.trunc(o.pulse).toLocaleString()}`})]}),(0,Y.jsxs)(`div`,{className:`phmTipMain`,children:[(0,Y.jsx)(`div`,{className:`phmTipBig`,children:yn(a,o.valueMode)}),(0,Y.jsxs)(`div`,{className:`phmTipSubRow`,children:[(0,Y.jsx)(`span`,{className:`phmTipSub`,children:Number.isFinite(o.valuePhi)?`${Vt(o.valuePhi)} Φ`:`—`}),(0,Y.jsx)(`span`,{className:`phmTipDot`,children:`•`}),(0,Y.jsx)(`span`,{className:`phmTipSub`,children:Number.isFinite(o.valueUsd)?`$${Bt(o.valueUsd)}`:`—`})]})]}),(0,Y.jsxs)(`div`,{className:`phmTipGrid`,children:[(0,Y.jsx)(`div`,{className:`phmTipK`,children:`Δ`}),(0,Y.jsxs)(`div`,{className:`phmTipV`,children:[Number.isFinite(o.dFromStart)?yn(a,o.dFromStart):`—`,Number.isFinite(o.dPctFromStart)?(0,Y.jsxs)(`span`,{className:`phmTipMini`,children:[` `,`(`,o.dPctFromStart>=0?`+`:``,o.dPctFromStart.toFixed(2),`%)`]}):null]}),(0,Y.jsx)(`div`,{className:`phmTipK`,children:`High`}),(0,Y.jsx)(`div`,{className:`phmTipV`,children:yn(a,o.hi)}),(0,Y.jsx)(`div`,{className:`phmTipK`,children:`Low`}),(0,Y.jsx)(`div`,{className:`phmTipV`,children:yn(a,o.lo)}),(0,Y.jsx)(`div`,{className:`phmTipK`,children:`USD/Φ`}),(0,Y.jsx)(`div`,{className:`phmTipV`,children:o.usdPerPhiPoint!=null&&Number.isFinite(o.usdPerPhiPoint)?`$${Bt(o.usdPerPhiPoint)}`:`—`}),(0,Y.jsx)(`div`,{className:`phmTipK`,children:`Points`}),(0,Y.jsx)(`div`,{className:`phmTipV`,children:o.points})]}),(0,Y.jsx)(`div`,{className:`phmTipHint`,children:n?`tap again to unlock`:`tap to lock`})]})}),s)}function Sn(e){let{lineData:t,mode:n,usdPerPhiFallback:r,livePhi:i,liveUsd:a,usdPerPhiNow:o}=e,s=(0,W.useRef)(null),c=(0,W.useMemo)(()=>gn(t),[t]),l=(0,W.useMemo)(()=>c.map(e=>_n(e,n,r)),[c,n,r]),u=(0,W.useMemo)(()=>vn(l,420,86,10),[l]),[d,f]=(0,W.useState)(null),[p,m]=(0,W.useState)(!1),[h,g]=(0,W.useState)(null),_=l.length,v=d==null?null:Nt(d,0,Math.max(0,_-1)),y=v!=null&&v>=0&&v<_,b=_>0?l[0]:null,x=_>0?l[_-1]:null,S=(0,W.useMemo)(()=>{if(!Number.isFinite(b??NaN)||!Number.isFinite(x??NaN))return null;let e=Math.abs(b);return e<=0?null:(x-b)/e*100},[b,x]),C=(0,W.useMemo)(()=>!y||v==null?null:bn({mode:n,points:c,values:l,idx:v,usdPerPhiFallback:r,hi:u.maxV,lo:u.minV}),[y,v,n,c,l,r,u.maxV,u.minV]),w=e=>{let t=s.current;if(!t||!_)return;let n=t.getBoundingClientRect(),r=Nt(e-n.left,0,n.width),i=n.width>0?r/n.width:0,a=Math.round(i*Math.max(0,_-1));f(a);let o=u.xAt(a),c=u.yAt(l[a]??0),d=n.width>0?o/420*n.width:0,p=n.height>0?c/86*n.height:0;g({x:n.left+d,y:n.top+p})},T=e=>{_&&(p||w(e.clientX))},E=e=>{_&&(p||w(e.clientX))},D=()=>{p||(f(null),g(null))},O=e=>{if(_){if(p){m(!1),f(null),g(null);return}m(!0),w(e.clientX)}},ee=n===`phi`?i??null:a??null,k=yn(n,Number.isFinite(ee??NaN)?ee:NaN),A=o==null?`—`:`$${Bt(o)} / Φ`;return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)(`div`,{ref:s,className:`phmChart phmChart--lite phmChart--interactive ${p?`isLocked`:``}`,role:`group`,"aria-label":`Live value chart`,onPointerMove:T,onPointerEnter:E,onPointerLeave:D,onClick:O,children:[(0,Y.jsxs)(`div`,{className:`phmChartTopRow`,"aria-hidden":`true`,children:[(0,Y.jsxs)(`span`,{className:`phmChartBadge`,children:[(0,Y.jsx)(`span`,{className:`phmLiveDot`}),`LIVE`]}),(0,Y.jsx)(`span`,{className:`phmTicker`,children:k}),(0,Y.jsx)(`span`,{className:`phmChartHint`,children:p?`tap again to unlock`:`tap to lock`})]}),(0,Y.jsxs)(`svg`,{className:`phmChartSvg`,viewBox:`0 0 420 86`,preserveAspectRatio:`none`,"aria-hidden":`true`,children:[(0,Y.jsxs)(`defs`,{children:[(0,Y.jsxs)(`linearGradient`,{id:`phmLine`,x1:`0`,y1:`0`,x2:`1`,y2:`0`,children:[(0,Y.jsx)(`stop`,{offset:`0%`,stopColor:`rgba(191,252,255,0.85)`}),(0,Y.jsx)(`stop`,{offset:`60%`,stopColor:`rgba(183,163,255,0.75)`}),(0,Y.jsx)(`stop`,{offset:`100%`,stopColor:`rgba(191,252,255,0.55)`})]}),(0,Y.jsxs)(`linearGradient`,{id:`phmFill`,x1:`0`,y1:`0`,x2:`0`,y2:`1`,children:[(0,Y.jsx)(`stop`,{offset:`0%`,stopColor:`rgba(191,252,255,0.18)`}),(0,Y.jsx)(`stop`,{offset:`70%`,stopColor:`rgba(191,252,255,0.04)`}),(0,Y.jsx)(`stop`,{offset:`100%`,stopColor:`rgba(0,0,0,0)`})]}),(0,Y.jsxs)(`filter`,{id:`phmGlow`,x:`-30%`,y:`-50%`,width:`160%`,height:`200%`,children:[(0,Y.jsx)(`feGaussianBlur`,{stdDeviation:`2.3`,result:`b`}),(0,Y.jsx)(`feColorMatrix`,{in:`b`,type:`matrix`,values:`
                  1 0 0 0 0
                  0 1 0 0 0
                  0 0 1 0 0
                  0 0 0 .55 0`})]})]}),u.d?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(`path`,{d:`${u.d} L 410 76 L 10 76 Z`,fill:`url(#phmFill)`,opacity:`0.9`}),(0,Y.jsx)(`path`,{d:u.d,stroke:`url(#phmLine)`,strokeWidth:`3`,fill:`none`,filter:`url(#phmGlow)`,opacity:`0.8`}),(0,Y.jsx)(`path`,{d:u.d,stroke:`url(#phmLine)`,strokeWidth:`1.6`,fill:`none`,opacity:`0.95`}),_>0?(0,Y.jsx)(`circle`,{className:`phmChartDot`,cx:u.xAt(_-1),cy:u.yAt(l[_-1]??0),r:`3.2`}):null]}):(0,Y.jsx)(`text`,{x:`50%`,y:`52%`,textAnchor:`middle`,fill:`rgba(255,255,255,0.62)`,fontSize:`12`,children:`No data`})]}),(0,Y.jsxs)(`div`,{className:`phmChartBottomRow`,"aria-hidden":`true`,children:[(0,Y.jsx)(`span`,{className:`phmChartSub`,children:A}),(0,Y.jsx)(`span`,{className:`phmChartChg`,children:S!=null&&Number.isFinite(S)?`${S>=0?`+`:``}${S.toFixed(2)}%`:``})]})]}),(0,Y.jsx)(xn,{open:!!(C&&h),locked:p,x:h?.x??0,y:h?.y??0,mode:n,tip:C})]})}var Cn=W.memo(function(e){let{node:t,x:n,y:r,selected:i,isOrigin:a,onClick:o}=e,s=Yt(typeof t.pulse==`number`&&Number.isFinite(t.pulse)?t.pulse:0),c=Xt(s),l=Ht(t.chakraDay),u=Qt(`${s}:${l}`),d=(Zt(t.hash)-.5)*220*Jt,f=[];typeof t.pulse==`number`&&f.push(`pulse ${t.pulse}`),Number.isFinite(c.beat)&&Number.isFinite(c.stepIndex)&&f.push(`beat ${c.beat} step ${c.stepIndex}`),t.chakraDay&&f.push(t.chakraDay),f.push(zt(t.hash,12));let p=f.join(` — `);return(0,Y.jsx)(`button`,{type:`button`,className:[`sigilHex`,hn(t.chakraDay),t.transferDirection?`xfer-${t.transferDirection}`:``,a?`isOrigin`:``,i?`isSelected`:``].join(` `),style:{transform:`translate3d(${n}px, ${r}px, ${d.toFixed(2)}px)`},onClick:o,"aria-label":p,title:p,children:(0,Y.jsxs)(`div`,{className:`sigilHexInner`,children:[(0,Y.jsx)(`div`,{className:`sigilHexGlyphFrame`,"aria-hidden":`true`,children:u?(0,Y.jsx)(se,{pulse:s,beat:c.beat,stepIndex:c.stepIndex,stepPct:c.stepPct,chakraDay:l,size:48,hashMode:`deterministic`,animate:!1}):(0,Y.jsx)(`div`,{className:`sigilHexGlyphPlaceholder`})}),(0,Y.jsxs)(`div`,{className:`sigilHexTop`,children:[(0,Y.jsx)(`span`,{className:`sigilHexPulse`,children:typeof t.pulse==`number`?t.pulse:`—`}),(0,Y.jsx)(`span`,{className:`sigilHexHash`,children:zt(t.hash)})]}),(0,Y.jsxs)(`div`,{className:`sigilHexMid`,children:[(0,Y.jsxs)(`span`,{className:`sigilHexBeat`,children:[c.beat,`:`,c.stepIndex]}),(0,Y.jsx)(`span`,{className:`sigilHexDelta`,children:Ft(t.phiDelta)??`—`})]}),(0,Y.jsx)(`div`,{className:`sigilHexBot`,children:(0,Y.jsx)(`span`,{className:`sigilHexChakra`,children:t.chakraDay||`—`})})]})})});function wn(e){let{open:t,pulse:n,originUrl:r,originHash:i,anchor:a,registryRev:o,onClose:s}=e,c=(0,W.useRef)(null),l=(0,W.useRef)(0),u=pn(`(max-width: 720px), (max-height: 720px)`),d=!!a&&!u;mn({enabled:t&&d,shellRef:c,anchor:a}),(0,W.useEffect)(()=>{if(!t||!u||!Dt)return;let e={bodyPosition:document.body.style.position,bodyTop:document.body.style.top,bodyLeft:document.body.style.left,bodyRight:document.body.style.right,bodyWidth:document.body.style.width,bodyHeight:document.body.style.height,bodyOverflow:document.body.style.overflow,bodyTouchAction:document.body.style.touchAction,htmlOverflow:document.documentElement.style.overflow,htmlHeight:document.documentElement.style.height,htmlOverscroll:document.documentElement.style.getPropertyValue(`overscroll-behavior`),bodyOverscroll:document.body.style.getPropertyValue(`overscroll-behavior`),htmlTouchAction:document.documentElement.style.touchAction};l.current=window.scrollY||window.pageYOffset||0,document.body.style.position=`fixed`,document.body.style.top=`-${l.current}px`,document.body.style.left=`0`,document.body.style.right=`0`,document.body.style.width=`100%`,document.body.style.height=`100%`,document.body.style.overflow=`hidden`,document.documentElement.style.overflow=`hidden`,document.documentElement.style.height=`100%`,document.documentElement.style.setProperty(`overscroll-behavior`,`none`),document.body.style.setProperty(`overscroll-behavior`,`none`),document.documentElement.style.touchAction=`none`,document.body.style.touchAction=`none`;let n=e=>{if(!e.cancelable)return;let t=e.target;t&&c.current?.contains(t)||e.preventDefault()};return document.addEventListener(`touchmove`,n,{passive:!1}),()=>{document.removeEventListener(`touchmove`,n),document.body.style.position=e.bodyPosition,document.body.style.top=e.bodyTop,document.body.style.left=e.bodyLeft,document.body.style.right=e.bodyRight,document.body.style.width=e.bodyWidth,document.body.style.height=e.bodyHeight,document.body.style.overflow=e.bodyOverflow,document.body.style.touchAction=e.bodyTouchAction,document.documentElement.style.overflow=e.htmlOverflow,document.documentElement.style.height=e.htmlHeight,document.documentElement.style.setProperty(`overscroll-behavior`,e.htmlOverscroll),document.body.style.setProperty(`overscroll-behavior`,e.bodyOverscroll),document.documentElement.style.touchAction=e.htmlTouchAction,window.scrollTo(0,l.current)}},[t,u]),(0,W.useEffect)(()=>{if(!Dt||!t)return;let e=e=>{e.key===`Escape`&&s()};return window.addEventListener(`keydown`,e),window.setTimeout(()=>{(c.current?.querySelector(`.phmBtnClose`))?.focus()},0),()=>window.removeEventListener(`keydown`,e)},[t,s]),(0,W.useEffect)(()=>{if(!Dt||!t)return;let e=document.documentElement,n=document.body,r=e.style.overflow,i=n.style.overflow;return e.style.overflow=`hidden`,n.style.overflow=`hidden`,()=>{e.style.overflow=r,n.style.overflow=i}},[t]);let f=Dt?document.body:null;if(!t||f==null)return null;let p=`${n??`none`}:${i??``}:${r??``}`,m=[`phmBackdrop`,d?`phmBackdrop--anchored`:``,u?`phmBackdrop--sheet`:``].filter(Boolean).join(` `),h=[`phmShell`,d?`phmShell--anchored`:``,u?`phmShell--sheet`:``].filter(Boolean).join(` `);return(0,Tt.createPortal)((0,Y.jsxs)(`div`,{className:m,role:`presentation`,children:[d?null:(0,Y.jsx)(`div`,{style:{position:`fixed`,inset:0,pointerEvents:`auto`},onMouseDown:()=>s(),"aria-hidden":`true`}),(0,Y.jsx)(`div`,{ref:c,className:h,role:`dialog`,"aria-modal":!d,"aria-label":`Pulse Atlas`,"data-anchored":d?`1`:`0`,"data-phm-version":Et,children:(0,Y.jsx)(Tn,{pulse:n,originUrl:r,originHash:i,registryRev:o,onClose:s},p)})]}),f)}function Tn({pulse:e,originUrl:t,originHash:n,registryRev:r,onClose:i}){let[a]=(0,W.useState)(`parent+children`),[o,c]=(0,W.useState)(null),[l,d]=(0,W.useState)(null),[f,p]=(0,W.useState)(()=>u(new Date)),m=(0,W.useRef)(null),[h,g]=(0,W.useState)({w:0,h:0}),[_,v]=(0,W.useState)(1),[y,b]=(0,W.useState)(!1),[x,S]=(0,W.useState)({x:0,y:0}),C=(0,W.useRef)({active:!1,x0:0,y0:0,panX0:0,panY0:0});(0,W.useEffect)(()=>{if(!Dt)return;let e=window.setInterval(()=>p(u(new Date)),6e3);return()=>window.clearInterval(e)},[]),(0,W.useEffect)(()=>{let e=m.current;if(!e||typeof ResizeObserver>`u`)return;let t=new ResizeObserver(e=>{let t=e[0]?.contentRect;t&&g({w:Math.round(t.width),h:Math.round(t.height)})});return t.observe(e),()=>t.disconnect()},[]),(0,W.useEffect)(()=>{if(!Dt)return;let e=m.current;if(!e)return;let t=0,n=0,r=e=>{e.touches.length===1&&(t=e.touches[0]?.clientY??0,n=e.touches[0]?.clientX??0)},i=e=>{if(!e.cancelable||e.touches.length!==1)return;let r=e.touches[0]?.clientY??0,i=e.touches[0]?.clientX??0,a=r-t,o=i-n;t=r,n=i,!(Math.abs(a)<=Math.abs(o))&&a>0&&window.scrollY<=0&&e.preventDefault()};return e.addEventListener(`touchstart`,r,{passive:!0}),e.addEventListener(`touchmove`,i,{passive:!1}),()=>{e.removeEventListener(`touchstart`,r),e.removeEventListener(`touchmove`,i)}},[]);let w=typeof e==`number`?e:null,T=(0,W.useMemo)(()=>w==null?[]:on(w),[w,r]),E=(0,W.useMemo)(()=>n??(t?$t(t):null)??null,[n,t]),D=(0,W.useMemo)(()=>{let e=new Map;for(let t of T)e.set(t.hash,t);return e},[T]),O=(0,W.useMemo)(()=>{let e=new Map;for(let t of T){if(!t.parentHash)continue;let n=e.get(t.parentHash)??[];n.push(t.hash),e.set(t.parentHash,n)}return e},[T]),ee=(0,W.useMemo)(()=>{if(T.length===0)return null;if(E&&D.has(E))return E;let e=null;for(let t of T)e?t.degree>e.degree&&(e=t):e=t;return e?.hash??T[0].hash},[T,E,D]),k=(0,W.useMemo)(()=>{let e=o?o.toLowerCase():null;return e&&D.has(e)?e:ee},[o,D,ee]),A=(0,W.useMemo)(()=>k?D.get(k)??null:null,[k,D]),te=!!A?.originHash,ne=l??(te?`usd`:`phi`),re=(0,W.useMemo)(()=>w==null?null:le(w),[w]),ie=w==null?`—`:w.toLocaleString(),M=re?.chakraDay??`Root`,N=re?.beat??`—`,ae=re?.stepIndex??`—`,oe=(0,W.useMemo)(()=>{let e=A?.userPhiKey?A.userPhiKey:void 0,t=A?.kaiSignature?A.kaiSignature:void 0;if(e||t)return{userPhiKey:e,kaiSignature:t,hash:A?.hash??null};if(w==null)return{userPhiKey:void 0,kaiSignature:void 0,hash:null};let n=null,r=-1;for(let[,e]of j){if(!Pt(e)||X(e.pulse)!==w)continue;let t=Ft(e.userPhiKey),i=It(e.kaiSignature),a=(t?1:0)+(i?1:0);if(a>r&&(r=a,n={userPhiKey:t,kaiSignature:i}),r>=2)break}return{userPhiKey:n?.userPhiKey,kaiSignature:n?.kaiSignature,hash:A?.hash??null}},[A?.userPhiKey,A?.kaiSignature,A?.hash,w]),P=(0,W.useMemo)(()=>{if(w==null)return{phi:null,usd:null,usdPerPhi:null};let e=0,t=null;for(let[,n]of j){if(!Pt(n)||X(n.pulse)!==w)continue;let r=X(n.pulse)??w,i=dn(n,tn(n)==null?f:r);if(i!=null&&(e+=i),t==null){let e=fn(n,f);e!=null&&(t=e)}}let n=Number.isFinite(e)?e:null;return{phi:n,usd:n!=null&&t!=null?n*t:null,usdPerPhi:t}},[w,f,r]),ce=(0,W.useMemo)(()=>{if(w==null||f==null)return null;let e=null;for(let[,t]of j)if(Pt(t)&&X(t.pulse)===w){e=t;break}if(!e)return null;let t=un(e),{unsigned:n}=_e(t,f);return s({version:1,unit:`Φ`,algorithm:`phi/kosmos-vφ-5`,policyChecksum:n.policyChecksum,valuePhi:n.valuePhi,premium:n.premium,inputs:n.inputs,computedAtPulse:n.computedAtPulse,headRef:n.headRef,stamp:`0`},t,f,64)},[w,f,r]),F=(0,W.useMemo)(()=>{let e=T.length,t=cn(e),n=Math.round(30*Jt),r=t.map(e=>ln(e,n)),i=1/0,a=1/0,o=-1/0,s=-1/0;for(let e of r)i=Math.min(i,e.x),a=Math.min(a,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y);let c=Math.sqrt(3)*n,l=2*n,u=(Number.isFinite(i)?-i:0)+120,d=(Number.isFinite(a)?-a:0)+120,f=T.map((e,t)=>{let n=r[t]??{x:0,y:0};return{node:e,x:n.x+u-c/2,y:n.y+d-l/2,cx:n.x+u,cy:n.y+d}}),p=(Number.isFinite(o-i)?o-i:0)+240+c,m=(Number.isFinite(s-a)?s-a:0)+240+l,h=new Map;for(let e of f)h.set(e.node.hash,e);return{width:p,height:m,items:f,itemByHash:h,centerOf:e=>{if(!e)return null;let t=h.get(e);return t?{x:t.cx,y:t.cy}:null}}},[T]),I=(0,W.useMemo)(()=>{if(!k||!h.w||!h.h)return{x:0,y:0};let e=F.centerOf(k);return e?{x:h.w/2-e.x*_,y:h.h/2-e.y*_}:{x:0,y:0}},[k,h.w,h.h,F,_]),ue=y?x:I,de=(0,W.useMemo)(()=>{if(!k||a===`none`)return[];let e=F.itemByHash.get(k),t=D.get(k);if(!e||!t)return[];let n=[],r=(t,r)=>{if(!t)return;let i=F.itemByHash.get(t);i&&n.push({x1:e.cx,y1:e.cy,x2:i.cx,y2:i.cy,kind:r})};if((a===`parent`||a===`parent+children`||a===`all`)&&r(t.parentHash,`parent`),a===`parent+children`||a===`all`){let e=O.get(t.hash)??[];for(let t of e)r(t,`child`)}return a===`all`&&r(t.originHash,`origin`),n},[k,a,F,D,O]),L=e=>{let t=e.toLowerCase();c(t),d(null),Rt(t),b(!1),S({x:0,y:0})},R=e=>{let t=m.current;if(!t)return;let n=Nt(_*(e.deltaY>0?.92:1.08),.35,3),r=t.getBoundingClientRect(),i=e.clientX-r.left,a=e.clientY-r.top,o=ue,s=(i-o.x)/_,c=(a-o.y)/_,l=i-s*n,u=a-c*n;v(n),b(!0),S({x:l,y:u})},fe=e=>{e.button===0&&(e.target instanceof HTMLElement&&e.target.closest(`.sigilHex`)||(b(!0),C.current={active:!0,x0:e.clientX,y0:e.clientY,panX0:ue.x,panY0:ue.y},e.currentTarget.setPointerCapture(e.pointerId)))},pe=e=>{if(!C.current.active)return;let t=e.clientX-C.current.x0,n=e.clientY-C.current.y0;S({x:C.current.panX0+t,y:C.current.panY0+n})},z=e=>{C.current.active=!1;try{e.currentTarget.releasePointerCapture(e.pointerId)}catch{}},me=()=>{A&&window.open(A.bestUrl,`_blank`,`noopener,noreferrer`)},B=async()=>{A&&await Ut(A.bestUrl)},V=()=>{d(e=>(e??(te?`usd`:`phi`))===`phi`?`usd`:`phi`)},he=ne===`phi`?P.phi==null?`—`:`${Vt(P.phi)} Φ`:P.usd==null?`—`:`$${Bt(P.usd)}`,ge=ne===`phi`?P.usd==null?`—`:`$${Bt(P.usd)}`:P.phi==null?`—`:`${Vt(P.phi)} Φ`,H=P.usdPerPhi==null?`—`:`$${Bt(P.usdPerPhi)} / Φ`,U=oe.userPhiKey,ve=oe.kaiSignature,ye=A?.hash??null;return(0,Y.jsxs)(`div`,{className:`phmRoot`,"aria-label":`Pulse Atlas`,"data-phm-version":Et,children:[(0,Y.jsxs)(`header`,{className:`phmHeader`,children:[(0,Y.jsxs)(`div`,{className:`phmHeaderLeft`,children:[(0,Y.jsxs)(`div`,{className:`phmSigilCard`,"aria-label":`Pulse sigil glyph`,children:[(0,Y.jsx)(`div`,{className:`phmSigilFrame`,children:w==null?(0,Y.jsx)(`div`,{className:`phmSigilPlaceholder`}):(0,Y.jsx)(se,{pulse:w,chakraDay:M,size:56,animate:!0})}),(0,Y.jsxs)(`div`,{className:`phmSigilMeta`,children:[(0,Y.jsxs)(`div`,{className:`phmSigilPulse`,children:[`☤KAI `,ie]}),(0,Y.jsxs)(`div`,{className:`phmSigilSub`,children:[(0,Y.jsxs)(`span`,{children:[`Beat `,N]}),(0,Y.jsx)(`span`,{className:`phmDot`,children:`•`}),(0,Y.jsxs)(`span`,{children:[`Step `,ae]}),(0,Y.jsx)(`span`,{className:`phmDot`,children:`•`}),(0,Y.jsx)(`span`,{children:M})]})]})]}),(0,Y.jsxs)(`button`,{type:`button`,className:`phmValueCard phmValueCard--switch`,onClick:V,"aria-label":`Toggle value unit`,children:[(0,Y.jsx)(`div`,{className:`phmValueLabel`,children:`Asset Value`}),(0,Y.jsx)(`div`,{className:`phmValuePrimary`,children:he}),(0,Y.jsx)(`div`,{className:`phmValueSecondary`,children:ge}),(0,Y.jsx)(`div`,{className:`phmValueMeta`,children:H})]}),(0,Y.jsx)(`div`,{className:`phmHeaderStack`,children:(0,Y.jsx)(`div`,{className:`phmChartWrap`,"aria-label":`Asset value chart`,children:ce?(0,Y.jsx)(Sn,{lineData:ce.lineData,mode:ne,usdPerPhiFallback:P.usdPerPhi,livePhi:P.phi,liveUsd:P.usd,usdPerPhiNow:P.usdPerPhi}):(0,Y.jsx)(`div`,{className:`phmChart phmChart--lite phmChartEmpty`,children:`No pulse data`})})})]}),(0,Y.jsxs)(`div`,{className:`phmHeaderRight`,children:[(0,Y.jsxs)(`div`,{className:`phmProofStrip`,"aria-label":`Proof details`,children:[ye?(0,Y.jsxs)(`button`,{type:`button`,className:`phmProofItem`,onClick:()=>Ut(ye),title:ye,children:[(0,Y.jsx)(`span`,{className:`phmProofK`,children:`Key`}),(0,Y.jsx)(`span`,{className:`phmProofV mono`,children:zt(ye,16)})]}):null,U?(0,Y.jsxs)(`button`,{type:`button`,className:`phmProofItem`,onClick:()=>Ut(U),title:U,children:[(0,Y.jsx)(`span`,{className:`phmProofK`,children:`ΦKey`}),(0,Y.jsx)(`span`,{className:`phmProofV mono`,children:zt(U,18)})]}):null,ve?(0,Y.jsxs)(`button`,{type:`button`,className:`phmProofItem`,onClick:()=>Ut(ve),title:ve,children:[(0,Y.jsx)(`span`,{className:`phmProofK`,children:`KaiSig`}),(0,Y.jsx)(`span`,{className:`phmProofV mono`,children:zt(ve,18)})]}):null]}),(0,Y.jsx)(`button`,{type:`button`,className:`phmBtn phmBtnClose`,onClick:i,"aria-label":`Close`,children:`✕`})]})]}),(0,Y.jsx)(`div`,{className:`phmBody`,children:(0,Y.jsx)(`div`,{className:`phmCombPanel`,children:(0,Y.jsxs)(`div`,{className:`phmViewport combViewport`,ref:m,onWheel:R,onPointerDown:fe,onPointerMove:pe,onPointerUp:z,onPointerCancel:z,children:[(0,Y.jsxs)(`div`,{className:`combInner`,style:{width:`${F.width}px`,height:`${F.height}px`,transform:`translate(${ue.x}px, ${ue.y}px) scale(${_})`},children:[(0,Y.jsx)(`svg`,{className:`combEdges`,width:F.width,height:F.height,"aria-hidden":`true`,children:de.map((e,t)=>(0,Y.jsx)(`line`,{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,className:`edgeLine edge-${e.kind}`,vectorEffect:`non-scaling-stroke`},`${e.kind}-${t}`))}),F.items.map(e=>(0,Y.jsx)(Cn,{node:e.node,x:e.x,y:e.y,isOrigin:E!=null&&e.node.hash===E,selected:e.node.hash===k,onClick:()=>L(e.node.hash)},e.node.hash))]}),(0,Y.jsx)(`div`,{className:`combHint phmHint`,children:`Pulse lattice • drag to pan • scroll to zoom`})]})})}),(0,Y.jsxs)(`footer`,{className:`phmBottomBar`,"aria-label":`Actions`,children:[(0,Y.jsxs)(`div`,{className:`phmSelChip`,title:A?.hash??``,children:[(0,Y.jsx)(`span`,{className:`phmSelLabel`,children:`SEL`}),(0,Y.jsx)(`span`,{className:`phmSelHash`,children:A?zt(A.hash,18):`—`})]}),(0,Y.jsxs)(`div`,{className:`phmBottomActions`,children:[(0,Y.jsx)(`button`,{type:`button`,className:`phmMiniBtn`,onClick:me,disabled:!A,children:`Proof of Breath™`}),(0,Y.jsx)(`button`,{type:`button`,className:`phmMiniBtn phmMiniBtn--glow`,onClick:B,disabled:!A,children:`Remember`})]})]})]})}var Z=typeof window<`u`,En=`sigil:explorer:open`,Dn=`sigil:explorer:bc:v1`,On=520,kn=900,An=80,jn=80,Mn=25e4,Nn=18;function Pn(){let e;for(let[,t]of j){let n=t.pulse;typeof n!=`number`||!Number.isFinite(n)||(e==null||n>e)&&(e=n)}return e}function Fn(e){let t=e?.pulse??e?.latestPulse??e?.latest_pulse;if(!(typeof t!=`number`||!Number.isFinite(t)))return t}var In=`/phi.svg`,Q=`phi`;function Ln({className:e}){return(0,Y.jsx)(`img`,{className:[`phi-mark`,e].filter(Boolean).join(` `),src:In,alt:Q,decoding:`async`,loading:`lazy`,draggable:!1})}function $(e,t){return(0,Y.jsxs)(`span`,{className:[`phi-amount`,t?.className].filter(Boolean).join(` `),children:[t?.sign?(0,Y.jsx)(`span`,{className:`phi-amount__sign`,children:t.sign}):null,(0,Y.jsx)(`span`,{className:`phi-amount__value`,children:V(e)}),(0,Y.jsx)(Ln,{className:[`phi-amount__mark`,t?.markClassName].filter(Boolean).join(` `)})]})}function Rn(){return Date.now()}function zn(){return Z?new Promise(e=>{if(typeof window.requestAnimationFrame==`function`){window.requestAnimationFrame(()=>e());return}window.setTimeout(e,0)}):Promise.resolve()}function Bn(e){let t=(Z?window:null)?.CSS?.escape;return typeof t==`function`?t(e):e.replace(/["\\]/g,`\\$&`)}function Vn(e){return!!e&&typeof e==`object`&&!Array.isArray(e)}function Hn(e,t){return Vn(e)&&typeof e[t]==`string`}function Un(e){if(typeof e==`number`&&Number.isFinite(e))return e;if(typeof e==`string`){let t=Number(e);if(!Number.isNaN(t)&&Number.isFinite(t))return t}}function Wn(e){if(typeof e==`boolean`)return e}function Gn(e){if(e===`low`||e===`med`||e===`high`)return e}function Kn(e){let t=e,n=Un(e.stepsPerBeat),r=Array.isArray(t.transfers)?t.transfers:void 0,i=Array.isArray(t.segments)?t.segments:void 0,a=Vn(t.ip)?t.ip:void 0;return{pulse:e.pulse,kaiPulse:e.pulse,beat:e.beat,stepIndex:e.stepIndex,stepsPerBeat:Un(t.stepsPerBeat)??n,kaiSignature:e.kaiSignature,userPhiKey:e.userPhiKey,chakraDay:e.chakraDay,chakraGate:typeof t.chakraGate==`string`?t.chakraGate:void 0,seriesSize:Un(t.seriesSize),quality:Gn(t.quality),creatorVerified:Wn(t.creatorVerified),creatorRep:Un(t.creatorRep),frequencyHz:Un(t.frequencyHz),transfers:r,cumulativeTransfers:Un(t.cumulativeTransfers),segments:i,segmentsMerkleRoot:typeof t.segmentsMerkleRoot==`string`?t.segmentsMerkleRoot:void 0,transfersWindowRoot:typeof t.transfersWindowRoot==`string`?t.transfersWindowRoot:void 0,ip:a}}function qn(e,t){if(t==null||!Number.isFinite(t))return null;try{let{unsigned:n}=_e(Kn(e),t);return Number.isFinite(n.valuePhi)?n.valuePhi:null}catch{return null}}function Jn(e,t){if(t==null||!Number.isFinite(t))return null;try{let n=f({meta:Kn(e),nowPulse:t,usd:100,currentStreakDays:0,lifetimeUsdSoFar:0},c);return Number.isFinite(n.usdPerPhi)?n.usdPerPhi:null}catch{return null}}function Yn(e){if(!Z||typeof Worker>`u`||e.length<Mn)return Promise.resolve(JSON.parse(e));let t=null,n=``;try{let e=new Blob([`
    self.onmessage = (event) => {
      try {
        const parsed = JSON.parse(event.data);
        self.postMessage({ ok: true, value: parsed });
      } catch (err) {
        self.postMessage({ ok: false, error: err && err.message ? err.message : "parse-failed" });
      }
    };
  `],{type:`text/javascript`});n=URL.createObjectURL(e),t=new Worker(n)}catch{return n&&URL.revokeObjectURL(n),Promise.resolve(JSON.parse(e))}return new Promise((r,i)=>{let a=()=>{t?.terminate(),n&&URL.revokeObjectURL(n)};t.onmessage=e=>{let t=e.data;a(),t?.ok?r(t.value):i(Error(t?.error??`parse-failed`))},t.onerror=()=>{a(),i(Error(`parse-failed`))},t.postMessage(e)})}function Xn(e){let t=E(e.url);return t===`stream`?`inhale`:t===`post`?`exhale`:null}function Zn(e,t){let n=Ee(Le(e),t);if(n)return n;let r=we(e.payload);if(r)return r;let i=e.payload,a=Te(i);if(a)return a;if(Vn(i.feed)){let e=Te(i.feed);if(e)return e}for(let t of e.urls){let e=ye(t);if(!e)continue;let n=we(e);if(n)return n;let r=Te(e);if(r)return r}}function Qn(e){if(typeof e!=`string`)return null;let t=e.trim().toLowerCase();return t?t.includes(`receive`)||t.includes(`received`)||t.includes(`inhale`)?`receive`:t.includes(`send`)||t.includes(`sent`)||t.includes(`exhale`)?`send`:null:null}function $n(e){let t=e;return Qn(t.transferDirection)||Qn(t.transferMode)||Qn(t.transferKind)||Qn(t.phiDirection)}function er(e){let t=e,n=t.transferNonce??t.nonce;return typeof n==`string`&&n.trim()?n.trim():null}function tr(e){let t=e,n=t.canonicalHash??t.childHash??t.hash;return typeof n==`string`&&n.trim()?n.trim().toLowerCase():null}function nr(e){let t=new Set,n=new Set;for(let r of e.values()){if($n(r)!==`receive`)continue;let e=er(r);e&&t.add(e);let i=tr(r);i&&n.add(i)}return{nonces:t,canonicals:n}}function rr(e,t,n){let r=Zn(e,t);if(!r)return null;if(r.direction===`receive`)return`received`;let i=er(e.payload);if(i&&n.nonces.has(i))return`received`;let a=Le(e);return a&&n.canonicals.has(a)?`received`:`pending`}function ir(e,t,n,r,i){let a=e.payload,o=[],s=new Set,c=Zn(e,n),l=c?rr(e,n,r):null,u=l===`pending`&&c?c.amount:i?.netPhi??null,d=l===`pending`&&c?c.amountUsd??(i?.usdPerPhi==null?null:c.amount*i.usdPerPhi):i?.usdValue??null;u!=null&&o.push({label:(0,Y.jsxs)(`span`,{className:`phi-detail__label`,children:[`Live `,(0,Y.jsx)(Ln,{className:`phi-detail__mark`}),` value`]}),value:$(u),valueText:`${V(u)} ${Q}`}),d!=null&&o.push({label:`Live USD`,value:`$${A(d)}`});let f=i?.pendingFromChildren??0,p=i?.pendingFromParent??0,m=e.children.length>0?f:f+p;m>0&&o.push({label:`Exhale (pending)`,value:$(m,{sign:`-`}),valueText:`-${V(m)} ${Q}`});let h=i?.receivedFromChildren??0;h>0&&o.push({label:(0,Y.jsxs)(`span`,{className:`phi-detail__label`,children:[(0,Y.jsx)(Ln,{className:`phi-detail__mark`}),` Exhaled`]}),value:$(h,{sign:`-`}),valueText:`-${V(h)} ${Q}`});let g=re(e.payload);if(g!==void 0&&o.push({label:(0,Y.jsxs)(`span`,{className:`phi-detail__label`,children:[`This glyph `,(0,Y.jsx)(Ln,{className:`phi-detail__mark`})]}),value:$(g),valueText:`${V(g)} ${Q}`}),c){let e=c.direction===`receive`?`Inhaled`:`Exhaled`,t=c.direction===`receive`?`Inhale (pending)`:`Exhale (pending)`,n=c.sentPulse===void 0?``:` • pulse ${c.sentPulse}`,r=c.sentPulse===void 0?``:` (pulse ${c.sentPulse})`;l&&o.push({label:`Transfer status`,value:`${l===`pending`?t:e}${n}`}),l===`received`&&o.push({label:(0,Y.jsxs)(`span`,{className:`phi-detail__label`,children:[(0,Y.jsx)(Ln,{className:`phi-detail__mark`}),` `,e,r]}),value:$(c.amount,{sign:`+`}),valueText:`+${V(c.amount)} ${Q}`}),c.amountUsd!==void 0&&o.push({label:`USD value`,value:`$${A(c.amountUsd)}`}),c.sentPulse!==void 0&&o.push({label:`Sent pulse`,value:String(c.sentPulse)});let i=c;Hn(i,`txHash`)&&o.push({label:`Tx hash`,value:i.txHash})}let _=a.feed,v=typeof _?.author==`string`?_.author:typeof a.author==`string`?a.author:void 0,y=_?_.usernameClaim:void 0,b=y?z(y.payload?.normalized||y.payload?.username||``):``,x=z(v??``),S=b||x;if(S){let e=t[S],n=typeof v==`string`&&v.trim().length>0?v.trim():`@${S}`;e?(o.push({label:`Username (claimed)`,value:`${n} → glyph ${R(e.claimHash,10)}`}),o.push({label:`Claim glyph`,value:I(e.claimUrl)})):o.push({label:`Username`,value:n})}let C=(e,t)=>{let n=a[e];typeof n==`string`&&n.trim().length>0&&!s.has(e)&&(o.push({label:t,value:n.trim()}),s.add(e))};C(`userPhiKey`,`PhiKey`),C(`phiKey`,`PhiKey`),C(`phikey`,`PhiKey`),C(`kaiSignature`,`Kai Signature`),typeof a.parentUrl==`string`&&a.parentUrl.length>0&&o.push({label:`Parent URL`,value:I(a.parentUrl)}),typeof a.originUrl==`string`&&a.originUrl.length>0&&o.push({label:`Origin URL`,value:I(a.originUrl)});let w=a.label??a.title??a.type??a.note??a.description;typeof w==`string`&&w.trim().length>0&&o.push({label:`Label / Type`,value:w.trim()}),o.push({label:`Primary URL`,value:I(e.url)});let T=e.urls.filter(e=>!ve(e)).map(e=>I(e));return e.urls.length>1&&o.push({label:`URL variants`,value:T.length===0?`${e.urls.length} urls (kept in data; hidden from browser view)`:T.length<=3?T.join(` | `):`${e.urls.length} urls (kept in data; rendered once)`}),o.slice(0,12)}async function ar(e){if(Z){try{if(navigator.clipboard&&typeof navigator.clipboard.writeText==`function`){await navigator.clipboard.writeText(e);return}}catch{}try{let t=document.createElement(`textarea`);t.value=e,t.setAttribute(`readonly`,`true`),t.style.position=`fixed`,t.style.left=`-9999px`,t.style.top=`-9999px`,document.body.appendChild(t),t.select(),document.execCommand(`copy`),document.body.removeChild(t)}catch{}}}async function or(e){if(Z)try{await fetch(e,{method:`GET`,cache:`force-cache`,mode:`cors`,credentials:`omit`,redirect:`follow`})}catch{}}function sr({p:e}){let t=typeof e.pulse==`number`?e.pulse:0,n=typeof e.stepsPerBeat==`number`&&e.stepsPerBeat>0?e.stepsPerBeat:44,r=typeof e.stepIndex==`number`?e.stepIndex:typeof e.pulse==`number`?D(e.pulse,n):0,i=typeof e.beat==`number`?e.beat:0;return(0,Y.jsxs)(`span`,{className:`k-stamp`,title:`pulse ${t} • beat ${i} • step ${r}`,children:[(0,Y.jsxs)(`span`,{className:`k-pill`,children:[`☤KAI `,t]}),(0,Y.jsx)(`span`,{className:`k-dot`,children:`•`}),(0,Y.jsxs)(`span`,{className:`k-pill`,children:[`beat `,i]}),(0,Y.jsx)(`span`,{className:`k-dot`,children:`•`}),(0,Y.jsxs)(`span`,{className:`k-pill`,children:[`step `,r]})]})}function cr({node:e,expanded:t,toggle:n,phiTotalsByPulse:r,usernameClaims:i,transferRegistry:a,receiveLocks:o,valueSnapshots:s}){let c=t.has(e.id),l=Le(e),u=e.payload.kaiSignature,d=e.payload.chakraDay,f=typeof e.payload.pulse==`number`?e.payload.pulse:void 0,p=f==null?void 0:r.get(f),m=he(e.url),h=s.get(e.id)??null,g=c?ir(e,i,a,o,h):[],_=Zn(e,a),v=rr(e,a,o),y=Xn(e),b=!(e.children.length>0),x=h?.netPhi??null,S=h?.usdValue??null,C=v===`pending`&&_?_.amount:x,w=v===`pending`&&_?_.amountUsd??(h?.usdPerPhi==null?null:_.amount*h.usdPerPhi):S,T=h?.pendingFromChildren??0,E=h?.pendingFromParent??0,D=h?.receivedFromChildren??0,O=T+D,ee=O>0?D/O:0,k=T>0&&D>0?{"--exhale-rgb":`${Math.round(255*(.85+.15*ee))},${Math.round(140*(1-ee)+75*ee)},${Math.round(80*(1-ee)+110*ee)}`}:void 0,te=T>0?`Exhale (pending) children: -${V(T)} ${Q}${C===null?``:` • Live ${V(Math.max(0,C))} ${Q}`}`:void 0,j=E>0?`Exhale (pending) send: -${V(E)} ${Q}${C===null?``:` • Live ${V(Math.max(0,C))} ${Q}`}`:void 0,ne=b&&E>0&&v!==`pending`,re=D>0?`Exhaled: -${V(D)} ${Q}${C===null?``:` • Live ${V(Math.max(0,C))} ${Q}`}`:void 0,ie=C===null?void 0:`Live value: ${V(C)} ${Q}${w===null?``:` • $${A(w)}`}`,M=_&&v===`received`?{direction:`send`,sign:`-`,titleVerb:_.direction===`receive`?`inhaled`:`exhaled`}:_?{direction:`pending`,sign:`-`,titleVerb:_.direction===`receive`?`inhaled`:`exhaled`}:null;return(0,Y.jsxs)(`div`,{className:`node`,style:G(d),"data-chakra":String(d??``),"data-node-id":e.id,children:[(0,Y.jsxs)(`div`,{className:`node-row`,children:[(0,Y.jsxs)(`div`,{className:`node-main`,children:[(0,Y.jsx)(`button`,{className:`twirl`,"aria-label":c?`Collapse memories`:`Expand memories`,"aria-expanded":c,onClick:()=>n(e.id),title:c?`Collapse`:`Expand`,type:`button`,children:(0,Y.jsx)(`span`,{className:`tw ${c?`open`:``}`})}),(0,Y.jsx)(`a`,{className:`node-link`,href:m,target:`_blank`,rel:`noopener noreferrer`,title:m,children:(0,Y.jsx)(`span`,{children:R(u??l??`glyph`,12)})})]}),(0,Y.jsxs)(`div`,{className:`node-meta`,children:[(0,Y.jsx)(sr,{p:e.payload}),d&&(0,Y.jsx)(`span`,{className:`chakra`,title:String(d),children:String(d)}),b&&_&&M&&(0,Y.jsxs)(`span`,{className:`phi-move phi-move--${M.direction}`,title:`Phi ${M.titleVerb}${v===`pending`?` (pending)`:``}: ${V(_.amount)} ${Q}${_.amountUsd===void 0?``:` • $${A(_.amountUsd)}`}${_.sentPulse===void 0?``:` • sent pulse ${_.sentPulse}`}`,children:[(0,Y.jsx)(`span`,{className:`phi-move__sign`,"aria-hidden":`true`,children:M.sign}),$(_.amount,{className:`phi-move__amount`,markClassName:`phi-move__mark`}),v===`received`&&_.amountUsd!==void 0&&(0,Y.jsxs)(`span`,{className:`phi-move__usd`,children:[`$`,A(_.amountUsd)]}),v===`received`&&_.amountUsd===void 0&&h?.usdPerPhi!=null&&(0,Y.jsxs)(`span`,{className:`phi-move__usd`,children:[`$`,A(_.amount*h.usdPerPhi)]}),v===`pending`&&h?.usdPerPhi!=null&&(0,Y.jsxs)(`span`,{className:`phi-move__usd`,children:[`$`,A(_.amount*h.usdPerPhi)]})]}),b&&_&&v===`pending`&&(0,Y.jsx)(`span`,{className:`phi-status phi-status--pending`,title:`Exhale pending`,children:`Exhale`}),b&&_&&y===`exhale`&&v===`received`&&(0,Y.jsx)(`span`,{className:`phi-status phi-status--received`,title:`Exhale received`,children:`Exhaled`}),!_&&y!==`inhale`&&O>0&&(0,Y.jsx)(`span`,{className:`phi-status phi-status--${T>0&&D>0?`exhale-mix`:`received`}`,title:T>0&&D>0?`Exhale mix: ${V(D)} exhaled • ${V(T)} pending`:T>0?`Exhale pending: ${V(T)} ${Q}`:`Exhaled: ${V(D)} ${Q}`,style:k,children:`Exhale`}),y===`inhale`&&(0,Y.jsx)(`span`,{className:`phi-status phi-status--inhale`,title:`Inhale`,children:`Inhale`}),C!==null&&(0,Y.jsxs)(`span`,{className:`phi-pill phi-pill--live`,title:ie,children:[(0,Y.jsxs)(`span`,{className:`phi-pill__label`,children:[(0,Y.jsx)(Ln,{className:`phi-pill__mark`}),y===`inhale`?`+`:`live:`]}),$(C)]}),w!==null&&(0,Y.jsxs)(`span`,{className:`phi-pill phi-pill--usd`,title:ie,children:[`$`,A(w)]}),D>0&&(0,Y.jsxs)(`span`,{className:`phi-pill phi-pill--drain`,title:re,children:[`Exhaled `,$(D,{sign:`-`})]}),T>0&&(0,Y.jsxs)(`span`,{className:`phi-pill phi-pill--pending`,title:te,children:[`Exhale (pending) `,$(T,{sign:`-`})]}),ne&&(0,Y.jsxs)(`span`,{className:`phi-pill phi-pill--pending`,title:j,children:[`Exhale (pending) `,$(E,{sign:`-`})]}),b&&v===`received`&&_&&y===`exhale`&&(0,Y.jsx)(`span`,{className:`phi-pill phi-pill--drain`,title:`Exhaled: ${V(_.amount)} ${Q}${_.amountUsd===void 0?``:` • $${A(_.amountUsd)}`}`,children:`Exhaled`}),p!==void 0&&(0,Y.jsxs)(`span`,{className:`phi-pill`,title:`Total ${Q} on pulse ${e.payload.pulse??``}`,children:[(0,Y.jsxs)(`span`,{className:`phi-pill__label`,children:[(0,Y.jsx)(Ln,{className:`phi-pill__mark`}),`pulse:`]}),$(p)]}),(0,Y.jsx)(`button`,{className:`node-copy`,"aria-label":`Copy URL`,onClick:()=>void ar(m),title:`Copy URL`,type:`button`,children:`⧉`})]})]}),c&&(0,Y.jsxs)(`div`,{className:`node-open`,children:[(0,Y.jsx)(`div`,{className:`node-detail`,children:g.length===0?(0,Y.jsx)(`div`,{className:`node-detail-empty`,children:`No additional memory fields recorded on this glyph.`}):(0,Y.jsx)(`div`,{className:`node-detail-grid`,children:g.map((e,t)=>(0,Y.jsxs)(W.Fragment,{children:[(0,Y.jsx)(`div`,{className:`detail-label`,children:e.label}),(0,Y.jsx)(`div`,{className:`detail-value`,title:e.valueText??(typeof e.value==`string`?e.value:void 0),children:e.value})]},t))})}),e.children.length>0&&(0,Y.jsx)(`div`,{className:`node-children`,"aria-label":`Memory Imprints`,children:e.children.map(e=>(0,Y.jsx)(cr,{node:e,expanded:t,toggle:n,phiTotalsByPulse:r,usernameClaims:i,transferRegistry:a,receiveLocks:o,valueSnapshots:s},e.id))})]})]})}function lr({root:e,expanded:t,toggle:r,phiTotalsByPulse:i,usernameClaims:a,transferRegistry:o,receiveLocks:s,valueSnapshots:c,onOpenPulseView:l}){let u=(0,W.useMemo)(()=>{let t=0,n=e=>{t+=1,e.children.forEach(n)};return n(e),t},[e]),d=n(e.url),f=e.payload.kaiSignature,p=Un(e.payload.pulse)??Un(j.get(e.url)?.pulse),m=he(e.url),h=e.payload.chakraDay,g=c.get(e.id)??null,_=(0,W.useMemo)(()=>{let t=0,n=g?.pendingFromParent??0;for(let r of e.children){let e=c.get(r.id);e?.receivedAmount&&(t+=e.receivedAmount),e?.pendingFromParent&&(n+=e.pendingFromParent)}let r=g?.basePhi??null,i=g?.netPhi??null,a=g?.usdPerPhi??null;return{basePhi:r,netPhi:i,usdValue:i!=null&&a!=null?i*a:null,derivedPhi:t,pendingPhi:n}},[e,g,c]),v=(0,W.useMemo)(()=>{let t=0,n=0,r=0,i=e=>{let r=E(e.url),a=c.get(e.id)??null;if(r===`stream`&&a?.netPhi!=null&&(t+=a.netPhi),r===`post`){let t=Zn(e,o);(t?rr(e,o,s):null)===`received`&&t&&(n+=t.amount)}e.children.forEach(i)};i(e);for(let t of e.children){if(E(t.url)!==`post`)continue;let e=Zn(t,o);(e?rr(t,o,s):null)===`pending`&&e&&(r+=e.amount)}return{inhaleTotal:t,exhaleTotal:n,pendingTotal:r}},[s,e,o,c]),y=_.netPhi==null?void 0:`Live origin value: ${V(_.netPhi)} ${Q}${_.usdValue==null?``:` • $${A(_.usdValue)}`}`,b=t=>{if(t.metaKey||t.ctrlKey||t.shiftKey){typeof window<`u`&&window.open(m,`_blank`,`noopener,noreferrer`);return}if(p==null)return;let n=t.currentTarget.getBoundingClientRect();l?.({pulse:p,originUrl:e.url,originHash:d??void 0,anchor:{x:n.left+n.width/2,y:n.bottom}})};return(0,Y.jsxs)(`section`,{className:`origin`,"aria-label":`Sigil origin stream`,style:G(h),"data-chakra":String(h??``),"data-node-id":e.id,children:[(0,Y.jsxs)(`header`,{className:`origin-head`,children:[(0,Y.jsxs)(`div`,{className:`o-meta`,children:[(0,Y.jsx)(`span`,{className:`o-title`,children:`Origin`}),(0,Y.jsx)(`button`,{className:`o-link`,onClick:b,type:`button`,title:p==null?m:`Open pulse view for ${m}`,"aria-label":`Open origin pulse view`,children:R(f??d??`origin`,14)}),h&&(0,Y.jsx)(`span`,{className:`o-chakra`,title:String(h),children:String(h)})]}),(0,Y.jsxs)(`div`,{className:`o-right`,children:[(0,Y.jsx)(sr,{p:e.payload}),_.netPhi!=null&&(0,Y.jsxs)(`span`,{className:`phi-pill phi-pill--live`,title:y,children:[(0,Y.jsxs)(`span`,{className:`phi-pill__label`,children:[(0,Y.jsx)(Ln,{className:`phi-pill__mark`}),`live:`]}),$(_.netPhi)]}),_.usdValue!=null&&(0,Y.jsxs)(`span`,{className:`phi-pill phi-pill--usd`,title:y,children:[`$`,A(_.usdValue)]}),v.inhaleTotal>0&&(0,Y.jsxs)(`span`,{className:`phi-pill phi-pill--lift`,title:`Inhales from memory: +${V(v.inhaleTotal)} ${Q}`,children:[`Inhale `,$(v.inhaleTotal,{sign:`+`})]}),v.exhaleTotal>0&&(0,Y.jsxs)(`span`,{className:`phi-pill phi-pill--drain`,title:`Exhaled: -${V(v.exhaleTotal)} ${Q}`,children:[`Exhaled `,$(v.exhaleTotal,{sign:`-`})]}),v.pendingTotal>0&&(0,Y.jsxs)(`span`,{className:`phi-pill phi-pill--pending`,title:`Exhale (pending): -${V(v.pendingTotal)} ${Q}`,children:[`Exhale (pending) `,$(v.pendingTotal,{sign:`-`})]}),(0,Y.jsxs)(`span`,{className:`o-count`,title:`Total content keys in this lineage`,children:[u,` keys`]}),(0,Y.jsx)(`button`,{className:`o-copy`,onClick:()=>void ar(m),title:`Copy origin URL`,type:`button`,children:`Remember Origin`})]})]}),(0,Y.jsx)(`div`,{className:`origin-body`,children:e.children.length===0?(0,Y.jsx)(`div`,{className:`kx-empty`,children:`No memories yet. The stream begins here.`}):(0,Y.jsx)(`div`,{className:`tree`,children:e.children.map(e=>(0,Y.jsx)(cr,{node:e,expanded:t,toggle:r,phiTotalsByPulse:i,usernameClaims:a,transferRegistry:o,receiveLocks:s,valueSnapshots:c},e.id))})})]})}function ur({onAdd:e,onImport:t,onExport:n,total:r,lastAdded:i,viewMode:a,onViewModeChange:o}){let[s,c]=(0,W.useState)(``);return(0,Y.jsx)(`div`,{className:`kx-toolbar`,role:`region`,"aria-label":`Explorer toolbar`,children:(0,Y.jsxs)(`div`,{className:`kx-toolbar-inner`,children:[(0,Y.jsxs)(`div`,{className:`kx-brand`,children:[(0,Y.jsx)(`div`,{className:`kx-glyph`,"aria-hidden":!0,children:(0,Y.jsx)(`img`,{className:`kx-glyph__mark`,src:In,alt:``,"aria-hidden":`true`,decoding:`async`,loading:`eager`,draggable:!1})}),(0,Y.jsxs)(`div`,{className:`kx-title`,children:[(0,Y.jsxs)(`h1`,{children:[`KAIROS `,(0,Y.jsx)(`span`,{children:`Keystream`})]}),(0,Y.jsxs)(`div`,{className:`kx-tagline`,children:[`Sovereign Lineage • No DB • Pure `,(0,Y.jsx)(Ln,{className:`phi-tagline__mark`})]})]})]}),(0,Y.jsxs)(`div`,{className:`kx-controls`,children:[(0,Y.jsxs)(`form`,{className:`kx-add-form`,onSubmit:t=>{t.preventDefault(),s.trim()&&(e(s.trim()),c(``))},children:[(0,Y.jsx)(`input`,{className:`kx-input`,placeholder:`Inhale a sigil (or memory)…`,spellCheck:!1,value:s,onChange:e=>c(e.target.value),"aria-label":`Sigil Key`}),(0,Y.jsx)(`button`,{className:`kx-button`,type:`submit`,children:`Inhale`})]}),(0,Y.jsxs)(`div`,{className:`kx-io`,role:`group`,"aria-label":`Import and export`,children:[(0,Y.jsxs)(`label`,{className:`kx-import`,title:`Import a JSON list of Keys (or krystals)`,children:[(0,Y.jsx)(`input`,{type:`file`,accept:`application/json`,onChange:e=>{let n=e.target.files?.[0];n&&t(n)},"aria-label":`Import JSON`}),`Inhale`]}),(0,Y.jsx)(`button`,{className:`kx-export`,onClick:n,"aria-label":`Export registry to JSON`,type:`button`,children:`Exhale`})]}),(0,Y.jsx)(`div`,{className:`kx-view-toggle`,role:`group`,"aria-label":`Explorer view mode`,children:(0,Y.jsx)(`button`,{className:`kx-view-btn`,type:`button`,onClick:()=>o(a===`keystream`?`lattice`:`keystream`),"aria-pressed":a===`lattice`,children:a===`keystream`?`Memory`:`Keystream`})}),(0,Y.jsxs)(`div`,{className:`kx-stats`,"aria-live":`polite`,children:[(0,Y.jsxs)(`span`,{className:`kx-pill`,title:`Total KEYS in registry (includes variants)`,children:[r,` KEYS`]}),i&&(0,Y.jsxs)(`span`,{className:`kx-pill subtle`,title:i,children:[`Last: `,R(i,8)]})]})]})]})})}var dr=()=>{let[n,a]=(0,W.useState)(()=>v()?1:0),[s,c]=(0,W.useState)(0),[f,S]=(0,W.useState)(void 0),[D,ee]=(0,W.useState)(()=>_()),[A,te]=(0,W.useState)(()=>u(new Date)),[ie,M]=(0,W.useState)(`keystream`),[ae,se]=(0,W.useState)({open:!1,pulse:null}),F=(0,W.useRef)(!1),le=(0,W.useRef)(new Set),L=(0,W.useRef)(null),R=(0,W.useRef)(!1),fe=(0,W.useRef)(null),z=(0,W.useRef)(0),V=(0,W.useRef)(null),H=(0,W.useRef)(!1),_e=(0,W.useRef)(void 0),U=(0,W.useRef)(0),ve=(0,W.useRef)(null),be=(0,W.useRef)([]),xe=(0,W.useRef)(null),G=(0,W.useCallback)(e=>{let t=Rn()+e;t>z.current&&(z.current=t)},[]),Se=(0,W.useCallback)(()=>{if(!Z||F.current)return;let e=Rn(),t=z.current-e;if(t>0){V.current!=null&&window.clearTimeout(V.current),V.current=window.setTimeout(()=>{V.current=null,Se()},t+An);return}let n=be.current.splice(0);if(n.length>0&&(0,W.startTransition)(()=>{ee(e=>{let t=e;for(let e of n){let n=t[e.normalized];n&&n.claimHash===e.claimHash&&n.claimUrl===e.claimUrl&&n.originHash===(e.originHash??n.originHash)&&n.ownerHint===(e.ownerHint??n.ownerHint)||(t={...t,[e.normalized]:{...n,normalized:e.normalized,claimHash:e.claimHash,claimUrl:e.claimUrl,originHash:e.originHash??n?.originHash,ownerHint:e.ownerHint??n?.ownerHint??null,updatedAt:n?.updatedAt??0}})}return t})}),_e.current!==void 0){let e=_e.current;_e.current=void 0,(0,W.startTransition)(()=>S(e))}if(ve.current!==null){let e=ve.current;ve.current=null,(0,W.startTransition)(()=>te(e))}if(U.current>0){let e=U.current;U.current=0,(0,W.startTransition)(()=>c(t=>t+e))}H.current&&(H.current=!1,(0,W.startTransition)(()=>a(e=>e+1)))},[G]),K=(0,W.useCallback)(()=>{if(!Z||V.current!=null)return;let e=Rn(),t=z.current-e,n=Math.max(0,t)+An;V.current=window.setTimeout(()=>{V.current=null,Se()},n)},[Se]),q=(0,W.useCallback)(()=>{if(!F.current){if(Rn()<z.current||R.current){H.current=!0,K();return}(0,W.startTransition)(()=>a(e=>e+1))}},[K]),J=(0,W.useCallback)(e=>{if(!F.current){if(Rn()<z.current||R.current){_e.current=e,K();return}(0,W.startTransition)(()=>S(e))}},[K]),Ce=(0,W.useCallback)((e=1)=>{if(!F.current){if(Rn()<z.current||R.current){U.current+=e,K();return}(0,W.startTransition)(()=>c(t=>t+e))}},[K]),we=(0,W.useCallback)(e=>{if(!F.current){if(Rn()<z.current||R.current){ve.current=e,K();return}(0,W.startTransition)(()=>te(e))}},[K]),Te=(0,W.useRef)(null),[Ee,De]=(0,W.useState)(()=>new Set),Oe=(0,W.useCallback)(e=>{G(kn);let t=L.current;if(t){let n=`[data-node-id="${Bn(e)}"]`,r=t.querySelector(n);Te.current={id:e,scrollTop:t.scrollTop,rectTop:r?r.getBoundingClientRect().top:0}}De(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n}),K()},[G,K]);(0,W.useEffect)(()=>{if(!Z)return;let e=window.setInterval(()=>we(u(new Date)),6e3);return()=>window.clearInterval(e)},[we]),(0,W.useEffect)(()=>{if(!Z)return;let e=document.documentElement,t=document.body,n=document.scrollingElement||document.documentElement,r={htmlOverscroll:e?.style.overscrollBehavior??``,htmlOverscrollY:e?.style.overscrollBehaviorY??``,bodyOverscroll:t?.style.overscrollBehavior??``,bodyOverscrollY:t?.style.overscrollBehaviorY??``,rootOverscroll:n?.style.overscrollBehavior??``,rootOverscrollY:n?.style.overscrollBehaviorY??``};return e&&(e.style.overscrollBehavior=`none`,e.style.overscrollBehaviorY=`none`),t&&(t.style.overscrollBehavior=`none`,t.style.overscrollBehaviorY=`none`),n&&(n.style.overscrollBehavior=`none`,n.style.overscrollBehaviorY=`none`),()=>{e&&(e.style.overscrollBehavior=r.htmlOverscroll,e.style.overscrollBehaviorY=r.htmlOverscrollY),t&&(t.style.overscrollBehavior=r.bodyOverscroll,t.style.overscrollBehaviorY=r.bodyOverscrollY),n&&(n.style.overscrollBehavior=r.rootOverscroll,n.style.overscrollBehaviorY=r.rootOverscrollY)}},[]),(0,W.useEffect)(()=>{if(!Z)return;let e=L.current;if(!e)return;let t=0,n=0,r=e=>{e.touches.length===1&&(t=e.touches[0]?.clientY??0,n=e.touches[0]?.clientX??0)},i=r=>{if(!r.cancelable||r.touches.length!==1)return;let i=r.touches[0]?.clientY??0,a=r.touches[0]?.clientX??0,o=i-t,s=a-n;if(t=i,n=a,Math.abs(o)<=Math.abs(s))return;let c=e.scrollHeight-e.clientHeight;if(c<=0)return;let l=e.scrollTop<=0,u=e.scrollTop>=c-1,d=o>0,f=o<0;(l&&d&&window.scrollY<=0||u&&f)&&r.preventDefault()};return e.addEventListener(`touchstart`,r,{passive:!0}),e.addEventListener(`touchmove`,i,{passive:!1}),()=>{e.removeEventListener(`touchstart`,r),e.removeEventListener(`touchmove`,i)}},[]),(0,W.useEffect)(()=>{if(!Z)return;let e=L.current;if(!e)return;let t=()=>{R.current=!0,G(On),fe.current!=null&&window.clearTimeout(fe.current),fe.current=window.setTimeout(()=>{R.current=!1,fe.current=null,K()},180)};return e.addEventListener(`scroll`,t,{passive:!0}),()=>{e.removeEventListener(`scroll`,t),fe.current!=null&&window.clearTimeout(fe.current),fe.current=null,R.current=!1}},[G,K]);let ke=(0,W.useCallback)(e=>{Number.isFinite(e.pulse)&&se({open:!0,pulse:e.pulse,originUrl:e.originUrl,originHash:e.originHash,anchor:e.anchor})},[]);(0,W.useLayoutEffect)(()=>{let e=Te.current;if(!e)return;Te.current=null;let t=L.current;if(!t)return;let n=`[data-node-id="${Bn(e.id)}"]`,r=t.querySelector(n);if(!r)return;let i=r.getBoundingClientRect().top-e.rectTop;Number.isFinite(i)&&Math.abs(i)>1&&(t.scrollTop=Math.max(0,e.scrollTop+i))},[Ee]);let Ae=(0,W.useRef)(null),je=(0,W.useRef)(!1),Me=(0,W.useRef)(null);(0,W.useEffect)(()=>{if(F.current=!1,p(),m(),o(),de(),v()&&q(),Z){let e=N(window.location.href);if(ye(e)){let t=T(e,{includeAncestry:!0,broadcast:!1,persist:!0,source:`local`,enqueueToApi:!0});J(I(e)),t&&q()}}let n=window.__SIGIL__?.registerSigilUrl,r=window.__SIGIL__?.registerSend;window.__SIGIL__||(window.__SIGIL__={}),window.__SIGIL__.registerSigilUrl=l,window.__SIGIL__.registerSend=e=>{if(!e||typeof e!=`object`)return;let t=e.url;typeof t!=`string`||!t.trim()||T(t,{includeAncestry:!0,broadcast:!0,persist:!0,source:`local`,enqueueToApi:!0})&&(J(I(t)),q())};let i=e=>{let t=e?.detail?.url;typeof t==`string`&&t.length&&T(t,{includeAncestry:!0,broadcast:!0,persist:!0,source:`local`,enqueueToApi:!0})&&(J(I(t)),q())};window.addEventListener(`sigil:url-registered`,i);let a=e=>{let t=e?.detail?.url;typeof t==`string`&&t.length&&T(t,{includeAncestry:!0,broadcast:!0,persist:!0,source:`local`,enqueueToApi:!0})&&(J(I(t)),q())};window.addEventListener(`sigil:minted`,a);let s=Z&&`BroadcastChannel`in window?new BroadcastChannel(Dn):null,c=e=>{let t=e.data;t?.type===`sigil:add`&&typeof t.url==`string`&&T(t.url,{includeAncestry:!0,broadcast:!1,persist:!0,source:`local`,enqueueToApi:!0})&&(J(I(t.url)),q())};s?.addEventListener(`message`,c);let u=e=>{if(!e.key)return;let t=e.key===C,n=e.key===w;if(e.key===`kai:sigil-transfer:v1`){Ce();return}if(!(!t&&!n)&&e.newValue)try{let t=JSON.parse(e.newValue);if(!Array.isArray(t))return;let n=!1;for(let e of t)typeof e==`string`&&T(e,{includeAncestry:!0,broadcast:!1,persist:!1,source:`local`,enqueueToApi:!0})&&(n=!0);J(void 0),n&&(ue(),q())}catch{}};window.addEventListener(`storage`,u);let f=()=>Ce();window.addEventListener(b,f);let h=Z&&`BroadcastChannel`in window?new BroadcastChannel(ge):null,_=e=>{e.data?.type===`transfer:update`&&Ce()};h?.addEventListener(`message`,_);let y=()=>{me(),oe()};window.addEventListener(`pagehide`,y);let x=ne(e=>{if(Rn()<z.current||R.current){be.current.push({normalized:e.normalized,claimHash:e.claimHash,claimUrl:e.claimUrl,originHash:e.originHash,ownerHint:e.ownerHint}),K();return}(0,W.startTransition)(()=>{ee(t=>{let n=t[e.normalized];return n&&n.claimHash===e.claimHash&&n.claimUrl===e.claimUrl&&n.originHash===e.originHash&&n.ownerHint===e.ownerHint?t:{...t,[e.normalized]:e}})})}),S=new AbortController,E=async t=>{F.current||e()&&(R.current||Rn()<z.current&&(t===`pulse`||t===`import`)||await oe())},D=async n=>{if(!F.current&&e()&&!je.current&&!R.current&&!(Rn()<z.current&&(n===`pulse`||n===`import`))){je.current=!0;try{let e=Ae.current,r=await P(e=>new URL(t,e).toString(),{method:`GET`,cache:`no-store`,signal:S.signal,headers:void 0});if(!r||r.status===304||!r.ok)return;let i=``,a;try{let e=await r.json();i=typeof e?.seal==`string`?e.seal:``,a=Fn(e)}catch{return}let o=a==null?void 0:Pn();if(e&&i&&e===i&&!(a!=null&&(o==null||a>o))){Ae.current=i;return}let s=await d(S.signal);s.pulled&&(Ae.current=s.remoteSeal??i??e??null),s.imported>0&&(J(void 0),q());let c=Ae.current;(n===`open`||(n===`visible`||n===`focus`||n===`online`||n===`import`)&&c!==Me.current)&&(k(),Me.current=c,await oe())}finally{je.current=!1}}};xe.current=async e=>{await E(e),await D(e)},k(),E(`open`),D(`open`);let O=null,A=()=>{if(!Z||F.current)return;O!=null&&window.clearTimeout(O);let t=g();O=window.setTimeout(()=>{if(O=null,document.visibilityState!==`visible`){A();return}if(!e()){A();return}E(`pulse`),D(`pulse`),A()},t)},te=()=>{A()};A();let j=()=>{document.visibilityState===`visible`&&(te(),E(`visible`),D(`visible`))};document.addEventListener(`visibilitychange`,j);let re=()=>{te(),E(`focus`),D(`focus`)},ie=()=>{te(),E(`online`),D(`online`)};return window.addEventListener(`focus`,re),window.addEventListener(`online`,ie),()=>{window.__SIGIL__&&(window.__SIGIL__.registerSigilUrl=n,window.__SIGIL__.registerSend=r),window.removeEventListener(`sigil:url-registered`,i),window.removeEventListener(`sigil:minted`,a),window.removeEventListener(`storage`,u),window.removeEventListener(b,f),h?.removeEventListener(`message`,_),h?.close(),window.removeEventListener(`pagehide`,y),window.removeEventListener(`focus`,re),window.removeEventListener(`online`,ie),document.removeEventListener(`visibilitychange`,j),s?.removeEventListener(`message`,c),s?.close(),typeof x==`function`&&x(),V.current!=null&&window.clearTimeout(V.current),V.current=null,O!=null&&window.clearTimeout(O),O=null,S.abort(),xe.current=null,F.current=!0}},[q,G,K,J]);let Ne=(0,W.useCallback)(e=>{let t=xe.current;t&&t(e)},[]);(0,W.useEffect)(()=>{if(!Z)return;let e=()=>Ne(`visible`);return window.addEventListener(En,e),()=>window.removeEventListener(En,e)},[Ne]);let Pe=(0,W.useMemo)(()=>Ie(j),[n]),Fe=(0,W.useMemo)(()=>r(),[s]),Le=(0,W.useMemo)(()=>nr(j),[n,s]),Re=(0,W.useMemo)(()=>{let e=0;for(let[,]of j)e+=1;return e},[n]),ze=(0,W.useMemo)(()=>{let e=new Map,t=n=>{let r=qn(n.payload,A),i=Jn(n.payload,A),a=Zn(n,Fe)??null,o=rr(n,Fe,Le),s=o===`received`&&a?a.amount:0,c=s>0?s:r??0,l=0,u=0,d=0;for(let e of n.children){let n=t(e);l+=n.receivedFromParent,u+=n.pendingFromParent,d+=n.liftToParent}let f=o===`pending`&&a?.direction===`send`?a.amount:0,p=Math.max(0,c+d-l),m=o===`received`&&a?.amountUsd?a.amountUsd:i==null?null:p*i,h=f,g=E(n.url)===`stream`?p:0;return e.set(n.id,{basePhi:r,netPhi:Number.isFinite(p)?p:null,usdValue:m,usdPerPhi:i,transferMove:a,receivedAmount:s,receivedFromChildren:l,pendingFromChildren:u,pendingFromParent:h}),{receivedFromParent:s,pendingFromParent:h,liftToParent:g}};for(let e of Pe)t(e);return e},[Pe,A,Le,Fe]),Be=(0,W.useMemo)(()=>{let e=new Map,t=new Map;for(let[n,r]of j){let i=typeof r.pulse==`number`?r.pulse:void 0;if(i==null)continue;let a=y(N(n),r),o=t.get(i);if(o||(o=new Set,t.set(i,o)),o.has(a))continue;o.add(a);let s=re(r);s!==void 0&&e.set(i,(e.get(i)??0)+s)}return e},[n]),Ve=(0,W.useMemo)(()=>{let e=[];for(let[t]of j){let n=N(he(t));e.includes(n)||e.push(n)}return e},[n]);(0,W.useEffect)(()=>{if(!Z||Ve.length===0)return;let e=Ve.filter(e=>!le.current.has(e));if(e.length===0)return;let t=!1,n=async()=>{for(let n of e){if(t)break;le.current.add(n),await or(n)}},r=window,i=null;if(typeof r.requestIdleCallback==`function`){let e=r.requestIdleCallback(()=>void n(),{timeout:1e3});i=()=>r.cancelIdleCallback?.(e)}else{let e=window.setTimeout(()=>void n(),120);i=()=>window.clearTimeout(e)}return()=>{t=!0,i?.()}},[Ve]);let He=(0,W.useCallback)(async()=>{if(!Z||R.current||!e()||Rn()<z.current)return;let t=[],n=e=>{if(e.urls.length>1){let n=E(e.url),r=[...e.urls].map(e=>N(I(e))).filter((e,t,n)=>n.indexOf(e)===t).sort((e,t)=>x(t,n)-x(e,n));for(let e of r.slice(0,2)){let n=N(e);!ce.has(n)&&!t.includes(n)&&t.push(n)}}e.children.forEach(n)};for(let e of Pe)n(e);if(t.length!==0)for(let e of t.slice(0,Nn)){let t=await i(e);t===`ok`&&h(e,1),t===`bad`&&h(e,-1)}},[Pe]);(0,W.useEffect)(()=>{if(!Z)return;let e=!1,t=()=>{e||He()},n=window,r=null;if(typeof n.requestIdleCallback==`function`){let e=n.requestIdleCallback(t,{timeout:900});r=()=>n.cancelIdleCallback?.(e)}else{let e=window.setTimeout(t,250);r=()=>window.clearTimeout(e)}return()=>{e=!0,r?.()}},[n,He]);let Ue=(0,W.useCallback)(e=>{G(kn),T(e,{includeAncestry:!0,broadcast:!0,persist:!0,source:`local`,enqueueToApi:!0})&&(J(I(e)),q())},[q,G,J]),We=(0,W.useCallback)(async e=>{G(0);let t=await e.text(),n;try{n=await Yn(t)}catch{return}let{urls:r,rawKrystals:i}=B(n);if(r.length===0&&i.length===0)return;let a=!1;for(let e=0;e<i.length;e+=jn){for(let t of i.slice(e,e+jn))pe(t);e+jn<i.length&&await zn()}for(let e=0;e<r.length;e+=jn){for(let t of r.slice(e,e+jn))T(t,{includeAncestry:!0,broadcast:!0,persist:!0,source:`import`,enqueueToApi:!0})&&(a=!0);a&&(J(void 0),q()),e+jn<r.length&&await zn()}r.length>0&&O(r),a&&(J(void 0),q()),Ne(`import`)},[q,G,Ne,J]),Ge=(0,W.useCallback)(()=>{G(kn);let e=[];for(let[t]of j)e.push(t);let t=new Blob([JSON.stringify({urls:e},null,2)],{type:`application/json`}),n=document.createElement(`a`);n.href=URL.createObjectURL(t),n.download=`sigil-registry-${Date.now()}.json`,n.click(),URL.revokeObjectURL(n.href)},[G]);return(0,Y.jsxs)(`div`,{className:`sigil-explorer`,"aria-label":`Kairos Keystream Explorer`,children:[(0,Y.jsx)(ur,{onAdd:Ue,onImport:We,onExport:Ge,total:Re,lastAdded:f,viewMode:ie,onViewModeChange:e=>{G(kn),M(e)}}),(0,Y.jsx)(`div`,{className:[`explorer-scroll`,ie===`lattice`?`explorer-scroll--lattice`:``].filter(Boolean).join(` `),ref:L,role:`region`,"aria-label":`Explorer scroll viewport`,children:(0,Y.jsxs)(`div`,{className:`explorer-inner`,children:[ie===`keystream`?(0,Y.jsx)(Y.Fragment,{children:Pe.length===0?(0,Y.jsxs)(`div`,{className:`kx-empty`,children:[(0,Y.jsx)(`p`,{children:`No sigil-glyphs in your keystream yet.`}),(0,Y.jsxs)(`ol`,{children:[(0,Y.jsx)(`li`,{children:`Import your keystream memories.`}),(0,Y.jsx)(`li`,{children:`Seal a moment — auto-registered here.`}),(0,Y.jsx)(`li`,{children:`Inhale any sigil-glyph or memory key above — lineage aligns instantly.`})]})]}):(0,Y.jsx)(`div`,{className:`forest`,"aria-label":`Sigil forest`,children:Pe.map(e=>(0,Y.jsx)(lr,{root:e,expanded:Ee,toggle:Oe,phiTotalsByPulse:Be,usernameClaims:D,transferRegistry:Fe,receiveLocks:Le,valueSnapshots:ze,onOpenPulseView:ke},e.id))})}):(0,Y.jsx)(`div`,{className:`kx-view kx-view--lattice`,"aria-label":`Memory`,children:(0,Y.jsx)(Ct,{className:`kx-lattice`,syncMode:`embedded`,onOpenPulseView:ke})}),(0,Y.jsx)(`footer`,{className:`kx-footer`,"aria-label":`Explorer footer`,children:(0,Y.jsxs)(`span`,{className:`row`,children:[(0,Y.jsx)(`span`,{children:`Determinate • Stateless • Kairos-Memory`}),(0,Y.jsx)(`span`,{className:`dot`,children:`•`}),(0,Y.jsx)(`span`,{children:e()?`online`:`offline`}),(0,Y.jsx)(`span`,{className:`dot`,children:`•`}),(0,Y.jsxs)(`span`,{children:[Re,` keys`]})]})})]})}),(0,Y.jsx)(wn,{open:ae.open,pulse:ae.pulse,originUrl:ae.originUrl,originHash:ae.originHash,anchor:ae.anchor,registryRev:n,onClose:()=>se({open:!1,pulse:null,anchor:void 0})})]})};export{dr as default};