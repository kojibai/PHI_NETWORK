import{$n as e,Bt as t,Gr as n,Hn as r,Hr as i,Kr as a,Lr as o,Vr as s,Vt as c,Wt as l,Zr as u,a as d,at as f,c as p,cr as m,ct as h,d as g,dr as _,dt as v,er as y,f as b,fr as x,ft as S,gr as C,hi as w,hr as T,ht as E,ir as D,it as O,jn as k,kt as A,l as j,li as M,lr as ee,lt as te,m as N,mr as ne,mt as P,nt as re,o as F,ot as ie,p as I,pr as L,pt as R,qr as ae,rt as z,s as oe,sr as se,st as B,tr as V,ui as H,ur as ce,ut as le,w as ue}from"./index-C2ckdEdO.js";import{n as U,t as de}from"./webauthnKAS-1jcsBWo5.js";import"./prop-types-eGdfnZGz.js";import{n as fe}from"./SigilAuthContext-BL6CBYus.js";import{d as W,t as pe}from"./ticker-C5e0I5gN.js";import{i as G,n as me,r as he,t as ge}from"./sessionStorage-2Nr46eZD.js";import{i as _e,r as ve}from"./postSeal-DGeRGc3h.js";import{t as ye}from"./VerifierFrame-BFZPIdsp.js";var K=w(M(),1);const be=(0,K.createContext)(void 0);var q=w(l(),1);function xe({children:e}){let[t,n]=(0,K.useState)(()=>he());(0,K.useEffect)(()=>{t?G(t):me()},[t]),(0,K.useEffect)(()=>{let e=e=>{e.key!==null&&e.key===`kai.voh.session.v1`&&n(he())};return window.addEventListener(`storage`,e),()=>window.removeEventListener(`storage`,e)},[]);let r=(0,K.useMemo)(()=>({session:t,setSession:e=>n(e),clearSession:()=>n(null)}),[t]);return(0,q.jsx)(be.Provider,{value:r,children:e})}function J(){let e=(0,K.useContext)(be);if(!e)throw Error(`useSession must be used within a SessionProvider`);return e}var Se=[`video/webm;codecs=vp9,opus`,`video/webm;codecs=vp8,opus`,`video/webm`,`video/mp4;codecs=h264,aac`,`video/mp4`],Y=typeof window<`u`&&`MediaRecorder`in window;async function Ce(e){let t=await crypto.subtle.digest(`SHA-256`,e),n=new Uint8Array(t),r=``;for(let e=0;e<n.length;e++)r+=n[e].toString(16).padStart(2,`0`);return r}function we(){if(Y){for(let e of Se)if(window.MediaRecorder.isTypeSupported(e))return e}}function Te(e){let{isOpen:t,onClose:n,onCaptured:r,maxDurationMs:i=15e3,preferredFacingMode:a=`user`}=e,[o,s]=(0,K.useState)(null),[c,l]=(0,K.useState)(!1),[u,d]=(0,K.useState)(a),[f,p]=(0,K.useState)(!1),[m,h]=(0,K.useState)(!1),[g,_]=(0,K.useState)(!1),[v,y]=(0,K.useState)(!1),[b,x]=(0,K.useState)(0),[S,C]=(0,K.useState)(0),w=(0,K.useRef)(null),T=(0,K.useRef)(null),E=(0,K.useRef)(null),D=(0,K.useRef)([]),O=(0,K.useRef)(0),k=(0,K.useRef)(null),A=(0,K.useMemo)(()=>we(),[]);(0,K.useEffect)(()=>{if(t)return(async()=>{s(null),l(!0);try{await j()}catch(e){s(e instanceof Error?e.message:`Failed to access camera.`)}finally{l(!1)}})(),()=>{M()}},[t,u,f]),(0,K.useEffect)(()=>{t&&ee().catch(()=>_(!1))},[t,u]);async function j(){M();let e={audio:{echoCancellation:!0,noiseSuppression:!0},video:{facingMode:u,width:{ideal:1080},height:{ideal:1920},frameRate:{ideal:30,max:60}}},t=await navigator.mediaDevices.getUserMedia(e);w.current=t,T.current&&(T.current.srcObject=t,T.current.muted=!0,await T.current.play().catch(()=>{})),await te(m&&g)}function M(){if(ie(!0),T.current&&(T.current.pause(),T.current.srcObject=null),w.current)for(let e of w.current.getTracks())e.stop();w.current=null,h(!1),y(!1),x(0),C(0),k.current!==null&&(cancelAnimationFrame(k.current),k.current=null)}async function ee(){let e=w.current;if(!e){_(!1);return}let[t]=e.getVideoTracks();if(!t){_(!1);return}let n=t.getCapabilities?.()??{};_(!!(typeof n.torch==`boolean`&&n.torch)&&u===`environment`)}async function te(e){let t=w.current;if(!t)return;let[n]=t.getVideoTracks();if(!(!n||!n.applyConstraints))try{g&&u===`environment`&&await n.applyConstraints({advanced:[{torch:e}]})}catch{}}function N(){d(e=>e===`user`?`environment`:`user`)}function ne(){p(e=>!e)}async function P(){if(!g)return;let e=!m;h(e),await te(e)}function re(){if(!v)return;let e=performance.now()-O.current;if(C(e),x(Math.min(1,e/i)),e>=i){ie(!1);return}k.current=requestAnimationFrame(re)}function F(){if(!Y){s(`MediaRecorder is not supported on this browser.`);return}if(v)return;s(null);let e=w.current;if(!e){s(`No camera stream.`);return}for(let t of e.getAudioTracks())t.enabled=!f;let t=A??``,n;try{n=t?new MediaRecorder(e,{mimeType:t,videoBitsPerSecond:35e5}):new MediaRecorder(e)}catch{n=new MediaRecorder(e)}E.current=n,D.current=[],n.ondataavailable=e=>{e.data&&e.data.size>0&&D.current.push(e.data)},n.onstop=()=>{I()},n.start(250),y(!0),O.current=performance.now(),k.current=requestAnimationFrame(re)}function ie(e){if(!v)return;let t=E.current;if(t){try{t.state!==`inactive`&&t.stop()}catch{}y(!1),k.current!==null&&(cancelAnimationFrame(k.current),k.current=null),e&&(D.current=[],x(0),C(0))}}async function I(){let e=D.current;if(D.current=[],!e.length)return;let t=Math.max(0,S),n=E.current?.mimeType||A||`video/webm`,i=new Blob(e,{type:n}),a=Date.now(),{width:o,height:s,thumbnailDataUrl:c}=await L(i),l=await Ce(await i.arrayBuffer()),u=`story_${a}.${n.includes(`mp4`)?`mp4`:`webm`}`;r({blob:i,file:new File([i],u,{type:n,lastModified:a}),mimeType:n,durationMs:t,width:o,height:s,thumbnailDataUrl:c,sha256:l,createdAt:a})}async function L(e){let t=URL.createObjectURL(e);try{let e=document.createElement(`video`);e.src=t,e.muted=!0,await e.play().catch(()=>void 0),await new Promise(t=>{let n=()=>{e.pause(),e.currentTime=0},r=()=>{n(),t()};e.onloadeddata=r,setTimeout(r,250)});let n=e.videoWidth||1080,r=e.videoHeight||1920,i=document.createElement(`canvas`);i.width=n,i.height=r;let a=i.getContext(`2d`);return a&&a.drawImage(e,0,0,n,r),{width:n,height:r,thumbnailDataUrl:i.toDataURL(`image/png`,.9)}}finally{URL.revokeObjectURL(t)}}function R(){v||F()}function ae(){v&&ie(!1)}function z(){v?ie(!1):F()}return t?(0,q.jsxs)(`div`,{className:`story-rec-overlay`,role:`dialog`,"aria-modal":`true`,"aria-label":`Story recorder`,children:[(0,q.jsx)(`div`,{className:`story-rec-video-wrap`,children:(0,q.jsx)(`video`,{ref:T,className:`story-rec-video ${u===`user`?`mirror`:``}`,playsInline:!0})}),(0,q.jsxs)(`div`,{className:`story-rec-topbar`,children:[(0,q.jsx)(`button`,{type:`button`,className:`story-btn top left`,"aria-label":`Close`,onClick:()=>{M(),n()},children:`‚úï`}),(0,q.jsx)(`div`,{className:`story-top-center`,children:(0,q.jsxs)(`div`,{className:`story-timer mono`,children:[Ee(S),` / `,Ee(i)]})}),(0,q.jsxs)(`div`,{className:`story-top-actions`,children:[(0,q.jsx)(`button`,{type:`button`,className:`story-btn ${f?`active`:``}`,"aria-pressed":f,"aria-label":f?`Unmute microphone`:`Mute microphone`,onClick:ne,title:f?`Unmute mic`:`Mute mic`,children:f?`üîá`:`üéôÔ∏è`}),(0,q.jsx)(`button`,{type:`button`,className:`story-btn ${u===`environment`&&g?``:`disabled`}`,disabled:!(u===`environment`&&g),onClick:()=>void P(),"aria-label":`Toggle torch`,title:g?m?`Torch on`:`Torch off`:`Torch not supported`,children:m?`üî¶`:`üí°`}),(0,q.jsx)(`button`,{type:`button`,className:`story-btn`,"aria-label":`Flip camera`,onClick:N,title:`Flip camera`,children:`üîÅ`})]})]}),(0,q.jsxs)(`div`,{className:`story-rec-bottombar`,children:[(0,q.jsx)(`div`,{className:`record-wrap`,children:(0,q.jsxs)(`button`,{type:`button`,className:`record-btn ${v?`recording`:``}`,"aria-pressed":v,"aria-label":v?`Stop recording`:`Start recording`,onClick:z,onPointerDown:R,onPointerUp:ae,onPointerLeave:ae,children:[(0,q.jsx)(`span`,{className:`progress-ring`,style:{background:`conic-gradient(currentColor ${b*360}deg, transparent 0)`}}),(0,q.jsx)(`span`,{className:`dot`})]})}),o&&(0,q.jsx)(`div`,{className:`story-rec-error`,children:o}),c&&(0,q.jsx)(`div`,{className:`story-rec-hint`,children:`Initializing camera‚Ä¶`})]})]}):null}function Ee(e){let t=Math.floor(e/1e3);return`${Math.floor(t/60).toString().padStart(2,`0`)}:${(t%60).toString().padStart(2,`0`)}`}var X={phiKey:[`userPhiKey`,`phiKey`,`phikey`,`Œ¶Key`,`walletPhiKey`],kaiSig:[`kaiSignature`,`kaiSig`,`ksig`,`Œ£Sig`,`sig`,`signature`],sigilId:[`sigilId`,`sigilID`,`glyphId`,`glyphID`,`sigil_id`,`glyph_id`],url:[`sigilActionUrl`,`sigilUrl`,`actionUrl`,`url`,`claimedUrl`,`loginUrl`,`sourceUrl`,`originUrl`,`link`,`href`]};function De(e){if(typeof e!=`string`||!e.trim())return!1;try{let t=new URL(e,globalThis.location?.origin??`https://example.org`);return t.protocol===`https:`||t.protocol===`http:`}catch{return!1}}function Z(e,t){if(typeof e!=`object`||!e)return;let n=e;for(let e of t){let t=n[e];if(typeof t==`string`&&t.trim())return t.trim()}let r=n.meta;if(typeof r==`object`&&r){let e=r;for(let n of t){let t=e[n];if(typeof t==`string`&&t.trim())return t.trim()}}}function Oe(e){return e.replace(/^<!\[CDATA\[/,``).replace(/\]\]>$/,``).trim()}function ke(e){let t=e.trim();if(!t)return;try{let e=JSON.parse(t);if(typeof e==`object`&&e)return e}catch{}let n=t.match(/\{[\s\S]*\}/);if(n)try{let e=JSON.parse(n[0]);if(typeof e==`object`&&e)return e}catch{}}function Ae(e,t){let n=RegExp(`${t}"?\\s*[:=]\\s*"?([^"\\n\\r<>{}]+)"?`,`i`),r=e.match(n);if(r)return(r[1]??``).trim()||void 0}function je(e){let t={};for(let n of X.phiKey){let r=Ae(e,n);if(r){t.userPhiKey=r;break}}for(let n of X.kaiSig){let r=Ae(e,n);if(r){t.kaiSignature=r;break}}for(let n of X.sigilId){let r=Ae(e,n);if(r){t.sigilId=r;break}}for(let n of X.url){let r=Ae(e,n);if(r&&De(r))return t.actionUrl=r,t}let n=e.match(/https?:\/\/[^\s"'<>)#]+/i);return n&&De(n[0])&&(t.actionUrl=n[0]),t}function Me(e,t){return{userPhiKey:e.userPhiKey??t.userPhiKey,kaiSignature:e.kaiSignature??t.kaiSignature,sigilId:e.sigilId??t.sigilId,actionUrl:e.actionUrl??t.actionUrl,meta:e.meta??t.meta}}function Ne(e){let t=(e??``).trim();if(!t)return{};try{let e=new DOMParser().parseFromString(t,`image/svg+xml`),n=e.getElementsByTagName(`parsererror`);if(n&&n.length>0)return je(t);let r=e.documentElement,i={};if(r&&r.attributes)for(let e of Array.from(r.attributes))i[e.name]=e.value;let a={userPhiKey:Z(i,X.phiKey),kaiSignature:Z(i,X.kaiSig),sigilId:Z(i,X.sigilId),actionUrl:(()=>{let e=Z(i,X.url);return e&&De(e)?e:void 0})(),meta:void 0},o=Array.from(e.getElementsByTagName(`metadata`));for(let e of o){let t=Oe((e.textContent??``).trim());if(!t)continue;let n=ke(t);if(n){let e={userPhiKey:Z(n,X.phiKey),kaiSignature:Z(n,X.kaiSig),sigilId:Z(n,X.sigilId),actionUrl:(()=>{let e=Z(n,X.url);return e&&De(e)?e:void 0})(),meta:n};if(a=Me(a,e),a.userPhiKey&&a.kaiSignature)return a}else a=Me(a,je(t))}for(let t of Array.from(e.getElementsByTagName(`desc`))){let e=Oe((t.textContent??``).trim());if(!e)continue;let n=ke(e);if(n){let e={userPhiKey:Z(n,X.phiKey),kaiSignature:Z(n,X.kaiSig),sigilId:Z(n,X.sigilId),actionUrl:(()=>{let e=Z(n,X.url);return e&&De(e)?e:void 0})(),meta:n};a=Me(a,e)}else a=Me(a,je(e));if(a.userPhiKey&&a.kaiSignature)return a}for(let t of Array.from(e.getElementsByTagName(`a`))){let e=t.getAttribute(`href`)||t.getAttribute(`xlink:href`);if(e&&De(e)){a.actionUrl=a.actionUrl??e;break}}return(!a.userPhiKey||!a.kaiSignature)&&(a=Me(a,je(t))),a}catch{return je(t)}}var Pe=new TextEncoder;function Fe(){if(typeof crypto>`u`||!crypto.subtle)throw Error(`WebCrypto subtle unavailable`);return crypto.subtle}function Ie(e){if(e.buffer instanceof ArrayBuffer)return e;let t=new Uint8Array(e.byteLength);return t.set(e),t}function Le(e){let t=e.replace(/-/g,`+`).replace(/_/g,`/`).trim();if(!/^[A-Za-z0-9+/]*={0,2}$/.test(t))throw Error(`Invalid base64/base64url`);let n=(4-t.length%4)%4,r=t+`=`.repeat(n),i=new Int16Array(128).fill(-1);for(let e=0;e<64;e++)i[`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`.charCodeAt(e)]=e;let a=Math.floor(r.length*3/4)-(r.endsWith(`==`)?2:r.endsWith(`=`)?1:0),o=new Uint8Array(a),s=0;for(let e=0;e<r.length;e+=4){let t=r.charCodeAt(e),n=r.charCodeAt(e+1),c=r.charCodeAt(e+2),l=r.charCodeAt(e+3),u=i[t]??-1,d=i[n]??-1,f=c===61?-1:i[c]??-1,p=l===61?-1:i[l]??-1;if(u<0||d<0||f<0&&c!==61||p<0&&l!==61)throw Error(`Invalid base64 characters`);let m=u<<18|d<<12|(f<0?0:f)<<6|(p<0?0:p);s<a&&(o[s++]=m>>>16&255),s<a&&c!==61&&(o[s++]=m>>>8&255),s<a&&l!==61&&(o[s++]=m&255)}return o}function Re(e){let t=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`,n=[],r=e.length,i=0;for(;i+2<r;i+=3){let r=e[i]<<16|e[i+1]<<8|e[i+2];n.push(t[r>>>18&63]+t[r>>>12&63]+t[r>>>6&63]+t[r&63])}let a=r-i;if(a===1){let r=e[i]<<16;n.push(t[r>>>18&63]+t[r>>>12&63]+`==`)}else if(a===2){let r=e[i]<<16|e[i+1]<<8;n.push(t[r>>>18&63]+t[r>>>12&63]+t[r>>>6&63]+`=`)}return n.join(``).replace(/\+/g,`-`).replace(/\//g,`_`).replace(/=+$/g,``)}function ze(e){let t=e.trim().toLowerCase();if(!/^[0-9a-f]+$/.test(t)||t.length%2!=0)throw Error(`Invalid hex`);let n=new Uint8Array(t.length/2);for(let e=0;e<n.length;e++)n[e]=parseInt(t.slice(e*2,e*2+2),16);return n}function Be(e){let t=e.trim();return t.length>=32&&t.length%2==0&&/^[0-9a-fA-F]+$/.test(t)}function Ve(e){let t=e.trim();return t.length>=16&&/^[A-Za-z0-9\-_]+$/.test(t)}function He(e){let t=e.trim();if(!t)throw Error(`Empty kaiSignature`);if(Be(t))return ze(t);if(Ve(t))try{return Le(t)}catch{}return Ie(Pe.encode(t))}async function Ue(e){let t=Fe(),n=await t.importKey(`raw`,e.ikm,{name:`HKDF`},!1,[`deriveBits`]),r=await t.deriveBits({name:`HKDF`,hash:`SHA-256`,salt:e.salt,info:e.info},n,e.bits);return new Uint8Array(r)}async function We(e){let t=Ie(He(e.baseKaiSignature)),n=Ie(Le(e.salt_b64url)),r=(e.context??`KaiVoh.deriveKaiSignature.v1`).trim();return await Ue({ikm:t,salt:n,info:Ie(Pe.encode(r)),bits:256})}async function Ge(e){return Re(await We(e))}function Ke(){return(0,q.jsxs)(`svg`,{viewBox:`0 0 24 24`,className:`ico`,"aria-hidden":`true`,focusable:`false`,children:[(0,q.jsx)(`rect`,{x:`3`,y:`6`,width:`14`,height:`12`,rx:`3`,stroke:`currentColor`,strokeWidth:`2`,fill:`none`}),(0,q.jsx)(`circle`,{cx:`10`,cy:`12`,r:`3`,stroke:`currentColor`,strokeWidth:`2`,fill:`none`}),(0,q.jsx)(`path`,{d:`M17 9l4-2v10l-4-2z`,stroke:`currentColor`,strokeWidth:`2`,fill:`none`}),(0,q.jsx)(`circle`,{cx:`18.5`,cy:`5.5`,r:`2.5`,fill:`currentColor`})]})}function qe(){return(0,q.jsxs)(`svg`,{viewBox:`0 0 24 24`,className:`ico`,"aria-hidden":`true`,focusable:`false`,children:[(0,q.jsx)(`path`,{d:`M3 6h18M9 6V4h6v2M7 6l1 14h8l1-14`,stroke:`currentColor`,strokeWidth:`2`,fill:`none`}),(0,q.jsx)(`path`,{d:`M10 10v6M14 10v6`,stroke:`currentColor`,strokeWidth:`2`})]})}var Je=6e3,Ye=1024,Xe=1024*Ye,Ze=e=>e>=Xe?`${(e/Xe).toFixed(2)} MB`:e>=Ye?`${(e/Ye).toFixed(2)} KB`:`${e} B`,Qe=(e,t=8,n=6)=>e.length<=t+n?e:`${e.slice(0,t)}‚Ä¶${e.slice(-n)}`,$e=e=>{if(typeof e!=`string`||!e)return!1;try{let t=new URL(e,globalThis.location?.origin??`https://example.org`);return t.protocol===`https:`||t.protocol===`http:`}catch{return!1}};function et(e){try{let t=new URL(e,globalThis.location?.origin??`https://example.org`),n=new URLSearchParams(t.hash.replace(/^#/,``)).has(`t`),r=new URLSearchParams(t.search).has(`p`),i=t.pathname,a=/^\/(?:stream|feed)\/p\/[^/]+$/.test(i),o=/^\/p~[^/?#]+$/.test(i);return n||r||a||o}catch{return!1}}function tt(e){let t=new Uint8Array(e),n=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`,r=[],i=t.length,a=0;for(;a+2<i;a+=3){let e=t[a]<<16|t[a+1]<<8|t[a+2];r.push(n[e>>>18&63]+n[e>>>12&63]+n[e>>>6&63]+n[e&63])}let o=i-a;if(o===1){let e=t[a]<<16;r.push(n[e>>>18&63]+n[e>>>12&63]+`==`)}else if(o===2){let e=t[a]<<16|t[a+1]<<8;r.push(n[e>>>18&63]+n[e>>>12&63]+n[e>>>6&63]+`=`)}return r.join(``).replace(/\+/g,`-`).replace(/\//g,`_`).replace(/=+$/g,``)}function Q(e,t){if(typeof e!=`object`||!e)return;let n=e,r=n[t];if(typeof r==`string`)return r;let i=n.meta;if(typeof i==`object`&&i){let e=i[t];if(typeof e==`string`)return e}}function nt(e,t){if(typeof e!=`object`||!e)return;let n=e,r=n[t];if(typeof r==`number`&&Number.isFinite(r))return r;let i=n.meta;if(typeof i==`object`&&i){let e=i[t];if(typeof e==`number`&&Number.isFinite(e))return e}}function rt(e,t){if(!e)return;let n=[`sigilActionUrl`,`sigilUrl`,`actionUrl`,`url`,`claimedUrl`,`loginUrl`,`sourceUrl`,`originUrl`,`link`,`href`];if(t)for(let e of n){let n=t[e];if($e(n))return n}try{let t=new DOMParser().parseFromString(e,`image/svg+xml`);for(let e of Array.from(t.getElementsByTagName(`metadata`))){let t=(e.textContent??``).trim();if(!t)continue;let r=t.replace(/^<!\[CDATA\[/,``).replace(/\]\]>$/,``);try{let e=JSON.parse(r);if(typeof e==`object`&&e)for(let t of n){let n=e[t];if($e(n))return n}}catch{let e=r.match(/https?:\/\/[^\s"'<>)#]+/i);if(e&&$e(e[0]))return e[0]}}for(let e of Array.from(t.getElementsByTagName(`a`))){let t=e.getAttribute(`href`)||e.getAttribute(`xlink:href`);if($e(t))return t}}catch{}}async function it(e,t,n={}){let r=n.cacheName??`sigil-attachments-v1`,i=(n.pathPrefix??`/att/`).replace(/\/+$/,``)+`/`;try{if(!(`caches`in globalThis)||typeof caches.open!=`function`)return;let n=await caches.open(r),a=`${i}${e}`;return await n.put(new Request(a,{method:`GET`}),new Response(t,{headers:{"Content-Type":t.type||`application/octet-stream`}})),a}catch{return}}function at(e){let t=Math.floor(e/1e3);return`${Math.floor(t/60).toString().padStart(2,`0`)}:${(t%60).toString().padStart(2,`0`)}`}function ot(e){let t=e.indexOf(`
`);return t>=0?e.slice(0,t):e}function st(e,t){return e.length<=t?e:`${e.slice(0,Math.max(0,t-1))}‚Ä¶`}var ct=`kai-voh:draft:v1`,lt=[`text`,`code`,`md`,`html`],ut=[`code`,`sanitized`],dt=[`derived`,`glyph`],ft=e=>typeof e==`object`&&!!e,pt=e=>{let t=BigInt(2**53-1),n=BigInt(-(2**53-1));return e>t?2**53-1:e<n?-(2**53-1):Number(e)},mt=e=>{let t=typeof e==`number`?e:typeof e==`string`?Number.parseInt(e,10):typeof e==`bigint`?Number(e):NaN;if(!Number.isFinite(t))return null;let n=Math.floor(t);return n<0?null:n};function ht({pulseRef:e}){let t=pe(),n=(0,K.useMemo)(()=>ft(t)?mt(t.pulse):null,[t]);return(0,K.useEffect)(()=>{typeof n==`number`&&(e.current=n)},[n,e]),null}var gt=(e,t=``)=>typeof e==`string`?e:t,_t=(e,t=!1)=>typeof e==`boolean`?e:t,vt=e=>Array.isArray(e)?e.filter(e=>typeof e==`string`):[],yt=e=>{if(!Array.isArray(e))return[];let t=[];for(let n of e){if(!ft(n))continue;let e=gt(n.phiKey),r=gt(n.kaiSignature),i=gt(n.label);if(!e||!r||!i)continue;let a=typeof n.sigilId==`string`&&n.sigilId.trim()?n.sigilId:void 0;t.push({phiKey:e,kaiSignature:r,label:i,sigilId:a})}return t},bt=()=>typeof performance<`u`&&typeof performance.now==`function`?performance.now():0,xt=async()=>{await new Promise(e=>requestAnimationFrame(()=>e()))},St=async(e,t,n)=>{let r=null,i=new Promise((e,i)=>{r=window.setTimeout(()=>i(Error(`${n} timed out`)),t)});try{return await Promise.race([e,i])}finally{r!==null&&window.clearTimeout(r)}},$=()=>{let e=typeof crypto<`u`?crypto:void 0;if(e&&`randomUUID`in e&&typeof e.randomUUID==`function`)return e.randomUUID();if(e&&`getRandomValues`in e&&typeof e.getRandomValues==`function`){let t=new Uint8Array(16);e.getRandomValues(t);let n=``;for(let e=0;e<t.length;e++)n+=t[e].toString(16).padStart(2,`0`);return n}return`id-${Math.random().toString(16).slice(2)}-${Math.random().toString(16).slice(2)}`},Ct=null,wt=new Map;function Tt(){if(Ct)return Ct;if(typeof window>`u`)throw Error(`encode worker unavailable (no window)`);if(typeof Worker>`u`)throw Error(`encode worker unavailable (Worker not supported)`);let e=new URL(`data:video/mp2t;base64,Ly8vIDxyZWZlcmVuY2UgbGliPSJ3ZWJ3b3JrZXIiIC8+CgppbXBvcnQgewogIGVuY29kZVRva2VuV2l0aEJ1ZGdldHMsCiAgdHlwZSBGZWVkUG9zdFBheWxvYWQsCn0gZnJvbSAiLi4vLi4vdXRpbHMvZmVlZFBheWxvYWQiOwoKdHlwZSBFbmNvZGVXb3JrZXJSZXF1ZXN0ID0gewogIGlkOiBzdHJpbmc7CiAgcGF5bG9hZDogRmVlZFBvc3RQYXlsb2FkOwp9OwoKdHlwZSBFbmNvZGVXb3JrZXJSZXNwb25zZSA9CiAgfCB7IGlkOiBzdHJpbmc7IG9rOiB0cnVlOyB0b2tlbjogc3RyaW5nOyB3aXRoaW5IYXJkOiBib29sZWFuOyBtczogbnVtYmVyIH0KICB8IHsgaWQ6IHN0cmluZzsgb2s6IGZhbHNlOyBlcnJvcjogc3RyaW5nOyBtczogbnVtYmVyIH07Cgpjb25zdCBub3cgPSAoKTogbnVtYmVyID0+CiAgc2VsZi5wZXJmb3JtYW5jZSAmJiB0eXBlb2Ygc2VsZi5wZXJmb3JtYW5jZS5ub3cgPT09ICJmdW5jdGlvbiIKICAgID8gc2VsZi5wZXJmb3JtYW5jZS5ub3coKQogICAgOiBEYXRlLm5vdygpOwoKc2VsZi5vbm1lc3NhZ2UgPSAoZXY6IE1lc3NhZ2VFdmVudDxFbmNvZGVXb3JrZXJSZXF1ZXN0PikgPT4gewogIGNvbnN0IHQwID0gbm93KCk7CiAgY29uc3QgZGF0YSA9IGV2LmRhdGE7CgogIHRyeSB7CiAgICBjb25zdCBvdXQgPSBlbmNvZGVUb2tlbldpdGhCdWRnZXRzKGRhdGEucGF5bG9hZCk7CiAgICBjb25zdCBtc2c6IEVuY29kZVdvcmtlclJlc3BvbnNlID0gewogICAgICBpZDogZGF0YS5pZCwKICAgICAgb2s6IHRydWUsCiAgICAgIHRva2VuOiBvdXQudG9rZW4sCiAgICAgIHdpdGhpbkhhcmQ6IG91dC53aXRoaW5IYXJkLAogICAgICBtczogbm93KCkgLSB0MCwKICAgIH07CiAgICBzZWxmLnBvc3RNZXNzYWdlKG1zZyk7CiAgfSBjYXRjaCAoZSkgewogICAgY29uc3QgbXNnOiBFbmNvZGVXb3JrZXJSZXNwb25zZSA9IHsKICAgICAgaWQ6IGRhdGEuaWQsCiAgICAgIG9rOiBmYWxzZSwKICAgICAgZXJyb3I6IGUgaW5zdGFuY2VvZiBFcnJvciA/IGUubWVzc2FnZSA6IFN0cmluZyhlKSwKICAgICAgbXM6IG5vdygpIC0gdDAsCiAgICB9OwogICAgc2VsZi5wb3N0TWVzc2FnZShtc2cpOwogIH0KfTsK`,``+import.meta.url);return Ct=new Worker(e,{type:`module`,name:`kaiVohEncodeWorker`}),Ct.onmessage=e=>{let t=e.data,n=wt.get(t.id);n&&(wt.delete(t.id),n(t))},Ct.onerror=()=>{for(let[e,t]of wt)t({id:e,ok:!1,error:`encode worker crashed`,ms:0});wt.clear();try{Ct?.terminate()}catch{}Ct=null},Ct}async function Et(e){let t=Tt(),n=$();return new Promise(r=>{wt.set(n,r);let i={id:n,payload:e};t.postMessage(i)})}async function Dt(e){let t=bt(),n=()=>{try{let n=D(e);return{id:$(),ok:!0,token:n.token,withinHard:n.withinHard,ms:bt()-t}}catch(e){return{id:$(),ok:!1,error:e instanceof Error?e.message:String(e),ms:bt()-t}}};try{let t=await Et(e);if(!t.ok){let e=n();return e.ok?e:t}return t}catch{return n()}}function Ot({initialCaption:e=``,initialAuthor:t=``,onExhale:i}){let{auth:a}=fe(),o=a.meta,s=(0,K.useRef)(NaN),[c,l]=(0,K.useState)(e),[u,d]=(0,K.useState)(t),[f,p]=(0,K.useState)(`text`),[h,g]=(0,K.useState)(`tsx`),[v,b]=(0,K.useState)(`code`),[S,w]=(0,K.useState)(``),[E,D]=(0,K.useState)(``),[O,A]=(0,K.useState)(``),[j,M]=(0,K.useState)([]),[te,N]=(0,K.useState)([]),[P,re]=(0,K.useState)({version:1,totalBytes:0,inlinedBytes:0,items:[]}),F=(0,K.useRef)(P),[ie,I]=(0,K.useState)(!1),[R,ae]=(0,K.useState)(null),[z,oe]=(0,K.useState)(!1),[B,V]=(0,K.useState)(``),[H,le]=(0,K.useState)(null),[ue,U]=(0,K.useState)(null),[de,W]=(0,K.useState)(null),[pe,G]=(0,K.useState)(!1),[me,he]=(0,K.useState)(``),[ge,ye]=(0,K.useState)(0),[be,xe]=(0,K.useState)(`path`),[J,Se]=(0,K.useState)(!1),[Y,Ce]=(0,K.useState)(`derived`),[we,Ee]=(0,K.useState)(``),[X,De]=(0,K.useState)(()=>ve(18)),[Z,Oe]=(0,K.useState)([]),[ke,Ae]=(0,K.useState)(!1),je=(0,K.useRef)(!1),Me=(0,K.useRef)(null),Pe=(0,K.useRef)(null),Fe=!!o;(0,K.useEffect)(()=>{je.current||l(e)},[e]),(0,K.useEffect)(()=>{je.current||d(t)},[t]),(0,K.useEffect)(()=>{if(je.current||(je.current=!0,typeof window>`u`))return;let n=window.sessionStorage.getItem(ct);if(n)try{let r=JSON.parse(n);if(!ft(r)||r.v!==1)return;let i=lt.includes(r.bodyKind)?r.bodyKind:`text`,a=ut.includes(r.htmlMode)?r.htmlMode:`code`,o=dt.includes(r.sealMode)?r.sealMode:`derived`,s=vt(r.extraUrls).map(e=>e.trim()).filter(e=>$e(e)).map(e=>T({url:e}));l(gt(r.caption,e)),d(gt(r.author,t)),p(i),g(gt(r.codeLang,`tsx`)),b(a),A(gt(r.extraUrlField,``)),M(s),Se(_t(r.privateOn,!1)),Ce(o),Ee(gt(r.sealTeaser,``)),De(gt(r.sealSalt,ve(18))),Oe(yt(r.allowedGlyphs)),Ae(_t(r.sealAdvanced,!1))}catch{}},[t,e]),(0,K.useEffect)(()=>{if(je.current)return Me.current&&window.clearTimeout(Me.current),Me.current=window.setTimeout(()=>{let e={v:1,caption:c,author:u,bodyKind:f,codeLang:h,htmlMode:v,extraUrlField:O,extraUrls:j.map(e=>e.url),privateOn:J,sealMode:Y,sealTeaser:we,sealSalt:X,allowedGlyphs:Z,sealAdvanced:ke};try{window.sessionStorage.setItem(ct,JSON.stringify(e))}catch{}},250),()=>{Me.current&&window.clearTimeout(Me.current)}},[c,u,f,h,v,O,j,J,Y,we,X,Z,ke]),(0,K.useEffect)(()=>{F.current=P},[P]),(0,K.useEffect)(()=>()=>{R&&URL.revokeObjectURL(R.url)},[]);let Ie=(0,K.useMemo)(()=>Q(o,`sigilActionUrl`)||Q(o,`sigilUrl`)||Q(o,`actionUrl`)||Q(o,`url`)||Q(o,`claimedUrl`)||Q(o,`loginUrl`)||Q(o,`sourceUrl`)||Q(o,`originUrl`)||Q(o,`link`)||Q(o,`href`)||rt(a.svgText,o??{})||(globalThis.location?.origin??`https://kaiklok.com`),[o,a.svgText]);(0,K.useEffect)(()=>{o&&(w(Q(o,`userPhiKey`)??``),D(Q(o,`kaiSignature`)??``))},[o]),(0,K.useEffect)(()=>{J&&(X.trim()||De(ve(18)))},[J,X]);let Le=()=>{let e=O.trim();if(!$e(e)){W(`Invalid URL. Enter a full http(s) link.`);return}M(t=>[...t,T({url:e})]),A(``),W(null)},Re=e=>{M(t=>t.filter((t,n)=>n!==e))};function ze(e){let t=e,n=typeof t.webkitRelativePath==`string`?t.webkitRelativePath:``;return n.trim()?n:e.name}async function Be(e){let t=await e.arrayBuffer(),n=await crypto.subtle.digest(`SHA-256`,t),r=new Uint8Array(n),i=``;for(let e=0;e<r.length;e++)i+=r[e].toString(16).padStart(2,`0`);return i}let Ve=async e=>{let t=F.current.items.slice(),n=[];for(let r of e){let e=ze(r);if(J&&r.size>Je){n.push(e);continue}if(r.size<=Je){let n=await r.arrayBuffer();t.push(x({name:e,type:r.type||`application/octet-stream`,size:r.size,data_b64url:tt(n)}))}else{let n=await Be(r),i=await it(n,r,{cacheName:`sigil-attachments-v1`,pathPrefix:`/att/`});t.push(ce({sha256:n,name:e,type:r.type||`application/octet-stream`,size:r.size,url:i}))}}return n.length>0&&W(`Private (Sealed) mode cannot include cache-backed large files. Skipped: ${n.slice(0,3).join(`, `)}${n.length>3?` (+${n.length-3} more)`:``}. Attach as a URL instead (Drive/S3/IPFS/etc), or keep files ‚â§ ${Ze(Je)}.`),se(t)},He=async e=>{if(!e.target.files)return;let t=Array.from(e.target.files);N(e=>[...e,...t]),re(await Ve(t))},Ue=async e=>{if(e.preventDefault(),e.stopPropagation(),!e.dataTransfer?.files?.length)return;let t=Array.from(e.dataTransfer.files);N(e=>[...e,...t]),re(await Ve(t))},We=e=>{e.preventDefault(),e.stopPropagation()},Ye=()=>{N([]);let e={version:1,totalBytes:0,inlinedBytes:0,items:[]};re(e),F.current=e};function Xe(e){let[,t]=e.split(`,`,2);return t?Math.ceil(t.length*3/4):0}async function mt(e){if(J){W(`Private (Sealed) mode cannot include recorded stories (cache-backed video refs). Upload as a URL instead.`),I(!1);return}let t=await it(e.sha256,e.file,{cacheName:`sigil-attachments-v1`,pathPrefix:`/att/`}),n=ce({sha256:e.sha256,name:e.file.name,type:e.mimeType||e.file.type||`video/webm`,size:e.file.size,url:t}),r=(e.thumbnailDataUrl.split(`,`,2)[1]??``).replace(/\+/g,`-`).replace(/\//g,`_`).replace(/=+$/g,``),i=x({name:e.file.name.replace(/\.(webm|mp4)$/i,``)+`_thumb.png`,type:`image/png`,size:Xe(e.thumbnailDataUrl),data_b64url:r});re(se([...F.current.items,n,i])),R&&URL.revokeObjectURL(R.url),ae({url:URL.createObjectURL(e.file),durationMs:e.durationMs}),I(!1)}let $=c.trim(),Ct=(0,K.useMemo)(()=>$?f===`text`?ne($):f===`md`?L($):f===`html`?_($,v):ee($,h.trim()||void 0):void 0,[$,f,h,v]),wt=(0,K.useMemo)(()=>{if(!$)return;let e=ot($).trim();if(e){if(f===`code`){let t=h.trim();return st(`${t?`code:${t}`:`code`} ‚Äî ${e}`,220)}return st(f===`md`?`md ‚Äî ${e}`:f===`html`?`html ‚Äî ${e}`:e,220)}},[$,f,h]),Tt=(0,K.useMemo)(()=>F.current.items.some(e=>e.kind===`file-ref`),[P]),Et=(0,K.useMemo)(()=>{if(!J)return wt;let e=we.trim();return e?st(e,220):`Sealed Memory`},[J,wt,we]),Ot=J&&Y===`derived`&&Fe&&!!E.trim(),kt=J&&Y===`glyph`&&Z.length>0,At=(0,K.useMemo)(()=>J?Fe?Y===`derived`?E.trim()?X.trim()?(0,q.jsxs)(`div`,{className:`composer-hint`,children:[`Mode: `,(0,q.jsx)(`strong`,{children:`Derived Glyph Access`}),` ‚Ä¢ Any derivative glyph exported from this issuer glyph can unlock ‚Ä¢ Salt length`,` `,(0,q.jsx)(`strong`,{children:X.trim().length})]}):(0,q.jsx)(`div`,{className:`composer-hint warn`,children:`Derivation salt missing ‚Äî rotate to generate.`}):(0,q.jsx)(`div`,{className:`composer-hint warn`,children:`Derived access requires Œ£Sig (kaiSignature) present in your verified glyph.`}):Z.length===0?(0,q.jsx)(`div`,{className:`composer-hint warn`,children:`Mode: Specific Glyph Access requires at least one allowed glyph SVG uploaded.`}):(0,q.jsxs)(`div`,{className:`composer-hint`,children:[`Mode: `,(0,q.jsx)(`strong`,{children:`Specific Glyph Access`}),` ‚Ä¢ Allowed glyphs `,(0,q.jsx)(`strong`,{children:Z.length})]}):(0,q.jsx)(`div`,{className:`composer-hint warn`,children:`Private (Sealed) requires a verified glyph session.`}):null,[J,Fe,Y,E,X,Z.length]),jt=async e=>{if(e.length===0)return;let t=[],n=[];for(let r of e)try{let e=Ne(await r.text()),i=(e.userPhiKey??``).trim(),a=(e.kaiSignature??``).trim();if(!i||!a){n.push(r.name);continue}t.push({label:r.name,phiKey:i,kaiSignature:a,sigilId:(e.sigilId??``).trim()?(e.sigilId??``).trim():void 0})}catch{n.push(r.name)}t.length>0&&(Oe(e=>{let n=e.slice(),r=new Set(e.map(e=>`${e.phiKey}:${e.kaiSignature}`));for(let e of t){let t=`${e.phiKey}:${e.kaiSignature}`;r.has(t)||(r.add(t),n.push(e))}return n}),W(null)),n.length>0&&W(`Some glyph SVGs were missing Œ¶Key/Œ£Sig metadata and were not added: ${n.slice(0,3).join(`, `)}${n.length>3?` (+${n.length-3} more)`:``}.`)},Mt=e=>{Oe(t=>t.filter((t,n)=>n!==e))},Nt=async()=>{if(z)return;U(null),W(null),G(!1),he(``),ye(0),xe(`path`),le(null);let e=(Ie||``).trim(),t=et(e);if(t||W(`Proof of Breath‚Ñ¢ URL not detected; using fallback. Link generation will still work.`),J){if([...F.current.items,...j].some(e=>e.kind===`file-ref`)){U(`Private (Sealed) mode cannot include cache-backed file refs. Keep files ‚â§ ${Ze(Je)} (inline) or attach public URLs.`);return}if(Y===`derived`&&!Ot){U(`Private (Sealed) ‚Üí Derived mode requires a verified glyph with Œ£Sig (kaiSignature) present.`);return}if(Y===`glyph`&&!kt){U(`Private (Sealed) ‚Üí Specific Glyph mode requires at least one allowed glyph SVG uploaded.`);return}}let a=s.current;if(!Number.isFinite(a)||a<0){U(`Failed to compute Kai pulse (aligned ticker not ready).`);return}let c=pt(n(a)),l=bt();try{oe(!0),V(`paint`),await xt(),await xt(),V(`assemble`);let n=[...F.current.items,...j],s=n.length>0?se(n):void 0,d=t?e:void 0,f=d?r(d)??d:void 0,p=Q(o,`sigilId`)||Q(o,`sigilID`)||Q(o,`glyphId`)||void 0,h=m({url:e,pulse:a,caption:Et,body:Ct,author:u.trim()?u.trim():void 0,source:`manual`,sigilId:p,phiKey:Fe&&S?S:void 0,kaiSignature:Fe&&E?E:void 0,ts:c,attachments:s,parentUrl:d,originUrl:f});V(`prepare`);let g=bt(),_=await St(C(h,{cacheName:`sigil-attachments-v1`,pathPrefix:`/att/`}),2e4,`preparePayloadForLink`),v=bt()-g,b=_;if(J){let e={body:_.body??null,attachments:_.attachments??null},t;if(Y===`derived`){let n=X.trim()?X.trim():ve(18);n!==X&&De(n),t=await _e({inner:e,teaser:Et??void 0,derived:{issuerKaiSignature:E,issuerPhiKey:S||void 0,salt_b64url:n}})}else{let n=Z.map(e=>({phiKey:e.phiKey,kaiSignature:e.kaiSignature,sigilId:e.sigilId}));t=await _e({inner:e,teaser:Et??void 0,allowGlyphs:n})}b={..._,body:void 0,attachments:void 0,seal:t}}V(`encode(worker)`);let x=bt(),w=await St(Dt(b),3e4,`encodeTokenWithBudgets(worker)`),T=bt()-x;if(!w.ok){le({stage:`encode(worker)`,totalMs:bt()-l,prepareMs:v,encodeMs:w.ms,items:n.length,inlinedBytes:s?.inlinedBytes,totalBytes:s?.totalBytes,note:w.error}),U(`Token encode failed: ${w.error}. If you have a strict CSP, allow module workers from 'self' (worker-src 'self'). This build uses a real worker file (no blob workers).`);return}let{token:D,withinHard:O}=w;ye(D.length);let A=globalThis.location?.origin??`https://kaiklok.com`,M=O?`${A}/stream/p/${encodeURIComponent(D)}`:`${A}/stream#t=${D}`;xe(O?`path`:`hash`),D.length>3500?W(`Token exceeds hard path limit (${D.length.toLocaleString()} > ${y.toLocaleString()}). Using hash URL to avoid request-line limits.`):D.length>1800&&W(`Token is large (${D.length.toLocaleString()} chars). Prefer trimming inlined files or relying on external URLs.`),V(`register`),k(M),V(`clipboard`);try{await navigator.clipboard.writeText(M),G(!0)}catch{G(!1)}he(M),le({stage:`done`,totalMs:bt()-l,prepareMs:v,encodeMs:T,tokenLen:D.length,items:n.length,inlinedBytes:s?.inlinedBytes,totalBytes:s?.totalBytes}),i&&i({shareUrl:M,token:D,payload:b})}catch(e){let t=e instanceof Error?e.message:typeof e==`string`?e:`Failed to generate link.`;U(t),le({stage:B||`unknown`,totalMs:bt()-l,note:t})}finally{V(``),oe(!1)}},Pt=()=>{l(e||``),d(t||``),p(`text`),g(`tsx`),b(`code`),A(``),M([]),Ye(),U(null),W(null),G(!1),he(``),ye(0),xe(`path`),V(``),le(null),Ee(``),Ae(!1),R&&(URL.revokeObjectURL(R.url),ae(null));try{window.sessionStorage.removeItem(ct)}catch{}},Ft=e=>t=>e(t.target.value),It=(0,K.useMemo)(()=>{if(!Fe)return null;let e=nt(o,`pulse`);return(0,q.jsxs)(`div`,{className:`id-banner`,role:`status`,"aria-live":`polite`,children:[(0,q.jsx)(`span`,{className:`id-dot`}),(0,q.jsxs)(`span`,{className:`id-text`,children:[`Verified by Sigil ‚Äî Œ¶Key `,(0,q.jsx)(`strong`,{children:Qe(S)}),` ‚Ä¢ `,`Last verified pulse `,(0,q.jsx)(`strong`,{children:e??`‚Äî`})]}),(0,q.jsxs)(`span`,{className:`id-sub mono`,children:[`Œ£Sig `,Qe(E)]})]})},[Fe,S,E,o]),Lt=(0,K.useMemo)(()=>Ie?(0,q.jsxs)(`div`,{className:`composer`,children:[(0,q.jsx)(`label`,{className:`composer-label`,children:`Proof Of Breath‚Ñ¢ URL`}),(0,q.jsxs)(`div`,{className:`composer-input-row`,children:[(0,q.jsx)(`input`,{className:`composer-input locked`,type:`url`,value:Ie,readOnly:!0}),(0,q.jsx)(`button`,{type:`button`,className:`composer-aux`,onClick:async()=>{try{await navigator.clipboard.writeText(Ie),G(!0),window.setTimeout(()=>G(!1),1200)}catch{}},title:`Remember Proof Of Breath‚Ñ¢ URL`,children:pe?`Remembered ‚úì`:`Remember`})]}),!et(Ie)&&(0,q.jsx)(`div`,{className:`composer-hint warn`,children:`No canonical stream token detected in the URL. Fallback will still produce a valid post.`})]}):null,[Ie,pe]),Rt=(0,q.jsxs)(`div`,{className:`composer`,children:[(0,q.jsx)(`label`,{className:`composer-label`,children:`Privacy Seal`}),(0,q.jsxs)(`div`,{className:`story-actions`,style:{alignItems:`center`,gap:10},children:[(0,q.jsx)(`button`,{type:`button`,className:`pill ${J?`prim`:`subtle`}`,onClick:()=>{Se(e=>!e),U(null),W(null)},title:`Toggle Private (Sealed)`,children:J?`Private: ON`:`Private: OFF`}),J&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(`button`,{type:`button`,className:`pill ${Y===`derived`?`prim`:`subtle`}`,onClick:()=>Ce(`derived`),title:`Derived glyph access`,children:`Derived`}),(0,q.jsx)(`button`,{type:`button`,className:`pill ${Y===`glyph`?`prim`:`subtle`}`,onClick:()=>Ce(`glyph`),title:`Specific glyph allowlist`,children:`Specific Glyph`}),(0,q.jsx)(`button`,{type:`button`,className:`pill ${ke?`prim`:`subtle`}`,onClick:()=>Ae(e=>!e),title:`Show advanced sealing details`,children:`Advanced`})]})]}),J&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(`div`,{className:`composer-hint`,children:[`Private (Sealed) encrypts `,(0,q.jsx)(`span`,{className:`mono`,children:`body + attachments`}),` inside the token. The outer post remains verifiable (Œ¶Key/Œ£Sig) but does not contain plaintext content.`]}),(0,q.jsxs)(`div`,{className:`composer`,style:{padding:0,marginTop:10},children:[(0,q.jsx)(`label`,{className:`composer-label`,children:`Public teaser (optional)`}),(0,q.jsx)(`input`,{className:`composer-input`,type:`text`,value:we,onChange:Ft(Ee),placeholder:`What should be visible without unlocking?`,maxLength:240}),(0,q.jsxs)(`div`,{className:`composer-hint`,children:[`If empty, the public caption becomes `,(0,q.jsx)(`span`,{className:`mono`,children:`Sealed Memory`}),`.`]})]}),Y===`derived`&&(0,q.jsxs)(`div`,{className:`composer`,style:{padding:0,marginTop:10},children:[(0,q.jsx)(`label`,{className:`composer-label`,children:`Derivation salt (for verifier export)`}),(0,q.jsxs)(`div`,{className:`composer-input-row`,children:[(0,q.jsx)(`input`,{className:`composer-input mono`,type:`text`,readOnly:!0,value:X}),(0,q.jsx)(`button`,{type:`button`,className:`composer-aux`,onClick:()=>De(ve(18)),title:`Rotate derivation salt`,children:`Rotate`}),(0,q.jsx)(`button`,{type:`button`,className:`composer-aux`,onClick:async()=>{try{await navigator.clipboard.writeText(X),G(!0),window.setTimeout(()=>G(!1),900)}catch{}},title:`Copy salt`,children:`Copy`})]}),ke&&(0,q.jsx)(`div`,{className:`composer-hint mono`,style:{marginTop:8},children:Fe&&E.trim()?(0,q.jsxs)(q.Fragment,{children:[`Derived Œ£Sig (b64url, post-scoped): `,(0,q.jsx)(`button`,{type:`button`,className:`pill subtle`,onClick:async()=>{try{let e=await Ge({baseKaiSignature:E,salt_b64url:X});await navigator.clipboard.writeText(e),G(!0),window.setTimeout(()=>G(!1),900)}catch{}},title:`Copy derived signature`,children:`Copy derived Œ£Sig`}),(0,q.jsx)(`span`,{className:`dim`,style:{marginLeft:8},children:`(secret-equivalent; only for issuer export workflows)`})]}):`Derived preview unavailable (missing verified Œ£Sig).`})]}),Y===`glyph`&&(0,q.jsxs)(`div`,{className:`composer`,style:{padding:0,marginTop:10},children:[(0,q.jsx)(`label`,{className:`composer-label`,children:`Allowed glyphs (upload SVG)`}),(0,q.jsxs)(`div`,{className:`story-actions`,style:{alignItems:`center`},children:[(0,q.jsxs)(`label`,{className:`pill`,children:[(0,q.jsx)(`input`,{type:`file`,accept:`.svg,image/svg+xml`,multiple:!0,className:`visually-hidden`,onChange:async e=>{let t=e.target.files?Array.from(e.target.files):[];e.currentTarget.value=``,t.length!==0&&await jt(t)}}),`Add allowed glyphs‚Ä¶`]}),Z.length>0&&(0,q.jsx)(`button`,{type:`button`,className:`pill subtle`,onClick:()=>Oe([]),title:`Clear allowlist`,children:`Clear`})]}),Z.length>0&&(0,q.jsx)(`ul`,{className:`url-list`,style:{marginTop:10},children:Z.map((e,t)=>(0,q.jsxs)(`li`,{className:`url-item`,style:{alignItems:`center`},children:[(0,q.jsx)(`span`,{className:`badge`,children:`glyph`}),(0,q.jsx)(`span`,{className:`mono`,children:st(e.label,36)}),(0,q.jsxs)(`span`,{className:`dim`,style:{marginLeft:10},children:[`Œ¶Key `,Qe(e.phiKey,10,8)]}),(0,q.jsx)(`button`,{type:`button`,className:`pill danger`,onClick:()=>Mt(t),title:`Remove glyph`,children:`‚úï`})]},`${e.phiKey}:${e.kaiSignature}:${t}`))}),(0,q.jsxs)(`div`,{className:`composer-hint`,style:{marginTop:8},children:[`This is `,(0,q.jsx)(`strong`,{children:`not`}),` pulse-locked ‚Äî if a user possesses an allowed glyph (its Œ£Sig), they can unlock sealed posts across pulses.`]})]}),(0,q.jsxs)(`div`,{className:`composer-hint warn`,style:{marginTop:10},children:[`Private (Sealed) hard-guard: no cache-backed `,(0,q.jsx)(`span`,{className:`mono`,children:`file-ref`}),` attachments. Use URLs or keep files ‚â§`,` `,(0,q.jsx)(`strong`,{children:Ze(Je)}),`.`]}),At]})]}),zt=(0,q.jsxs)(`div`,{className:`attachments`,children:[(0,q.jsx)(`h3`,{className:`attachments-title`,children:`Seals`}),(0,q.jsxs)(`div`,{className:`composer`,children:[(0,q.jsx)(`label`,{className:`composer-label`,children:`Seal a memory`}),(0,q.jsxs)(`div`,{className:`story-actions`,children:[(0,q.jsx)(`button`,{type:`button`,className:`pill prim icon-only${J?` disabled`:``}`,"aria-label":`Open Memory Recorder`,title:J?`Private mode: story capture is disabled (cache-backed)`:`Record story`,onClick:()=>{if(J){W(`Private (Sealed) mode disables story recording (cache-backed file refs). Add as URL instead.`);return}I(!0)},disabled:J,children:(0,q.jsx)(Ke,{})}),R&&(0,q.jsxs)(`div`,{className:`story-preview`,children:[(0,q.jsx)(`video`,{src:R.url,playsInline:!0,controls:!0,className:`story-preview-video`}),(0,q.jsx)(`div`,{className:`story-preview-meta mono`,children:at(R.durationMs)}),(0,q.jsx)(`button`,{type:`button`,className:`pill danger icon-only`,onClick:()=>{URL.revokeObjectURL(R.url),ae(null)},"aria-label":`Remove recorded preview`,title:`Remove preview`,children:(0,q.jsx)(qe,{})})]})]})]}),(0,q.jsxs)(`div`,{className:`composer`,children:[(0,q.jsx)(`label`,{className:`composer-label`,children:`Seal any URL`}),(0,q.jsxs)(`div`,{className:`composer-input-row`,children:[(0,q.jsx)(`input`,{className:`composer-input`,type:`url`,placeholder:`https://example.com/docs/your-file.pdf`,value:O,onChange:Ft(A),autoCapitalize:`none`,autoCorrect:`off`,spellCheck:!1}),(0,q.jsx)(`button`,{type:`button`,className:`composer-aux`,onClick:Le,title:`Add URL`,children:`Seal`})]}),j.length>0&&(0,q.jsx)(`ul`,{className:`url-list`,children:j.map((e,t)=>(0,q.jsxs)(`li`,{className:`url-item`,children:[(0,q.jsx)(`span`,{className:`mono`,children:Qe(e.url,28,16)}),(0,q.jsx)(`button`,{type:`button`,className:`pill danger`,onClick:()=>Re(t),title:`Remove URL`,children:`‚úï`})]},`${e.url}-${t}`))})]}),(0,q.jsx)(`div`,{ref:Pe,className:`dropzone`,onDragOver:We,onDrop:Ue,"aria-label":`Drop files or folders here`,children:(0,q.jsxs)(`div`,{className:`dropzone-inner`,children:[(0,q.jsx)(`div`,{className:`dz-title`,children:`Seal files or folders`}),(0,q.jsxs)(`div`,{className:`dz-sub`,children:[`Tiny files get inlined; large files become cache-backed refs.`,J?(0,q.jsxs)(q.Fragment,{children:[` `,(0,q.jsx)(`strong`,{children:`(Private mode skips large files.)`})]}):null]}),(0,q.jsxs)(`div`,{className:`dz-actions`,children:[(0,q.jsxs)(`label`,{className:`pill`,children:[(0,q.jsx)(`input`,{type:`file`,multiple:!0,onChange:He,className:`visually-hidden`}),`Inhale files‚Ä¶`]}),(0,q.jsxs)(`label`,{className:`pill`,children:[(0,q.jsx)(`input`,{type:`file`,multiple:!0,webkitdirectory:``,onChange:He,className:`visually-hidden`}),`Inhale folder‚Ä¶`]}),te.length>0&&(0,q.jsx)(`button`,{type:`button`,className:`pill subtle`,onClick:Ye,children:`Reset`})]})]})}),P.items.length>0&&(0,q.jsxs)(`div`,{className:`file-summary`,children:[(0,q.jsxs)(`div`,{className:`composer-hint`,children:[`Items: `,(0,q.jsx)(`strong`,{children:P.items.length}),` ‚Ä¢ Files total: `,(0,q.jsx)(`strong`,{children:Ze(P.totalBytes??0)}),` ‚Ä¢ Inlined:`,` `,(0,q.jsx)(`strong`,{children:Ze(P.inlinedBytes??0)}),` (‚â§ `,Ze(Je),` each)`]}),(0,q.jsx)(`ul`,{className:`file-list`,children:P.items.map((e,t)=>{if(e.kind===`url`)return(0,q.jsx)(`li`,{className:`file-item`,children:(0,q.jsxs)(`div`,{className:`file-row`,children:[(0,q.jsx)(`span`,{className:`badge`,children:`url`}),(0,q.jsx)(`span`,{className:`mono`,children:Qe(e.url,34,18)})]})},`url-${t}`);let n=e.name??`file-${t}`,r=e.kind===`file-inline`,i=`type`in e&&typeof e.type==`string`?e.type:`application/octet-stream`,a=`size`in e&&typeof e.size==`number`?e.size:0;return(0,q.jsx)(`li`,{className:`file-item`,children:(0,q.jsxs)(`div`,{className:`file-row`,children:[(0,q.jsx)(`span`,{className:`badge`,children:r?`inline`:`file`}),(0,q.jsx)(`span`,{className:`mono`,children:n}),(0,q.jsxs)(`span`,{className:`dim`,children:[i,` ‚Ä¢ `,Ze(a)]})]})},`${n}-${t}`)})}),P.items.some(e=>e.kind===`file-ref`)&&(0,q.jsxs)(`div`,{className:`composer-hint ${J?`warn`:``}`,children:[`Large files are cached and referenced by SHA-256.`,J?` Private (Sealed) will refuse these ‚Äî attach public URLs instead.`:` You can also host publicly and attach the public URL above.`]})]})]}),Bt=f===`code`?10:3,Vt=f===`code`?`Paste your code‚Ä¶`:f===`md`?`Write markdown‚Ä¶`:f===`html`?`Write HTML‚Ä¶ (default renders as escaped code unless sanitized by the stream UI)`:`What Resonants About This Moment‚Ä¶`,Ht=z||J&&Y===`derived`&&!Ot||J&&Y===`glyph`&&!kt||J&&Tt;return(0,q.jsxs)(`div`,{className:`social-connector-container`,children:[(0,q.jsx)(ht,{pulseRef:s}),(0,q.jsx)(`h2`,{className:`social-connector-title`,children:`KaiVoh`}),(0,q.jsxs)(`p`,{className:`social-connector-sub`,children:[`Exhale a sealed `,(0,q.jsx)(`strong`,{children:`Memory Stream`}),`.`]}),It,Lt,Rt,(0,q.jsxs)(`div`,{className:`composer`,children:[(0,q.jsx)(`label`,{className:`composer-label`,children:`Body Format`}),(0,q.jsxs)(`div`,{className:`story-actions`,children:[(0,q.jsx)(`button`,{type:`button`,className:`pill ${f===`text`?`prim`:`subtle`}`,onClick:()=>p(`text`),title:`Text`,children:`Text`}),(0,q.jsx)(`button`,{type:`button`,className:`pill ${f===`code`?`prim`:`subtle`}`,onClick:()=>p(`code`),title:`Code`,children:`Code`}),(0,q.jsx)(`button`,{type:`button`,className:`pill ${f===`md`?`prim`:`subtle`}`,onClick:()=>p(`md`),title:`Markdown`,children:`MD`}),(0,q.jsx)(`button`,{type:`button`,className:`pill ${f===`html`?`prim`:`subtle`}`,onClick:()=>p(`html`),title:`HTML`,children:`HTML`}),f===`code`&&(0,q.jsx)(`input`,{className:`composer-input`,style:{maxWidth:160},value:h,onChange:Ft(g),placeholder:`lang (tsx)`,"aria-label":`Code language`,autoCapitalize:`none`,autoCorrect:`off`,spellCheck:!1}),f===`html`&&(0,q.jsxs)(`button`,{type:`button`,className:`pill ${v===`code`?`prim`:`subtle`}`,onClick:()=>b(e=>e===`code`?`sanitized`:`code`),title:`HTML mode (stream decides how to render)`,children:[`mode:`,v]})]}),(0,q.jsxs)(`div`,{className:`composer-hint`,children:[`v2 posts include `,(0,q.jsx)(`span`,{className:`mono`,children:`body.kind`}),` so the stream can render code as code (escaped) instead of treating everything as plain text.`,J?(0,q.jsx)(q.Fragment,{children:` In Private mode, the body is sealed and not visible until unlocked.`}):null]})]}),(0,q.jsxs)(`div`,{className:`composer two`,children:[(0,q.jsxs)(`div`,{className:`field`,children:[(0,q.jsxs)(`label`,{htmlFor:`caption`,className:`composer-label`,children:[`Memory `,(0,q.jsx)(`span`,{className:`muted`,children:`(Body)`})]}),(0,q.jsx)(`textarea`,{id:`caption`,className:`composer-textarea${f===`code`?` mono`:``}`,rows:Bt,placeholder:Vt,value:c,onChange:Ft(l),spellCheck:f!==`code`})]}),(0,q.jsxs)(`div`,{className:`field`,children:[(0,q.jsxs)(`label`,{htmlFor:`author`,className:`composer-label`,children:[`Author Handle `,(0,q.jsx)(`span`,{className:`muted`,children:`(optional, e.g., @KaiRexKlok)`})]}),(0,q.jsx)(`input`,{id:`author`,className:`composer-input`,type:`text`,placeholder:`@handle`,value:u,onChange:Ft(d),autoCorrect:`off`,autoCapitalize:`none`})]})]}),zt,ue&&(0,q.jsx)(`div`,{className:`composer-error`,children:ue}),de&&!ue&&(0,q.jsx)(`div`,{className:`composer-warn`,children:de}),(z||H)&&(0,q.jsxs)(`div`,{className:`composer-hint mono`,"aria-live":`polite`,children:[z&&B?`stage: ${B}`:null,H?(0,q.jsxs)(q.Fragment,{children:[z&&B?` ‚Ä¢ `:null,`total ${Math.round(H.totalMs)}ms`,typeof H.prepareMs==`number`?` ‚Ä¢ prepare ${Math.round(H.prepareMs)}ms`:``,typeof H.encodeMs==`number`?` ‚Ä¢ encode ${Math.round(H.encodeMs)}ms`:``,typeof H.tokenLen==`number`?` ‚Ä¢ token ${H.tokenLen.toLocaleString()}`:``,typeof H.items==`number`?` ‚Ä¢ items ${H.items}`:``,typeof H.inlinedBytes==`number`?` ‚Ä¢ inlined ${Ze(H.inlinedBytes)}`:``,typeof H.totalBytes==`number`?` ‚Ä¢ bytes ${Ze(H.totalBytes)}`:``,H.note?` ‚Ä¢ note: ${H.note}`:``]}):null]}),(0,q.jsxs)(`div`,{className:`composer-actions`,children:[(0,q.jsx)(`button`,{type:`button`,onClick:Nt,className:`composer-submit`,disabled:Ht,title:Ht?`Fix sealing requirements / attachments to proceed`:`Exhale Stream`,children:z?`Exhaling‚Ä¶${B?` (${B})`:``}`:J?`Exhale Sealed Stream`:`Exhale Stream`}),(0,q.jsx)(`button`,{type:`button`,className:`composer-reset`,onClick:Pt,children:`Reset`})]}),me&&(0,q.jsxs)(`div`,{className:`composer-result`,children:[(0,q.jsx)(`label`,{htmlFor:`gen-url`,className:`composer-label`,children:`Your shareable link`}),(0,q.jsx)(`input`,{id:`gen-url`,className:`composer-input`,type:`text`,readOnly:!0,value:me,onFocus:e=>e.currentTarget.select()}),(0,q.jsxs)(`div`,{className:`composer-actions`,children:[(0,q.jsx)(`button`,{type:`button`,className:`composer-copy`,onClick:async()=>{try{await navigator.clipboard.writeText(me),G(!0)}catch{G(!1)}},children:pe?`Remembered ‚úì`:`Remember`}),(0,q.jsx)(`a`,{className:`composer-open`,href:me,target:`_blank`,rel:`noopener noreferrer`,children:`Open in new tab ‚Üí`})]}),(0,q.jsxs)(`p`,{className:`composer-hint`,children:[`Token length: `,(0,q.jsx)(`strong`,{children:ge.toLocaleString()}),` chars ‚Ä¢ URL mode:`,` `,(0,q.jsx)(`strong`,{children:be===`path`?`path`:`hash`}),` ‚Ä¢ soft `,1800 .toLocaleString(),` ‚Ä¢ hard`,` `,3500 .toLocaleString(),J?(0,q.jsxs)(q.Fragment,{children:[` `,`‚Ä¢ `,(0,q.jsx)(`strong`,{children:`sealed`})]}):null]})]}),(0,q.jsx)(Te,{isOpen:ie,onClose:()=>I(!1),onCaptured:mt,maxDurationMs:15e3,preferredFacingMode:`user`})]})}var kt=50*1024*1024,At=10;function jt(e){if(e===0)return`0 B`;let t=[`B`,`KB`,`MB`,`GB`,`TB`],n=1024,r=Math.floor(Math.log(e)/Math.log(n)),i=e/n**+r;return`${i.toFixed(i>=10?0:1)} ${t[r]}`}function Mt(e){let{type:t,name:n}=e,r=n.toLowerCase();return t.startsWith(`image/`)?`image`:t.startsWith(`video/`)?`video`:t.startsWith(`audio/`)?`audio`:t===`application/pdf`||t.startsWith(`text/`)||t.includes(`word`)||t.includes(`officedocument`)||t.includes(`spreadsheet`)||t.includes(`presentation`)?`document`:r.endsWith(`.zip`)||r.endsWith(`.rar`)||r.endsWith(`.7z`)||r.endsWith(`.tar`)||r.endsWith(`.gz`)?`archive`:`other`}var Nt={image:`Image`,video:`Video`,audio:`Audio`,document:`Document`,archive:`Archive`,other:`File`};function Pt(e){return[e.name,e.size,e.lastModified,Date.now(),Math.random().toString(36).slice(2,8)].join(`-`)}function Ft(e){return e.length===0?null:(e.find(e=>e.kind===`image`||e.kind===`video`)??e[0])?.id??null}function It(e){return`${e.name}:${e.size}:${e.lastModified}`}function Lt({onReady:e}){let t=(0,K.useRef)(null),n=(0,K.useRef)(null),r=(0,K.useRef)(null),[i,a]=(0,K.useState)([]),[o,s]=(0,K.useState)(null),[c,l]=(0,K.useState)(null),[u,d]=(0,K.useState)(`file`),[f,p]=(0,K.useState)(``),[m,h]=(0,K.useState)(``),[g,_]=(0,K.useState)(`general`),[v,y]=(0,K.useState)(``),[b,x]=(0,K.useState)(``),[S,C]=(0,K.useState)(``),[w,T]=(0,K.useState)(``),[E,D]=(0,K.useState)(``),[O,k]=(0,K.useState)(``),[A,j]=(0,K.useState)(!1),[M,ee]=(0,K.useState)(!1),[te,N]=(0,K.useState)(null),[ne,P]=(0,K.useState)(!1),[re,F]=(0,K.useState)(!1),ie=1e3,I=i.length>0,L=g===`legal-contract`,R=(0,K.useMemo)(()=>i.reduce((e,t)=>e+t.file.size,0),[i]),ae=(0,K.useMemo)(()=>I?jt(R):`0 B`,[I,R]),z=(0,K.useMemo)(()=>L?v.trim().length>0&&b.trim().length>0:!0,[L,v,b]),oe=(0,K.useMemo)(()=>I?z?3:2:1,[I,z]),se=(0,K.useMemo)(()=>oe===1?L?`Attach your agreement, annexes, and evidence`:`Attach the media or files you want to seal`:oe===2?L?`Describe the agreement and parties`:`Add context: caption, link, and tags`:L?`Review and seal as a legal record`:`Review and seal to the KaiVoh stream`,[oe,L]),B=(0,K.useCallback)(()=>{n.current&&=(URL.revokeObjectURL(n.current),null),r.current=null},[]);(0,K.useEffect)(()=>()=>{B()},[B]);let V=(0,K.useCallback)((e,t)=>{let i=t!==null&&e.some(e=>e.id===t)?t:Ft(e);if(s(i),!i){c&&(B(),l(null)),u!==`file`&&d(`file`);return}let a=e.find(e=>e.id===i)??null;if(!a){c&&(B(),l(null)),u!==`file`&&d(`file`);return}if(a.kind===`image`||a.kind===`video`){let e=a.kind;u!==e&&d(e);let t=It(a.file);if(!(i===o&&r.current===t&&typeof c==`string`&&c.length>0)){B();let e=URL.createObjectURL(a.file);n.current=e,r.current=t,l(e)}return}u!==`file`&&d(`file`),c&&(B(),l(null))},[B,o,u,c,s,d,l]),H=(0,K.useCallback)(()=>{a([]),s(null),B(),l(null),d(`file`),p(``),h(``),_(`general`),y(``),x(``),C(``),T(``),D(``),k(``),j(!1),ee(!1),N(null),F(!1),t.current&&(t.current.value=``)},[B]),ce=(0,K.useCallback)(e=>{let t=Array.isArray(e)?e:Array.from(e);if(t.length===0)return;let n=!1,r=!1,s=[...i];for(let e of t){if(s.length>=At){r=!0;break}if(e.size>kt){n=!0;continue}if(s.some(t=>t.file.name===e.name&&t.file.size===e.size&&t.file.lastModified===e.lastModified))continue;let t=Mt(e),i={id:Pt(e),file:e,kind:t};s=[...s,i]}s.length===i.length&&!n?r||N(`No new files were added (duplicates or all invalid).`):N(null),n?N(`Some files were too large. Max individual file size is ${jt(kt)}.`):r&&N(`You can attach up to ${At} files per sealed post. Remove one to add another.`),a(s),V(s,o)},[i,o,V]),le=e=>{let t=e.target.files;!t||t.length===0||ce(t)},ue=e=>{e.preventDefault(),e.stopPropagation(),P(!1);let t=e.dataTransfer.files;!t||t.length===0||ce(t)},U=e=>{e.preventDefault(),e.stopPropagation()},de=e=>{e.preventDefault(),e.stopPropagation(),P(!0)},fe=e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget===e.target&&P(!1)},W=()=>{t.current?.click()},pe=e=>{(e.key===`Enter`||e.key===` `)&&(e.preventDefault(),W())},G=e=>{let t=i.filter(t=>t.id!==e);a(t),V(t,o===e?null:o)},me=e=>{s(e),V(i,e)},he=()=>{if(!I){N(`Attach at least one file to seal.`);return}if(L&&!z){N(`Fill in the agreement title and counterparty to seal legally.`);return}let t=m.trim();if(t.length>0)try{new URL(t)}catch{N(`The link URL looks invalid. Please check it.`);return}let n=(o?i.find(e=>e.id===o):null)??i[0]??null;if(!n){N(`Something went wrong selecting the primary attachment.`);return}let r=f.trim(),a=L?{agreementTitle:v.trim()||void 0,counterpartyName:b.trim()||void 0,counterpartyEmail:S.trim()||void 0,jurisdiction:w.trim()||void 0,effectiveDateIso:E||void 0,referenceCode:O.trim()||void 0,isConfidential:A,includesPersonalData:M}:void 0;F(!0),e({mediaType:n.kind===`image`||n.kind===`video`?n.kind:`file`,file:n.file,caption:r.length>0?r:void 0,attachments:i,mainAttachmentId:n.id,postKind:g,legalMeta:a,linkUrl:t.length>0?t:void 0})},ge=(0,K.useMemo)(()=>{if(!I)return null;let e=i.length;return`${e===1?`1 attached file`:`${e} attached files total`} ‚Ä¢ ${ae}`},[i,I,ae]);return(0,q.jsxs)(`div`,{className:`kv-post-composer flex flex-col items-center gap-4 p-6 w-full`,children:[(0,q.jsxs)(`div`,{className:`kv-post-header w-full max-w-xl flex flex-col gap-2`,children:[(0,q.jsxs)(`div`,{className:`kv-post-step-row flex items-center justify-between`,children:[(0,q.jsxs)(`div`,{className:`kv-post-step-badge`,children:[(0,q.jsx)(`span`,{className:`kv-post-step-number`,children:oe}),(0,q.jsx)(`span`,{className:`kv-post-step-label`,children:se})]}),I&&(0,q.jsx)(`button`,{type:`button`,className:`kv-post-reset-btn`,onClick:H,children:`Reset`})]}),(0,q.jsx)(`p`,{className:`kv-post-subtitle`,children:`Attach images, videos, PDFs, DOCX, ZIPs‚Äîanything you want sealed to your Kai-Signature. For contracts, add parties and jurisdiction so this becomes a usable, timestamped record.`}),(0,q.jsxs)(`div`,{className:`kv-post-kind-row flex flex-wrap items-center gap-3 mt-1`,children:[(0,q.jsx)(`label`,{className:`kv-post-kind-label`,htmlFor:`kv-post-kind`,children:`Intent`}),(0,q.jsxs)(`select`,{id:`kv-post-kind`,className:`kv-post-kind-select`,value:g,onChange:e=>_(e.target.value),children:[(0,q.jsx)(`option`,{value:`general`,children:`General post / media`}),(0,q.jsx)(`option`,{value:`legal-contract`,children:`Legal contract / agreement`}),(0,q.jsx)(`option`,{value:`evidence`,children:`Evidence / proof bundle`}),(0,q.jsx)(`option`,{value:`announcement`,children:`Public announcement / notice`}),(0,q.jsx)(`option`,{value:`private-note`,children:`Private note / internal record`})]})]})]}),te&&(0,q.jsx)(`div`,{className:`kv-post-error w-full max-w-xl`,role:`alert`,children:te}),(0,q.jsx)(`div`,{className:`w-full max-w-xl`,children:(0,q.jsx)(`div`,{className:[`kv-post-dropzone`,ne?`kv-post-dropzone--dragging`:``,I?`kv-post-dropzone--has-media`:``].join(` `).trim(),tabIndex:0,role:`button`,"aria-label":`Choose or drop files to attach`,onClick:W,onKeyDown:pe,onDragOver:U,onDragEnter:de,onDragLeave:fe,onDrop:ue,children:(0,q.jsxs)(`div`,{className:`kv-post-dropzone-inner`,children:[(0,q.jsx)(`div`,{className:`kv-post-dropzone-icon`,children:I?`üîÑ`:ne?`üåÄ`:`üìÅ`}),(0,q.jsxs)(`div`,{className:`kv-post-dropzone-text`,children:[(0,q.jsx)(`div`,{className:`kv-post-dropzone-title`,children:I?`Add or replace attached files`:`Tap or drop files to start`}),(0,q.jsx)(`div`,{className:`kv-post-dropzone-hint`,children:`Images, videos, PDFs, DOCX, ZIPs, audio, and more ‚Ä¢ Drag & drop or tap to choose`}),(0,q.jsxs)(`div`,{className:`kv-post-dropzone-meta`,children:[`Max `,At,` files ‚Ä¢ `,jt(kt),` per file`]})]})]})})}),I&&(0,q.jsxs)(`div`,{className:`kv-post-body w-full max-w-xl mt-2`,children:[c&&(0,q.jsxs)(`div`,{className:`kv-post-preview`,children:[u===`image`&&(0,q.jsx)(`img`,{src:c,alt:`Primary attachment preview`,className:`kv-post-preview-media`}),u===`video`&&(0,q.jsx)(`video`,{src:c,controls:!0,className:`kv-post-preview-media`})]}),(0,q.jsxs)(`div`,{className:`kv-post-attachments`,children:[(0,q.jsxs)(`div`,{className:`kv-post-attachments-header flex justify-between items-center`,children:[(0,q.jsx)(`div`,{className:`kv-post-attachments-title`,children:`Attachments`}),ge&&(0,q.jsx)(`div`,{className:`kv-post-attachments-summary`,children:ge})]}),(0,q.jsx)(`ul`,{className:`kv-post-attachments-list`,children:i.map(e=>{let t=e.id===o;return(0,q.jsxs)(`li`,{className:[`kv-post-attachment-item`,t?`kv-post-attachment-item--primary`:``].join(` `).trim(),children:[(0,q.jsxs)(`div`,{className:`kv-post-attachment-main`,children:[(0,q.jsx)(`div`,{className:`kv-post-attachment-name`,children:e.file.name}),(0,q.jsxs)(`div`,{className:`kv-post-attachment-meta`,children:[(0,q.jsxs)(`span`,{children:[Nt[e.kind],` ‚Ä¢ `,jt(e.file.size)]}),t&&(0,q.jsx)(`span`,{className:`kv-post-attachment-pill`,children:`Primary`})]})]}),(0,q.jsxs)(`div`,{className:`kv-post-attachment-actions`,children:[!t&&(0,q.jsx)(`button`,{type:`button`,className:`kv-post-attachment-btn`,onClick:()=>me(e.id),children:`Set as primary`}),(0,q.jsx)(`button`,{type:`button`,className:`kv-post-attachment-btn kv-post-attachment-btn--danger`,onClick:()=>G(e.id),children:`Remove`})]})]},e.id)})})]}),(0,q.jsxs)(`div`,{className:`kv-post-caption-block mt-4`,children:[(0,q.jsx)(`label`,{htmlFor:`kv-post-caption`,className:`kv-post-caption-label`,children:`Caption / description (optional)`}),(0,q.jsx)(`textarea`,{id:`kv-post-caption`,placeholder:L?`Summarize what this agreement covers, key obligations, or why you are sealing it now‚Ä¶`:`Describe the moment, the pulse, or what this bundle of files represents‚Ä¶`,className:`kv-post-caption-textarea`,rows:3,maxLength:ie,value:f,onChange:e=>p(e.target.value)}),(0,q.jsx)(`div`,{className:`kv-post-caption-footer`,children:(0,q.jsxs)(`span`,{className:`kv-post-caption-count`,children:[f.length,`/`,ie]})})]}),(0,q.jsxs)(`div`,{className:`kv-post-link-block mt-4`,children:[(0,q.jsx)(`label`,{htmlFor:`kv-post-link`,className:`kv-post-link-label`,children:`Canonical URL (optional)`}),(0,q.jsx)(`input`,{id:`kv-post-link`,type:`url`,inputMode:`url`,placeholder:`https://‚Ä¶ (DMS link, IPFS URL, external system reference)`,className:`kv-post-link-input`,value:m,onChange:e=>h(e.target.value)}),(0,q.jsx)(`p`,{className:`kv-post-link-hint`,children:`This can point to the master copy of the contract, folder, or evidence bundle. It will be sealed alongside the files.`})]}),g===`legal-contract`&&(0,q.jsxs)(`div`,{className:`kv-post-legal-block mt-6`,children:[(0,q.jsx)(`div`,{className:`kv-post-legal-header`,children:`Legal details for this agreement`}),(0,q.jsxs)(`div`,{className:`kv-post-legal-grid`,children:[(0,q.jsxs)(`div`,{className:`kv-post-legal-field`,children:[(0,q.jsxs)(`label`,{htmlFor:`kv-legal-title`,className:`kv-post-legal-label`,children:[`Agreement title `,(0,q.jsx)(`span`,{className:`kv-post-legal-required`,children:`*`})]}),(0,q.jsx)(`input`,{id:`kv-legal-title`,type:`text`,className:`kv-post-legal-input`,placeholder:`e.g. Master Services Agreement, NDA, Licensing Deal‚Ä¶`,value:v,onChange:e=>y(e.target.value)})]}),(0,q.jsxs)(`div`,{className:`kv-post-legal-field`,children:[(0,q.jsxs)(`label`,{htmlFor:`kv-legal-counterparty`,className:`kv-post-legal-label`,children:[`Counterparty name `,(0,q.jsx)(`span`,{className:`kv-post-legal-required`,children:`*`})]}),(0,q.jsx)(`input`,{id:`kv-legal-counterparty`,type:`text`,className:`kv-post-legal-input`,placeholder:`Person or organization`,value:b,onChange:e=>x(e.target.value)})]}),(0,q.jsxs)(`div`,{className:`kv-post-legal-field`,children:[(0,q.jsx)(`label`,{htmlFor:`kv-legal-email`,className:`kv-post-legal-label`,children:`Counterparty contact (optional)`}),(0,q.jsx)(`input`,{id:`kv-legal-email`,type:`email`,className:`kv-post-legal-input`,placeholder:`Email or contact handle`,value:S,onChange:e=>C(e.target.value)})]}),(0,q.jsxs)(`div`,{className:`kv-post-legal-field`,children:[(0,q.jsx)(`label`,{htmlFor:`kv-legal-jurisdiction`,className:`kv-post-legal-label`,children:`Jurisdiction (optional)`}),(0,q.jsx)(`input`,{id:`kv-legal-jurisdiction`,type:`text`,className:`kv-post-legal-input`,placeholder:`e.g. Ontario, Canada ‚Ä¢ Delaware, USA ‚Ä¢ EU-wide‚Ä¶`,value:w,onChange:e=>T(e.target.value)})]}),(0,q.jsxs)(`div`,{className:`kv-post-legal-field`,children:[(0,q.jsx)(`label`,{htmlFor:`kv-legal-effective`,className:`kv-post-legal-label`,children:`Effective date (optional)`}),(0,q.jsx)(`input`,{id:`kv-legal-effective`,type:`date`,className:`kv-post-legal-input`,value:E,onChange:e=>D(e.target.value)})]}),(0,q.jsxs)(`div`,{className:`kv-post-legal-field`,children:[(0,q.jsx)(`label`,{htmlFor:`kv-legal-ref`,className:`kv-post-legal-label`,children:`Reference code (optional)`}),(0,q.jsx)(`input`,{id:`kv-legal-ref`,type:`text`,className:`kv-post-legal-input`,placeholder:`Internal ID, contract number, matter code‚Ä¶`,value:O,onChange:e=>k(e.target.value)})]})]}),(0,q.jsxs)(`div`,{className:`kv-post-legal-flags mt-3`,children:[(0,q.jsxs)(`label`,{className:`kv-post-legal-flag`,children:[(0,q.jsx)(`input`,{type:`checkbox`,checked:A,onChange:e=>j(e.target.checked)}),(0,q.jsx)(`span`,{children:`This agreement is confidential`})]}),(0,q.jsxs)(`label`,{className:`kv-post-legal-flag`,children:[(0,q.jsx)(`input`,{type:`checkbox`,checked:M,onChange:e=>ee(e.target.checked)}),(0,q.jsx)(`span`,{children:`This bundle includes personal data (names, addresses, IDs, etc.)`})]})]}),(0,q.jsx)(`p`,{className:`kv-post-legal-hint mt-2`,children:`These details are sealed as metadata with the files and time pulse, creating a clear, timestamped record of what was agreed and with whom. This does not replace legal advice‚Äîuse it as a hardened, auditable trail around your contracts.`})]})]}),(0,q.jsx)(`div`,{className:`kv-post-actions w-full max-w-xl mt-4 flex justify-end`,children:(0,q.jsx)(`button`,{type:`button`,className:`kv-post-submit-btn`,onClick:he,disabled:!I||re,children:re?`Sealing‚Ä¶`:`Seal with Breath`})}),(0,q.jsx)(`input`,{id:`kv-post-file-input`,type:`file`,multiple:!0,accept:`*/*`,ref:t,onChange:le,className:`kv-post-file-input`})]})}var Rt=H(((e,t)=>{var n=`Input must be an string, Buffer or Uint8Array`;function r(e){let t;if(e instanceof Uint8Array)t=e;else if(typeof e==`string`)t=new TextEncoder().encode(e);else throw Error(n);return t}function i(e){return Array.prototype.map.call(e,function(e){return(e<16?`0`:``)+e.toString(16)}).join(``)}function a(e){return(4294967296+e).toString(16).substring(1)}function o(e,t,n){let r=`
`+e+` = `;for(let i=0;i<t.length;i+=2){if(n===32)r+=a(t[i]).toUpperCase(),r+=` `,r+=a(t[i+1]).toUpperCase();else if(n===64)r+=a(t[i+1]).toUpperCase(),r+=a(t[i]).toUpperCase();else throw Error(`Invalid size `+n);i%6==4?r+=`
`+Array(e.length+4).join(` `):i<t.length-2&&(r+=` `)}console.log(r)}function s(e,t,n){let r=new Date().getTime(),i=new Uint8Array(t);for(let e=0;e<t;e++)i[e]=e%256;let a=new Date().getTime();console.log(`Generated random input in `+(a-r)+`ms`),r=a;for(let a=0;a<n;a++){let n=e(i),a=new Date().getTime(),o=a-r;r=a,console.log(`Hashed in `+o+`ms: `+n.substring(0,20)+`...`),console.log(Math.round(t/(1<<20)/(o/1e3)*100)/100+` MB PER SECOND`)}}t.exports={normalizeInput:r,toHex:i,debugPrint:o,testSpeed:s}})),zt=H(((e,t)=>{var n=Rt();function r(e,t,n){let r=e[t]+e[n],i=e[t+1]+e[n+1];r>=4294967296&&i++,e[t]=r,e[t+1]=i}function i(e,t,n,r){let i=e[t]+n;n<0&&(i+=4294967296);let a=e[t+1]+r;i>=4294967296&&a++,e[t]=i,e[t+1]=a}function a(e,t){return e[t]^e[t+1]<<8^e[t+2]<<16^e[t+3]<<24}function o(e,t,n,a,o,s){let c=u[o],d=u[o+1],f=u[s],p=u[s+1];r(l,e,t),i(l,e,c,d);let m=l[a]^l[e],h=l[a+1]^l[e+1];l[a]=h,l[a+1]=m,r(l,n,a),m=l[t]^l[n],h=l[t+1]^l[n+1],l[t]=m>>>24^h<<8,l[t+1]=h>>>24^m<<8,r(l,e,t),i(l,e,f,p),m=l[a]^l[e],h=l[a+1]^l[e+1],l[a]=m>>>16^h<<16,l[a+1]=h>>>16^m<<16,r(l,n,a),m=l[t]^l[n],h=l[t+1]^l[n+1],l[t]=h>>>31^m<<1,l[t+1]=m>>>31^h<<1}var s=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),c=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3].map(function(e){return e*2})),l=new Uint32Array(32),u=new Uint32Array(32);function d(e,t){let n=0;for(n=0;n<16;n++)l[n]=e.h[n],l[n+16]=s[n];for(l[24]^=e.t,l[25]^=e.t/4294967296,t&&(l[28]=~l[28],l[29]=~l[29]),n=0;n<32;n++)u[n]=a(e.b,4*n);for(n=0;n<12;n++)o(0,8,16,24,c[n*16+0],c[n*16+1]),o(2,10,18,26,c[n*16+2],c[n*16+3]),o(4,12,20,28,c[n*16+4],c[n*16+5]),o(6,14,22,30,c[n*16+6],c[n*16+7]),o(0,10,20,30,c[n*16+8],c[n*16+9]),o(2,12,22,24,c[n*16+10],c[n*16+11]),o(4,14,16,26,c[n*16+12],c[n*16+13]),o(6,8,18,28,c[n*16+14],c[n*16+15]);for(n=0;n<16;n++)e.h[n]=e.h[n]^l[n]^l[n+16]}var f=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function p(e,t,n,r){if(e===0||e>64)throw Error(`Illegal output length, expected 0 < length <= 64`);if(t&&t.length>64)throw Error(`Illegal key, expected Uint8Array with 0 < length <= 64`);if(n&&n.length!==16)throw Error(`Illegal salt, expected Uint8Array with length is 16`);if(r&&r.length!==16)throw Error(`Illegal personal, expected Uint8Array with length is 16`);let i={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:e};f.fill(0),f[0]=e,t&&(f[1]=t.length),f[2]=1,f[3]=1,n&&f.set(n,32),r&&f.set(r,48);for(let e=0;e<16;e++)i.h[e]=s[e]^a(f,e*4);return t&&(m(i,t),i.c=128),i}function m(e,t){for(let n=0;n<t.length;n++)e.c===128&&(e.t+=e.c,d(e,!1),e.c=0),e.b[e.c++]=t[n]}function h(e){for(e.t+=e.c;e.c<128;)e.b[e.c++]=0;d(e,!0);let t=new Uint8Array(e.outlen);for(let n=0;n<e.outlen;n++)t[n]=e.h[n>>2]>>8*(n&3);return t}function g(e,t,r,i,a){r||=64,e=n.normalizeInput(e),i&&=n.normalizeInput(i),a&&=n.normalizeInput(a);let o=p(r,t,i,a);return m(o,e),h(o)}function _(e,t,r,i,a){let o=g(e,t,r,i,a);return n.toHex(o)}t.exports={blake2b:g,blake2bHex:_,blake2bInit:p,blake2bUpdate:m,blake2bFinal:h}})),Bt=H(((e,t)=>{var n=Rt();function r(e,t){return e[t]^e[t+1]<<8^e[t+2]<<16^e[t+3]<<24}function i(e,t,n,r,i,o){c[e]=c[e]+c[t]+i,c[r]=a(c[r]^c[e],16),c[n]=c[n]+c[r],c[t]=a(c[t]^c[n],12),c[e]=c[e]+c[t]+o,c[r]=a(c[r]^c[e],8),c[n]=c[n]+c[r],c[t]=a(c[t]^c[n],7)}function a(e,t){return e>>>t^e<<32-t}var o=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),s=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),c=new Uint32Array(16),l=new Uint32Array(16);function u(e,t){let n=0;for(n=0;n<8;n++)c[n]=e.h[n],c[n+8]=o[n];for(c[12]^=e.t,c[13]^=e.t/4294967296,t&&(c[14]=~c[14]),n=0;n<16;n++)l[n]=r(e.b,4*n);for(n=0;n<10;n++)i(0,4,8,12,l[s[n*16+0]],l[s[n*16+1]]),i(1,5,9,13,l[s[n*16+2]],l[s[n*16+3]]),i(2,6,10,14,l[s[n*16+4]],l[s[n*16+5]]),i(3,7,11,15,l[s[n*16+6]],l[s[n*16+7]]),i(0,5,10,15,l[s[n*16+8]],l[s[n*16+9]]),i(1,6,11,12,l[s[n*16+10]],l[s[n*16+11]]),i(2,7,8,13,l[s[n*16+12]],l[s[n*16+13]]),i(3,4,9,14,l[s[n*16+14]],l[s[n*16+15]]);for(n=0;n<8;n++)e.h[n]^=c[n]^c[n+8]}function d(e,t){if(!(e>0&&e<=32))throw Error(`Incorrect output length, should be in [1, 32]`);let n=t?t.length:0;if(t&&!(n>0&&n<=32))throw Error(`Incorrect key length, should be in [1, 32]`);let r={h:new Uint32Array(o),b:new Uint8Array(64),c:0,t:0,outlen:e};return r.h[0]^=16842752^n<<8^e,n>0&&(f(r,t),r.c=64),r}function f(e,t){for(let n=0;n<t.length;n++)e.c===64&&(e.t+=e.c,u(e,!1),e.c=0),e.b[e.c++]=t[n]}function p(e){for(e.t+=e.c;e.c<64;)e.b[e.c++]=0;u(e,!0);let t=new Uint8Array(e.outlen);for(let n=0;n<e.outlen;n++)t[n]=e.h[n>>2]>>8*(n&3)&255;return t}function m(e,t,r){r||=32,e=n.normalizeInput(e);let i=d(r,t);return f(i,e),p(i)}function h(e,t,r){let i=m(e,t,r);return n.toHex(i)}t.exports={blake2s:m,blake2sHex:h,blake2sInit:d,blake2sUpdate:f,blake2sFinal:p}})),Vt=w(H(((e,t)=>{var n=zt(),r=Bt();t.exports={blake2b:n.blake2b,blake2bHex:n.blake2bHex,blake2bInit:n.blake2bInit,blake2bUpdate:n.blake2bUpdate,blake2bFinal:n.blake2bFinal,blake2s:r.blake2s,blake2sHex:r.blake2sHex,blake2sInit:r.blake2sInit,blake2sUpdate:r.blake2sUpdate,blake2sFinal:r.blake2sFinal}}))(),1),Ht=5236,Ut=50;function Wt(e){return e===`root`||e===`sacral`||e===`solar`||e===`heart`||e===`throat`||e===`thirdEye`||e===`crown`||e===`krown`}function Gt({post:e,identityKaiSignature:t,userPhiKey:n,onSealComplete:r}){let[i,s]=(0,K.useState)(`idle`),[c,l]=(0,K.useState)(0),[u,d]=(0,K.useState)(null),f=(0,K.useRef)(null),p=(0,K.useRef)(!1),m=(0,K.useRef)(0),h=(0,K.useRef)(!0),g=(0,K.useMemo)(()=>Ht*2,[]);(0,K.useEffect)(()=>(h.current=!0,()=>{h.current=!1,f.current!=null&&window.clearInterval(f.current)}),[]);let _=()=>{f.current!=null&&(window.clearInterval(f.current),f.current=null)},v=()=>{if(!p.current){if(!t.trim()){d(`Missing identityKaiSignature (session signature). Please re-login.`),s(`idle`),l(0);return}_(),d(null),s(`inhale`),l(0),p.current=!1,m.current=0,f.current=window.setInterval(()=>{m.current+=Ut;let e=m.current;if(e<Ht)s(`inhale`);else if(e<g)s(`exhale`);else{_(),y();return}l(Math.min(e/g,1))},Ut)}},y=async()=>{if(!p.current){p.current=!0;try{let i=t.trim();if(!i)throw Error(`Missing identityKaiSignature (session signature).`);let c=await a(void 0,new o({ignoreOverride:!0})),l=Number(c.pulse??0),u=Wt(c.chakraDay)?c.chakraDay:null,d=e.file?.name??`unknown`,f=Vt.default.blake2bHex(`${d}-${l}`,void 0,16);if(r({pulse:l,kaiSignature:i,chakraDay:u,post:e,userPhiKey:n??null,kksNonce:f}),!h.current)return;s(`sealed`)}catch(e){p.current=!1;let t=e instanceof Error?e.message:`Failed to seal with live Kai pulse. Please try again.`;if(!h.current)return;d(t),s(`idle`),l(0)}}},b=(()=>{if(u)return`Error`;switch(i){case`idle`:return`Ready to Breathe`;case`inhale`:return`Inhale`;case`exhale`:return`Exhale`;case`sealed`:return`Sealed in Kairos`;default:return`Breath`}})(),x=Math.round(Math.min(c,.5)*200),S=Math.round(Math.max(c-.5,0)*200),C=(()=>{if(u)return u;switch(i){case`idle`:return`Tap begin, inhale as the orb expands, exhale as it returns to stillness. We‚Äôll seal at the end of your exhale.`;case`inhale`:return`Inhale slowly‚Ä¶ ${x}%`;case`exhale`:return`Exhale and let go‚Ä¶ ${50+S}% ‚Äî sealing this breath into KaiOS.`;case`sealed`:return`Sealed on a live Kai pulse. Advancing to embed‚Ä¶`;default:return``}})(),w=(()=>{if(u)return`‚ö†Ô∏è`;switch(i){case`idle`:return`üå¨`;case`inhale`:return`ü´Å`;case`exhale`:return`üåÄ`;case`sealed`:return`‚ú®`;default:return`üå¨`}})(),T=e.file?.name&&e.file.name.length>40?`${e.file.name.slice(0,22)}‚Ä¶${e.file.name.slice(-12)}`:e.file?.name??`Unnamed glyph`;return(0,q.jsxs)(`div`,{className:`kv-breath-root`,"data-phase":i,"aria-live":`polite`,children:[(0,q.jsxs)(`div`,{className:`kv-breath-meta`,children:[(0,q.jsxs)(`div`,{className:`kv-breath-meta-left`,children:[(0,q.jsx)(`span`,{className:`kv-breath-pill`,children:`Breath Seal ‚Ä¢ œÜ 5.236s`}),(0,q.jsx)(`span`,{className:`kv-breath-file`,title:e.file?.name,children:T})]}),(0,q.jsx)(`div`,{className:`kv-breath-meta-right`,children:(0,q.jsx)(`span`,{className:`kv-breath-tag`,children:`Live Kai Pulse`})})]}),(0,q.jsxs)(`div`,{className:`kv-breath-orb-row`,children:[(0,q.jsxs)(`div`,{className:`kv-breath-orb`,"aria-label":`Breath phase: ${b}`,children:[(0,q.jsx)(`div`,{className:`kv-breath-orb-inner`,children:(0,q.jsx)(`span`,{className:`kv-breath-orb-emoji`,children:w})}),(0,q.jsx)(`div`,{className:`kv-breath-orb-ring`,style:{"--kv-breath-progress":c}})]}),(0,q.jsxs)(`div`,{className:`kv-breath-status`,children:[(0,q.jsxs)(`div`,{className:`kv-breath-status-row`,children:[(0,q.jsx)(`span`,{className:`kv-breath-status-label`,children:b}),(0,q.jsxs)(`span`,{className:`kv-breath-status-percent`,children:[Math.round(c*100),`%`]})]}),(0,q.jsx)(`p`,{className:`kv-breath-status-text`,children:C}),(0,q.jsxs)(`div`,{className:`kv-breath-bars`,children:[(0,q.jsxs)(`div`,{className:`kv-breath-bar`,children:[(0,q.jsx)(`span`,{className:`kv-breath-bar-label`,children:`Inhale`}),(0,q.jsx)(`div`,{className:`kv-breath-bar-track`,"aria-hidden":`true`,children:(0,q.jsx)(`div`,{className:`kv-breath-bar-fill kv-breath-bar-fill--inhale`,style:{width:`${x}%`}})})]}),(0,q.jsxs)(`div`,{className:`kv-breath-bar`,children:[(0,q.jsx)(`span`,{className:`kv-breath-bar-label`,children:`Exhale`}),(0,q.jsx)(`div`,{className:`kv-breath-bar-track`,"aria-hidden":`true`,children:(0,q.jsx)(`div`,{className:`kv-breath-bar-fill kv-breath-bar-fill--exhale`,style:{width:`${S}%`}})})]})]})]})]}),(0,q.jsxs)(`div`,{className:`kv-breath-actions`,children:[i===`idle`&&!p.current&&!u&&(0,q.jsx)(`button`,{type:`button`,onClick:v,className:`kv-breath-btn kv-breath-btn-primary`,children:`Begin Breath`}),u&&i===`idle`&&(0,q.jsx)(`button`,{type:`button`,onClick:v,className:`kv-breath-btn kv-breath-btn-warning`,children:`Retry Breath Seal`}),i!==`idle`&&i!==`sealed`&&!u&&(0,q.jsx)(`button`,{type:`button`,className:`kv-breath-btn kv-breath-btn-ghost`,disabled:!0,children:`Sealing on this exhale‚Ä¶`}),i===`sealed`&&(0,q.jsx)(`div`,{className:`kv-breath-sealed-note`,children:`Sealed. The stream will remember this breath forever.`})]})]})}function Kt(e){let t=e.trim();return(t.startsWith(`0x`)||t.startsWith(`0X`))&&(t=t.slice(2)),/^[0-9a-fA-F]+$/.test(t)&&(t=t.toLowerCase()),t}var qt=`http://www.w3.org/2000/svg`;async function Jt(e){let t=typeof e==`string`?e:JSON.stringify(e),n=new TextEncoder().encode(t),r=await crypto.subtle.digest(`SHA-256`,n),i=new Uint8Array(r),a=``;for(let e=0;e<i.length;e+=1)a+=i[e].toString(16).padStart(2,`0`);return a}function Yt(e){let{pulse:t}=e,n=u(t);return{beat:typeof e.beat==`number`?e.beat:typeof n.beat==`number`?n.beat:0,stepIndex:typeof e.stepIndex==`number`?e.stepIndex:typeof n.stepIndex==`number`?n.stepIndex:0,chakraDay:e.chakraDay??n.chakraDay??null,stepsPerBeat:typeof n.stepsPerBeat==`number`?n.stepsPerBeat:44}}async function Xt(e,t){let{post:n,pulse:r,kaiSignature:i}=e;if(!i||i.length===0)throw Error(`embedKaiSignature: kaiSignature is required.`);let{beat:a,stepIndex:o,chakraDay:s,stepsPerBeat:c}=Yt(e),l=n.file,u=n.caption??null,d=n.originUrl??n.url??null,f=n.authorHandle??null,p=n.authorDisplayName??null,m=new Date().toISOString(),h=Kt(i),g=await A(h),_=e.userPhiKey??null;if(_&&_!==g)throw Error(`embedKaiSignature: userPhiKey does not match derived Œ¶-Key from kaiSignature.`);let v=g,y=`œÜK-${g.slice(0,8)}`,b={kind:t,mimeType:l.type,filename:l.name,sizeBytes:l.size},x=await Jt({caption:u,media:b,pulse:r,beat:a,stepIndex:o,chakraDay:s});return{spec:`KKS-1.0`,specVersion:`1.0`,kksType:`kai-sigil-signature`,app:`KaiVoh`,appVersion:`1.0.0`,pulse:r,kaiPulse:r,beat:a,stepIndex:o,stepsPerBeat:c,chakraDay:s,kaiMomentId:`${r}|${a}|${o}|${s??`Unknown`}`,kaiSignature:h,userPhiKey:v,phiKey:g,phiKeyShort:y,caption:u,timestamp:m,kksNonce:e.kksNonce??null,hashes:{statement:x},statement:{caption:u,media:b},post:{caption:u,originUrl:d,authorHandle:f,authorDisplayName:p}}}async function Zt(e){let t=e,{post:n,pulse:r}=t,i=await Xt(t,n.mediaType===`video`?`video`:`image`);if(n.mediaType===`image`&&n.file.type.includes(`svg`)){let e=await n.file.text(),t=new DOMParser().parseFromString(e,`image/svg+xml`);if(t.querySelector(`parsererror`))throw Error(`Invalid SVG content (parsererror present).`);let a=t.documentElement;if(!a||a.namespaceURI!==qt||a.tagName.toLowerCase()!==`svg`)throw Error(`Not an SVG root document.`);let o=t.getElementsByTagName(`metadata`),s;o.length>0?s=o.item(0):(s=t.createElementNS(qt,`metadata`),a.appendChild(s)),s.textContent=JSON.stringify(i,null,2);let c=new XMLSerializer().serializeToString(t);return{type:`image`,content:new Blob([c],{type:`image/svg+xml`}),filename:`sigil-${r}.svg`,metadata:i}}return n.mediaType===`image`?{type:`image`,content:n.file,filename:n.file.name,metadata:i}:{type:`video`,content:n.file,filename:n.file.name,metadata:i}}function Qt(e){let{baseCaption:t,phiKey:n,kaiSignature:r,pulse:i,chakraDay:a,verifierUrl:o}=e,s=[];return t&&t.trim().length>0&&s.push(t.trim(),``),s.push(`‚Äî`),s.push(`Kai-Sigil Proof of Origin`),n&&s.push(`Œ¶-Key: ${n}`),r&&s.push(`Kai Signature: ${r}`),typeof i==`number`&&s.push(`Pulse: ${i}`),a&&s.push(`Chakra Day: ${a}`),o&&(s.push(``),s.push(`Verify this post: ${o}`)),s.join(`
`)}function $t(e){let{phiKey:t,kaiSignature:n,pulse:r,chakraDay:i,verifierUrl:a}=e,o={phiKey:t??null,kaiSignature:n??null,pulse:typeof r==`number`?r:null,chakraDay:i??null,verifierUrl:a??null};return JSON.stringify(o,null,2)}async function en(e){if(typeof navigator<`u`&&navigator.clipboard&&typeof navigator.clipboard.writeText==`function`){await navigator.clipboard.writeText(e);return}let t=document.createElement(`textarea`);t.value=e,t.setAttribute(`readonly`,`true`),t.style.position=`absolute`,t.style.left=`-9999px`,document.body.appendChild(t),t.select(),document.execCommand(`copy`),document.body.removeChild(t)}function tn(e,t){let n=URL.createObjectURL(e),r=document.createElement(`a`);r.href=n,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}function nn(e,t,n){let r=encodeURIComponent(t),i=n?encodeURIComponent(n):``;switch(e){case`x`:return`https://twitter.com/intent/tweet?text=${r}`;case`linkedin`:return i?`https://www.linkedin.com/sharing/share-offsite/?url=${i}`:`https://www.linkedin.com/feed/?shareActive=true&text=${r}`;case`facebook`:return i?`https://www.facebook.com/sharer/sharer.php?u=${i}`:`https://www.facebook.com/dialog/share?display=popup&quote=${r}`;default:return null}}function rn({media:e,suggestedCaption:t,verifierUrl:n,onShared:r,onError:i}){let[a,o]=(0,K.useState)(null),{kaiSignature:s,phiKey:c,pulse:l,chakraDay:u,verifierUrl:d}=e?.metadata??{},f=n??d??void 0,p=(0,K.useMemo)(()=>Qt({baseCaption:t,kaiSignature:s,phiKey:c,pulse:l,chakraDay:u,verifierUrl:f}),[t,s,c,l,u,f]),m=(0,K.useMemo)(()=>$t({phiKey:c,kaiSignature:s,pulse:l,chakraDay:u,verifierUrl:f}),[c,s,l,u,f]),h=typeof navigator<`u`&&typeof navigator.share==`function`,g=(e,t)=>{let n=t instanceof Error?t:Error(String(t??`Unknown error`));i&&i(e,n),o(n.message)},_=e=>{r&&r(e)},v=async t=>{if(!e){o(`No sealed media detected for this pulse yet. Complete Seal & Embed first.`);return}try{if(o(null),t===`copy-caption`){await en(p),o(`Caption copied to clipboard. Paste into your post.`),_(t);return}if(t===`copy-proof`){await en(m),o(`Proof JSON copied. Save it with your post or dev tools.`),_(t);return}if(t===`download`){tn(e.content,e.filename),o(`Sealed glyph downloaded.`),_(t);return}if(t===`system-share`){if(!h){await en(p),o(`System share unavailable; caption copied. Open your app and paste.`),_(t);return}let n=navigator,r={text:p};if(typeof n.canShare==`function`)try{let i=e.type===`image`?`image/svg+xml`:e.type===`video`?`video/mp4`:`text/plain`,a=new File([e.content],e.filename,{type:i}),s={...r,files:[a]};if(n.canShare(s)){await navigator.share(s),o(`Shared via system sheet with media.`),_(t);return}}catch{}await navigator.share(r),o(`Shared via system sheet.`),_(t);return}if(t===`x`||t===`linkedin`||t===`facebook`){let e=nn(t,p,f);if(!e){await en(p),o(`Unable to open share URL; caption copied instead. Paste into your post.`),_(t);return}window.open(e,`_blank`,`noopener,noreferrer`),await en(p),o(`Opened share composer and copied caption. Paste if not auto-filled.`),_(t);return}if(t===`instagram`||t===`tiktok`){tn(e.content,e.filename),await en(p);let n=t===`instagram`?`https://www.instagram.com/`:`https://www.tiktok.com/upload`;window.open(n,`_blank`,`noopener,noreferrer`),o(`Downloaded glyph and copied caption. Opened ${t} ‚Äî create a new memory, pick the image, and paste the caption.`),_(t);return}await en(p),o(`Caption copied. Paste into your social app.`),_(t)}catch(e){g(t,e)}};return e?(0,q.jsxs)(`section`,{className:`kv-social-connector`,children:[(0,q.jsxs)(`header`,{className:`kv-social-header`,children:[(0,q.jsx)(`h2`,{className:`kv-social-title`,children:`Share Your Kai-Sigil Post`}),(0,q.jsx)(`p`,{className:`kv-social-subtitle`,children:`Every share includes a verifiable Kai-Sigil proof so anyone can confirm this post was sealed by your Œ¶-Key.`})]}),(0,q.jsxs)(`div`,{className:`kv-social-proof`,children:[(0,q.jsxs)(`div`,{className:`kv-social-proof-block`,children:[(0,q.jsx)(`div`,{className:`kv-proof-label`,children:`Preview caption`}),(0,q.jsx)(`pre`,{className:`kv-proof-caption`,"aria-label":`Proof caption preview`,children:p})]}),(0,q.jsxs)(`div`,{className:`kv-social-proof-meta`,children:[(0,q.jsxs)(`div`,{className:`kv-proof-meta-row`,children:[(0,q.jsx)(`span`,{className:`kv-proof-meta-label`,children:`Œ¶-Key`}),(0,q.jsx)(`span`,{className:`kv-proof-meta-value`,children:c??`‚Äî (not provided)`})]}),(0,q.jsxs)(`div`,{className:`kv-proof-meta-row`,children:[(0,q.jsx)(`span`,{className:`kv-proof-meta-label`,children:`Kai Signature`}),(0,q.jsx)(`span`,{className:`kv-proof-meta-value`,children:s??`‚Äî (not provided)`})]}),(0,q.jsxs)(`div`,{className:`kv-proof-meta-row`,children:[(0,q.jsx)(`span`,{className:`kv-proof-meta-label`,children:`Pulse`}),(0,q.jsx)(`span`,{className:`kv-proof-meta-value`,children:typeof l==`number`?l:`‚Äî`})]}),(0,q.jsxs)(`div`,{className:`kv-proof-meta-row`,children:[(0,q.jsx)(`span`,{className:`kv-proof-meta-label`,children:`Verifier URL`}),(0,q.jsx)(`span`,{className:`kv-proof-meta-value`,children:f??`‚Äî`})]})]})]}),(0,q.jsxs)(`div`,{className:`kv-social-actions`,children:[(0,q.jsxs)(`div`,{className:`kv-social-row kv-social-row--primary`,children:[(0,q.jsx)(`button`,{type:`button`,className:`kv-btn kv-btn-primary`,onClick:()=>void v(`system-share`),children:`System Share (Best on Mobile)`}),(0,q.jsx)(`button`,{type:`button`,className:`kv-btn kv-btn-ghost`,onClick:()=>void v(`download`),children:`Download Glyph`})]}),(0,q.jsxs)(`div`,{className:`kv-social-row kv-social-row--grid`,children:[(0,q.jsx)(`button`,{type:`button`,className:`kv-btn kv-btn-chip`,onClick:()=>void v(`x`),children:`Post to X (Twitter)`}),(0,q.jsx)(`button`,{type:`button`,className:`kv-btn kv-btn-chip`,onClick:()=>void v(`instagram`),children:`Post to Instagram`}),(0,q.jsx)(`button`,{type:`button`,className:`kv-btn kv-btn-chip`,onClick:()=>void v(`tiktok`),children:`Post to TikTok`}),(0,q.jsx)(`button`,{type:`button`,className:`kv-btn kv-btn-chip`,onClick:()=>void v(`linkedin`),children:`Post to LinkedIn`}),(0,q.jsx)(`button`,{type:`button`,className:`kv-btn kv-btn-chip`,onClick:()=>void v(`facebook`),children:`Post to Facebook`})]}),(0,q.jsxs)(`div`,{className:`kv-social-row kv-social-row--secondary`,children:[(0,q.jsx)(`button`,{type:`button`,className:`kv-btn kv-btn-outline`,onClick:()=>void v(`copy-caption`),children:`Remember Caption with Proof`}),(0,q.jsx)(`button`,{type:`button`,className:`kv-btn kv-btn-outline`,onClick:()=>void v(`copy-proof`),children:`Remember Proof JSON`})]})]}),a&&(0,q.jsx)(`p`,{className:`kv-social-status`,children:a})]}):(0,q.jsxs)(`section`,{className:`kv-social-connector`,children:[(0,q.jsxs)(`header`,{className:`kv-social-header`,children:[(0,q.jsx)(`h2`,{className:`kv-social-title`,children:`Connect & Share`}),(0,q.jsx)(`p`,{className:`kv-social-subtitle`,children:`Seal a post or glyph first. Once Kai-Sigil has embedded your proof into the media, this panel will unlock full social sharing with verifiable origin.`})]}),(0,q.jsxs)(`p`,{className:`kv-social-status`,children:[`No sealed media detected for this pulse yet. Complete the`,` `,(0,q.jsx)(`strong`,{children:`Seal & Embed`}),` step, then tap`,` `,(0,q.jsx)(`strong`,{children:`Connect Accounts`}),` again.`]}),a&&(0,q.jsx)(`p`,{className:`kv-social-status`,children:a})]})}function an(e){return e===`x`||e===`ig`||e===`tiktok`||e===`threads`}function on(e){return typeof e==`string`&&e.trim().length>0&&(e.startsWith(`http://`)||e.startsWith(`https://`))}function sn(e,t){let n=e[t];return typeof n==`string`&&n.trim().length>0?n.trim():void 0}function cn(e,t){let n=e[t];if(typeof n==`number`&&Number.isFinite(n))return n;if(typeof n==`string`){let e=Number(n);if(Number.isFinite(e))return e}}function ln(e,t){return e.length<=t?e:`${e.slice(0,Math.max(0,t-1))}‚Ä¶`}function un(e,t){let n={},r=e??{},i=typeof t?.pulse==`number`&&Number.isFinite(t.pulse)?t.pulse:cn(r,`pulse`);typeof i==`number`&&(n.pulse=i);let a=typeof t?.kaiSignature==`string`&&t.kaiSignature.trim().length>0?t.kaiSignature.trim():sn(r,`kaiSignature`);typeof a==`string`&&(n.kaiSignature=a);let o=typeof t?.phiKey==`string`&&t.phiKey.trim().length>0?t.phiKey.trim():sn(r,`phiKey`);typeof o==`string`&&(n.phiKey=o);let s=N(typeof t?.chakraDay==`string`&&t.chakraDay.trim().length>0?t.chakraDay:sn(r,`chakraDay`));typeof s==`string`&&(n.chakraDay=s);let c=r.verifierUrl,l=t?.verifierUrl,u;on(l)?u=l.trim():on(c)&&(u=c.trim());let d=typeof i==`number`?i:0,f=typeof a==`string`&&a.length>0?a:`unknown-signature`;u||=j(d,f),n.verifierUrl=u;for(let e of[`beat`,`stepIndex`,`step`,`kaiTime`,`kksVersion`,`userPhiKey`,`timestamp`]){let t=r[e];(typeof t==`string`||typeof t==`number`||typeof t==`boolean`||t===null)&&(n[e]=t)}return n}function dn(e,t,n){let r=e.pulse,i=typeof r==`number`?r:`‚àû`,a=(typeof e.kaiSignature==`string`?e.kaiSignature:``).slice(0,10),o=typeof e.phiKey==`string`&&e.phiKey.length>0?e.phiKey:`œÜK`,s=typeof e.verifierUrl==`string`&&e.verifierUrl.length>0?e.verifierUrl:j(0,`unknown-signature`),c=[`#KaiKlok`,`#SigilProof`,`#PostedByBreath`],l={x:c,ig:[...c,`#HarmonicTime`],tiktok:[...c,`#KaiTime`,`#ForYou`],threads:[...c,`#Threads`]},u=n?` by @${n}`:``;return t===`x`?ln([`üåÄ Pulse ${i}${u}`,`Sig:${a}`,`ID:${o}`,`Verify:${s}`,...l.x].join(` ‚Ä¢ `),270):t===`ig`?[`üåÄ Pulse ${i}${u}`,`Sig: ${a}`,`ID: ${o}`,`Verify: ${s}`,``,l.ig.join(` `)].join(`
`):t===`tiktok`?[`Verify: ${s}`,`üåÄ Pulse ${i}${u}`,`Sig: ${a} ‚Ä¢ ID: ${o}`,l.tiktok.join(` `)].join(`
`):[`üåÄ Pulse ${i}${u}`,`Sig: ${a} ‚Ä¢ ID: ${o}`,`Verify: ${s}`,l.threads.join(` `)].join(`
`)}function fn({media:e,proof:t,onComplete:n}){let{session:r}=J(),i=(0,K.useMemo)(()=>{let e=[],t=r?.connectedAccounts;if(!t)return e;for(let[n,r]of Object.entries(t)){if(!r||!an(n))continue;let t=n===`x`?`X / Twitter`:n===`ig`?`Instagram`:n===`tiktok`?`TikTok`:`Threads`;e.push({platform:n,label:t,handle:r})}return e},[r?.connectedAccounts]),a=(0,K.useMemo)(()=>new Set(i.map(e=>e.platform)),[i]),[o,s]=(0,K.useState)({}),c=(0,K.useMemo)(()=>{let e=e=>{if(!a.has(e))return!1;let t=o[e];return typeof t==`boolean`?t:!0};return{x:e(`x`),ig:e(`ig`),tiktok:e(`tiktok`),threads:e(`threads`)}},[a,o]),l=e=>{s(t=>{let n=!(a.has(e)&&(typeof t[e]!=`boolean`||t[e]));return{...t,[e]:n}})},[u,d]=(0,K.useState)(`idle`),[f,p]=(0,K.useState)([]),[m,h]=(0,K.useState)(!1),[g,_]=(0,K.useState)(null),[v,y]=(0,K.useState)(null),b=(0,K.useMemo)(()=>un(e.metadata,t),[e.metadata,t]),x=(0,K.useMemo)(()=>{let t=e.type===`video`?`video`:`image`;return{content:e.content,filename:e.filename,type:t,metadata:b}},[e.content,e.filename,e.type,b]);async function S(t,n){let r=new FormData;r.append(`file`,e.content,e.filename);let i=dn(b,t,n);r.append(`caption`,i),n&&r.append(`handle`,n);let a=await fetch(`/api/post/${t}`,{method:`POST`,body:r});if(!a.ok)throw Error(`POST /api/post/${t} failed: ${a.status}`);return{link:(await a.json()).url??`#`}}let C=async()=>{if(!r)return;let e=i.filter(e=>c[e.platform]);e.length!==0&&(d(`posting`),p([]),p(await Promise.all(e.map(async e=>{try{let t=await S(e.platform,e.handle);return{platform:e.platform,link:t.link}}catch(t){return console.warn(`Post to ${e.platform} failed:`,t),{platform:e.platform,link:`‚ùå Failed`}}}))),d(`done`))},w=i.length===0||!i.some(e=>c[e.platform]),T=u===`done`||m;return(0,q.jsxs)(`div`,{className:`kv-share-shell flex flex-col gap-6 w-full max-w-2xl`,children:[(0,q.jsxs)(`header`,{className:`kv-share-header`,children:[(0,q.jsx)(`h2`,{className:`kv-share-title`,children:`Broadcast to connected socials`}),(0,q.jsx)(`p`,{className:`kv-share-subtitle`,children:`Post directly to linked accounts, then (or instead) use the manual share hub below to reach any platform ‚Äî every share carries your Kai-Sigil proof.`})]}),(0,q.jsx)(`section`,{className:`kv-share-broadcast`,children:i.length===0?(0,q.jsx)(`p`,{className:`kv-share-empty`,children:`No platforms connected yet. You can still share manually below.`}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(`div`,{className:`kv-share-connected-label`,children:`Connected accounts`}),(0,q.jsx)(`div`,{className:`grid grid-cols-2 gap-3 w-full`,children:i.map(e=>(0,q.jsxs)(`label`,{className:`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition ${c[e.platform]?`border-emerald-400 bg-emerald-400/10`:`border-white/20 bg-white/5`}`,children:[(0,q.jsx)(`input`,{type:`checkbox`,className:`accent-emerald-400`,checked:c[e.platform],onChange:()=>l(e.platform)}),(0,q.jsxs)(`div`,{className:`flex flex-col`,children:[(0,q.jsxs)(`span`,{className:`text-sm font-medium`,children:[e.label,` `,e.handle?`¬∑ @${e.handle}`:``]}),(0,q.jsx)(`span`,{className:`text-xs opacity-60`,children:`Auto-post via KaiVoh`})]})]},e.platform))}),(0,q.jsx)(`div`,{className:`mt-3`,children:(0,q.jsx)(`button`,{type:`button`,disabled:w||u===`posting`,onClick:()=>void C(),className:`kv-btn kv-btn-primary ${w||u===`posting`?`kv-btn-disabled`:``}`,children:u===`posting`?`Posting with breath‚Ä¶`:w?`No platforms selected`:`Post to Selected`})}),u===`done`?(0,q.jsxs)(`div`,{className:`kv-share-results mt-3`,children:[(0,q.jsx)(`h3`,{className:`text-xs uppercase tracking-wide opacity-60 mb-2`,children:`Post results`}),(0,q.jsx)(`ul`,{className:`text-sm space-y-1`,children:f.map(e=>(0,q.jsxs)(`li`,{className:`flex items-center gap-2 break-all`,children:[(0,q.jsx)(`span`,{className:`font-semibold min-w-[80px] capitalize`,children:e.platform}),(0,q.jsx)(`span`,{children:`:`}),e.link===`‚ùå Failed`?(0,q.jsx)(`span`,{className:`text-red-400`,children:e.link}):(0,q.jsx)(`a`,{href:e.link,target:`_blank`,rel:`noopener noreferrer`,className:`underline`,children:e.link})]},e.platform))})]}):null]})}),(0,q.jsxs)(`section`,{className:`kv-share-manual`,children:[(0,q.jsx)(rn,{media:x,onShared:e=>{h(!0),_(e),y(null)},onError:(e,t)=>{y(t.message)}}),g?(0,q.jsxs)(`p`,{className:`kv-share-status text-xs opacity-70 mt-2`,children:[`Last shared via `,(0,q.jsx)(`span`,{className:`font-semibold`,children:g}),`.`]}):null,v?(0,q.jsx)(`p`,{className:`kv-share-error text-xs text-red-400 mt-1`,children:v}):null]}),(0,q.jsx)(`footer`,{className:`kv-share-footer mt-4 flex flex-col items-center gap-2`,children:(0,q.jsx)(`button`,{type:`button`,className:`kv-btn kv-btn-primary ${T?``:`kv-btn-disabled`}`,disabled:!T,onClick:()=>{n(f.map(e=>({platform:e.platform,link:e.link})))},children:T?`Continue to Verify`:`Share at least once to continue`})})]})}function pn(e){let t=e.phiKey;if(typeof t==`string`){let e=t.trim();if(e.length>0)return e}if(t&&typeof t==`object`){if(`id`in t&&typeof t.id==`string`){let e=t.id.trim();if(e.length>0)return e}if(`key`in t&&typeof t.key==`string`){let e=t.key.trim();if(e.length>0)return e}if(`address`in t&&typeof t.address==`string`){let e=t.address.trim();if(e.length>0)return e}if(`userPhiKey`in t&&typeof t.userPhiKey==`string`){let e=t.userPhiKey.trim();if(e.length>0)return e}}return typeof e.kaiSignature==`string`&&e.kaiSignature.length?`œÜK-${e.kaiSignature.slice(0,8)}`:`œÜK-unknown`}function mn(e){let n=e.pulse,r=e.postLedger&&e.postLedger.length>0?e.postLedger.reduce((e,t)=>t.pulse>e?t.pulse:e,e.postLedger[0].pulse):n,i=r,a=r,o=u(i),l=o.stepIndex,d=o.beat,f=P(e.chakraDay??o.chakraDay),p=l%44/44,m=Math.max(0,Math.min(1,p)),g=h[f],_=te[f],{sides:y,hue:b}=g,x=i%7+1,C=d%5+2,w=m*2*Math.PI,T=le**2*Math.PI*(i%97)%(2*Math.PI),D=50+15*Math.sin(m*2*Math.PI),O=S((b+360*.03*m)%360,100,D),k=E(y,T),A=R(x,C,w),j=v*.009,M=v*.016,ee=ie(f,l),N=pn(e),ne=re(void 0,d,l,i),F=Array.from(N).reduce((e,t)=>(e*131+t.charCodeAt(0))%104729,0),I=v*.31,L=Array.from({length:12}).map((e,t)=>{let n=(t+F%100/100)/12,r=n*2*Math.PI,i=I*(1+F%7/100*Math.sin(2*Math.PI*n*le)),a=500+i*Math.cos(r),o=500+i*Math.sin(r),s=M*(.5+.5*Math.sin(2*Math.PI*n*le));return`    <circle cx="${a.toFixed(3)}" cy="${o.toFixed(3)}" r="${s.toFixed(3)}" fill="${O}" opacity="0.7" />`}).join(`
`),ae=new Date().toISOString(),z={"@context":t,type:c,kksVersion:`KKS-1.0`,kind:`KaiVohSessionMemory`,logoutSigil:!0,pulse:i,beat:d,stepIndex:l,stepsPerBeat:44,chakraDay:f,chakraGate:_,frequencyHz:ee,pulseMs:s,userPhiKey:N,sessionKaiSignature:e.kaiSignature,phiKey:N,originPulse:n,exhalePulse:a,sigilPulse:i,kaiPulse:a,connectedAccounts:e.connectedAccounts??{},postLedger:e.postLedger??[],summary:ne,createdAt:ae};return`
<svg xmlns="http://www.w3.org/2000/svg"
     viewBox="0 0 ${v} ${v}"
     width="${v}"
     height="${v}">
  <title>${`KaiVoh Memory ‚Ä¢ Œ¶-Key ${N} ‚Ä¢ p${n}‚Üíp${a}`}</title>
  <desc>${ne}</desc>

  <defs>
    <!-- Background radial gradient -->
    <radialGradient id="kv-mem-bg" cx="50%" cy="45%" r="75%">
      <stop offset="0%" stop-color="${O}" stop-opacity="0.18" />
      <stop offset="45%" stop-color="${O}" stop-opacity="0.04" />
      <stop offset="100%" stop-color="#02040a" stop-opacity="1" />
    </radialGradient>

    <!-- Soft glow around the core -->
    <filter id="kv-mem-glow" x="-40%" y="-40%" width="180%" height="180%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="${v*.025}" result="blur" />
      <feColorMatrix
        in="blur"
        type="matrix"
        values="0 0 0 0 0.7
                0 0 0 0 1
                0 0 0 0 0.9
                0 0 0 0.7 0" />
    </filter>

    <!-- Inner orb gradient -->
    <radialGradient id="kv-mem-orb" cx="50%" cy="50%" r="60%">
      <stop offset="0%" stop-color="${O}" stop-opacity="0.9" />
      <stop offset="45%" stop-color="${O}" stop-opacity="0.25" />
      <stop offset="100%" stop-color="#02040a" stop-opacity="0" />
    </radialGradient>
  </defs>

  <!-- Background -->
  <rect x="0" y="0" width="${v}" height="${v}" fill="url(#kv-mem-bg)" />

  <!-- Aura + core (glow group) -->
  <g filter="url(#kv-mem-glow)" stroke-linecap="round" stroke-linejoin="round">
    <!-- Outer Kai-lissajous orbit -->
    <path
      d="${A}"
      fill="none"
      stroke="${O}"
      stroke-width="${v*.0025}"
      opacity="0.55"
    />
    <!-- Core polygon (diamond / star) -->
    <path
      d="${k}"
      fill="none"
      stroke="${O}"
      stroke-width="${j}"
      opacity="0.9"
    />
    <!-- Inner orb -->
    <circle
      cx="500"
      cy="500"
      r="${v*.12}"
      fill="url(#kv-mem-orb)"
    />
    <!-- Central Kai pulse point -->
    <circle
      cx="500"
      cy="500"
      r="${M}"
      fill="${O}"
    />
    <!-- Œ¶ ‚ÄúDNA ring‚Äù derived from Œ¶-Key (visual identity, no text) -->
${L}
  </g>

  <!-- Embedded memory/meta payload (Verifier-compatible JSON) -->
  <metadata><![CDATA[
${JSON.stringify(z,null,2)}
  ]]></metadata>
</svg>`.trim()}function hn(e,t){let n=new Blob([t],{type:`image/svg+xml`}),r=URL.createObjectURL(n),i=document.createElement(`a`);i.href=r,i.download=e,i.click(),URL.revokeObjectURL(r)}var gn=e=>{if(!e)return null;if(Array.isArray(e)){let t=e[0];return t==null?null:String(t)}if(typeof e==`string`){try{let t=JSON.parse(e);if(Array.isArray(t)){let e=t[0];return e==null?null:String(e)}}catch{return e}return e}return null};function _n(e){return typeof e==`object`&&!!e}function vn(e){return _n(e)&&typeof e.pulse==`number`&&typeof e.platform==`string`&&typeof e.link==`string`}function yn(e){if(!Array.isArray(e))return[];let t=[];for(let n of e)vn(n)&&t.push(n);return t}function bn(e){if(!_n(e))return;let t={};for(let[n,r]of Object.entries(e))typeof r==`string`&&(t[n]=r);return t}function xn(e){if(!_n(e))return null;let t=e.kaiSignature,n=e.pulse;return typeof t!=`string`||typeof n!=`number`?null:{kaiSignature:t,pulse:n,chakraDay:typeof e.chakraDay==`string`?e.chakraDay:void 0,userPhiKey:typeof e.userPhiKey==`string`?e.userPhiKey:void 0,connectedAccounts:bn(e.connectedAccounts),postLedger:yn(e.postLedger)}}var Sn=/^[1-9A-HJ-NP-Za-km-z]+$/;function Cn(e){return Sn.test(e)&&e.length>=26&&e.length<=64}var wn=[`connect`,`compose`,`seal`,`embed`,`share`,`verify`],Tn={login:`Login`,connect:`KaiVoh`,compose:`Compose`,seal:`Seal Breath`,embed:`Embed Signature`,share:`Share`,verify:`Verify`};function En(e){return e?e.length<=10?e:`${e.slice(0,5)}‚Ä¶${e.slice(-4)}`:`‚Äî`}function Dn(e){let t=e||`Crown`;return`kv-chakra-${{Root:`root`,Sacral:`sacral`,"Solar Plexus":`solar`,Heart:`heart`,Throat:`throat`,"Third Eye":`brow`,Crown:`crown`}[t]??t.toLowerCase().replace(/\s+/g,`-`).replace(/[^a-z0-9-]/g,``)}`}function On(e){if(e==null||!Number.isFinite(e)||e<=0)return`0.0s`;let t=e/1e3;return t<1?`${t.toFixed(2)}s`:t<10?`${t.toFixed(1)}s`:`${t.toFixed(0)}s`}function kn(e){let t=e.lastIndexOf(`.`);if(t<=0||t>=e.length-1)return``;let n=e.slice(t);return n.length>12?``:n}var An=`http://www.w3.org/2000/svg`;async function jn(e,t){hn(e,await t.text())}async function Mn(e,t){try{let n=await e.text(),r=new DOMParser().parseFromString(n,`image/svg+xml`);if(r.querySelector(`parsererror`))return e;let i=r.documentElement;if(!i||i.namespaceURI!==An||i.tagName.toLowerCase()!==`svg`)return e;let a=r.getElementsByTagName(`metadata`),o=a.length>0?a.item(0):r.createElementNS(An,`metadata`);a.length===0&&i.appendChild(o),o.textContent=JSON.stringify(t,null,2);let s=new XMLSerializer().serializeToString(r);return new Blob([s],{type:`image/svg+xml`})}catch{return e}}async function Nn(e,t){try{let n=ue(await e.text(),t);return new Blob([n],{type:`image/svg+xml`})}catch{return e}}function Pn({current:e}){let t=wn.indexOf(e);return(0,q.jsx)(`div`,{className:`kv-steps`,children:wn.map((n,r)=>(0,q.jsxs)(`div`,{className:`kv-step`,children:[(0,q.jsxs)(`div`,{className:[`kv-step-chip`,t>=0&&r<t?`kv-step-chip--done`:``,n===e?`kv-step-chip--active`:``].filter(Boolean).join(` `),children:[(0,q.jsx)(`span`,{className:`kv-step-index`,children:r+1}),(0,q.jsx)(`span`,{className:`kv-step-label`,children:Tn[n]})]}),r<wn.length-1?(0,q.jsx)(`div`,{className:`kv-step-rail`,"aria-hidden":`true`}):null]},n))})}function Fn(e){let[t,r]=(0,K.useState)(null),[i,a]=(0,K.useState)(null);return(0,K.useEffect)(()=>{if(!e)return;let t=!1,i=async()=>{let e=new Date,i=await ae(void 0,e);if(t)return;let o=i.pulse,s=n(o+1),c=Number(s-BigInt(e.getTime()));(!Number.isFinite(c)||c<0)&&(c=0),r(o),a(c)};i();let o=window.setInterval(()=>void i(),250);return()=>{t=!0,window.clearInterval(o)}},[e]),{livePulse:t,msToNextPulse:i}}function In({session:e,step:t,hasConnectedAccounts:n,onLogout:r,onNewPost:i}){let{livePulse:a,msToNextPulse:o}=Fn(!!e),s=e.postLedger?.length??0,c=a??e.pulse,l=On(o);return(0,q.jsxs)(`header`,{className:[`kv-session-hud`,Dn(e.chakraDay)].join(` `),children:[(0,q.jsxs)(`div`,{className:`kv-session-main`,children:[(0,q.jsxs)(`div`,{className:`kv-session-header-row`,children:[(0,q.jsxs)(`div`,{className:`kv-session-title-block`,children:[(0,q.jsx)(`div`,{className:`kv-session-kicker`,children:`KaiVoh ¬∑ Glyph Session`}),(0,q.jsxs)(`div`,{className:`kv-session-keyline`,children:[(0,q.jsxs)(`span`,{className:`kv-meta-item kv-meta-phikey`,children:[(0,q.jsx)(`span`,{className:`kv-meta-label`,children:`Œ¶-Key`}),(0,q.jsx)(`span`,{className:`kv-meta-value`,children:En(e.phiKey)})]}),(0,q.jsx)(`span`,{className:`kv-meta-divider`}),(0,q.jsxs)(`span`,{className:`kv-meta-item`,children:[(0,q.jsx)(`span`,{className:`kv-meta-label`,children:`Sigil Pulse`}),(0,q.jsx)(`span`,{className:`kv-meta-value`,children:e.pulse})]}),(0,q.jsx)(`span`,{className:`kv-meta-divider`}),(0,q.jsxs)(`span`,{className:`kv-meta-item`,children:[(0,q.jsx)(`span`,{className:`kv-meta-label`,children:`Chakra`}),(0,q.jsx)(`span`,{className:`kv-meta-value`,children:e.chakraDay??`Crown`})]}),s>0?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(`span`,{className:`kv-meta-divider`}),(0,q.jsxs)(`span`,{className:`kv-meta-item kv-meta-activity`,children:[(0,q.jsx)(`span`,{className:`kv-meta-label`,children:`Sealed`}),(0,q.jsxs)(`span`,{className:`kv-meta-value`,children:[s,` `,s===1?`post`:`posts`]})]})]}):null]}),(0,q.jsxs)(`div`,{className:`kv-session-live`,children:[(0,q.jsx)(`span`,{className:`kv-live-label`,children:`Live Kai Pulse`}),(0,q.jsxs)(`span`,{className:`kv-live-value`,children:[c,(0,q.jsxs)(`span`,{className:`kv-live-countdown`,children:[`¬∑ next breath in `,l]})]})]})]}),(0,q.jsxs)(`div`,{className:`kv-session-status-block`,children:[(0,q.jsx)(`span`,{className:[`kv-accounts-pill`,n?`kv-accounts-pill--ok`:`kv-accounts-pill--warn`].join(` `),children:n?`Accounts linked`:`Connect accounts`}),(0,q.jsx)(`span`,{className:`kv-step-current-label`,children:Tn[t]??`Flow`})]})]}),(0,q.jsx)(`div`,{className:`kv-session-steps-row`,children:(0,q.jsx)(Pn,{current:t})})]}),(0,q.jsxs)(`div`,{className:`kv-session-actions`,children:[(0,q.jsx)(`button`,{type:`button`,onClick:i,className:`kv-btn kv-btn-primary`,children:`+ Exhale Memory`}),(0,q.jsx)(`button`,{type:`button`,onClick:r,className:`kv-btn kv-btn-ghost`,children:`‚èª Inhale Memories`})]})]})}function Ln({ledger:e}){if(!e||e.length===0)return null;let t=[...e].sort((e,t)=>t.pulse-e.pulse).slice(0,4);return(0,q.jsxs)(`section`,{className:`kv-activity`,children:[(0,q.jsxs)(`div`,{className:`kv-activity-header`,children:[(0,q.jsx)(`span`,{className:`kv-activity-title`,children:`Session Activity`}),(0,q.jsxs)(`span`,{className:`kv-activity-count`,children:[e.length,` total`]})]}),(0,q.jsx)(`div`,{className:`kv-activity-list`,children:t.map(e=>(0,q.jsxs)(`div`,{className:`kv-activity-item`,children:[(0,q.jsxs)(`div`,{className:`kv-activity-item-main`,children:[(0,q.jsx)(`span`,{className:`kv-activity-platform`,children:e.platform}),(0,q.jsxs)(`span`,{className:`kv-activity-pulse`,children:[`Pulse `,(0,q.jsx)(`span`,{children:e.pulse})]})]}),e.link?(0,q.jsx)(`a`,{href:e.link,target:`_blank`,rel:`noreferrer`,className:`kv-activity-link`,children:e.link}):null]},`${e.platform}-${e.pulse}-${e.link}`))})]})}function Rn(){let{session:e,setSession:t,clearSession:n}=J(),[r,i]=(0,K.useState)(`login`),[a,o]=(0,K.useState)(null),[s,c]=(0,K.useState)(null),[l,u]=(0,K.useState)(null),[d,m]=(0,K.useState)(null),[h,_]=(0,K.useState)(null),v=(0,K.useMemo)(()=>!e||!e.connectedAccounts?!1:Object.keys(e.connectedAccounts).length>0,[e]),y=async(e,n)=>{try{_(null);let e=xn(n);if(!e)throw Error(`Malformed sigil metadata from login.`);let r=await A(e.kaiSignature);if(e.userPhiKey&&e.userPhiKey!==r&&console.warn(`[KaiVoh] Embedded userPhiKey differs from derived; preferring derived from signature.`,{embedded:e.userPhiKey,derived:r}),!Cn(r))throw Error(`Invalid Œ¶-Key shape after derivation.`);let a=N(e.chakraDay)??`Crown`,o={phiKey:r,kaiSignature:e.kaiSignature,pulse:e.pulse,chakraDay:a,connectedAccounts:e.connectedAccounts??{},postLedger:e.postLedger??[]};t(o),Object.keys(o.connectedAccounts??{}).length>0?i(`compose`):i(`connect`)}catch(e){_(e instanceof Error?e.message:`Invalid Œ¶-Key signature or metadata.`),i(`login`)}},x=()=>{if(!e)return;let t=mn(e);hn(`sigil-${e.pulse+1}.svg`,t),n(),o(null),c(null),u(null),m(null),_(null),i(`login`)},S=()=>{o(null),c(null),u(null),m(null),_(null),i(`compose`)},C=async()=>{l&&(l.type!==`image`||!l.content.type.includes(`svg`)||await jn(l.filename,l.content))};(0,K.useEffect)(()=>{let t=!1;return(async()=>{if(!(r!==`embed`||!s||!e))try{let n=await Zt(s);if(t)return;let r=e.pulse,a=s.pulse,o=n.metadata,c=(o.kaiSignature??s.kaiSignature??e.kaiSignature??``).trim();if(!c)throw Error(`Missing kaiSignature for embedded proof.`);let l=await A(c);if(e.phiKey&&e.phiKey!==l)throw Error(`Proof mismatch: embedded kaiSignature derives a different Œ¶-Key than session.`);let d=typeof o.chakraDay==`string`?o.chakraDay:void 0,h=N(s.chakraDay??void 0)??N(d)??N(e.chakraDay??void 0)??`Crown`,_=p(a,c),v=j(a,c),y={v:`KPV-1`,pulse:a,chakraDay:h,kaiSignature:c,phiKey:l,verifierSlug:_},x=await b(y),S={...o,pulse:a,kaiPulse:a,chakraDay:h,kaiSignature:c,phiKey:l,userPhiKey:l,phiKeyShort:`œÜK-${l.slice(0,8)}`,verifierUrl:v,verifierSlug:_,proofCapsule:y,proofHash:x,capsuleHash:x,hashAlg:F,canon:`JCS`,originPulse:r,sigilPulse:r,exhalePulse:a},C=n.content;n.type===`image`&&C.type.includes(`svg`)&&(C=await Mn(C,S));let w,T,E=null;if(n.type===`image`&&C.type.includes(`svg`)){w=await I(await C.text());let e=typeof S.zkPoseidonHash==`string`?S.zkPoseidonHash:void 0,t=typeof S.zkPoseidonSecret==`string`?S.zkPoseidonSecret:void 0,n=typeof S.payloadHashHex==`string`?S.payloadHashHex:void 0,r=S.zkProof,i=S.proofHints,a=S.zkPublicInputs;if(e){let o=r&&typeof r==`object`?r:null,s=typeof r==`string`?r.trim().length>0:Array.isArray(r)?r.length>0:o?Object.keys(o).length>0:!1,c=typeof t==`string`&&t.trim().length>0?t.trim():void 0;if(!c&&n){let t=await f(n);t.hash===e&&(c=t.secret)}if(!s&&c){let t=await O({poseidonHash:e,secret:c,proofHints:typeof i==`object`&&i?i:void 0});t&&(r=t.proof,i=t.proofHints,a=t.zkPublicInputs)}i=typeof i!=`object`||!i?z(e):z(e,i)}if(e&&a){let t=gn(a);if(t&&t!==e)throw Error(`Embedded ZK mismatch`)}let o=typeof S.shareUrl==`string`?S.shareUrl:void 0,s={v:`KPB-1`,hashAlg:F,canon:`JCS`,proofCapsule:y,capsuleHash:x,svgHash:w,shareUrl:o,verifierUrl:v,zkPoseidonHash:e,zkProof:r,proofHints:i,zkPublicInputs:a};T=await g(oe({...s,authorSig:null}));try{await de(l),E=await U(l,T)}catch(e){console.warn(`Author signature failed; continuing without authorSig.`,e),E=null}let c={...s,bundleHash:T,authorSig:E};C=await Nn(C,c)}let D=`memory_p${r}_p${a}${kn(n.filename)||kn(s.post.file.name)||(n.type===`video`?`.mp4`:`.svg`)}`;u({...n,content:C,filename:D,metadata:{...S,svgHash:w,bundleHash:T,authorSig:E}}),m({pulse:a,chakraDay:h,kaiSignature:c,phiKey:l,verifierSlug:_,verifierUrl:v,hashAlg:F,canon:`JCS`,capsuleHash:x,svgHash:w??``,bundleHash:T??``,authorSig:E,proofHash:x}),i(`share`)}catch(e){if(t)return;_(e instanceof Error?e.message:`Failed to embed Kai Signature into media.`),i(`compose`)}})(),()=>{t=!0}},[r,s,e]);let w=(n,r)=>{if(!e||n.length===0)return;let i=[...e.postLedger??[],...n.map(e=>({pulse:r,platform:e.platform,link:e.link}))];t({...e,postLedger:i})};return!e||r===`login`?(0,q.jsx)(`div`,{className:`kai-voh-login-shell`,children:(0,q.jsxs)(`main`,{className:`kv-main-card`,children:[(0,q.jsx)(W,{onVerified:y}),h?(0,q.jsx)(`p`,{className:`kv-error`,children:h}):null]})}):(0,q.jsxs)(`div`,{className:`kai-voh-app-shell`,children:[(0,q.jsx)(In,{session:e,step:r,hasConnectedAccounts:v,onLogout:x,onNewPost:S}),(0,q.jsxs)(`main`,{className:`kv-main-card`,children:[(()=>r===`connect`?(0,q.jsxs)(`div`,{className:`kv-connect-step`,children:[(0,q.jsx)(Ot,{}),(0,q.jsx)(`button`,{type:`button`,onClick:()=>i(`compose`),className:`kv-btn kv-btn-primary kv-btn-wide`,children:`Continue to Compose`})]}):r===`compose`&&!a?(0,q.jsx)(Lt,{onReady:e=>{o(e),c(null),u(null),m(null),_(null),i(`seal`)}}):r===`seal`&&a?(0,q.jsx)(Gt,{post:a,identityKaiSignature:e.kaiSignature,userPhiKey:e.phiKey,onSealComplete:e=>{c(e),i(`embed`)}}):r===`embed`?(0,q.jsx)(`p`,{className:`kv-embed-status`,children:`Embedding Kai Signature into your media‚Ä¶`}):r===`share`&&l&&s&&d?(0,q.jsx)(fn,{media:l,proof:d,onComplete:e=>{w(e,s.pulse),i(`verify`)}}):r===`verify`&&d?(0,q.jsxs)(`div`,{className:`kv-verify-step`,children:[(0,q.jsx)(ye,{pulse:d.pulse,kaiSignature:d.kaiSignature,phiKey:d.phiKey,chakraDay:d.chakraDay,compact:!1}),(0,q.jsx)(`p`,{className:`kv-verify-copy`,children:`Your memory is now verifiable as human-authored under this Œ¶-Key. Anyone can scan the QR or open the verifier link to confirm it was sealed at this pulse under your sigil.`}),(0,q.jsxs)(`div`,{className:`kv-verify-actions`,children:[(0,q.jsx)(`button`,{type:`button`,onClick:S,className:`kv-btn kv-btn-primary`,children:`+ Exhale Memory`}),l?.type===`image`&&l.content.type.includes(`svg`)?(0,q.jsx)(`button`,{type:`button`,onClick:()=>void C(),className:`kv-btn kv-btn-ghost`,children:`Download sealed SVG`}):null,(0,q.jsx)(`button`,{type:`button`,onClick:x,className:`kv-btn kv-btn-ghost`,children:`‚èª Inhale Memories`})]})]}):(0,q.jsxs)(`div`,{className:`kv-error-state`,children:[`Something went sideways in the breath stream‚Ä¶`,(0,q.jsx)(`button`,{type:`button`,onClick:S,className:`kv-error-reset`,children:`Reset step`})]}))(),h?(0,q.jsx)(`p`,{className:`kv-error`,children:h}):null]}),e.postLedger&&e.postLedger.length>0?(0,q.jsx)(Ln,{ledger:e.postLedger}):null]})}function zn(){return(0,q.jsx)(xe,{children:(0,q.jsx)(Rn,{})})}export{zn as default};