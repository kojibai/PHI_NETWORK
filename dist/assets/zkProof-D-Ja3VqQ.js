const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser.esm-1ID3ykFX.js","assets/index-DbRFIeyC.js","assets/index-BjumX9GF.css"])))=>i.map(i=>d[i]);
import{Vr as e}from"./index-DbRFIeyC.js";function t(e){return typeof e==`object`&&!!e&&Object.keys(e).length>0}function n(e){return e?typeof e==`string`?e.trim().length>0:Array.isArray(e)?e.length>0:t(e):!1}async function r(e){if(typeof fetch!=`function`)return e[0]??``;for(let t of e)try{if((await fetch(t,{method:`HEAD`})).ok)return t}catch{}return e[0]??``}async function i(e){if(typeof fetch!=`function`)return null;try{let n=await fetch(`/api/proof/sigil`,{method:`POST`,cache:`no-store`,headers:{"Content-Type":`application/json`},body:JSON.stringify({zkPoseidonHash:e.poseidonHash,poseidonHash:e.poseidonHash,payloadHashHex:e.payloadHashHex})});if(!n.ok)return null;let r=await n.json();if(!r||!t(r)||!r.zkProof||!r.zkPublicInputs)return null;let i={scheme:`groth16-poseidon`,api:`/api/proof/sigil`,explorer:`/keystream/hash/${e.poseidonHash}`,...e.proofHints??{},...r.proofHints??{}};return{proof:r.zkProof,proofHints:i,zkPublicInputs:Array.isArray(r.zkPublicInputs)?r.zkPublicInputs.map(e=>String(e)):[e.poseidonHash]}}catch{return null}}async function a(){let t=e=>typeof e==`object`&&!!e&&`fullProve`in e&&typeof e.fullProve==`function`;if(typeof window<`u`&&t(window.snarkjs?.groth16))return window.snarkjs.groth16;let n=await e(()=>import(`./browser.esm-1ID3ykFX.js`),__vite__mapDeps([0,1,2])).catch(()=>null),r=n?.groth16??n?.default?.groth16;return t(r)?r:null}async function o(e){if(e)return e;if(typeof window<`u`){let e=window;if(e.SIGIL_ZK_VKEY)return e.SIGIL_ZK_VKEY}if(typeof fetch!=`function`)return null;for(let e of[`/zk/sigil.vkey.json`,`/sigil.vkey.json`])try{let t=await fetch(e,{cache:`no-store`});if(!t.ok)continue;return await t.json()}catch{}return null}async function s(e){let t=e.poseidonHash?.trim();if(!t)return null;let s=typeof fetch==`function`;if(s){let n=await i({poseidonHash:t,proofHints:e.proofHints,payloadHashHex:e.payloadHashHex});if(n)return n;throw Error(`ZK proof API unavailable`)}let c=await a();if(!c?.fullProve)return null;let l=await r([`/zk/sigil.wasm`,`/sigil.wasm`]),u=await r([`/zk/sigil.zkey`,`/sigil.zkey`]),d={poseidonHash:t};try{let{proof:r,publicSignals:i}=await c.fullProve(d,l,u);if(!n(r))return null;let a=i?.[0];if(String(a??``)!==t)throw Error(`ZK public input mismatch`);if(typeof c.verify!=`function`)throw Error(`ZK verifier unavailable`);let s=await o(e.vkey);if(!s)throw Error(`ZK verifying key missing`);if(!await c.verify(s,i,r))throw Error(`ZK proof failed verification`);return{proof:r,proofHints:{scheme:`groth16-poseidon`,api:`/api/proof/sigil`,explorer:`/keystream/hash/${t}`,...e.proofHints??{}},zkPublicInputs:i}}catch(n){if(n instanceof Error){let e=n.message;if(e.includes(`ZK public input mismatch`)||e.includes(`ZK proof failed verification`))throw n}return s?null:i({poseidonHash:t,proofHints:e.proofHints,payloadHashHex:e.payloadHashHex})}}export{s as t};