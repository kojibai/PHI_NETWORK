import{Cr as e,Dr as t,Er as n,Rr as r,Sr as i,Tr as a,Vr as o,_r as s,br as c,fi as l,hr as u,mr as d,oi as f,vr as p,wr as m,xr as h,yr as g}from"./index-6AQe18Wa.js";var _=l(f(),1);function v(){let[e,t]=(0,_.useState)(null),[n,i]=(0,_.useState)(r),a=(0,_.useRef)(null),s=(0,_.useRef)(null);return(0,_.useEffect)(()=>{let e=null,n=()=>{let e=o(new Date),n=Date.now();if(s.current==null||e.pulse!==s.current)s.current=e.pulse,a.current=n,t(e.pulse),i(r);else{let o=a.current,s=o==null?r:Math.max(0,r-(n-o));t(e.pulse),i(s)}};return e=window.setInterval(n,50),n(),()=>{e!=null&&window.clearInterval(e)}},[]),{pulse:e,msToNextPulse:n}}function y(){return(0,_.useMemo)(()=>async e=>{let t=new TextEncoder().encode(e),n=await crypto.subtle.digest(`SHA-256`,t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,`0`)).join(``)},[])}function b({payload:r,urlSearchParams:o,currentPulse:l}){let[f,v]=(0,_.useState)(null),[b,x]=(0,_.useState)(null),[S,C]=(0,_.useState)(null),w=(0,_.useRef)(null),T=(0,_.useRef)(null),E=y(),D=o?.get(`vpol`)??``;(0,_.useEffect)(()=>{let e=!0;return(async()=>{if(!r||!Number.isFinite(l??NaN)){if(!e)return;v(e=>e===null?e:null),x(e=>e===null?e:null),C(e=>e===null?e:null),w.current=null,T.current=null;return}let{seal:t}=await d({pulse:r.pulse,kaiPulse:r.pulse,beat:r.beat,stepIndex:r.stepIndex,stepsPerBeat:r.stepsPerBeat,seriesSize:r.seriesSize,quality:r.quality,creatorVerified:r.creatorVerified,creatorRep:r.creatorRep,frequencyHz:r.frequencyHz,chakraDay:r.chakraDay,chakraGate:r.chakraGate,transfers:r.transfers,cumulativeTransfers:r.cumulativeTransfers,segments:r.segments,segmentsMerkleRoot:r.segmentsMerkleRoot,transfersWindowRoot:r.transfersWindowRoot,ip:r.ip,kaiSignature:r.kaiSignature,userPhiKey:r.userPhiKey,valuationPolicyId:D||void 0},l,E);if(!e)return;T.current!==t.stamp&&(v(e=>e&&e.stamp===t.stamp?e:t),T.current=t.stamp);let n=t.valuePhi,i=w.current;i!==n&&(x(e=>e===n?e:n),i!=null&&Math.abs(n-i)>1e-9?C(e=>e===`up`&&n>i?e:n>i?`up`:`down`):C(e=>e===null?e:null),w.current=n)})(),()=>{e=!1}},[r,l,D,E]);let O=(0,_.useMemo)(()=>r?.pulse,[r]),k=(0,_.useMemo)(()=>Number.isFinite(O??NaN)?{score:i(O),lines:c(O)}:{score:null,lines:[]},[O]),A=(0,_.useMemo)(()=>{if(!Number.isFinite(O??NaN)||!Number.isFinite(l??NaN))return null;let e=f?.inputs?.pulsesPerBeat?Math.max(1,Math.round(f.inputs.pulsesPerBeat/11)):r?.stepsPerBeat??44,t=f?.inputs?.cadenceRegularity??1,n=f?.inputs?.resonancePhi??.5,i=r?.stepIndex;return g(O,l,{stepsPerBeat:e,cadenceRegularity:t,resonancePhi:n,stepIndexClaimOverride:i})},[O,l,f,r]),j=(0,_.useMemo)(()=>{let e=r?.transfers;return!e||!e.length?[`No closed transfers yet â€” lineage still forming.`]:p(e,{stepsPerBeat:r?.stepsPerBeat??44})},[r]);return{valSeal:f,livePrice:b,priceFlash:S,rarity:k,oscillation:A,lineageNarrative:j,trust:(0,_.useMemo)(()=>f?s(f.inputs):null,[f]),marketTier:(0,_.useMemo)(()=>Number.isFinite(O??NaN)?u(O,f??void 0):null,[O,f]),kairos:(0,_.useMemo)(()=>Number.isFinite(l??NaN)?{window:n(l,144,1,{stepsPerBeat:r?.stepsPerBeat??44})}:{window:[]},[l,r]),visuals:(0,_.useMemo)(()=>{if(!f||!Number.isFinite(O??NaN))return{spiralSVG:null,scrollSVG:null,scrollText:null,scrollHTML:null};let n=e(O),{scrollSVG:r,scrollText:i}=t(f,{title:`Kai-Sigil Valuation Scroll`});return{spiralSVG:n,scrollSVG:r,scrollText:i,scrollHTML:m(f,{title:`Kai-Sigil Valuation Scroll`})}},[f,O]),audio:(0,_.useMemo)(()=>{if(!Number.isFinite(O??NaN))return{dataURI:null,renderWav:void 0};let{dataURI:e}=a(O,2,44100,{stereo:!0});return{dataURI:e,renderWav:(e=2,t=44100,n)=>a(O,e,t,n)}},[O]),motifSimilarityWith:(0,_.useMemo)(()=>e=>!Number.isFinite(e??NaN)||!Number.isFinite(O??NaN)?null:h(O,e),[O]),helpers:(0,_.useMemo)(()=>({explainRarity:()=>k.lines,explainLineage:()=>j,scanKairos:(e,t,i=1,a)=>n(e,t,i,{stepsPerBeat:a??r?.stepsPerBeat??44}),makeScroll:e=>f?t(f,{title:e??`Kai-Sigil Valuation Scroll`}):null,makeScrollHTML:e=>f?m(f,{title:e}):null,makeSpiral:t=>Number.isFinite(t??O)?e(t??O):null}),[k.lines,j,r,f,O])}}export{v as n,b as t};