(3+Math.sqrt(5))*1e3;const e=`https://schema.phi.network/sigil/v1`,t=`application/phi.kairos.sigil+svg`,n=2e3,r=e=>Array.from(e).map(e=>e.toString(16).padStart(2,`0`)).join(``);async function i(e){let t=typeof e==`string`?new TextEncoder().encode(e):e,n=await crypto.subtle.digest(`SHA-256`,t);return r(new Uint8Array(n))}var a=`123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz`;function o(e){let t=0n;for(let n of e)t=(t<<8n)+BigInt(n);let n=``;for(;t>0n;)n=a[Number(t%58n)]+n,t/=58n;for(let t=0;t<e.length&&e[t]===0;t++)n=`1`+n;return n}async function s(e,t=0){let n=new Uint8Array(1+e.length);n[0]=t,n.set(e,1);let r=await crypto.subtle.digest(`SHA-256`,n),i=await crypto.subtle.digest(`SHA-256`,r),a=new Uint8Array(i).slice(0,4),s=new Uint8Array(n.length+4);return s.set(n),s.set(a,n.length),o(s)}const c={encode(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,`-`).replace(/\//g,`_`).replace(/=+$/g,``)},decode(e){let t=e.replace(/-/g,`+`).replace(/_/g,`/`)+`===`.slice((e.length+3)%4),n=atob(t),r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return r}};async function l(e){let t=c.decode(e),n=await crypto.subtle.digest(`SHA-256`,t);return s(new Uint8Array(n).slice(0,20),0)}async function u(e,t){return i(new TextEncoder().encode(e+`|`+t))}async function d(e){if(e.length===0)return`0`.repeat(64);let t=e.slice();for(;t.length>1;){let e=[];for(let n=0;n<t.length;n+=2){let r=t[n],i=n+1<t.length?t[n+1]:t[n],[a,o]=r<=i?[r,i]:[i,r];e.push(await u(a,o))}t=e}return t[0]}async function f(e,t){if(e.length===0)return{leaf:`0`.repeat(64),index:0,siblings:[]};let n=t,r=e.slice(),i=[];for(;r.length>1;){let e=n%2==1?n-1:n+1,t=r[e]??r[n];i.push(t);let a=[];for(let e=0;e<r.length;e+=2){let t=r[e],n=e+1<r.length?r[e+1]:r[e];a.push(await u(t<=n?t:n,t<=n?n:t))}r=a,n=Math.floor(n/2)}return{leaf:e[t],index:t,siblings:i}}async function p(e,t){let n=t.leaf,r=t.index;for(let e of t.siblings){let t=r%2==0?[n,e]:[e,n];n=await u(t[0]<=t[1]?t[0]:t[1],t[0]<=t[1]?t[1]:t[0]),r=Math.floor(r/2)}return n===e}var m=[`Root`,`Sacral`,`Solar Plexus`,`Heart`,`Throat`,`Third Eye`,`Crown`].reduce((e,t)=>(e[t.toLowerCase()]=t,e),{});function h(e){let t=e.toLowerCase().trim().replace(/[-_]/g,` `).replace(/\b(gate|chakra|day)\b/g,``).replace(/\s+/g,` `).trim();return/(third\s*eye)/.test(t)?`third eye`:/(solar\s*plexus)/.test(t)?`solar plexus`:t}function g(e){if(typeof e!=`string`)return null;let t=h(e),n=m[t];if(n)return n;switch(t){case`root`:return`Root`;case`sacral`:return`Sacral`;case`solar`:case`plexus`:return`Solar Plexus`;case`heart`:return`Heart`;case`throat`:return`Throat`;case`third`:case`eye`:return`Third Eye`;case`crown`:return`Crown`;default:return null}}function _(e){return g(e.chakraDay??``)||g(e.chakraGate??``)||null}const v={CTX:e,TYPE:t};function y(e){return(!e[`@context`]||e[`@context`]===v.CTX)&&(!e.type||e.type===v.TYPE)}function b(e){if(typeof e!=`object`||!e)return JSON.stringify(e);if(Array.isArray(e))return`[`+e.map(b).join(`,`)+`]`;let t=e;return`{`+Object.keys(t).sort().map(e=>JSON.stringify(e)+`:`+b(t[e])).join(`,`)+`}`}async function x(e){let{pulse:t,beat:n,stepIndex:r,chakraDay:a}=e;return typeof t!=`number`||typeof n!=`number`||typeof r!=`number`||typeof a!=`string`?null:i(`${t}|${n}|${r}|${a}|${e.intentionSigil??``}`)}async function S(e){let t=await i(e+`Ï†`),n=new Uint8Array(20);for(let e=0;e<20;e++)n[e]=parseInt(t.slice(e*2,e*2+2),16);return s(n,0)}function C(e){let t={senderSignature:e.senderSignature,senderStamp:e.senderStamp,senderKaiPulse:e.senderKaiPulse};return e.payload&&(t.payload={name:e.payload.name,mime:e.payload.mime,size:e.payload.size}),e.receiverSignature&&(t.receiverSignature=e.receiverSignature),e.receiverStamp&&(t.receiverStamp=e.receiverStamp),e.receiverKaiPulse!=null&&(t.receiverKaiPulse=e.receiverKaiPulse),t}async function w(e){return i(JSON.stringify(C(e)))}function T(e){let t={senderSignature:e.senderSignature,senderStamp:e.senderStamp,senderKaiPulse:e.senderKaiPulse};return e.payload&&(t.payload={name:e.payload.name,mime:e.payload.mime,size:e.payload.size}),t}async function E(e){return i(JSON.stringify(T(e)))}async function D(e){return d(await Promise.all(e.map(w)))}async function O(e,t){return i(b({pulse:e.pulse??0,beat:e.beat??0,stepIndex:e.stepIndex??0,chakraDay:e.chakraDay??``,kaiSignature:e.kaiSignature??``,creatorPublicKey:e.creatorPublicKey??``,cumulativeTransfers:t??e.cumulativeTransfers??0,segments:(e.segments??[]).map(e=>({index:e.index,root:e.root,cid:e.cid,count:e.count})),segmentsMerkleRoot:e.segmentsMerkleRoot??``}))}function k(e){return(e.segments??[]).reduce((e,t)=>e+(t.count||0),0)}async function A(e,t){return O(e,k(e)+t)}function j(e,t){let n=g(e.chakraDay)??`Root`,r={v:1,type:`send`,sigil:{pulse:e.pulse??0,beat:e.beat??0,stepIndex:e.stepIndex??0,chakraDay:n,kaiSignature:e.kaiSignature??``},previousHeadRoot:t.previousHeadRoot,senderKaiPulse:t.senderKaiPulse,senderPubKey:t.senderPubKey,nonce:t.nonce,transferLeafHashSend:t.transferLeafHashSend};return new TextEncoder().encode(b(r))}function M(e){let t={v:1,type:`receive`,link:e.senderSig,previousHeadRoot:e.previousHeadRoot,receiverKaiPulse:e.receiverKaiPulse,receiverPubKey:e.receiverPubKey,transferLeafHashReceive:e.transferLeafHashReceive};return new TextEncoder().encode(b(t))}async function N(e){return i(JSON.stringify({pulse:e.pulse,beat:e.beat,stepIndex:e.stepIndex,chakraDay:e.chakraDay,kaiSignature:e.kaiSignature,userPhiKey:e.userPhiKey,cumulativeTransfers:e.cumulativeTransfers??0,segments:(e.segments??[]).map(e=>({index:e.index,root:e.root,cid:e.cid,count:e.count})),segmentsMerkleRoot:e.segmentsMerkleRoot??``}))}function P(e){let t=JSON.stringify(e);return btoa(unescape(encodeURIComponent(t))).replace(/\+/g,`-`).replace(/\//g,`_`).replace(/=+$/g,``)}function F(){let e=new Uint8Array(16);return crypto.getRandomValues(e),Array.from(e).map(e=>e.toString(16).padStart(2,`0`)).join(``)}async function I(e){return i(b(e))}async function L(e){let t=JSON.stringify(e),n=await crypto.subtle.digest(`SHA-256`,new TextEncoder().encode(t));return[...new Uint8Array(n)].map(e=>e.toString(16).padStart(2,`0`)).join(``)}export{p as C,n as D,i as E,e as O,f as S,l as T,b as _,D as a,d as b,S as c,I as d,w as f,y as g,O as h,j as i,t as k,A as l,N as m,P as n,x as o,E as p,M as r,L as s,v as t,F as u,k as v,c as w,u as x,_ as y};