const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser.esm-CoS-dwBB.js","assets/index-DyQYnTeu.js","assets/index-BjumX9GF.css"])))=>i.map(i=>d[i]);
import{Vr as e}from"./index-DyQYnTeu.js";function t(e){return typeof e==`object`&&!!e&&Object.keys(e).length>0}function n(e){return Array.isArray(e)?n(e[0]):typeof e==`string`?e.trim():typeof e==`number`||typeof e==`bigint`?e.toString():``}function r(e){return e?typeof e==`string`?e.trim().length>0:Array.isArray(e)?e.length>0:t(e):!1}async function i(e){if(typeof fetch!=`function`)return e[0]??``;for(let t of e)try{if((await fetch(t,{method:`HEAD`})).ok)return t}catch{}return e[0]??``}async function a(e){if(typeof fetch!=`function`)return null;let r=n(e.poseidonHash);if(!r)return null;try{let n=await fetch(`/api/proof/sigil`,{method:`POST`,cache:`no-store`,headers:{"Content-Type":`application/json`},body:JSON.stringify({poseidonHash:r})});if(!n.ok)return null;let i=await n.json();if(!i||!t(i)||!i.zkProof||!i.zkPublicInputs)return null;let a={scheme:`groth16-poseidon`,api:`/api/proof/sigil`,explorer:`/keystream/hash/${r}`,...e.proofHints??{},...i.proofHints??{}};return{proof:i.zkProof,proofHints:a,zkPublicInputs:Array.isArray(i.zkPublicInputs)?i.zkPublicInputs.map(e=>String(e)):[r]}}catch{return null}}async function o(){let t=e=>typeof e==`object`&&!!e&&`fullProve`in e&&typeof e.fullProve==`function`;if(typeof window<`u`&&t(window.snarkjs?.groth16))return window.snarkjs.groth16;let n=await e(()=>import(`./browser.esm-CoS-dwBB.js`),__vite__mapDeps([0,1,2])).catch(()=>null),r=n?.groth16??n?.default?.groth16;return t(r)?r:null}async function s(e){if(e)return e;if(typeof window<`u`){let e=window;if(e.SIGIL_ZK_VKEY)return e.SIGIL_ZK_VKEY}if(typeof fetch!=`function`)return null;for(let e of[`/zk/sigil.vkey.json`,`/sigil.vkey.json`])try{let t=await fetch(e,{cache:`no-store`});if(!t.ok)continue;return await t.json()}catch{}return null}async function c(e){let t=n(e.poseidonHash);if(!t)return null;let c=typeof fetch==`function`;if(c){let n=await a({poseidonHash:t,proofHints:e.proofHints,payloadHashHex:e.payloadHashHex});if(n)return n;throw Error(`ZK proof API unavailable`)}let l=await o();if(!l?.fullProve)return null;let u=await i([`/zk/sigil.wasm`,`/sigil.wasm`]),d=await i([`/zk/sigil.zkey`,`/sigil.zkey`]),f={poseidonHash:t};try{let{proof:n,publicSignals:i}=await l.fullProve(f,u,d);if(!r(n))return null;let a=i?.[0];if(String(a??``)!==t)throw Error(`ZK public input mismatch`);if(typeof l.verify!=`function`)throw Error(`ZK verifier unavailable`);let o=await s(e.vkey);if(!o)throw Error(`ZK verifying key missing`);if(!await l.verify(o,i,n))throw Error(`ZK proof failed verification`);return{proof:n,proofHints:{scheme:`groth16-poseidon`,api:`/api/proof/sigil`,explorer:`/keystream/hash/${t}`,...e.proofHints??{}},zkPublicInputs:i}}catch(n){if(n instanceof Error){let e=n.message;if(e.includes(`ZK public input mismatch`)||e.includes(`ZK proof failed verification`))throw n}return c?null:a({poseidonHash:t,proofHints:e.proofHints,payloadHashHex:e.payloadHashHex})}}export{c as t};