import{E as e,O as t,k as n}from"./sigilUtils-B63ZJyAr.js";function r(e,t){let n=e.match(RegExp(`${t}="([^"]+)"`,`i`));return n?n[1]:void 0}function i(e,t){let n=r(e,t);if(!n)return;let i=Number(n);return Number.isFinite(i)?i:void 0}function a(e){try{let t=new DOMParser().parseFromString(e,`image/svg+xml`).querySelector(`metadata`);return t?t.textContent??null:null}catch{return null}}async function o(e){let t=await e.text(),n={},o=a(t);if(o)try{n=JSON.parse(o)}catch{}if(n.pulse??=i(t,`data-pulse`),n.beat??=i(t,`data-beat`),n.stepIndex??=i(t,`data-step-index`),n.frequencyHz??=(()=>{let e=r(t,`data-frequency-hz`);return e?Number(e):void 0})(),n.chakraGate??=r(t,`data-chakra-gate`),!n.chakraDay){let e=r(t,`data-harmonic-day`)||r(t,`data-chakra-day`);e&&(n.chakraDay=e)}n.kaiSignature??=r(t,`data-kai-signature`),n.userPhiKey??=r(t,`data-phi-key`);let s=!n[`@context`]||n[`@context`]===`https://schema.phi.network/sigil/v1`,c=!n.type||n.type===`application/phi.kairos.sigil+svg`;return{text:t,meta:n,contextOk:s,typeOk:c}}async function s(t,n){let r=new Image;r.crossOrigin=`anonymous`,r.src=t,await r.decode();let i=document.createElement(`canvas`);i.width=r.width,i.height=r.height;let a=i.getContext(`2d`);if(!a)throw Error(`Canvas 2D context unavailable`);a.drawImage(r,0,0);let{data:o}=a.getImageData(Math.floor(r.width/2),Math.floor(r.height/2),1,1),s=[o[0],o[1],o[2]];return{sig:(await e(`${n}-2:3-${s.join(`,`)}`)).slice(0,32),rgb:s}}async function c(e,t){let n=await fetch(e).then(e=>e.text()),r=JSON.stringify(t,null,2),i=n.match(/<metadata[^>]*>/i)?n.replace(/<metadata[^>]*>[\s\S]*?<\/metadata>/i,`<metadata>${r}</metadata>`):n.replace(/<svg([^>]*)>/i,`<svg$1><metadata>${r}</metadata>`);return`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(i)))}`}async function l(e,t=1024){let n=new Image;await new Promise((t,r)=>{n.onload=()=>t(),n.onerror=r,n.src=e});let r=document.createElement(`canvas`);r.width=t,r.height=t;let i=r.getContext(`2d`);if(!i)throw Error(`Canvas unsupported`);return i.clearRect(0,0,t,t),i.drawImage(n,0,0,t,t),await new Promise((e,t)=>r.toBlob(n=>n?e(n):t(Error(`PNG encode failed`)),`image/png`))}export{l as i,c as n,o as r,s as t};