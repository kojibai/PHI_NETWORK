import{m as e,u as t}from"./kai_pulse-DWvpfws5.js";var n=(e,t,n)=>{let r=Math.floor(e);return r<t?t:r>n?n:r},r=250,i=2**31-1;function a(t){return t===`pulse`?e:e*484}function o(e){let t=e.pauseWhenHidden!==!1,o=n(n(e.every,1,1e6)*a(e.unit),r,i),s=!1,c=null,l=()=>{c!==null&&window.clearTimeout(c),c=null},u=e=>{if(s)return;let t=n(e,r,i);c=window.setTimeout(()=>void d(),t)},d=async()=>{if(!s){if(t&&document.visibilityState!==`visible`){u(o);return}try{await e.onTick()}finally{u(o)}}};u(o);let f=()=>{document.visibilityState===`visible`&&(l(),u(Math.min(o,1e3)))};return document.addEventListener(`visibilitychange`,f,{passive:!0}),{stop:()=>{s=!0,l(),document.removeEventListener(`visibilitychange`,f)}}}const s=[1,2,3,5,8,13,21,34];function c(e){let t=e.pauseWhenHidden!==!1,o=n(typeof e.maxIndex==`number`?e.maxIndex:s.length-1,0,s.length-1),c=a(e.unit),l=!1,u=null,d=0,f=()=>{u!==null&&window.clearTimeout(u),u=null},p=()=>{if(l)return;let e=n((s[d]??1)*c,r,i);u=window.setTimeout(()=>{m()},e)},m=async()=>{if(!l){if(t&&document.visibilityState!==`visible`){p();return}try{await e.work(),d=0,e.onSuccess?.()}catch{d=Math.min(d+1,o),e.onFailure?.()}p()}};p();let h=()=>{document.visibilityState===`visible`&&(f(),e.work().catch(()=>{}),p())};return document.addEventListener(`visibilitychange`,h,{passive:!0}),{stop:()=>{l=!0,f(),document.removeEventListener(`visibilitychange`,h)}}}export{s as KAI_FIB,o as startKaiCadence,c as startKaiFibBackoff};