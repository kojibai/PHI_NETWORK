import{Ar as e,Cr as t,Dr as n,Er as r,Or as i,Sr as a,Tr as o,Vr as s,Wr as c,_r as l,br as u,hi as d,kr as f,li as p,vr as m,wr as h,xr as g}from"./index-C2ckdEdO.js";var _=d(p(),1);function v(){let[e,t]=(0,_.useState)(null),[n,r]=(0,_.useState)(s),i=(0,_.useRef)(null),a=(0,_.useRef)(null);return(0,_.useEffect)(()=>{let e=null,n=()=>{let e=c(new Date),n=Date.now();if(a.current==null||e.pulse!==a.current)a.current=e.pulse,i.current=n,t(e.pulse),r(s);else{let a=i.current,o=a==null?s:Math.max(0,s-(n-a));t(e.pulse),r(o)}};return e=window.setInterval(n,50),n(),()=>{e!=null&&window.clearInterval(e)}},[]),{pulse:e,msToNextPulse:n}}function y(){return(0,_.useMemo)(()=>async e=>{let t=new TextEncoder().encode(e),n=await crypto.subtle.digest(`SHA-256`,t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,`0`)).join(``)},[])}function b({payload:s,urlSearchParams:c,currentPulse:d}){let[p,v]=(0,_.useState)(null),[b,x]=(0,_.useState)(null),[S,C]=(0,_.useState)(null),w=(0,_.useRef)(null),T=(0,_.useRef)(null),E=y(),D=c?.get(`vpol`)??``;(0,_.useEffect)(()=>{let e=!0;return(async()=>{if(!s||!Number.isFinite(d??NaN)){if(!e)return;v(e=>e===null?e:null),x(e=>e===null?e:null),C(e=>e===null?e:null),w.current=null,T.current=null;return}let{seal:t}=await l({pulse:s.pulse,kaiPulse:s.pulse,beat:s.beat,stepIndex:s.stepIndex,stepsPerBeat:s.stepsPerBeat,seriesSize:s.seriesSize,quality:s.quality,creatorVerified:s.creatorVerified,creatorRep:s.creatorRep,frequencyHz:s.frequencyHz,chakraDay:s.chakraDay,chakraGate:s.chakraGate,transfers:s.transfers,cumulativeTransfers:s.cumulativeTransfers,segments:s.segments,segmentsMerkleRoot:s.segmentsMerkleRoot,transfersWindowRoot:s.transfersWindowRoot,ip:s.ip,kaiSignature:s.kaiSignature,userPhiKey:s.userPhiKey,valuationPolicyId:D||void 0},d,E);if(!e)return;T.current!==t.stamp&&(v(e=>e&&e.stamp===t.stamp?e:t),T.current=t.stamp);let n=t.valuePhi,r=w.current;r!==n&&(x(e=>e===n?e:n),r!=null&&Math.abs(n-r)>1e-9?C(e=>e===`up`&&n>r?e:n>r?`up`:`down`):C(e=>e===null?e:null),w.current=n)})(),()=>{e=!1}},[s,d,D,E]);let O=(0,_.useMemo)(()=>s?.pulse,[s]),k=(0,_.useMemo)(()=>Number.isFinite(O??NaN)?{score:o(O),lines:t(O)}:{score:null,lines:[]},[O]),A=(0,_.useMemo)(()=>{if(!Number.isFinite(O??NaN)||!Number.isFinite(d??NaN))return null;let e=p?.inputs?.pulsesPerBeat?Math.max(1,Math.round(p.inputs.pulsesPerBeat/11)):s?.stepsPerBeat??44,t=p?.inputs?.cadenceRegularity??1,n=p?.inputs?.resonancePhi??.5,r=s?.stepIndex;return a(O,d,{stepsPerBeat:e,cadenceRegularity:t,resonancePhi:n,stepIndexClaimOverride:r})},[O,d,p,s]),j=(0,_.useMemo)(()=>{let e=s?.transfers;return!e||!e.length?[`No closed transfers yet â€” lineage still forming.`]:g(e,{stepsPerBeat:s?.stepsPerBeat??44})},[s]);return{valSeal:p,livePrice:b,priceFlash:S,rarity:k,oscillation:A,lineageNarrative:j,trust:(0,_.useMemo)(()=>p?u(p.inputs):null,[p]),marketTier:(0,_.useMemo)(()=>Number.isFinite(O??NaN)?m(O,p??void 0):null,[O,p]),kairos:(0,_.useMemo)(()=>Number.isFinite(d??NaN)?{window:f(d,144,1,{stepsPerBeat:s?.stepsPerBeat??44})}:{window:[]},[d,s]),visuals:(0,_.useMemo)(()=>{if(!p||!Number.isFinite(O??NaN))return{spiralSVG:null,scrollSVG:null,scrollText:null,scrollHTML:null};let t=r(O),{scrollSVG:i,scrollText:a}=e(p,{title:`Kai-Sigil Valuation Scroll`});return{spiralSVG:t,scrollSVG:i,scrollText:a,scrollHTML:n(p,{title:`Kai-Sigil Valuation Scroll`})}},[p,O]),audio:(0,_.useMemo)(()=>{if(!Number.isFinite(O??NaN))return{dataURI:null,renderWav:void 0};let{dataURI:e}=i(O,2,44100,{stereo:!0});return{dataURI:e,renderWav:(e=2,t=44100,n)=>i(O,e,t,n)}},[O]),motifSimilarityWith:(0,_.useMemo)(()=>e=>!Number.isFinite(e??NaN)||!Number.isFinite(O??NaN)?null:h(O,e),[O]),helpers:(0,_.useMemo)(()=>({explainRarity:()=>k.lines,explainLineage:()=>j,scanKairos:(e,t,n=1,r)=>f(e,t,n,{stepsPerBeat:r??s?.stepsPerBeat??44}),makeScroll:t=>p?e(p,{title:t??`Kai-Sigil Valuation Scroll`}):null,makeScrollHTML:e=>p?n(p,{title:e}):null,makeSpiral:e=>Number.isFinite(e??O)?r(e??O):null}),[k.lines,j,s,p,O])}}export{v as n,b as t};