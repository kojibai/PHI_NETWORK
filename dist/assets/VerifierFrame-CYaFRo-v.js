import{_ as e,bi as t,c as n,d as r,f as i,g as a,m as o,mi as s,qt as c,s as l,u}from"./index-ChwrPS3I.js";import{t as d}from"./browser-tgLemYHd.js";var f=t(d(),1);async function p(e,t){let n=typeof t==`number`?t:t?.size??160,r=typeof t==`number`?2:t?.margin??2,i=typeof t==`number`?`Q`:t?.ecc??`Q`;return(0,f.toDataURL)(String(e),{width:Math.max(16,Math.floor(n)),margin:r,errorCorrectionLevel:i})}var m=t(s(),1),h=t(c(),1);function g(e,t=10,n=10){return e?e.length<=t+n+3?e:`${e.slice(0,t)}â€¦${e.slice(-n)}`:``}function _(e,t=10,n=10){return e?e.length<=t+n+3?e:`${e.slice(0,t)}â€¦${e.slice(-n)}`:``}async function v(e){try{return typeof navigator>`u`||!navigator.clipboard?.writeText?!1:(await navigator.clipboard.writeText(e),!0)}catch{return!1}}function y(){return(0,h.jsxs)(`svg`,{className:`kv-ic`,viewBox:`0 0 24 24`,"aria-hidden":`true`,focusable:`false`,children:[(0,h.jsx)(`path`,{d:`M14 5h5v5`,fill:`none`,stroke:`currentColor`,strokeWidth:`1.7`,strokeLinecap:`round`,strokeLinejoin:`round`}),(0,h.jsx)(`path`,{d:`M10 14 19 5`,fill:`none`,stroke:`currentColor`,strokeWidth:`1.7`,strokeLinecap:`round`,strokeLinejoin:`round`}),(0,h.jsx)(`path`,{d:`M19 14v4a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h4`,fill:`none`,stroke:`currentColor`,strokeWidth:`1.7`,strokeLinecap:`round`})]})}function b(){return(0,h.jsx)(`span`,{className:`kv-remember`,"aria-hidden":`true`,children:`ðŸ’ `})}function x({pulse:t,kaiSignature:s,phiKey:c,caption:l,chakraDay:d,compact:f=!1,verifierBaseUrl:x}){let[S,C]=(0,m.useState)(`idle`),[w,T]=(0,m.useState)(`idle`),[E,D]=(0,m.useState)(null),[O,k]=(0,m.useState)(null),A=f?92:128,j=f?`kv-verifier kv-verifier--compact`:`kv-verifier`,M=(0,m.useMemo)(()=>({"--qr-size":`${A}px`}),[A]),N=(0,m.useMemo)(()=>{let o=x??i(),l=String(o).replace(/\/+$/,``)||`/verify`,f=typeof s==`string`?s.trim():``,p=e(f),m=u(t,f),h=r(t,f,l),g=a(typeof d==`string`?d:String(d??``)),_=typeof c==`string`?c.trim():``,v=t>0&&f.length>0&&_.length>0&&g?{v:`KPV-1`,pulse:t,chakraDay:g,kaiSignature:f,phiKey:_,verifierSlug:m}:null;return{v:`KVPF-1`,hashAlg:n,canon:`JCS`,verifierUrl:h,verifierBaseUrl:l,verifierSlug:m,pulse:t,chakraDay:g??void 0,kaiSignature:f,kaiSignatureShort:p,phiKey:_,proofCapsule:v,capsuleHash:void 0}},[d,s,c,t,x]),P=N.proofCapsule?N.verifierSlug:null,F=P&&E?.key===P?E.hash:null,I=N.verifierUrl?`${N.verifierUrl}::${A}`:null,L=I&&O?.key===I?O.dataUrl:null;(0,m.useEffect)(()=>{let e=!1,t=N.proofCapsule;if(!t)return;let n=N.verifierSlug;return(async()=>{try{let r=await o(t);e||D({key:n,hash:r})}catch{e||D(null)}})(),()=>{e=!0}},[N.proofCapsule,N.verifierSlug]),(0,m.useEffect)(()=>{let e=!1,t=N.verifierUrl;if(!t)return;let n=`${t}::${A}`;return(async()=>{try{let r=await p(t,{size:A,margin:2,ecc:`M`});e||k({key:n,dataUrl:r})}catch{e||k(null)}})(),()=>{e=!0}},[N.verifierUrl,A]);let R=Number.isFinite(t)&&t>0?String(t):`â€”`,z=typeof l==`string`?l.trim():``,B=g(N.phiKey,f?10:12,f?10:12),V=F?_(F,f?10:12,f?10:12):`â€”`,H=!!N.proofCapsule&&!!F,U=async()=>{C(await v(N.verifierUrl)?`ok`:`error`),window.setTimeout(()=>C(`idle`),1600)},W=async()=>{try{let e=F??void 0,t=N.proofCapsule;!e&&t&&(e=await o(t),D({key:N.verifierSlug,hash:e}));let n={...N,capsuleHash:e};T(await v(JSON.stringify(n,null,2))?`ok`:`error`),window.setTimeout(()=>T(`idle`),1600)}catch{T(`error`),window.setTimeout(()=>T(`idle`),1600)}};return(0,h.jsxs)(`section`,{className:j,"aria-label":`Kai-Sigil verification frame`,"data-role":`verifier-frame`,"data-seal":H?`ok`:`off`,children:[(0,h.jsx)(`div`,{className:`kv-topline`,"aria-hidden":`true`}),(0,h.jsxs)(`div`,{className:`kv-wrap`,children:[(0,h.jsxs)(`div`,{className:`kv-topbar`,"aria-label":`Verifier top bar`,children:[(0,h.jsx)(`div`,{className:`kv-qr-shell`,role:`img`,"aria-label":`QR code for verifier pulse ${R}`,title:`Scan to open verifier`,style:M,children:(0,h.jsx)(`div`,{className:`kv-qr-inner`,children:L?(0,h.jsx)(`img`,{className:`kv-qr-image`,src:L,width:A,height:A,alt:`QR code for verifier pulse ${R}`,loading:`eager`,decoding:`async`}):(0,h.jsxs)(`div`,{className:`kv-qr-fallback`,"aria-label":`QR unavailable`,children:[(0,h.jsx)(`div`,{className:`kv-qr-fallback__mark`,children:`QR`}),(0,h.jsx)(`div`,{className:`kv-qr-fallback__sub`,children:`Open link`})]})})}),(0,h.jsxs)(`div`,{className:`kv-chipbar`,"aria-label":`Seal chips`,children:[(0,h.jsxs)(`div`,{className:H?`kv-chip kv-chip--ok`:`kv-chip`,title:`KPV-1 capsule binding`,children:[(0,h.jsx)(`span`,{className:`kv-chip__dot`,"aria-hidden":`true`}),(0,h.jsx)(`span`,{className:`kv-chip__txt`,children:`KPV-1`})]}),(0,h.jsx)(`div`,{className:`kv-chip`,title:`Hash algorithm`,children:(0,h.jsx)(`span`,{className:`kv-chip__txt`,children:n.toUpperCase()})}),(0,h.jsx)(`div`,{className:`kv-chip`,title:`Canonicalization`,children:(0,h.jsx)(`span`,{className:`kv-chip__txt`,children:`JCS`})}),(0,h.jsx)(`div`,{className:H?`kv-chip kv-chip--status kv-chip--ok`:`kv-chip kv-chip--status`,title:`Seal status`,children:(0,h.jsx)(`span`,{className:`kv-chip__txt`,children:H?`SOVEREIGN SEAL`:`INCOMPLETE`})})]})]}),(0,h.jsxs)(`div`,{className:`kv-body`,children:[(0,h.jsxs)(`header`,{className:`kv-head`,children:[(0,h.jsx)(`h3`,{className:`kv-title`,children:`â˜¤Kai Sigil-Glyph Verifier`}),(0,h.jsx)(`p`,{className:`kv-sub`,children:`Payload-bound proof vessel (capsule). Inhale to affirm this Î¦-Key sealed this moment.`})]}),(0,h.jsxs)(`dl`,{className:`kv-meta`,"aria-label":`Verification fields`,children:[(0,h.jsxs)(`div`,{className:`kv-row`,children:[(0,h.jsx)(`dt`,{className:`kv-k`,children:`â˜¤Kai (Pulse)`}),(0,h.jsx)(`dd`,{className:`kv-v`,children:R})]}),(0,h.jsxs)(`div`,{className:`kv-row`,children:[(0,h.jsx)(`dt`,{className:`kv-k`,children:`â˜¤Kai-Sig`}),(0,h.jsx)(`dd`,{className:`kv-v kv-mono`,children:N.kaiSignatureShort||`â€”`})]}),(0,h.jsxs)(`div`,{className:`kv-row`,children:[(0,h.jsx)(`dt`,{className:`kv-k`,children:`Î¦-Key`}),(0,h.jsx)(`dd`,{className:`kv-v kv-mono`,title:N.phiKey,children:B||`â€”`})]}),(0,h.jsxs)(`div`,{className:`kv-row`,children:[(0,h.jsx)(`dt`,{className:`kv-k`,children:`Spiral (Chakra)`}),(0,h.jsx)(`dd`,{className:`kv-v`,children:N.chakraDay??`â€”`})]}),(0,h.jsxs)(`div`,{className:`kv-row kv-row--wide`,children:[(0,h.jsx)(`dt`,{className:`kv-k`,children:`Vessel Hash`}),(0,h.jsx)(`dd`,{className:`kv-v kv-mono`,title:F??``,children:V})]})]}),z?(0,h.jsxs)(`p`,{className:`kv-caption`,children:[`â€œ`,z,`â€`]}):null,(0,h.jsxs)(`div`,{className:`kv-actions`,"aria-label":`Actions`,children:[(0,h.jsxs)(`a`,{href:N.verifierUrl,target:`_blank`,rel:`noopener noreferrer`,className:`kv-btn kv-btn--primary`,children:[(0,h.jsx)(y,{}),(0,h.jsx)(`span`,{className:`kv-btn__txt`,children:`Open`})]}),(0,h.jsxs)(`button`,{type:`button`,onClick:()=>void U(),className:`kv-btn kv-btn--ghost`,title:`ðŸ’  Remember Path`,children:[(0,h.jsx)(b,{}),(0,h.jsx)(`span`,{className:`kv-btn__txt`,children:S===`ok`?`Remembered`:`Path`})]}),(0,h.jsxs)(`button`,{type:`button`,onClick:()=>void W(),className:`kv-btn kv-btn--ghost`,title:`ðŸ’  Remember Proof`,children:[(0,h.jsx)(b,{}),(0,h.jsx)(`span`,{className:`kv-btn__txt`,children:w===`ok`?`Remembered`:`Proof`})]}),(0,h.jsx)(`div`,{className:`kv-toast`,"aria-live":`polite`,children:w===`error`||S===`error`?`Remember failed`:w===`ok`?`Proof remembered`:S===`ok`?`Link remembered`:``})]}),(0,h.jsxs)(`div`,{className:`kv-url`,"aria-label":`Verifier URL`,children:[(0,h.jsx)(`span`,{className:`kv-url__k`,children:`Verifier:`}),(0,h.jsx)(`span`,{className:`kv-url__v`,children:N.verifierUrl})]})]})]})]})}export{x as t};