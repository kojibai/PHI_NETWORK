const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser.esm-BVczWXo6.js","assets/index-D8YpiXIZ.js","assets/index-BjumX9GF.css"])))=>i.map(i=>d[i]);
import{Br as e}from"./index-D8YpiXIZ.js";function t(e){return typeof e==`object`&&!!e&&Object.keys(e).length>0}function n(e){return e?typeof e==`string`?e.trim().length>0:Array.isArray(e)?e.length>0:t(e):!1}async function r(e){if(typeof fetch!=`function`)return e[0]??``;for(let t of e)try{if((await fetch(t,{method:`HEAD`})).ok)return t}catch{}return e[0]??``}async function i(){if(typeof fetch!=`function`)return null;try{let e=await fetch(`/zk/sigil.artifacts.json`);if(!e.ok)return null;let n=await e.json();if(t(n))return n}catch{return null}return null}async function a(){let t=e=>typeof e==`object`&&!!e&&`fullProve`in e&&typeof e.fullProve==`function`;if(typeof window<`u`&&t(window.snarkjs?.groth16))return window.snarkjs.groth16;let n=await e(()=>import(`./browser.esm-BVczWXo6.js`),__vite__mapDeps([0,1,2])).catch(()=>null),r=n?.groth16??n?.default?.groth16;return t(r)?r:null}async function o(e){if(e)return e;if(typeof window<`u`){let e=window;if(e.SIGIL_ZK_VKEY)return e.SIGIL_ZK_VKEY}if(typeof fetch!=`function`)return null;for(let e of[`/zk/sigil.vkey.json`,`/sigil.vkey.json`])try{let t=await fetch(e,{cache:`no-store`});if(!t.ok)continue;return await t.json()}catch{}return null}async function s(e){let t=e.poseidonHash?.trim();if(!t)return null;let s=await a();if(!s?.fullProve)return null;let c=await r([`/zk/sigil.wasm`,`/sigil.wasm`]),l=await r([`/zk/sigil.zkey`,`/sigil.zkey`]),u={poseidonHash:t,zkPoseidonHash:t,hash:t};try{let{proof:r,publicSignals:i}=await s.fullProve(u,c,l);if(!n(r))return null;let a=i?.[0];if(String(a??``)!==t)throw Error(`ZK public input mismatch`);if(typeof s.verify!=`function`)throw Error(`ZK verifier unavailable`);let d=await o(e.vkey);if(!d)throw Error(`ZK verifying key missing`);if(!await s.verify(d,i,r))throw Error(`ZK proof failed verification`);return{proof:r,proofHints:{scheme:`groth16-poseidon`,api:`/api/proof/sigil`,explorer:`/keystream/hash/${t}`,...e.proofHints??{}},zkPublicInputs:i}}catch(n){if(n instanceof Error){let e=n.message;if(e.includes(`ZK public input mismatch`)||e.includes(`ZK proof failed verification`)||e.includes(`ZK verifier unavailable`)||e.includes(`ZK verifying key missing`))throw n}let r=await i();return r?{proof:r,proofHints:{scheme:`groth16-poseidon`,api:`/api/proof/sigil`,explorer:`/keystream/hash/${t}`,...e.proofHints??{}},zkPublicInputs:[t]}:null}}export{s as t};