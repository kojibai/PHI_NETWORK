const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser.esm-BK4k1-eN.js","assets/index-DSYDyts3.js","assets/index-BjumX9GF.css"])))=>i.map(i=>d[i]);
import{Vr as e}from"./index-DSYDyts3.js";function t(e){return typeof e==`object`&&!!e&&Object.keys(e).length>0}function n(e){return Array.isArray(e)?n(e[0]):typeof e==`string`?e.trim():typeof e==`number`||typeof e==`bigint`?e.toString():``}function r(e){if(!(e instanceof Error))return!1;let t=e.message??``;return t.includes(`Too many values for input signal`)||t.includes(`Not enough values for input signal`)||t.includes(`Signal`)&&t.includes(`not found`)||t.includes(`Not all inputs have been set`)}function i(e){let t=e.trim().replace(/^0x/i,``),n=t.slice(0,32).padStart(32,`0`),r=t.slice(32).padEnd(32,`0`);return{hi:BigInt(`0x${n}`).toString(),lo:BigInt(`0x${r}`).toString()}}function a(e){let t=[];if(e.poseidonHash&&t.push({poseidonHash:e.poseidonHash}),e.payloadHashHex){let{hi:n,lo:r}=i(e.payloadHashHex);t.push({payloadHash:[n,r]}),t.push({payloadHashHi:n,payloadHashLo:r}),t.push({hashHi:n,hashLo:r})}return t.push({}),t}function o(e){return e?typeof e==`string`?e.trim().length>0:Array.isArray(e)?e.length>0:t(e):!1}async function s(e){if(typeof fetch!=`function`)return e[0]??``;for(let t of e)try{if((await fetch(t,{method:`HEAD`})).ok)return t}catch{}return e[0]??``}async function c(e){if(typeof fetch!=`function`)return null;let r=n(e.poseidonHash);if(!r)return null;try{let n=await fetch(`/api/proof/sigil`,{method:`POST`,cache:`no-store`,headers:{"Content-Type":`application/json`},body:JSON.stringify({poseidonHash:r})});if(!n.ok)return null;let i=await n.json();if(!i||!t(i)||!i.zkProof||!i.zkPublicInputs)return null;let a={scheme:`groth16-poseidon`,api:`/api/proof/sigil`,explorer:`/keystream/hash/${r}`,...e.proofHints??{},...i.proofHints??{}};return{proof:i.zkProof,proofHints:a,zkPublicInputs:Array.isArray(i.zkPublicInputs)?i.zkPublicInputs.map(e=>String(e)):[r]}}catch{return null}}async function l(){let t=e=>typeof e==`object`&&!!e&&`fullProve`in e&&typeof e.fullProve==`function`;if(typeof window<`u`&&t(window.snarkjs?.groth16))return window.snarkjs.groth16;let n=await e(()=>import(`./browser.esm-BK4k1-eN.js`),__vite__mapDeps([0,1,2])).catch(()=>null),r=n?.groth16??n?.default?.groth16;return t(r)?r:null}async function u(e){if(e)return e;if(typeof window<`u`){let e=window;if(e.SIGIL_ZK_VKEY)return e.SIGIL_ZK_VKEY}if(typeof fetch!=`function`)return null;for(let e of[`/zk/sigil.vkey.json`,`/sigil.vkey.json`])try{let t=await fetch(e,{cache:`no-store`});if(!t.ok)continue;return await t.json()}catch{}return null}async function d(e){let t=n(e.poseidonHash);if(!t)return null;let i=typeof fetch==`function`;if(i){let n=await c({poseidonHash:t,proofHints:e.proofHints,payloadHashHex:e.payloadHashHex});if(n)return n;throw Error(`ZK proof API unavailable`)}let d=await l();if(!d?.fullProve)return null;let f=await s([`/zk/sigil.wasm`,`/sigil.wasm`]),p=await s([`/zk/sigil.zkey`,`/sigil.zkey`]);try{let n=a({poseidonHash:t,payloadHashHex:e.payloadHashHex}),i=null,s=null;for(let e of n)try{i=await d.fullProve(e,f,p);break}catch(e){if(!r(e))throw e;s=e}if(!i){let t=e.payloadHashHex?`Tried poseidonHash, payloadHash variants, and empty inputs.`:`Tried poseidonHash and empty inputs. Provide payloadHashHex or regenerate matching artifacts.`,n=s instanceof Error?s.message:`ZK input mismatch`;throw Error(`${n} ${t}`.trim())}let{proof:c,publicSignals:l}=i;if(!o(c))return null;let m=l?.[0];if(Array.isArray(l)&&l.length>0&&String(m??``)!==t)throw Error(`ZK public input mismatch`);if(typeof d.verify!=`function`)throw Error(`ZK verifier unavailable`);let h=await u(e.vkey);if(!h)throw Error(`ZK verifying key missing`);if(!await d.verify(h,l,c))throw Error(`ZK proof failed verification`);return{proof:c,proofHints:{scheme:`groth16-poseidon`,api:`/api/proof/sigil`,explorer:`/keystream/hash/${t}`,...e.proofHints??{}},zkPublicInputs:l}}catch(n){if(n instanceof Error){let e=n.message;if(e.includes(`ZK public input mismatch`)||e.includes(`ZK proof failed verification`))throw n}return i?null:c({poseidonHash:t,proofHints:e.proofHints,payloadHashHex:e.payloadHashHex})}}export{d as t};