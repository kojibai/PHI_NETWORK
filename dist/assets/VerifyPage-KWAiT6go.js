import{Rr as e,Wr as t,a as n,bt as r,c as i,s as a,st as o}from"./index-CwFuFhGx.js";import{a as s,c,i as l,l as u,n as d,s as f,t as p,u as m}from"./verifierProof-Dzd7zadT.js";import"./prop-types-C5dU9_9C.js";import{t as h}from"./VerifierFrame-CaGc-Rh_.js";var g=t(e(),1);function _(e){let t=decodeURIComponent(e||``).trim(),n=t.match(/^(\d+)-([A-Za-z0-9]+)$/);if(!n)return{raw:t,pulse:null,shortSig:null};let r=Number(n[1]);return{raw:t,pulse:Number.isFinite(r)&&r>0?r:null,shortSig:n[2]?String(n[2]):null}}function v(e,t){return e.length<=t?e:e.slice(0,t)}async function y(e,t){try{let n=a(t),r=(n.kaiSignature??``).trim();if(!r)return{status:`error`,message:`No kaiSignature found in the SVG metadata.`,slug:e,embedded:n};let i=await o(r),s=(n.phiKey??``).trim(),c=n.pulseExact,l=c&&Number.isFinite(Number(c))?Number(c):n.pulse,u={hasSignature:!0,slugPulseMatches:e.pulse==null||l==null?null:e.pulse===l,slugShortSigMatches:e.shortSig==null?null:e.shortSig===v(r,e.shortSig.length),derivedPhiKeyMatchesEmbedded:s.length===0?null:i===s};return u.slugPulseMatches===!1||u.slugShortSigMatches===!1||u.derivedPhiKeyMatchesEmbedded===!1?{status:`error`,message:`Verification failed: one or more checks did not match.`,slug:e,embedded:n,derivedPhiKey:i,checks:u}:{status:`ok`,slug:e,embedded:{...n,pulse:l??n.pulse,phiKey:s.length>0?s:i},derivedPhiKey:i,checks:u}}catch(t){return{status:`error`,message:t instanceof Error?t.message:`Verification failed.`,slug:e}}}var b=t(r(),1);function x(e){if(e==null)return`—`;if(typeof e==`string`)return e;try{return JSON.stringify(e,null,2)}catch{return String(e)}}function S(){if(typeof window>`u`)return``;let e=window.location.pathname||``,t=window.location.hash||``,n=e.match(/\/verify\/([^/?#]+)/);if(n&&n[1])return n[1];let r=t.match(/\/verify\/([^/?#]+)/);return r&&r[1]?r[1]:``}async function C(e){return await new Promise((t,n)=>{let r=new FileReader;r.onerror=()=>n(Error(`Failed to read file.`)),r.onload=()=>t(String(r.result??``)),r.readAsText(e)})}function w(){let e=(0,g.useMemo)(()=>S(),[]),t=(0,g.useMemo)(()=>_(e),[e]),[r,a]=(0,g.useState)(``),[o,p]=(0,g.useState)({status:`idle`}),[v,w]=(0,g.useState)(!1),[T,E]=(0,g.useState)(null),[D,O]=(0,g.useState)(``),[k,A]=(0,g.useState)(``),[j,M]=(0,g.useState)(``),[N,P]=(0,g.useState)(null),[F,I]=(0,g.useState)(``),[L,R]=(0,g.useState)(null),[z,B]=(0,g.useState)(null),V=(0,g.useMemo)(()=>N||(o.status!==`ok`||!o.embedded.zkProof&&!o.embedded.zkPublicInputs&&!o.embedded.zkPoseidonHash&&!o.embedded.proofHints?null:{zkPoseidonHash:o.embedded.zkPoseidonHash,zkProof:o.embedded.zkProof,zkPublicInputs:o.embedded.zkPublicInputs,proofHints:o.embedded.proofHints}),[N,o]),H=(0,g.useMemo)(()=>V?.zkProof?x(V.zkProof):``,[V]),U=(0,g.useMemo)(()=>V?.proofHints?x(V.proofHints):``,[V]),W=(0,g.useMemo)(()=>V?.zkPublicInputs?x(V.zkPublicInputs):``,[V]),G=(0,g.useMemo)(()=>({pulse:t.pulse??0,kaiSignature:t.shortSig??`unknown-signature`,phiKey:`—`}),[t.pulse,t.shortSig]),K=(0,g.useMemo)(()=>T?s(T.pulse,T.kaiSignature):``,[T]),q=(0,g.useCallback)(async()=>{let e=r.trim();if(!e){p({status:`error`,message:`Paste the sealed SVG text or upload the sealed SVG file first.`,slug:t});return}w(!0);try{p(await y(t,e))}finally{w(!1)}},[t,r]),J=(0,g.useCallback)(async(e,t)=>{if(e)try{if(!navigator.clipboard?.writeText){I(`Clipboard unavailable. Use manual copy.`);return}await navigator.clipboard.writeText(e),I(`${t} copied.`)}catch(e){I(`Copy failed. Use manual copy.`),console.error(e)}},[]);g.useEffect(()=>{let e=!0;return(async()=>{if(o.status!==`ok`){E(null),O(``),A(``),M(``),P(null),I(``);return}let t=o.embedded.kaiSignature??``,n=o.embedded.pulse??o.slug.pulse??0,a={v:`KPV-1`,pulse:n,chakraDay:m(o.embedded.chakraDay??``)??`Crown`,kaiSignature:t,phiKey:o.derivedPhiKey,verifierSlug:l(n,t)},s=await u(r),d=i(r),p=d?.proofCapsule??a,h=await c(p),g=await f(h,s);e&&(E(p),A(s),O(h),M(g),P(d))})(),()=>{e=!1}},[o,t.raw,r]),g.useEffect(()=>{let e=!0;return(async()=>{if(!V?.zkProof||!V?.zkPublicInputs){e&&R(null);return}if(!z)try{let t=await fetch(`/zk/verification_key.json`,{cache:`no-store`});if(!t.ok)return;let n=await t.json();if(!e)return;B(n)}catch{return}let t=typeof V.zkPublicInputs==`string`?(()=>{try{return JSON.parse(V.zkPublicInputs)}catch{return[V.zkPublicInputs]}})():V.zkPublicInputs,r=await n({proof:V.zkProof,publicSignals:t,vkey:z??void 0,fallbackVkey:z??void 0});e&&R(r)})(),()=>{e=!1}},[V,z]);let Y=(0,g.useCallback)(async e=>{if(!e.name.toLowerCase().endsWith(`.svg`)){p({status:`error`,message:`Upload a sealed .svg (this verifier reads embedded <metadata> JSON).`,slug:t});return}a(await C(e)),p({status:`idle`})},[t]);return(0,b.jsxs)(`div`,{className:`verify-page`,children:[(0,b.jsxs)(`header`,{className:`verify-hero`,children:[(0,b.jsx)(`h1`,{className:`verify-title`,children:`Kai-Sigil Verifier`}),(0,b.jsx)(`p`,{className:`verify-subtitle`,children:`Open a sealed memory and verify its human origin by Kai Signature → Φ-Key.`}),(0,b.jsxs)(`div`,{className:`verify-slug`,children:[(0,b.jsx)(`span`,{className:`verify-slug-label`,children:`Link:`}),(0,b.jsxs)(`code`,{className:`verify-slug-value`,children:[`/verify/`,t.raw||`—`]})]})]}),(0,b.jsxs)(`main`,{className:`verify-main`,children:[(0,b.jsxs)(`section`,{className:`verify-card`,children:[(0,b.jsx)(`h2`,{className:`verify-card-title`,children:`1) Provide the sealed post`}),(0,b.jsxs)(`div`,{className:`verify-upload-row`,children:[(0,b.jsxs)(`label`,{className:`verify-upload`,children:[(0,b.jsx)(`input`,{type:`file`,accept:`.svg,image/svg+xml`,onChange:e=>{let t=e.currentTarget.files?.[0];t&&Y(t),e.currentTarget.value=``}}),`Upload sealed SVG`]}),(0,b.jsx)(`button`,{type:`button`,className:`verify-btn`,onClick:()=>void q(),disabled:v,children:v?`Verifying…`:`Verify`})]}),(0,b.jsx)(`textarea`,{className:`verify-textarea`,value:r,onChange:e=>{a(e.currentTarget.value),p({status:`idle`})},placeholder:`Or paste the sealed SVG text here (must include <metadata>{...}</metadata> with kaiSignature + pulse + userPhiKey/phiKey).`,spellCheck:!1})]}),(0,b.jsxs)(`section`,{className:`verify-card`,children:[(0,b.jsx)(`h2`,{className:`verify-card-title`,children:`2) Proof capsule`}),o.status===`ok`?(0,b.jsx)(h,{pulse:o.embedded.pulse??t.pulse??0,kaiSignature:o.embedded.kaiSignature??t.shortSig??`unknown`,phiKey:o.derivedPhiKey,chakraDay:o.embedded.chakraDay,compact:!1}):(0,b.jsx)(h,{pulse:G.pulse,kaiSignature:G.kaiSignature,phiKey:G.phiKey,compact:!1}),(0,b.jsx)(`div`,{className:`verify-status`,children:o.status===`idle`?(0,b.jsx)(`p`,{className:`verify-muted`,children:`Upload/paste a sealed SVG, then click Verify.`}):o.status===`ok`?(0,b.jsxs)(`div`,{className:`verify-ok`,children:[(0,b.jsx)(`div`,{className:`verify-badge verify-badge--ok`,children:`Verified`}),(0,b.jsxs)(`p`,{className:`verify-line`,children:[`Sealed by Φ-Key: `,(0,b.jsx)(`code`,{children:o.derivedPhiKey})]}),(0,b.jsxs)(`ul`,{className:`verify-checks`,children:[(0,b.jsxs)(`li`,{children:[`slug pulse match:`,` `,(0,b.jsx)(`strong`,{children:o.checks.slugPulseMatches===null?`n/a`:String(o.checks.slugPulseMatches)})]}),(0,b.jsxs)(`li`,{children:[`slug shortSig match:`,` `,(0,b.jsx)(`strong`,{children:o.checks.slugShortSigMatches===null?`n/a`:String(o.checks.slugShortSigMatches)})]}),(0,b.jsxs)(`li`,{children:[`derived Φ-Key matches embedded:`,` `,(0,b.jsx)(`strong`,{children:o.checks.derivedPhiKeyMatchesEmbedded===null?`n/a (embed omitted phiKey)`:String(o.checks.derivedPhiKeyMatchesEmbedded)})]})]}),T?(0,b.jsxs)(`div`,{className:`verify-proof`,children:[(0,b.jsx)(`h3`,{className:`verify-proof-title`,children:`3) Proof bundle (capsule + SVG)`}),(0,b.jsx)(`p`,{className:`verify-proof-note`,children:`Deterministic capsule hash (capsuleHash) + SVG hash (svgHash) → bundleHash.`}),(0,b.jsxs)(`div`,{className:`verify-proof-row`,children:[(0,b.jsx)(`span`,{className:`verify-proof-label`,children:`Hash algorithm`}),(0,b.jsx)(`code`,{className:`verify-proof-code`,children:d}),(0,b.jsx)(`button`,{type:`button`,className:`verify-copy-btn`,onClick:()=>void J(d,`Hash algorithm`),children:`Copy`})]}),(0,b.jsxs)(`div`,{className:`verify-proof-row`,children:[(0,b.jsx)(`span`,{className:`verify-proof-label`,children:`Canonicalization`}),(0,b.jsx)(`code`,{className:`verify-proof-code`,children:`JCS`}),(0,b.jsx)(`button`,{type:`button`,className:`verify-copy-btn`,onClick:()=>void J(`JCS`,`Canonicalization`),children:`Copy`})]}),(0,b.jsxs)(`div`,{className:`verify-proof-row`,children:[(0,b.jsx)(`span`,{className:`verify-proof-label`,children:`Verifier URL`}),(0,b.jsx)(`code`,{className:`verify-proof-code`,children:K||`—`}),(0,b.jsx)(`button`,{type:`button`,className:`verify-copy-btn`,onClick:()=>void J(K,`Verifier URL`),disabled:!K,children:`Copy`})]}),(0,b.jsxs)(`div`,{className:`verify-proof-row`,children:[(0,b.jsx)(`span`,{className:`verify-proof-label`,children:`SVG hash`}),(0,b.jsx)(`code`,{className:`verify-proof-code`,children:k}),(0,b.jsx)(`button`,{type:`button`,className:`verify-copy-btn`,onClick:()=>void J(k,`SVG hash`),children:`Copy`})]}),(0,b.jsxs)(`div`,{className:`verify-proof-row`,children:[(0,b.jsx)(`span`,{className:`verify-proof-label`,children:`Capsule hash`}),(0,b.jsx)(`code`,{className:`verify-proof-code`,children:D}),(0,b.jsx)(`button`,{type:`button`,className:`verify-copy-btn`,onClick:()=>void J(D,`Capsule hash`),children:`Copy`})]}),(0,b.jsxs)(`div`,{className:`verify-proof-row`,children:[(0,b.jsx)(`span`,{className:`verify-proof-label`,children:`Bundle hash`}),(0,b.jsx)(`code`,{className:`verify-proof-code`,children:j}),(0,b.jsx)(`button`,{type:`button`,className:`verify-copy-btn`,onClick:()=>void J(j,`Bundle hash`),children:`Copy`})]}),V?.zkPoseidonHash&&(0,b.jsxs)(`div`,{className:`verify-proof-row`,children:[(0,b.jsx)(`span`,{className:`verify-proof-label`,children:`ZK Poseidon hash`}),(0,b.jsx)(`code`,{className:`verify-proof-code`,children:V.zkPoseidonHash}),(0,b.jsx)(`button`,{type:`button`,className:`verify-copy-btn`,onClick:()=>void J(V.zkPoseidonHash??``,`ZK Poseidon hash`),children:`Copy`})]}),H&&(0,b.jsxs)(`div`,{className:`verify-proof-row`,children:[(0,b.jsx)(`span`,{className:`verify-proof-label`,children:`ZK proof`}),(0,b.jsx)(`code`,{className:`verify-proof-code`,children:H}),(0,b.jsx)(`button`,{type:`button`,className:`verify-copy-btn`,onClick:()=>void J(H,`ZK proof`),children:`Copy`})]}),W&&(0,b.jsxs)(`div`,{className:`verify-proof-row`,children:[(0,b.jsx)(`span`,{className:`verify-proof-label`,children:`ZK public inputs`}),(0,b.jsx)(`code`,{className:`verify-proof-code`,children:W}),(0,b.jsx)(`button`,{type:`button`,className:`verify-copy-btn`,onClick:()=>void J(W,`ZK public inputs`),children:`Copy`})]}),U&&(0,b.jsxs)(`div`,{className:`verify-proof-row`,children:[(0,b.jsx)(`span`,{className:`verify-proof-label`,children:`Proof hints`}),(0,b.jsx)(`code`,{className:`verify-proof-code`,children:U}),(0,b.jsx)(`button`,{type:`button`,className:`verify-copy-btn`,onClick:()=>void J(U,`Proof hints`),children:`Copy`})]}),L!==null&&(0,b.jsxs)(`div`,{className:`verify-proof-row`,children:[(0,b.jsx)(`span`,{className:`verify-proof-label`,children:`Groth16 verify`}),(0,b.jsx)(`code`,{className:`verify-proof-code`,children:L===null?`n/a`:L?`✓ verified`:`✕ invalid`})]}),(0,b.jsx)(`textarea`,{className:`verify-proof-textarea`,readOnly:!0,value:JSON.stringify({hashAlg:d,canon:`JCS`,proofCapsule:T,capsuleHash:D,svgHash:k,bundleHash:j,shareUrl:N?.shareUrl??null,verifierUrl:K,authorSig:N?.authorSig??null,zkPoseidonHash:V?.zkPoseidonHash??null,zkProof:V?.zkProof??null,proofHints:V?.proofHints??null,zkPublicInputs:V?.zkPublicInputs??null},null,2)}),N?(0,b.jsxs)(`ul`,{className:`verify-checks`,children:[(0,b.jsxs)(`li`,{children:[`embedded hashAlg match:`,` `,(0,b.jsx)(`strong`,{children:N.hashAlg?String(N.hashAlg===d):`n/a`})]}),(0,b.jsxs)(`li`,{children:[`embedded canon match:`,` `,(0,b.jsx)(`strong`,{children:N.canon?String(N.canon===`JCS`):`n/a`})]}),(0,b.jsxs)(`li`,{children:[`embedded svgHash match:`,` `,(0,b.jsx)(`strong`,{children:N.svgHash?String(N.svgHash===k):`n/a`})]}),(0,b.jsxs)(`li`,{children:[`embedded capsuleHash match:`,` `,(0,b.jsx)(`strong`,{children:N.capsuleHash?String(N.capsuleHash===D):`n/a`})]}),(0,b.jsxs)(`li`,{children:[`embedded bundleHash match:`,` `,(0,b.jsx)(`strong`,{children:N.bundleHash?String(N.bundleHash===j):`n/a`})]}),(0,b.jsxs)(`li`,{children:[`author signature present:`,` `,(0,b.jsx)(`strong`,{children:N.authorSig?`true`:`false`})]})]}):(0,b.jsx)(`p`,{className:`verify-proof-note`,children:`No embedded proof bundle detected in <metadata id="kai-voh-proof">.`}),F?(0,b.jsx)(`p`,{className:`verify-proof-note`,children:F}):null]}):null]}):(0,b.jsxs)(`div`,{className:`verify-fail`,children:[(0,b.jsx)(`div`,{className:`verify-badge verify-badge--fail`,children:`Not verified`}),(0,b.jsx)(`p`,{className:`verify-line`,children:o.message}),o.checks?(0,b.jsxs)(`ul`,{className:`verify-checks`,children:[(0,b.jsxs)(`li`,{children:[`slug pulse match:`,` `,(0,b.jsx)(`strong`,{children:o.checks.slugPulseMatches===null?`n/a`:String(o.checks.slugPulseMatches)})]}),(0,b.jsxs)(`li`,{children:[`slug shortSig match:`,` `,(0,b.jsx)(`strong`,{children:o.checks.slugShortSigMatches===null?`n/a`:String(o.checks.slugShortSigMatches)})]}),(0,b.jsxs)(`li`,{children:[`derived Φ-Key matches embedded:`,` `,(0,b.jsx)(`strong`,{children:o.checks.derivedPhiKeyMatchesEmbedded===null?`n/a (embed omitted phiKey)`:String(o.checks.derivedPhiKeyMatchesEmbedded)})]})]}):null]})})]})]})]})}export{w as default};