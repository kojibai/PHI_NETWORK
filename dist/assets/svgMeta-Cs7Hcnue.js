import{or as e}from"./index-BUOThiBr.js";import{n as t}from"./kaiMath-C4GPq5jA.js";var n=`http://www.w3.org/2000/svg`,r=`http://www.w3.org/1999/xlink`;function i(e){if(typeof e!=`string`||e.trim()===``)return e;let t=e.replace(/<script[\s\S]*?<\/script>/gi,``);return t=t.replace(/\son[a-z]+\s*=\s*"[^"]*"/gi,``),t=t.replace(/\son[a-z]+\s*=\s*'[^']*'/gi,``),t=t.replace(/\son[a-z]+\s*=\s*[^\s>'"]+/gi,``),t=t.replace(/\s(?:xlink:)?href\s*=\s*"(?:https?:)?\/\/[^"]*"/gi,``),t=t.replace(/\s(?:xlink:)?href\s*=\s*'(?:https?:)?\/\/[^']*'/gi,``),t=t.replace(/<foreignObject[\s\S]*?<\/foreignObject>/gi,``),t}function a(e){let t=i(e),n=new DOMParser().parseFromString(t,`image/svg+xml`).documentElement;if(!n||n.nodeName.toLowerCase()!==`svg`)throw Error(`Invalid SVG`);let r=n.querySelector(`metadata`),a={};if(r&&r.textContent)try{a=JSON.parse(r.textContent)}catch{a={}}return{svg:n,meta:a}}function o(e){e.getAttribute(`xmlns`)||e.setAttribute(`xmlns`,n),e.getAttribute(`xmlns:xlink`)||e.setAttribute(`xmlns:xlink`,r)}function s(e){let t=e.ownerDocument??document,r=e.querySelector(`metadata`);if(r)return r;let i=t.createElementNS(n,`metadata`);return e.insertBefore(i,e.firstChild),i}function c(e,t,r){let i=e.ownerDocument??document,a=e.querySelector(`title`);a||(a=i.createElementNS(n,`title`),e.insertBefore(a,e.firstChild)),a.textContent=t;let o=e.querySelector(`desc`);o||(o=i.createElementNS(n,`desc`),e.insertBefore(o,a.nextSibling)),o.textContent=r}function l(e,t){if(!e.getAttribute(`viewBox`))try{let n=e.viewBox.baseVal;if(n?.width&&n?.height)e.setAttribute(`viewBox`,`${n.x} ${n.y} ${n.width} ${n.height}`);else if(typeof e.getBBox==`function`){let n=e.getBBox();n?.width&&n?.height?e.setAttribute(`viewBox`,`${n.x} ${n.y} ${n.width} ${n.height}`):e.setAttribute(`viewBox`,`0 0 ${t} ${t}`)}else e.setAttribute(`viewBox`,`0 0 ${t} ${t}`)}catch{e.setAttribute(`viewBox`,`0 0 ${t} ${t}`)}e.setAttribute(`width`,String(t)),e.setAttribute(`height`,String(t)),e.setAttribute(`preserveAspectRatio`,`xMidYMid meet`)}function u(e,t){let n=s(e);n.textContent=JSON.stringify(t),o(e);let r=new XMLSerializer().serializeToString(e);return r.startsWith(`<?xml`)?r:`<?xml version="1.0" encoding="UTF-8"?>\n${r}`}var d=e=>typeof e==`number`&&Number.isFinite(e),f=(e,t=0)=>{if(d(e))return e;if(typeof e==`string`&&e.trim()!==``){let n=Number(e);return Number.isFinite(n)?n:t}return t};function p(e){let n=[];if(e.pulse??n.push(`Missing metadata field: pulse`),e.beat??n.push(`Missing metadata field: beat`),e.chakraDay??n.push(`Missing metadata field: chakraDay`),n.length>0)return{ok:!1,errors:n};let r=Number.isFinite(e.stepsPerBeat)?Math.max(1,Number(e.stepsPerBeat)):44,i=Number(e.pulse),a=Number(e.stepIndex),o=Number.isFinite(a)&&a>=0&&a<r?Math.trunc(a):t(i,r),s=typeof e.stepPct==`number`?Math.max(0,Math.min(1,e.stepPct)):(o+1e-9)/r,c=f(e.expiresAtPulse,NaN),l=f(e.exportedAtPulse,NaN),u=typeof e.claimExtendUnit==`string`?String(e.claimExtendUnit).toLowerCase():``,d=u===`steps`?`steps`:u===`breaths`?`breaths`:void 0,p=e.claimExtendAmount!=null&&Number.isFinite(Number(e.claimExtendAmount))?Math.max(0,Math.floor(Number(e.claimExtendAmount))):void 0;return{ok:!0,errors:[],normalized:{pulse:i,beat:Number(e.beat),stepIndex:o,stepPct:s,chakraDay:e.chakraDay,kaiSignature:typeof e.kaiSignature==`string`?e.kaiSignature:void 0,userPhiKey:typeof e.userPhiKey==`string`?e.userPhiKey:void 0,stepsPerBeat:r,provenance:Array.isArray(e.provenance)?e.provenance:void 0,attachment:typeof e.attachment==`object`?e.attachment:void 0,expiresAtPulse:Number.isFinite(c)?c:void 0,canonicalHash:typeof e.canonicalHash==`string`?e.canonicalHash:void 0,transferNonce:typeof e.transferNonce==`string`?e.transferNonce:void 0,exportedAtPulse:Number.isFinite(l)?l:void 0,claimExtendUnit:d,claimExtendAmount:p,zkPoseidonHash:``,zkProof:{pi_a:[``,``,``],pi_b:[[``,``],[``,``],[``,``]],pi_c:[``,``,``]},ownerPubKey:{},ownerSig:``,originalAmount:0,debits:[],totalDebited:0,lineageRoot:null,eternalRecord:``,creatorResolved:``,origin:``,proofHints:{scheme:``,api:``,explorer:``}}}}function m(e,t){try{let{svg:n,meta:r}=a(e),i=!!n.getAttribute(`xmlns`)&&!!n.getAttribute(`xmlns:xlink`),o=!!n.getAttribute(`viewBox`),s=!!n.getAttribute(`width`)&&!!n.getAttribute(`height`),{ok:c,errors:l,normalized:u}=p(r);return i||l.push(`Missing xmlns / xmlns:xlink on <svg>.`),o||l.push(`Missing viewBox on <svg>.`),s||l.push(`Missing width/height on <svg>.`),t&&u?.canonicalHash&&u.canonicalHash!==t&&l.push(`canonicalHash in Î¦key metadata does not match the live glyph hash.`),{ok:l.length===0&&c,errors:l,payload:u??null,meta:r}}catch(e){return{ok:!1,errors:[e instanceof Error&&e.message?e.message:`Invalid SVG`],payload:null,meta:null}}}const h={SVG_NS:n,XLINK_NS:r};export{o as a,i as c,l as i,p as l,s as n,a as o,c as r,u as s,h as t,m as u};