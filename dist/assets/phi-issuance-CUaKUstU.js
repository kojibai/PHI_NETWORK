import{i as e}from"./valuation-5qS9fhyY.js";var t=(1+Math.sqrt(5))/2,n=17491.270421,r=11,i=(e,t,n)=>Math.max(t,Math.min(n,e)),a=(e,t=9)=>Math.round(e*10**t)/10**t;function o(e,t){let n=Math.trunc(Math.max(0,e));return Math.floor(n/r)%Math.max(1,t)}function s(e){return Math.trunc(Math.max(0,e))%r}function c(e,t,n){let r=((e-t)%n+n)%n;return .5*(1+Math.cos(2*Math.PI*r/n))}const l={basePhiPerUsd:.1,adoptionLambda:1/t,premiumGamma:1/t**2,momentBoostMax:1/t**2,sizeScaleUsd:100,sizeMu:1/t**3,sizeCap:1+1/t**2,whaleTaper:{k:1/t**4},streakMaxBoost:1/t**3,lifetimeTiers:[{thresholdUsd:200,boost:.05},{thresholdUsd:1e3,boost:.1},{thresholdUsd:3e3,boost:.16}],holdBonus:{eta:1/t**2,rho:1/t**3,capMultiple:1/t},choir:{windowPulses:242,maxBoost:1/t**3,wStep:.6,wBreath:.4},breath:{maxBoost:1/t**4},festival:{mode:`beatEvery`,interval:13,widthBeats:1,bonus:1/t**4},milestones:{adoption:[{atAdoption:.1,multiplier:.95},{atAdoption:.25,multiplier:.9},{atAdoption:.5,multiplier:1/t},{atAdoption:.75,multiplier:1/t**1.25}],phiTransition:[{atN:18,multiplier:.92},{atN:21,multiplier:.88},{atN:25,multiplier:.82}],combine:`min`,interpolation:`step`},vow:{earlyUnlockPenalty:.5,stewardEpochBeats:55,stewardSpreadBeats:21}};function u(e,t){let n=1;for(let r of t)e>=r.at&&(n=r.multiplier);return n}function d(e,t){if(!t.length)return 1;if(e<=t[0].at)return t[0].multiplier;for(let n=1;n<t.length;n++){let r=t[n-1],i=t[n];if(e<=i.at){let t=(e-r.at)/Math.max(1e-12,i.at-r.at);return r.multiplier+t*(i.multiplier-r.multiplier)}}return t[t.length-1].multiplier}function f(e,t=`min`){return e.length?t===`min`?Math.min(...e):t===`max`?Math.max(...e):e.reduce((e,t)=>e*t,1):1}function p(e,n,r,o){let s=[],c=null,l=e.milestones;if(!l)return{M_milestone:1,next:c};let p=l.interpolation??`step`;if(l.adoption?.length){let e=l.adoption.slice().sort((e,t)=>e.atAdoption-t.atAdoption).map(e=>({at:i(e.atAdoption,0,1),multiplier:e.multiplier})),t=p===`linear`?d(r,e):u(r,e);s.push(t);let n=e.find(e=>e.at>r);n&&(c??={kind:`adoption`,at:n.at,multiplier:n.multiplier})}if(l.pulse?.length){let e=l.pulse.slice().sort((e,t)=>e.atPulse-t.atPulse).map(e=>({at:Math.max(0,Math.trunc(e.atPulse)),multiplier:e.multiplier})),t=p===`linear`?d(n,e):u(n,e);s.push(t);let r=e.find(e=>e.at>n);r&&!c&&(c={kind:`pulse`,at:r.at,multiplier:r.multiplier})}if(l.beat?.length){let e=Math.floor(n/o),t=l.beat.slice().sort((e,t)=>e.atBeat-t.atBeat).map(e=>({at:Math.max(0,Math.trunc(e.atBeat)),multiplier:e.multiplier})),r=p===`linear`?d(e,t):u(e,t);s.push(r);let i=t.find(t=>t.at>e);i&&!c&&(c={kind:`beat`,at:i.at,multiplier:i.multiplier})}if(l.phiTransition?.length){let e=Math.floor(Math.log(Math.max(1,n))/Math.log(t)),r=l.phiTransition.slice().sort((e,t)=>e.atN-t.atN).map(e=>({at:Math.max(1,Math.trunc(e.atN)),multiplier:e.multiplier})),i=p===`linear`?d(e,r):u(e,r);s.push(i);let a=r.find(t=>t.at>e);a&&!c&&(c={kind:`phiTransition`,at:a.at,multiplier:a.multiplier})}return{M_milestone:a(f(s,l.combine??`min`)),next:c}}function m(e,t,n,i){if(!i||!n?.length)return 1;let l=Math.max(1,i.windowPulses),u=e-l,d=e+l,f=n.filter(e=>e.pulse>=u&&e.pulse<=d);if(!f.length)return 1;let p=o(e,t),m=s(e),h=0;for(let e of f){let n=o(e.pulse,t),a=s(e.pulse),l=c(p,n,t),u=c(m,a,r),d=(i.wStep??.5)*l+(i.wBreath??.5)*u;h+=d}let g=h/f.length;return a(1+(i.maxBoost??0)*(2*g-1))}function h(e,t,n){if(!n||t==null)return 1;let i=s(e)/r,o=1-Math.abs((t-i+1)%1-.5)*2;return a(1+(n.maxBoost??0)*(2*o-1))}function g(e,n,r){if(!r)return 1;let i=Math.floor(e/n);if(r.mode===`beatEvery`){let e=Math.max(1,Math.trunc(r.interval)),t=Math.max(0,Math.trunc(r.widthBeats));return a(i%e===0||Math.abs(i%e)<=t||Math.abs(i%e-e)<=t?1+(r.bonus||0):1)}let o=Math.floor(Math.log(Math.max(1,e))/Math.log(t)),s=Math.ceil(t**+o),c=o%Math.max(1,Math.trunc(r.interval))===0,l=Math.max(0,Math.trunc(r.widthBeats)),u=Math.floor(s/n),d=Math.abs(i-u)<=l;return a(c&&d?1+(r.bonus||0):1)}function _(i,o=l){let{unsigned:s}=e(i.meta,i.nowPulse),{premium:c,inputs:u}=s,d=u.adoptionNow,f=u.rarityScore01,_=u.pulsesPerBeat,v=Math.max(0,i.usd||0),y=o.basePhiPerUsd,b=a(Math.exp(-o.adoptionLambda*d)),x=a((1/Math.max(c,1e-9))**o.premiumGamma),S=a(1+o.momentBoostMax*f),C=1+o.sizeMu*Math.log1p(v/Math.max(o.sizeScaleUsd,1)),w=Math.min(C,o.sizeCap),T=o.whaleTaper?1/Math.sqrt(1+o.whaleTaper.k*v):1,E=a(w*T),D=Math.max(0,i.currentStreakDays||0),O=a(1+o.streakMaxBoost*(1-t**+-D)),k=Math.max(0,(i.lifetimeUsdSoFar||0)+v),A=a(1+(o.lifetimeTiers||[]).reduce((e,t)=>k>=t.thresholdUsd?Math.max(e,t.boost):e,0)),j=a(m(i.nowPulse,_/r,i.choirNearby??[],o.choir)),M=a(h(i.nowPulse,i.breathPhase01,o.breath)),N=a(g(i.nowPulse,_,o.festival)),{M_milestone:P,next:F}=p(o,i.nowPulse,d,_),I=a(b*x*S*E*O*A*j*M*N*P),L=a(y*I),R=a(v*L),z=null,B=0,V=0;if(o.holdBonus&&(i.plannedHoldBeats||0)>0){let e=Math.max(0,i.plannedHoldBeats),t=i.nowPulse+e*_;z=Math.trunc(t);let r=R*o.holdBonus.eta*(1-Math.exp(-o.holdBonus.rho*e));B=Math.min(r,R*o.holdBonus.capMultiple);let s=1/(1+Math.max(0,z-i.nowPulse)/n);V=a(B*s)}let H=a(1*c+u.pv_phi),U=a(H+R+V),W=o.vow&&z?{earlyUnlockPenalty:o.vow.earlyUnlockPenalty,stewardEpochBeats:o.vow.stewardEpochBeats,stewardSpreadBeats:o.vow.stewardSpreadBeats}:null;return{phiPerUsd:L,usdPerPhi:L>0?a(1/L):1/0,addPhiNow:R,issuanceMultiplier:I,multipliers:{M_adoption:b,M_premium:x,M_moment:S,sizeMultiplier:E,M_streak:O,M_tier:A,M_choir:j,M_breath:M,M_festival:N,M_milestone:P,M_taper:T},hold:z?{vestAtPulse:z,bonusPhiAtVest:a(B),bonusNowPV:V}:null,vow:W,premium:c,rarityFloor:u.rarityFloor,adoption:d,rarityScore:f,pulsesPerBeat:_,nextMilestone:F,valuePhiBefore:H,valuePhiAfterPV:U,ipEntries:[{atPulse:i.nowPulse,amountPhi:R},...z?[{atPulse:z,amountPhi:a(B)}]:[]]}}export{_ as n,l as t};