var e=`kai-voh-proof`,t=RegExp(`<metadata\\b[^>]*id=["']${e}["'][^>]*>[\\s\\S]*?<\\/metadata>`,`gi`);function n(e){return e.replace(t,``)}function r(e){return n(e)}function i(e){return r(e)}function a(n,r){let i=`<metadata id="${e}" type="application/json"><![CDATA[${JSON.stringify(r)}]]></metadata>`;if(t.lastIndex=0,t.test(n))return t.lastIndex=0,n.replace(t,i);let a=n.lastIndexOf(`</svg>`);return a===-1?`${n}${i}`:`${n.slice(0,a)}${i}${n.slice(a)}`}function o(e){return e===null||typeof e==`string`||typeof e==`number`||typeof e==`boolean`}function s(e){return Number.isFinite(e)?JSON.stringify(e):`null`}function c(e){if(o(e))return typeof e==`number`?s(e):JSON.stringify(e);if(typeof e==`bigint`)throw TypeError(`JCS does not support bigint values.`);if(typeof e==`function`||typeof e==`symbol`||e===void 0)return`null`;if(e&&typeof e==`object`){if(typeof e.toJSON==`function`)return c(e.toJSON());if(Array.isArray(e))return`[${e.map(e=>e===void 0||typeof e==`function`||typeof e==`symbol`?`null`:c(e)).join(`,`)}]`;let t=e,n=Object.keys(t).sort(),r=[];for(let e of n){let n=t[e];n===void 0||typeof n==`function`||typeof n==`symbol`||r.push(`${JSON.stringify(e)}:${c(n)}`)}return`{${r.join(`,`)}}`}return`null`}function l(e){return c(e)}var u=new TextEncoder;function d(e){return typeof e==`string`?u.encode(e):e}async function f(e){let t=d(e),n=await crypto.subtle.digest(`SHA-256`,t.slice().buffer);return new Uint8Array(n)}async function p(e){let t=await f(e);return Array.from(t).map(e=>e.toString(16).padStart(2,`0`)).join(``)}function m(e){let t=``;for(let n of e)t+=String.fromCharCode(n);return btoa(t).replace(/\+/g,`-`).replace(/\//g,`_`).replace(/=+$/g,``)}function h(e){let t=e.replace(/-/g,`+`).replace(/_/g,`/`),n=t.length%4==0?``:`=`.repeat(4-t.length%4),r=atob(`${t}${n}`),i=new Uint8Array(r.length);for(let e=0;e<r.length;e+=1)i[e]=r.charCodeAt(e);return i}const g=`sha256`,_=`JCS`;function v(e){return e.replace(/^\/+|\/+$/g,``)}function y(){try{return`/`}catch{}return`/`}function b(){if(typeof window>`u`)return`/verify`;let e=window.location.origin,t=v(y());return`${e}${t.length>0?`/${t}`:``}/verify`}function x(e){let t=typeof e==`string`?e.trim():``,n=t.length>0?t:`unknown-signature`;return n.length>10?n.slice(0,10):n}function S(e,t){return`${e}-${x(t)}`}function C(e,t,n){return`${(n??b()).replace(/\/+$/,``)}/${encodeURIComponent(S(e,t))}`}var w={root:`Root`,sacral:`Sacral`,solar:`Solar Plexus`,solarp:`Solar Plexus`,solarplexus:`Solar Plexus`,heart:`Heart`,throat:`Throat`,thirdeye:`Third Eye`,crown:`Crown`,krown:`Crown`};function T(e){if(typeof e!=`string`)return;let t=e.trim();if(t)return w[t.toLowerCase().replace(/[\s_-]/g,``)]}function E(e){return l({v:e.v,pulse:e.pulse,chakraDay:e.chakraDay,kaiSignature:e.kaiSignature,phiKey:e.phiKey,verifierSlug:e.verifierSlug})}async function D(e){return await p(E(e))}async function O(e){return await p(i(e))}function k(e){let{bundleHash:t,authorSig:n,...r}=e;return{...r,authorSig:null}}async function A(e){return await p(l(e))}var j=new TextDecoder;function M(e,t){let n=0;for(let r=0;r<t;r+=1)n=n<<8|e.data[e.offset+r];return e.offset+=t,n}function N(e,t){if(t<24)return t;if(t===24)return M(e,1);if(t===25)return M(e,2);if(t===26)return M(e,4);if(t===27){let t=M(e,4),n=M(e,4);return t*2**32+n}throw Error(`Unsupported CBOR length encoding.`)}function P(e){if(e.offset>=e.data.length)throw Error(`Unexpected end of CBOR data.`);let t=e.data[e.offset++],n=t>>5,r=t&31;switch(n){case 0:return N(e,r);case 1:return-1-N(e,r);case 2:{let t=N(e,r),n=e.offset;return e.offset+=t,e.data.slice(n,n+t)}case 3:{let t=N(e,r),n=e.offset;return e.offset+=t,j.decode(e.data.slice(n,n+t))}case 4:{let t=N(e,r),n=[];for(let r=0;r<t;r+=1)n.push(P(e));return n}case 5:{let t=N(e,r),n=new Map;for(let r=0;r<t;r+=1){let t=P(e),r=P(e);n.set(t,r)}return n}case 7:if(r===20)return!1;if(r===21)return!0;if(r===22)return null;throw Error(`Unsupported CBOR simple value.`);default:throw Error(`Unsupported CBOR major type.`)}}function F(e){return P({data:e,offset:0})}var I=`kai:kas1:passkey:`;function L(){return typeof window<`u`&&typeof navigator<`u`&&typeof PublicKeyCredential<`u`&&typeof navigator.credentials?.create==`function`&&typeof navigator.credentials?.get==`function`}function R(e){if(typeof window>`u`)return null;let t=window.localStorage.getItem(`${I}${e}`);if(!t)return null;try{let e=JSON.parse(t);return typeof e?.credId!=`string`||!e.pubKeyJwk?null:e}catch(e){throw Error(`Failed to read passkey cache: ${e instanceof Error?e.message:String(e)}`)}}function z(e,t){typeof window>`u`||window.localStorage.setItem(`${I}${e}`,JSON.stringify(t))}function B(e){if(e.length<37)throw Error(`AuthData too short to contain attested credential data.`);let t=new DataView(e.buffer,e.byteOffset,e.byteLength);if(!(e[32]&64))throw Error(`Attestation missing credential data (AT flag not set).`);let n=37;n+=16;let r=t.getUint16(n,!1);n+=2;let i=e.slice(n,n+r);n+=r;let a=e.slice(n);if(!a.length)throw Error(`Credential public key missing from attestation data.`);return{credentialId:i,credentialPublicKey:a}}function V(e,t){if(e instanceof Map)return e.get(t);if(typeof e==`object`&&e){let n=e;return n[t]??n[String(t)]}}function H(e){if(e instanceof Uint8Array)return e;if(e instanceof ArrayBuffer||Array.isArray(e))return new Uint8Array(e);throw Error(`Invalid COSE coordinate data.`)}function U(e){let t=H(V(e,-2)),n=H(V(e,-3));return{kty:`EC`,crv:`P-256`,x:m(t),y:m(n),ext:!0}}async function W(e){if(!L())throw Error(`WebAuthn is not available in this browser.`);let t=R(e);if(t)return t;let n=(await f(`KAS-1|phiKey|${e}`)).slice(0,16),r=crypto.getRandomValues(new Uint8Array(32)),i=await navigator.credentials.create({publicKey:{challenge:r,rp:{name:`Kai-Voh`,id:window.location.hostname},user:{id:n,name:e,displayName:e},pubKeyCredParams:[{type:`public-key`,alg:-7}],authenticatorSelection:{userVerification:`required`,residentKey:`required`,requireResidentKey:!0},timeout:6e4,attestation:`none`}});if(!i)throw Error(`Passkey creation was canceled or failed.`);let a=i.response,o=F(new Uint8Array(a.attestationObject)),s=o instanceof Map?o.get(`authData`):null;if(!s)throw Error(`Attestation missing authData.`);let c=U(F(B(s instanceof Uint8Array?s:s instanceof ArrayBuffer?new Uint8Array(s):(()=>{throw Error(`Attestation authData is not a byte array.`)})()).credentialPublicKey)),l={credId:m(new Uint8Array(i.rawId)),pubKeyJwk:c};return z(e,l),l}async function G(e,t){if(!L())throw Error(`WebAuthn is not available in this browser.`);let n=R(e);if(!n)throw Error(`No passkey found for this Î¦-Key. Please register first.`);let r=h(n.credId),i=await f(`KAS-1|bundleHash|${t}`),a=i.slice(),o=r.slice(),s=await navigator.credentials.get({publicKey:{challenge:a,allowCredentials:[{id:o,type:`public-key`}],userVerification:`required`}});if(!s)throw Error(`Signature request was canceled or failed.`);let c=s.response;return{v:`KAS-1`,alg:`webauthn-es256`,credId:n.credId,pubKeyJwk:n.pubKeyJwk,challenge:m(i),signature:m(new Uint8Array(c.signature)),authenticatorData:m(new Uint8Array(c.authenticatorData)),clientDataJSON:m(new Uint8Array(c.clientDataJSON))}}function K(e,t){let n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n}function q(e){let t=new ArrayBuffer(e.byteLength);return new Uint8Array(t).set(e),t}function J(e,t){if(e.length<8||e[0]!==48||e[1]+2!==e.length)return null;let n=2;if(e[n]!==2)return null;let r=e[n+1];n+=2;let i=e.slice(n,n+r);if(n+=r,e[n]!==2)return null;let a=e[n+1];n+=2;let o=e.slice(n,n+a),s=i[0]===0?i.slice(1):i,c=o[0]===0?o.slice(1):o;if(s.length>t||c.length>t)return null;let l=new Uint8Array(t*2);return l.set(s,t-s.length),l.set(c,t*2-c.length),l}async function Y(e){return crypto.subtle.importKey(`jwk`,e,{name:`ECDSA`,namedCurve:`P-256`},!1,[`verify`])}async function X(e,t){try{let n=m(await f(`KAS-1|bundleHash|${e}`));if(t.challenge!==n)return!1;let r=null;try{let e=h(t.clientDataJSON),n=new TextDecoder().decode(e);r=JSON.parse(n)}catch{return!1}if(!r||r.challenge!==n)return!1;let i=K(h(t.authenticatorData),await f(h(t.clientDataJSON))),a=h(t.signature),o=await Y(t.pubKeyJwk);if(await crypto.subtle.verify({name:`ECDSA`,hash:`SHA-256`},o,q(a),q(i)))return!0;let s=J(a,32);return s?crypto.subtle.verify({name:`ECDSA`,hash:`SHA-256`},o,q(s),q(i)):!1}catch{return!1}}export{g as a,C as c,D as d,O as f,a as h,_ as i,b as l,x as m,G as n,k as o,T as p,X as r,S as s,W as t,A as u};